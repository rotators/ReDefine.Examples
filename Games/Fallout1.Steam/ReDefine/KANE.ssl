procedure start;
procedure combat;
procedure critter_p_proc;
procedure pickup_p_proc;
procedure talk_p_proc;
procedure destroy_p_proc;
procedure look_at_p_proc;
procedure Kane00;
procedure Kane01;
procedure Kane02;
procedure Kane03;
procedure Kane04;
procedure Kane05;
procedure Kane06;
procedure Kane07;
procedure Kane08;
procedure Kane09;
procedure Kane10;
procedure Kane11;
procedure Kane12;
procedure Kane13;
procedure Kane14;
procedure Kane15;
procedure Kane16;
procedure Kane17;
procedure Kane18;
procedure Kane19;
procedure Kane29;
procedure Kane30;
procedure Kane31;
procedure Kane32;
procedure Kane33;
procedure Kane34;
procedure Kane35;
procedure Kane36;
procedure Kane36a;
procedure Kane37;
procedure Kane38;
procedure Kane39;
procedure Kane40;
procedure Kane41;
procedure Kane41a;
procedure Kane42;
procedure Kane43;
procedure Kane44;
procedure Kane45;
procedure Kane46;
procedure Kane47;
procedure Kane47a;
procedure Kane48;
procedure Kane49;
procedure Kane50;
procedure Kane51;
procedure Kane52;
procedure Kane53;
procedure Kane54;
procedure Kane55;
procedure Kane56;
procedure Kane57;
procedure Kane58;
procedure Kane59;
procedure Kane60;
procedure Kane61;
procedure Kane62;
procedure Kane63;
procedure Kane71;
procedure Kane72;
procedure Kane73;
procedure Kane74;
procedure Kane75;
procedure Kane75a;
procedure Kane76;
procedure Kane77;
procedure Kane78;
procedure Kane79;
procedure Kane80;
procedure Kane81;
procedure Kane82;
procedure Kane83;
procedure Kane84;
procedure Kane85;
procedure Kane86;
procedure Kane87;
procedure Kane88;
procedure Kane89;
procedure Kane90;
procedure Kane91;
procedure Kane92;
procedure Kane93;
procedure Kane93a;
procedure Kane94;
procedure Kane95;
procedure Kane96;
procedure Kane97;
procedure Kane98;
procedure Kane99;
procedure Kane100;
procedure Kane101;
procedure Kane102;
procedure Kane103;
procedure Kane104;
procedure Kane105;
procedure Kane106;
procedure Kane131;
procedure Kane132;
procedure Kane133;
procedure Kane134;
procedure Kane135;
procedure Kane136;
procedure Kane137;
procedure Kane138;
procedure Kane139;
procedure Kane140;
procedure Kane146;
procedure Kane147;
procedure Kane148;
procedure Kane149;
procedure Kane150;
procedure Kane151;
procedure Kane152;
procedure Kane153;
procedure Kane154;
procedure Kane155;
procedure KaneEnd;
procedure KaneEndHostile;
procedure KaneEndNotAcceptedOrDeclined;
procedure KaneEndDeclined;
procedure KaneEndAnnoyed;
procedure KaneEndTakeHike;
procedure KaneEndRefuses;
procedure KaneTravel;
procedure GoToDecker;

variable hostile;
variable Only_Once := 1;
variable travel;

import variable Kane_Ptr;
import variable Decker_Ptr;

procedure get_reaction;
procedure ReactToLevel;
procedure LevelToReact;
procedure UpReact;
procedure DownReact;
procedure BottomReact;
procedure TopReact;
procedure BigUpReact;
procedure BigDownReact;
procedure UpReactLevel;
procedure DownReactLevel;
procedure Goodbyes;

variable exit_line;


procedure start
begin
    if (Only_Once) then begin
        Only_Once := 0;
        Kane_Ptr := self_obj;
        if (map_var(49) == 1) then begin
            set_obj_visibility(self_obj, 1);
        end
        critter_add_trait(self_obj, TRAIT_OBJECT, OBJECT_TEAM_NUM, 38);
        critter_add_trait(self_obj, TRAIT_OBJECT, OBJECT_AI_PACKET, AI_CAIN);
    end
    if (script_action == look_at_proc) then begin
        call look_at_p_proc();
    end
    else begin
        if (script_action == pickup_proc) then begin
            call pickup_p_proc();
        end
        else begin
            if (script_action == talk_proc) then begin
                call talk_p_proc();
            end
            else begin
                if (script_action == critter_proc) then begin
                    call critter_p_proc();
                end
                else begin
                    if (script_action == destroy_proc) then begin
                        call destroy_p_proc();
                    end
                end
            end
        end
    end
end

procedure combat
begin
    hostile := 1;
end

procedure critter_p_proc
begin
    if (hostile) then begin
        hostile := 0;
        attack(dude_obj);
    end
    if (map_var(51) == 1) then begin
        dialogue_system_enter;
    end
    if (travel == 1) then begin
        travel := 0;
        call GoToDecker();
    end
end

procedure pickup_p_proc
begin
    if (source_obj == dude_obj) then begin
        hostile := 1;
    end
end

procedure talk_p_proc
begin
    call get_reaction();
    if (map_var(51) == 1) then begin
        set_map_var(51, 0);
        float_msg(self_obj, mstr(300), FLOAT_MSG_RED);
    end
    else begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
            if (local_var(6) == 0) then begin
                set_local_var(6, 1);
                call Kane61();
            end
            else begin
                if (local_var(6) == 1) then begin
                    set_local_var(6, 2);
                    call Kane62();
                end
                else begin
                    call Kane63();
                end
            end
        end
        else begin
            if (local_var(4) == 0) then begin
                set_local_var(4, 1);
                if (((global_var(GVAR_KILLIAN_DEAD) == 0) and (global_var(GVAR_GIZMO_DEAD) == 0)) == 1) then begin
                    if (((global_var(GVAR_BAD_MONSTER) + global_var(GVAR_GOOD_MONSTER)) >= 25) and ((global_var(GVAR_GOOD_MONSTER) > (2 * global_var(GVAR_BAD_MONSTER))) or (global_var(GVAR_BERSERKER_REPUTATION) == 1))) then begin
                        start_gdialog(594, self_obj, 4, -1, -1);
                        gsay_start;
                        call Kane11();
                        gsay_end;
                        end_dialogue;
                    end
                    else begin
                        if (((global_var(GVAR_BAD_MONSTER) + global_var(GVAR_GOOD_MONSTER)) >= 25) and ((global_var(160) > (3 * global_var(GVAR_GOOD_MONSTER))) or (global_var(GVAR_CHAMPION_REPUTATION) == 1))) then begin
                            start_gdialog(594, self_obj, 4, -1, -1);
                            gsay_start;
                            call Kane15();
                            gsay_end;
                            end_dialogue;
                        end
                        else begin
                            start_gdialog(594, self_obj, 4, -1, -1);
                            gsay_start;
                            call Kane60();
                            gsay_end;
                            end_dialogue;
                        end
                    end
                end
                else begin
                    if (((global_var(GVAR_KILLIAN_DEAD) == 1) == 1) and ((global_var(GVAR_GIZMO_DEAD) == 1) == 0)) then begin
                        start_gdialog(594, self_obj, 4, -1, -1);
                        gsay_start;
                        call Kane12();
                        gsay_end;
                        end_dialogue;
                    end
                    else begin
                        if (((global_var(GVAR_GIZMO_DEAD) == 1) == 1) and ((global_var(GVAR_KILLIAN_DEAD) == 1) == 0)) then begin
                            start_gdialog(594, self_obj, 4, -1, -1);
                            gsay_start;
                            call Kane13();
                            gsay_end;
                            end_dialogue;
                        end
                        else begin
                            if (((global_var(GVAR_KILLIAN_DEAD) == 1) and (global_var(GVAR_GIZMO_DEAD) == 1)) == 1) then begin
                                start_gdialog(594, self_obj, 4, -1, -1);
                                gsay_start;
                                call Kane14();
                                gsay_end;
                                end_dialogue;
                            end
                            else begin
                                start_gdialog(594, self_obj, 4, -1, -1);
                                gsay_start;
                                call Kane60();
                                gsay_end;
                                end_dialogue;
                            end
                        end
                    end
                end
            end
            else begin
                if ((map_var(44) == 1) or (map_var(11) == 1)) then begin
                    call Kane10();
                end
                else begin
                    if (map_var(45) == 2) then begin
                        start_gdialog(594, self_obj, 4, -1, -1);
                        gsay_start;
                        call Kane93();
                        gsay_end;
                        end_dialogue;
                    end
                    else begin
                        if (map_var(45) == 5) then begin
                            start_gdialog(594, self_obj, 4, -1, -1);
                            gsay_start;
                            call Kane100();
                            gsay_end;
                            end_dialogue;
                        end
                        else begin
                            if (map_var(45) == 4) then begin
                                start_gdialog(594, self_obj, 4, -1, -1);
                                gsay_start;
                                call Kane106();
                                gsay_end;
                                end_dialogue;
                            end
                            else begin
                                if ((global_var(GVAR_KILL_MERCHANT) != 2) and (local_var(7) == 0)) then begin
                                    if (map_var(46) == 0) then begin
                                        start_gdialog(594, self_obj, 4, -1, -1);
                                        gsay_start;
                                        call Kane60();
                                        gsay_end;
                                        end_dialogue;
                                    end
                                    else begin
                                        if (map_var(46) == 1) then begin
                                            start_gdialog(594, self_obj, 4, -1, -1);
                                            gsay_start;
                                            call Kane10();
                                            gsay_end;
                                            end_dialogue;
                                        end
                                        else begin
                                            if (map_var(46) == 2) then begin
                                                if (global_var(GVAR_KILL_MERCHANT) == 5) then begin
                                                    start_gdialog(594, self_obj, 4, -1, -1);
                                                    gsay_start;
                                                    call Kane153();
                                                    gsay_end;
                                                    end_dialogue;
                                                end
                                                else begin
                                                    start_gdialog(594, self_obj, 4, -1, -1);
                                                    gsay_start;
                                                    call Kane86();
                                                    gsay_end;
                                                    end_dialogue;
                                                end
                                            end
                                            else begin
                                                if (map_var(46) == 4) then begin
                                                    if (global_var(GVAR_KILL_MERCHANT) == 5) then begin
                                                        start_gdialog(594, self_obj, 4, -1, -1);
                                                        gsay_start;
                                                        call Kane153();
                                                        gsay_end;
                                                        end_dialogue;
                                                    end
                                                    else begin
                                                        start_gdialog(594, self_obj, 4, -1, -1);
                                                        gsay_start;
                                                        call Kane135();
                                                        gsay_end;
                                                        end_dialogue;
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                                else begin
                                    if ((global_var(GVAR_KILL_MERCHANT) == 2) and (local_var(7) == 0)) then begin
                                        if (map_var(46) == 0) then begin
                                            start_gdialog(594, self_obj, 4, -1, -1);
                                            gsay_start;
                                            call Kane71();
                                            gsay_end;
                                            end_dialogue;
                                        end
                                        else begin
                                            if (map_var(46) == 1) then begin
                                                start_gdialog(594, self_obj, 4, -1, -1);
                                                gsay_start;
                                                call Kane79();
                                                gsay_end;
                                                end_dialogue;
                                            end
                                            else begin
                                                if (map_var(46) == 2) then begin
                                                    start_gdialog(594, self_obj, 4, -1, -1);
                                                    gsay_start;
                                                    call Kane89();
                                                    gsay_end;
                                                    end_dialogue;
                                                end
                                                else begin
                                                    if (map_var(46) == 4) then begin
                                                        start_gdialog(594, self_obj, 4, -1, -1);
                                                        gsay_start;
                                                        call Kane87();
                                                        gsay_end;
                                                        end_dialogue;
                                                    end
                                                end
                                            end
                                        end
                                    end
                                    else begin
                                        if ((global_var(GVAR_KILL_JAIN) != 2) and (local_var(7) == 112)) then begin
                                            if (map_var(47) == 0) then begin
                                                start_gdialog(594, self_obj, 4, -1, -1);
                                                gsay_start;
                                                call Kane134();
                                                gsay_end;
                                                end_dialogue;
                                            end
                                            else begin
                                                if (map_var(47) == 2) then begin
                                                    start_gdialog(594, self_obj, 4, -1, -1);
                                                    gsay_start;
                                                    call Kane10();
                                                    gsay_end;
                                                    end_dialogue;
                                                end
                                                else begin
                                                    if (map_var(47) == 3) then begin
                                                        start_gdialog(594, self_obj, 4, -1, -1);
                                                        gsay_start;
                                                        call Kane91();
                                                        gsay_end;
                                                        end_dialogue;
                                                    end
                                                    else begin
                                                        if (map_var(47) == 5) then begin
                                                            start_gdialog(594, self_obj, 4, -1, -1);
                                                            gsay_start;
                                                            call Kane135();
                                                            gsay_end;
                                                            end_dialogue;
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                        else begin
                                            if ((global_var(GVAR_KILL_JAIN) == 2) and (local_var(7) == 112)) then begin
                                                if (map_var(47) == 0) then begin
                                                    start_gdialog(594, self_obj, 4, -1, -1);
                                                    gsay_start;
                                                    call Kane80();
                                                    gsay_end;
                                                    end_dialogue;
                                                end
                                                else begin
                                                    if (map_var(47) == 2) then begin
                                                        start_gdialog(594, self_obj, 4, -1, -1);
                                                        gsay_start;
                                                        call Kane79();
                                                        gsay_end;
                                                        end_dialogue;
                                                    end
                                                    else begin
                                                        if (map_var(47) == 3) then begin
                                                            start_gdialog(594, self_obj, 4, -1, -1);
                                                            gsay_start;
                                                            call Kane90();
                                                            gsay_end;
                                                            end_dialogue;
                                                        end
                                                        else begin
                                                            if (map_var(47) == 5) then begin
                                                                start_gdialog(594, self_obj, 4, -1, -1);
                                                                gsay_start;
                                                                call Kane92();
                                                                gsay_end;
                                                                end_dialogue;
                                                            end
                                                            else begin
                                                                if (map_var(47) == 6) then begin
                                                                    start_gdialog(594, self_obj, 4, -1, -1);
                                                                    gsay_start;
                                                                    call Kane134();
                                                                    gsay_end;
                                                                    end_dialogue;
                                                                end
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end

procedure destroy_p_proc
begin
    if (source_obj == dude_obj) then begin
        if (((global_var(GVAR_BAD_MONSTER) + global_var(GVAR_GOOD_MONSTER)) >= 25) and ((global_var(GVAR_GOOD_MONSTER) > (2 * global_var(GVAR_BAD_MONSTER))) or (global_var(GVAR_BERSERKER_REPUTATION) == 1))) then begin
            set_global_var(GVAR_BERSERKER_REPUTATION, 1);
            set_global_var(GVAR_CHAMPION_REPUTATION, 0);
        end
        if (((global_var(GVAR_BAD_MONSTER) + global_var(GVAR_GOOD_MONSTER)) >= 25) and ((global_var(160) > (3 * global_var(GVAR_GOOD_MONSTER))) or (global_var(GVAR_CHAMPION_REPUTATION) == 1))) then begin
            set_global_var(GVAR_CHAMPION_REPUTATION, 1);
            set_global_var(GVAR_BERSERKER_REPUTATION, 0);
        end
        set_global_var(GVAR_BAD_MONSTER, global_var(GVAR_BAD_MONSTER) + 1);
        if ((global_var(GVAR_BAD_MONSTER) % 6) == 0) then begin
            set_global_var(GVAR_PLAYER_REPUATION, global_var(GVAR_PLAYER_REPUATION) + 1);
        end
    end
    set_map_var(49, 1);
    if ((map_var(49) == 1) and (map_var(50) == 1)) then begin
        set_global_var(GVAR_UNDERGROUND_STATUS, 1);
        set_map_var(11, 1);
        set_map_var(44, 1);
    end
end

procedure look_at_p_proc
begin
    script_overrides;
    display_mstr(100);
end

procedure Kane00
begin
    giq_option(4, NAME, 101, Kane02, NEUTRAL_REACTION);
    giq_option(4, NAME, 102, Kane04, BAD_REACTION);
    giq_option(4, NAME, 104, Kane07, NEUTRAL_REACTION);
    giq_option(4, NAME, 105, KaneEndDeclined, NEUTRAL_REACTION);
    giq_option(-3, NAME, 106, Kane01, NEUTRAL_REACTION);
end

procedure Kane01
begin
    gsay_message(NAME, 107, NEUTRAL_REACTION);
    call KaneEndRefuses();
end

procedure Kane02
begin
    Reply(108);
    giq_option(4, NAME, 109, Kane03, NEUTRAL_REACTION);
    giq_option(4, NAME, 110, Kane06, NEUTRAL_REACTION);
    giq_option(6, NAME, 111, Kane09, NEUTRAL_REACTION);
    giq_option(4, NAME, 112, Kane08, NEUTRAL_REACTION);
end

procedure Kane03
begin
    gsay_message(NAME, 113, NEUTRAL_REACTION);
    call KaneTravel();
end

procedure Kane04
begin
    Reply(114);
    giq_option(4, NAME, 115, Kane02, NEUTRAL_REACTION);
    giq_option(4, NAME, 116, Kane05, BAD_REACTION);
end

procedure Kane05
begin
    if (dude_gender == 0) then begin
        Reply(117);
    end
    else begin
        Reply(118);
    end
    giq_option(4, NAME, 119, KaneEndHostile, BAD_REACTION);
    giq_option(4, NAME, 120, Kane02, NEUTRAL_REACTION);
    giq_option(4, NAME, 121, KaneEndNotAcceptedOrDeclined, NEUTRAL_REACTION);
end

procedure Kane06
begin
    gsay_message(NAME, 123, NEUTRAL_REACTION);
    call KaneEndNotAcceptedOrDeclined();
end

procedure Kane07
begin
    gsay_message(NAME, 124, NEUTRAL_REACTION);
    call KaneEndNotAcceptedOrDeclined();
end

procedure Kane08
begin
    Reply(125);
    giq_option(4, NAME, 126, Kane03, NEUTRAL_REACTION);
    giq_option(4, NAME, 127, KaneEndDeclined, NEUTRAL_REACTION);
    giq_option(4, NAME, 128, Kane06, NEUTRAL_REACTION);
end

procedure Kane09
begin
    Reply(129);
    giq_option(4, NAME, 130, KaneTravel, NEUTRAL_REACTION);
    giq_option(4, NAME, 131, KaneEndDeclined, NEUTRAL_REACTION);
    giq_option(4, NAME, 132, Kane06, NEUTRAL_REACTION);
end

procedure Kane10
begin
    if (local_var(5) < 3) then begin
        set_local_var(5, local_var(5) + 1);
        float_msg(self_obj, mstr(random(133, 136)), FLOAT_MSG_RED);
    end
    else begin
        set_map_var(11, 1);
        set_map_var(45, 4);
        set_map_var(44, 1);
        float_msg(self_obj, mstr(137), FLOAT_MSG_RED);
        call combat();
    end
end

procedure Kane11
begin
    if (dude_gender == 0) then begin
        Reply(138);
    end
    else begin
        Reply(139);
    end
    call Kane00();
end

procedure Kane12
begin
    Reply(140);
    call Kane00();
end

procedure Kane13
begin
    Reply(141);
    call Kane00();
end

procedure Kane14
begin
    if (dude_gender == 0) then begin
        Reply(143);
    end
    else begin
        Reply(142);
    end
    call Kane00();
end

procedure Kane15
begin
    Reply(144);
    call Kane16();
end

procedure Kane16
begin
    if (global_var(GVAR_FIND_WATER_CHIP) != 2) then begin
        giq_option(4, NAME, 145, Kane17, NEUTRAL_REACTION);
    end
    if (global_var(GVAR_DECKER_KNOWN) == 1) then begin
        giq_option(4, NAME, 146, Kane36, NEUTRAL_REACTION);
    end
    else begin
        giq_option(4, NAME, 147, Kane32, NEUTRAL_REACTION);
    end
    giq_option(4, NAME, 151, Kane29, NEUTRAL_REACTION);
    giq_option(4, NAME, 152, KaneEndNotAcceptedOrDeclined, NEUTRAL_REACTION);
    giq_option(-3, NAME, 154, Kane01, NEUTRAL_REACTION);
    giq_option(-3, NAME, 155, Kane01, NEUTRAL_REACTION);
end

procedure Kane17
begin
    Reply(156);
    giq_option(6, NAME, 157, Kane18, NEUTRAL_REACTION);
    giq_option(4, NAME, 158, Kane19, NEUTRAL_REACTION);
    giq_option(4, NAME, 159, Kane16, NEUTRAL_REACTION);
    giq_option(4, NAME, 160, KaneEndNotAcceptedOrDeclined, NEUTRAL_REACTION);
end

procedure Kane18
begin
    Reply(161);
    call Kane16();
end

procedure Kane19
begin
    Reply(162);
    call Kane16();
end

procedure Kane29
begin
    Reply(200);
    giq_option(4, NAME, 201, Kane59, NEUTRAL_REACTION);
    giq_option(4, NAME, 202, Kane31, NEUTRAL_REACTION);
    giq_option(4, NAME, 203, Kane30, NEUTRAL_REACTION);
end

procedure Kane30
begin
    Reply(204);
    call Kane16();
end

procedure Kane31
begin
    gsay_message(NAME, 205, BAD_REACTION);
    call KaneEndRefuses();
end

procedure Kane32
begin
    Reply(206);
    giq_option(4, NAME, 207, Kane33, BAD_REACTION);
    giq_option(4, NAME, 208, Kane35, NEUTRAL_REACTION);
end

procedure Kane33
begin
    Reply(209);
    giq_option(4, NAME, 210, Kane34, BAD_REACTION);
    giq_option(4, NAME, 211, Kane35, NEUTRAL_REACTION);
end

procedure Kane34
begin
    gsay_message(NAME, 212, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane35
begin
    Reply(213);
    call Kane16();
end

procedure Kane36
begin
    Reply(214);
    giq_option(4, NAME, 215, Kane41, NEUTRAL_REACTION);
    giq_option(4, NAME, 216, Kane39, NEUTRAL_REACTION);
    giq_option(4, NAME, 217, Kane36a, NEUTRAL_REACTION);
end

procedure Kane36a
begin
    if (is_success(roll_vs_skill(dude_obj, 14, -15))) then begin
        call Kane37();
    end
    else begin
        call Kane38();
    end
end

procedure Kane37
begin
    if (dude_gender == 0) then begin
        gsay_message(NAME, 218, NEUTRAL_REACTION);
    end
    else begin
        gsay_message(NAME, 219, NEUTRAL_REACTION);
    end
    call KaneTravel();
end

procedure Kane38
begin
    gsay_message(NAME, 220, BAD_REACTION);
    call KaneEndTakeHike();
end

procedure Kane39
begin
    Reply(221);
    giq_option(4, NAME, 222, Kane41, NEUTRAL_REACTION);
    giq_option(4, NAME, 223, Kane40, NEUTRAL_REACTION);
end

procedure Kane40
begin
    gsay_message(NAME, 224, NEUTRAL_REACTION);
    call KaneEndAnnoyed();
end

procedure Kane41
begin
    Reply(225);
    if (map_var(33) == 1) then begin
        giq_option(4, NAME, 226, Kane42, NEUTRAL_REACTION);
    end
    if (map_var(18) == 1) then begin
        giq_option(4, NAME, 227, Kane41a, NEUTRAL_REACTION);
    end
    if (global_var(GVAR_Loxley_known) == 1) then begin
        giq_option(4, NAME, 228, Kane47, NEUTRAL_REACTION);
    end
    giq_option(4, NAME, 229, Kane45, NEUTRAL_REACTION);
    giq_option(4, NAME, 230, Kane44, NEUTRAL_REACTION);
end

procedure Kane41a
begin
    if (map_var(21) == 1) then begin
        call Kane57();
    end
    else begin
        if (is_success(roll_vs_skill(dude_obj, 14, -15))) then begin
            call Kane57();
        end
        else begin
            call Kane58();
        end
    end
end

procedure Kane42
begin
    Reply(231);
    giq_option(4, NAME, 232, Kane43, NEUTRAL_REACTION);
    giq_option(4, NAME, 233, Kane46, NEUTRAL_REACTION);
end

procedure Kane43
begin
    gsay_message(NAME, 234, BAD_REACTION);
    call KaneEndAnnoyed();
end

procedure Kane44
begin
    gsay_message(NAME, 235, BAD_REACTION);
    call KaneEndAnnoyed();
end

procedure Kane45
begin
    gsay_message(NAME, 236, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane46
begin
    gsay_message(NAME, 237, NEUTRAL_REACTION);
    call KaneEndAnnoyed();
end

procedure Kane47
begin
    Reply(238);
    giq_option(4, NAME, 239, Kane47a, NEUTRAL_REACTION);
    giq_option(4, NAME, 240, Kane49, NEUTRAL_REACTION);
    giq_option(4, NAME, 241, KaneEndRefuses, BAD_REACTION);
    giq_option(4, NAME, 242, Kane48, NEUTRAL_REACTION);
end

procedure Kane47a
begin
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
        call Kane50();
    end
    else begin
        call Kane53();
    end
end

procedure Kane48
begin
    gsay_message(NAME, 243, BAD_REACTION);
    call KaneEndRefuses();
end

procedure Kane49
begin
    gsay_message(NAME, 244, NEUTRAL_REACTION);
    call KaneTravel();
end

procedure Kane50
begin
    Reply(245);
    giq_option(4, NAME, 246, Kane51, NEUTRAL_REACTION);
    giq_option(4, NAME, 247, Kane52, NEUTRAL_REACTION);
end

procedure Kane51
begin
    gsay_message(NAME, 248, BAD_REACTION);
    call KaneEndRefuses();
end

procedure Kane52
begin
    gsay_message(NAME, 249, NEUTRAL_REACTION);
    call KaneTravel();
end

procedure Kane53
begin
    Reply(250);
    giq_option(4, NAME, 251, Kane55, NEUTRAL_REACTION);
    giq_option(4, NAME, 252, Kane54, NEUTRAL_REACTION);
    giq_option(4, NAME, 253, Kane56, NEUTRAL_REACTION);
    giq_option(4, NAME, 254, Kane54, NEUTRAL_REACTION);
end

procedure Kane54
begin
    gsay_message(NAME, 255, NEUTRAL_REACTION);
    call KaneEndAnnoyed();
end

procedure Kane55
begin
    gsay_message(NAME, 256, NEUTRAL_REACTION);
    call KaneEndAnnoyed();
end

procedure Kane56
begin
    gsay_message(NAME, 257, NEUTRAL_REACTION);
    call KaneTravel();
end

procedure Kane57
begin
    gsay_message(NAME, 258, NEUTRAL_REACTION);
    call KaneTravel();
end

procedure Kane58
begin
    gsay_message(NAME, 259, BAD_REACTION);
    call KaneEndRefuses();
end

procedure Kane59
begin
    if (dude_gender == 0) then begin
        gsay_message(NAME, 260, GOOD_REACTION);
    end
    else begin
        gsay_message(NAME, 261, GOOD_REACTION);
    end
    call KaneEndNotAcceptedOrDeclined();
end

procedure Kane60
begin
    Reply(262);
    call Kane16();
end

procedure Kane61
begin
    float_msg(self_obj, mstr(263), FLOAT_MSG_RED);
end

procedure Kane62
begin
    float_msg(self_obj, mstr(264), FLOAT_MSG_RED);
end

procedure Kane63
begin
    float_msg(self_obj, mstr(265), FLOAT_MSG_RED);
end

procedure Kane71
begin
    set_map_var(46, 6);
    Reply(278);
    call Kane72();
end

procedure Kane72
begin
    giq_option(4, NAME, 279, Kane73, BAD_REACTION);
    giq_option(4, NAME, 280, Kane74, BAD_REACTION);
    giq_option(4, NAME, 281, Kane78, BAD_REACTION);
end

procedure Kane73
begin
    gsay_message(NAME, 282, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane74
begin
    gsay_message(NAME, 283, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane75
begin
    variable LVar0 := 0;
    variable LVar1 := 0;
    set_map_var(46, 5);
    give_exp_points(300);
    display_msg(message_str(SCRIPT_GENCHAT, 103) + 300 + message_str(SCRIPT_GENCHAT, 104));
    set_global_var(GVAR_PLAYER_REPUATION, global_var(GVAR_PLAYER_REPUATION) - 1);
    LVar1 := item_caps_adjust(dude_obj, 1500);
    Reply(284);
    giq_option(4, NAME, 285, Kane75a, BAD_REACTION);
    giq_option(4, NAME, 286, Kane76, NEUTRAL_REACTION);
    giq_option(4, NAME, 287, Kane77, BAD_REACTION);
    giq_option(-3, NAME, 288, Kane78, BAD_REACTION);
end

procedure Kane75a
begin
    set_map_var(47, 6);
    call KaneEndRefuses();
end

procedure Kane76
begin
    gsay_message(NAME, 289, NEUTRAL_REACTION);
    call KaneTravel();
end

procedure Kane77
begin
    gsay_message(NAME, 290, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane78
begin
    gsay_message(NAME, 291, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane79
begin
    set_map_var(46, 6);
    gsay_message(NAME, 292, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane80
begin
    variable LVar0 := 0;
    variable LVar1 := 0;
    give_exp_points(350);
    display_msg(message_str(SCRIPT_GENCHAT, 103) + 350 + message_str(SCRIPT_GENCHAT, 104));
    set_global_var(GVAR_PLAYER_REPUATION, global_var(GVAR_PLAYER_REPUATION) - 1);
    LVar1 := item_caps_adjust(dude_obj, 1000);
    set_map_var(47, 7);
    Reply(293);
    call Kane81();
end

procedure Kane81
begin
    giq_option(4, NAME, 294, Kane82, BAD_REACTION);
    giq_option(4, NAME, 295, Kane83, BAD_REACTION);
    giq_option(-3, NAME, 296, Kane84, BAD_REACTION);
end

procedure Kane82
begin
    gsay_message(NAME, 297, BAD_REACTION);
    call KaneEndRefuses();
end

procedure Kane83
begin
    gsay_message(NAME, 298, BAD_REACTION);
    call KaneEndRefuses();
end

procedure Kane84
begin
    gsay_message(NAME, 299, BAD_REACTION);
    call KaneEndRefuses();
end

procedure Kane85
begin
    float_msg(self_obj, mstr(300), FLOAT_MSG_RED);
end

procedure Kane86
begin
    variable LVar0 := 0;
    set_map_var(46, 4);
    set_global_var(GVAR_MARK_HUB_4, 1);
    LVar0 := item_caps_adjust(dude_obj, 500);
    gsay_message(NAME, 301, NEUTRAL_REACTION);
end

procedure Kane87
begin
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 2500);
    give_exp_points(600);
    display_msg(message_str(SCRIPT_GENCHAT, 103) + 600 + message_str(SCRIPT_GENCHAT, 104));
    set_global_var(GVAR_PLAYER_REPUATION, global_var(GVAR_PLAYER_REPUATION) - 2);
    set_map_var(46, 5);
    set_local_var(7, 112);
    gsay_message(NAME, 302, NEUTRAL_REACTION);
end

procedure Kane88
begin
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 3500);
    give_exp_points(600);
    display_msg(message_str(SCRIPT_GENCHAT, 103) + 600 + message_str(SCRIPT_GENCHAT, 104));
    set_global_var(GVAR_PLAYER_REPUATION, global_var(GVAR_PLAYER_REPUATION) - 2);
    set_map_var(46, 5);
    set_map_var(47, 5);
    set_local_var(7, 112);
    set_global_var(GVAR_KILL_JAIN, 1);
    gsay_message(NAME, 303, NEUTRAL_REACTION);
end

procedure Kane89
begin
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 3000);
    give_exp_points(600);
    display_msg(message_str(SCRIPT_GENCHAT, 103) + 600 + message_str(SCRIPT_GENCHAT, 104));
    set_global_var(GVAR_PLAYER_REPUATION, global_var(GVAR_PLAYER_REPUATION) - 2);
    set_map_var(46, 5);
    set_local_var(7, 112);
    gsay_message(NAME, 304, NEUTRAL_REACTION);
end

procedure Kane90
begin
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 5000);
    give_exp_points(700);
    display_msg(message_str(SCRIPT_GENCHAT, 103) + 700 + message_str(SCRIPT_GENCHAT, 104));
    set_global_var(GVAR_PLAYER_REPUATION, global_var(GVAR_PLAYER_REPUATION) - 2);
    set_map_var(47, 6);
    gsay_message(NAME, 305, NEUTRAL_REACTION);
    gsay_message(NAME, 306, NEUTRAL_REACTION);
end

procedure Kane91
begin
    variable LVar0 := 0;
    set_global_var(GVAR_MARK_HUB_6, 1);
    LVar0 := item_caps_adjust(dude_obj, 1000);
    set_map_var(47, 5);
    gsay_message(NAME, 308, NEUTRAL_REACTION);
end

procedure Kane92
begin
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 4000);
    give_exp_points(700);
    display_msg(message_str(SCRIPT_GENCHAT, 103) + 700 + message_str(SCRIPT_GENCHAT, 104));
    set_global_var(GVAR_PLAYER_REPUATION, global_var(GVAR_PLAYER_REPUATION) - 2);
    set_map_var(47, 6);
    gsay_message(NAME, 309, NEUTRAL_REACTION);
end

procedure Kane93
begin
    Reply(310);
    giq_option(4, NAME, 311, Kane95, NEUTRAL_REACTION);
    if (((global_var(GVAR_BAD_MONSTER) + global_var(GVAR_GOOD_MONSTER)) >= 25) and ((global_var(GVAR_GOOD_MONSTER) > (2 * global_var(GVAR_BAD_MONSTER))) or (global_var(GVAR_BERSERKER_REPUTATION) == 1))) then begin
        giq_option(4, NAME, 312, Kane148, BAD_REACTION);
    end
    giq_option(4, NAME, 313, Kane93a, NEUTRAL_REACTION);
    giq_option(4, NAME, 314, Kane149, BAD_REACTION);
    giq_option(-3, NAME, 315, Kane94, NEUTRAL_REACTION);
    giq_option(-3, NAME, 316, Kane94, NEUTRAL_REACTION);
end

procedure Kane93a
begin
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
        call Kane151();
    end
    else begin
        call Kane152();
    end
end

procedure Kane94
begin
    gsay_message(NAME, 317, NEUTRAL_REACTION);
    call KaneEndRefuses();
end

procedure Kane95
begin
    Reply(318);
    giq_option(4, NAME, 319, Kane98, BAD_REACTION);
    giq_option(4, NAME, 320, Kane99, BAD_REACTION);
    giq_option(4, NAME, 321, Kane97, BAD_REACTION);
    giq_option(4, NAME, 322, Kane98, BAD_REACTION);
    if (map_var(48) == 1) then begin
        giq_option(4, NAME, 323, Kane96, BAD_REACTION);
    end
end

procedure Kane96
begin
    gsay_message(NAME, 324, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane97
begin
    gsay_message(NAME, 325, BAD_REACTION);
    call KaneEndRefuses();
end

procedure Kane98
begin
    gsay_message(NAME, 326, BAD_REACTION);
    call KaneEndRefuses();
end

procedure Kane99
begin
    gsay_message(NAME, 327, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane100
begin
    Reply(328);
    giq_option(4, NAME, 330, Kane103, BAD_REACTION);
    giq_option(4, NAME, 331, Kane102, NEUTRAL_REACTION);
    giq_option(4, NAME, 332, Kane104, BAD_REACTION);
    giq_option(4, NAME, 333, Kane105, NEUTRAL_REACTION);
    giq_option(4, NAME, 334, Kane101, NEUTRAL_REACTION);
end

procedure Kane101
begin
    gsay_message(NAME, 335, NEUTRAL_REACTION);
    call KaneEnd();
end

procedure Kane102
begin
    gsay_message(NAME, 336, NEUTRAL_REACTION);
    call KaneTravel();
end

procedure Kane103
begin
    gsay_message(NAME, 337, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane104
begin
    gsay_message(NAME, 338, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane105
begin
    gsay_message(NAME, 339, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane106
begin
    Reply(340);
    if (map_var(21) == 1) then begin
        giq_option(4, NAME, 341, Kane57, NEUTRAL_REACTION);
    end
    else begin
        giq_option(4, NAME, 343, Kane132, NEUTRAL_REACTION);
    end
    giq_option(4, NAME, 344, KaneEnd, NEUTRAL_REACTION);
    giq_option(-3, NAME, 345, Kane101, NEUTRAL_REACTION);
end

procedure Kane131
begin
    gsay_message(NAME, random(403, 407), NEUTRAL_REACTION);
    call KaneTravel();
end

procedure Kane132
begin
    gsay_message(NAME, 408, NEUTRAL_REACTION);
    call KaneEndTakeHike();
end

procedure Kane133
begin
    giq_option(4, NAME, 409, Kane131, NEUTRAL_REACTION);
    giq_option(4, NAME, 411, KaneEnd, NEUTRAL_REACTION);
    giq_option(-3, NAME, 412, Kane101, NEUTRAL_REACTION);
end

procedure Kane134
begin
    Reply(413);
    call Kane133();
end

procedure Kane135
begin
    gsay_message(NAME, 415, BAD_REACTION);
end

procedure Kane136
begin
    gsay_message(NAME, 417, BAD_REACTION);
end

procedure Kane137
begin
    gsay_message(NAME, 418, BAD_REACTION);
end

procedure Kane138
begin
    Reply(420);
    giq_option(4, NAME, 423, Kane139, NEUTRAL_REACTION);
    giq_option(4, NAME, 424, KaneEnd, NEUTRAL_REACTION);
    giq_option(-3, NAME, 425, KaneEnd, NEUTRAL_REACTION);
end

procedure Kane139
begin
    Reply(426);
    giq_option(4, NAME, 427, Kane140, NEUTRAL_REACTION);
    giq_option(4, NAME, 428, KaneEndHostile, NEUTRAL_REACTION);
end

procedure Kane140
begin
    gsay_message(NAME, 429, NEUTRAL_REACTION);
end

procedure Kane146
begin
    float_msg(self_obj, mstr(449), FLOAT_MSG_RED);
end

procedure Kane147
begin
    float_msg(self_obj, mstr(451), FLOAT_MSG_RED);
end

procedure Kane148
begin
    gsay_message(NAME, 453, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane149
begin
    gsay_message(NAME, 454, BAD_REACTION);
    call KaneEndHostile();
end

procedure Kane150
begin
    display_mstr(455);
end

procedure Kane151
begin
    gsay_message(NAME, 456, NEUTRAL_REACTION);
    call KaneTravel();
end

procedure Kane152
begin
    gsay_message(NAME, 457, NEUTRAL_REACTION);
    call KaneEndRefuses();
end

procedure Kane153
begin
    Reply(458);
    giq_option(4, NAME, 459, Kane154, NEUTRAL_REACTION);
    giq_option(-3, NAME, 460, Kane154, NEUTRAL_REACTION);
end

procedure Kane154
begin
    Reply(461);
    giq_option(4, NAME, 462, Kane155, NEUTRAL_REACTION);
    giq_option(-3, NAME, 463, Kane155, NEUTRAL_REACTION);
end

procedure Kane155
begin
    gsay_message(NAME, 464, BAD_REACTION);
    call KaneEndHostile();
end

procedure KaneEnd
begin
end

procedure KaneEndHostile
begin
    set_map_var(11, 1);
    set_map_var(44, 1);
    set_map_var(45, 4);
end

procedure KaneEndNotAcceptedOrDeclined
begin
    set_map_var(45, 3);
end

procedure KaneEndDeclined
begin
    set_map_var(45, 2);
end

procedure KaneEndAnnoyed
begin
    set_map_var(45, 6);
end

procedure KaneEndTakeHike
begin
    set_map_var(45, 5);
end

procedure KaneEndRefuses
begin
    set_map_var(45, 4);
    set_map_var(11, 1);
end

procedure KaneTravel
begin
    travel := 1;
end

procedure GoToDecker
begin
    set_map_var(45, 1);
    gfade_out(1000);
    move_to(self_obj, 22526, 1);
    anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(Decker_Ptr)));
    move_to(dude_obj, 23722, 1);
    anim(dude_obj, 1000, rotation_to_tile(dude_tile, tile_num(Decker_Ptr)));
    gfade_in(1000);
end

procedure get_reaction
begin
    if (local_var(2) == 0) then begin
        set_local_var(0, 50);
        set_local_var(1, 2);
        set_local_var(2, 1);
        set_local_var(0, local_var(0) + (5 * dude_charisma) - 25);
        set_local_var(0, local_var(0) + (10 * has_trait(TRAIT_PERK, dude_obj, PERK_presence)));
        if (has_trait(TRAIT_PERK, dude_obj, PERK_cult_of_personality)) then begin
            if (global_var(GVAR_PLAYER_REPUATION) > 0) then begin
                set_local_var(0, local_var(0) + global_var(GVAR_PLAYER_REPUATION));
            end
            else begin
                set_local_var(0, local_var(0) - global_var(GVAR_PLAYER_REPUATION));
            end
        end
        else begin
            if (local_var(3) == 1) then begin
                set_local_var(0, local_var(0) - global_var(GVAR_PLAYER_REPUATION));
            end
            else begin
                set_local_var(0, local_var(0) + global_var(GVAR_PLAYER_REPUATION));
            end
        end
        if (global_var(GVAR_CHILDKILLER_REPUATION) > 2) then begin
            set_local_var(0, local_var(0) - 30);
        end
        if (((global_var(GVAR_BAD_MONSTER) + global_var(GVAR_GOOD_MONSTER)) >= 25) and ((global_var(160) > (3 * global_var(GVAR_GOOD_MONSTER))) or (global_var(GVAR_CHAMPION_REPUTATION) == 1))) then begin
            set_local_var(0, local_var(0) + 20);
        end
        if (((global_var(GVAR_BAD_MONSTER) + global_var(GVAR_GOOD_MONSTER)) >= 25) and ((global_var(GVAR_GOOD_MONSTER) > (2 * global_var(GVAR_BAD_MONSTER))) or (global_var(GVAR_BERSERKER_REPUTATION) == 1))) then begin
            set_local_var(0, local_var(0) - 20);
        end
        call ReactToLevel();
    end
end

procedure ReactToLevel
begin
    if (local_var(0) <= 25) then begin
        set_local_var(1, 1);
    end
    else begin
        if (local_var(0) <= 75) then begin
            set_local_var(1, 2);
        end
        else begin
            set_local_var(1, 3);
        end
    end
end

procedure LevelToReact
begin
    if (local_var(1) == 1) then begin
        set_local_var(0, random(1, 25));
    end
    else begin
        if (local_var(1) == 2) then begin
            set_local_var(0, random(26, 75));
        end
        else begin
            set_local_var(0, random(76, 100));
        end
    end
end

procedure UpReact
begin
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel();
end

procedure DownReact
begin
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel();
end

procedure BottomReact
begin
    set_local_var(1, 1);
    set_local_var(0, 1);
end

procedure TopReact
begin
    set_local_var(0, 100);
    set_local_var(1, 3);
end

procedure BigUpReact
begin
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel();
end

procedure BigDownReact
begin
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel();
end

procedure UpReactLevel
begin
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
        set_local_var(1, 3);
    end
    call LevelToReact();
end

procedure DownReactLevel
begin
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
        set_local_var(1, 1);
    end
    call LevelToReact();
end

procedure Goodbyes
begin
    exit_line := message_str(SCRIPT_MODREACT, random(100, 105));
end
