variable dude_objective_reputation;
variable self_subjective_reaction;
variable z_critter_search;
variable critter_is_detected;
variable detected_critter;
variable persuade_chance;
variable steal_perk;
variable steal_gloves;
variable z_weapon_class;

procedure start;
procedure timed_event_p_proc;
procedure critter_p_proc;
procedure map_enter_p_proc;
procedure combat_p_proc;
procedure map_update_p_proc;
procedure use_skill_on_p_proc;
procedure first_tip;
procedure Pass_Tartar;
procedure Electrical_tip;
procedure HMS_tip;
procedure All_Quests_tip;
procedure Steal_tip;
procedure Kill_tip;
procedure Karma_tip;
procedure Radiation_tip;
procedure Items_tip;
procedure tips_yes;
procedure tips_no;
procedure close_tip;
procedure vide;
procedure passtartar;
procedure look_at_p_proc;
procedure description_p_proc;
procedure use_obj_on_p_proc;


procedure start
begin
end

procedure timed_event_p_proc
begin
end

procedure critter_p_proc
begin
    if ((global_var(6) > 0) and ((obj_art_fid(dude_obj) == 16777217) or (obj_art_fid(dude_obj) == 16777218))) then begin
        animate_move_obj_to_tile(dude_obj, tile_num(dude_obj), 0);
    end
    if (has_trait(2, dude_obj, 13) and (global_var(365) != get_pc_stat(1))) then begin
        set_global_var(365, get_pc_stat(1));
        set_global_var(71, 0);
        set_global_var(72, 0);
        set_global_var(73, 0);
        set_global_var(74, 0);
        set_global_var(75, 0);
        set_global_var(76, 0);
        set_global_var(77, 0);
        set_global_var(78, 0);
        set_global_var(79, 0);
        set_global_var(80, 0);
        set_global_var(81, 0);
        set_global_var(82, 0);
        set_global_var(83, 0);
        set_global_var(84, 0);
        set_global_var(85, 0);
        set_global_var(86, 0);
        set_global_var(87, 0);
        set_global_var(88, 0);
        critter_mod_skill(dude_obj, 8, floor(5 - (0.20000 * get_pc_stat(1))));
        display_msg(message_str(10, 408));
        critter_mod_skill(dude_obj, 12, floor(5 - (0.20000 * get_pc_stat(1))));
        display_msg(message_str(10, 412));
        critter_mod_skill(dude_obj, 15, floor(5 - (0.20000 * get_pc_stat(1))));
        display_msg(message_str(10, 415));
        critter_mod_skill(dude_obj, 17, floor(5 - (0.20000 * get_pc_stat(1))));
        display_msg(message_str(10, 417));
    end
    if (obj_carrying_pid_obj(dude_obj, 487) or obj_carrying_pid_obj(dude_obj, 488) or obj_carrying_pid_obj(dude_obj, 489) and (get_sfall_global_int(40) == 0)) then begin
        set_sfall_global(40, 1);
        display_msg(message_str(78, 141));
    end
    if ((get_pc_stat(1) >= 7) and (has_skill(dude_obj, 13) >= 70) and (get_sfall_global_int(36) == 0)) then begin
        set_sfall_global(36, 1);
        play_sfx("LEVELUP");
        display_msg(message_str(78, 137));
    end
    if ((global_var(10) != 0) and (global_var(13) == 0)) then begin
        rm_obj_from_inven(dude_obj, obj_carrying_pid_obj(dude_obj, 43));
        set_global_var(13, 1);
    end
    if ((global_var(10) != 0) and (obj_carrying_pid_obj(dude_obj, 44) != 0)) then begin
        rm_obj_from_inven(dude_obj, obj_carrying_pid_obj(dude_obj, 44));
        add_obj_to_inven(dude_obj, create_object_sid(43, 1, 2, -1));
        set_global_var(10, 0);
        set_global_var(11, 0);
        set_global_var(12, 0);
        set_global_var(13, 0);
    end
    else begin
        if (obj_carrying_pid_obj(dude_obj, 44) != 0) then begin
            rm_obj_from_inven(dude_obj, obj_carrying_pid_obj(dude_obj, 44));
            add_obj_to_inven(dude_obj, create_object_sid(43, 1, 2, -1));
        end
    end
    if (get_sfall_global_int(1) == 1) then begin
        set_sfall_global(1, 2);
        call first_tip();
    end
    if (get_sfall_global_int(7) == 1) then begin
        set_sfall_global(7, 2);
        call Pass_Tartar();
    end
    if ((get_sfall_global_int(1) == 6) and (get_sfall_global_int(3) == 1)) then begin
        set_sfall_global(3, 2);
        call Electrical_tip();
    end
    if ((get_sfall_global_int(1) == 6) and (get_sfall_global_int(2) == 1)) then begin
        set_sfall_global(2, 2);
        call HMS_tip();
    end
    if ((get_sfall_global_int(1) == 6) and (get_sfall_global_int(12) != 2) and (global_var(0) != 0)) then begin
        set_sfall_global(12, 2);
        call Karma_tip();
    end
    if ((get_sfall_global_int(15) != 2) and (get_critter_stat(dude_obj, 37) > 0) and (cur_map_index > 11)) then begin
        set_sfall_global(15, 2);
        call Radiation_tip();
    end
    if (get_sfall_global_int(1) == 6) then begin
        if ((get_sfall_global_int(8) == 0) and (obj_carrying_pid_obj(dude_obj, 290) or obj_carrying_pid_obj(dude_obj, 294) or obj_carrying_pid_obj(dude_obj, 298) or obj_carrying_pid_obj(dude_obj, 441) or obj_carrying_pid_obj(dude_obj, 300) or obj_carrying_pid_obj(dude_obj, 302))) then begin
            set_sfall_global(8, 2);
            call Items_tip();
        end
    end
    if ((get_sfall_global_int(1) == 6) and (get_sfall_global_int(13) == 1)) then begin
        set_sfall_global(13, 2);
        call Steal_tip();
    end
    if ((get_sfall_global_int(1) == 6) and (get_sfall_global_int(14) == 1)) then begin
        set_sfall_global(14, 2);
        call Kill_tip();
    end
    if ((get_sfall_global_int(1) == 6) and (get_sfall_global_int(4) == 0) and (global_var(30) == 2) and (global_var(31) == 2) and (global_var(32) == 2) and (global_var(35) == 2)) then begin
        set_sfall_global(4, 2);
        call All_Quests_tip();
    end
    if (obj_carrying_pid_obj(dude_obj, 325) and (global_var(242) == 0)) then begin
        set_global_var(242, 1);
    end
    if (obj_carrying_pid_obj(dude_obj, 93) and (global_var(341) == 0)) then begin
        set_global_var(341, 1);
    end
    if (obj_carrying_pid_obj(dude_obj, 395) and (global_var(354) == 0)) then begin
        set_global_var(354, 1);
        display_msg(message_str(10, 1010));
        set_critter_stat(dude_obj, 0, 1);
    end
    if (obj_carrying_pid_obj(dude_obj, 396) and (global_var(355) == 0)) then begin
        set_global_var(355, 1);
        display_msg(message_str(10, 1011));
        set_critter_stat(dude_obj, 1, 1);
    end
    if (obj_carrying_pid_obj(dude_obj, 397) and (global_var(356) == 0)) then begin
        set_global_var(356, 1);
        display_msg(message_str(10, 1012));
        set_critter_stat(dude_obj, 2, 1);
    end
    if (obj_carrying_pid_obj(dude_obj, 398) and (global_var(357) == 0)) then begin
        set_global_var(357, 1);
        display_msg(message_str(10, 1013));
        set_critter_stat(dude_obj, 3, 1);
    end
    if (obj_carrying_pid_obj(dude_obj, 399) and (global_var(358) == 0)) then begin
        set_global_var(358, 1);
        display_msg(message_str(10, 1014));
        set_critter_stat(dude_obj, 4, 1);
    end
    if (obj_carrying_pid_obj(dude_obj, 400) and (global_var(359) == 0)) then begin
        set_global_var(359, 1);
        display_msg(message_str(10, 1015));
        set_critter_stat(dude_obj, 5, 1);
    end
    if (obj_carrying_pid_obj(dude_obj, 401) and (global_var(360) == 0)) then begin
        set_global_var(360, 1);
        display_msg(message_str(10, 1016));
        set_critter_stat(dude_obj, 6, 1);
    end
    if (not(metarule(17, 11) == 1) and obj_carrying_pid_obj(dude_obj, 311) and obj_carrying_pid_obj(dude_obj, 312) and obj_carrying_pid_obj(dude_obj, 313) and obj_carrying_pid_obj(dude_obj, 314)) then begin
        mark_area_known(0, 11, 1);
        if (obj_carrying_pid_obj(dude_obj, 393)) then begin
            set_sfall_global(18, 1);
            play_sfx("LEVELUP");
            display_msg(message_str(61, 112));
        end
    end
    if (obj_carrying_pid_obj(dude_obj, 340) and (global_var(288) == 0)) then begin
        set_global_var(288, 1);
        if (obj_carrying_pid_obj(dude_obj, 393)) then begin
            set_sfall_global(22, 1);
            play_sfx("LEVELUP");
            display_msg(message_str(61, 112));
        end
    end
    if (obj_carrying_pid_obj(dude_obj, 299) and (global_var(350) == 0)) then begin
        set_global_var(350, 1);
    end
    if (obj_carrying_pid_obj(dude_obj, 301) and (global_var(349) == 0)) then begin
        set_global_var(349, 1);
    end
    if (obj_carrying_pid_obj(dude_obj, 302) and (global_var(351) == 0)) then begin
        set_global_var(351, 1);
    end
    if ((global_var(282) >= 15) and (global_var(264) == 0)) then begin
        set_global_var(264, 1);
        give_exp_points(floor(200) + (get_critter_stat(dude_obj, 4) * floor(83)) + (get_critter_stat(dude_obj, 6) * floor(33)) + (floor(13) * (((get_critter_stat(dude_obj, 6) - 4) * 4) - (difficulty_level * 4))));
        display_msg(message_str(10, random(140, 143)) + (floor(200) + (get_critter_stat(dude_obj, 4) * floor(83)) + (get_critter_stat(dude_obj, 6) * floor(33)) + (floor(13) * (((get_critter_stat(dude_obj, 6) - 4) * 4) - (difficulty_level * 4)))) + message_str(10, 144));
        critter_mod_skill(dude_obj, 16, 25);
    end
    if ((global_var(221) == 3) and (get_sfall_global_int(20) == 0) and obj_carrying_pid_obj(dude_obj, 393)) then begin
        set_sfall_global(20, 1);
        play_sfx("LEVELUP");
        display_msg(message_str(61, 112));
    end
    if (combat_is_initialized) then begin
        call close_tip();
    end
    if ((global_var(257) == 1) and (global_var(258) == 1) and (global_var(259) == 1) and (global_var(260) == 1) and (global_var(261) == 0)) then begin
        set_global_var(261, 1);
    end
end

procedure map_enter_p_proc
begin
    if (global_var(7) == 1) then begin
        set_global_var(7, 0);
    end
end

procedure combat_p_proc
begin
    if ((global_var(6) > 0) and ((obj_art_fid(dude_obj) == 16777217) or (obj_art_fid(dude_obj) == 16777218))) then begin
        animate_move_obj_to_tile(dude_obj, tile_num(dude_obj), 0);
    end
end

procedure map_update_p_proc
begin
    if (metarule(46, 0) > 0) then begin
        if (global_var(47) < global_var(368)) then begin
            set_global_var(47, global_var(368));
        end
    end
end

procedure use_skill_on_p_proc
begin
    if (action_being_used == 6) then begin
        if (has_trait(2, dude_obj, 13)) then begin
            if (global_var(77) < get_pc_stat(1)) then begin
                if (is_success(roll_vs_skill(dude_obj, 6, 0))) then begin
                    set_global_var(95, global_var(95) + 3);
                end
                else begin
                    set_global_var(95, global_var(95) + 1);
                end
                if (global_var(95) >= (2 * get_pc_stat(1))) then begin
                    set_global_var(95, 0);
                    set_global_var(77, global_var(77) + 1);
                    critter_mod_skill(dude_obj, 6, 1);
                    display_msg(message_str(10, 406));
                end
            end
        end
    end
    if (action_being_used == 7) then begin
        if (has_trait(2, dude_obj, 13)) then begin
            if (global_var(78) < get_pc_stat(1)) then begin
                if (is_success(roll_vs_skill(dude_obj, 7, 0))) then begin
                    set_global_var(96, global_var(96) + 3);
                end
                else begin
                    set_global_var(96, global_var(96) + 1);
                end
                if (global_var(96) >= (2 * get_pc_stat(1))) then begin
                    set_global_var(96, 0);
                    set_global_var(78, global_var(78) + 1);
                    critter_mod_skill(dude_obj, 7, 1);
                    display_msg(message_str(10, 407));
                end
            end
        end
    end
    if (action_being_used == 9) then begin
        if (has_trait(2, dude_obj, 13)) then begin
        end
    end
    if (action_being_used == 10) then begin
        if (has_trait(2, dude_obj, 13)) then begin
        end
    end
    if (action_being_used == 11) then begin
        if (has_trait(2, dude_obj, 13)) then begin
        end
    end
    if (action_being_used == 13) then begin
        if (has_trait(2, dude_obj, 13)) then begin
            if (global_var(84) < get_pc_stat(1)) then begin
                if (is_success(roll_vs_skill(dude_obj, 13, 0))) then begin
                    set_global_var(100, global_var(100) + 2);
                end
                else begin
                    set_global_var(100, global_var(100) + 1);
                end
                if (global_var(100) >= get_pc_stat(1)) then begin
                    set_global_var(100, 0);
                    set_global_var(84, global_var(84) + 1);
                    critter_mod_skill(dude_obj, 13, 1);
                    display_msg(message_str(10, 413));
                end
            end
        end
    end
end

procedure first_tip
begin
    createWin("Tip_Window", (get_screen_width / 2) - 300, ((get_screen_height - 100) / 2) - 150, 600, 300);
    selectWin("Tip_Window");
    display("PCX/tipwndw.pcx");
    setFont(3);
    setTextColor(0.00000, 0.80000, 0.00000);
    format(" " + message_str(91, 10), 39, 56, 529, 20, 2);
    format(" " + message_str(91, 11), 39, 86, 529, 20, 2);
    format(" " + message_str(91, 12), 19, 116, 529, 20, 2);
    addButton("BTN_close", 445, 243, 135, 34);
    addButtonGfx("BTN_close", "PCX/tipcldwn.pcx", "PCX/tipclup.pcx", "PCX/tipclup.pcx");
    addButtonProc("BTN_close", vide, vide, vide, tips_no);
    addButton("BTN_yes", 185, 243, 135, 34);
    addButtonGfx("BTN_yes", "PCX/tipysdwn.pcx", "PCX/tipysup.pcx", "PCX/tipysup.pcx");
    addButtonProc("BTN_yes", vide, vide, vide, tips_yes);
    addButton("BTN_no", 22, 243, 135, 34);
    addButtonGfx("BTN_no", "PCX/tipnodwn.pcx", "PCX/tipnoup.pcx", "PCX/tipnoup.pcx");
    addButtonProc("BTN_no", vide, vide, vide, tips_no);
    game_ui_disable;
    mouseShape("PCX/mouse2.pcx", 0, 0);
    showWin;
end

procedure Pass_Tartar
begin
    createWin("Tip_Window", (get_screen_width / 2) - 300, ((get_screen_height - 100) / 2) - 150, 600, 300);
    selectWin("Tip_Window");
    display("PCX/tipwndw.pcx");
    setFont(3);
    setTextColor(0.00000, 0.80000, 0.00000);
    format(" " + message_str(91, 26), 39, 56, 529, 149, 2);
    addButton("BTN_close", 445, 243, 135, 34);
    addButtonGfx("BTN_close", "PCX/tipcldwn.pcx", "PCX/tipclup.pcx", "PCX/tipclup.pcx");
    addButtonProc("BTN_close", vide, vide, vide, close_tip);
    addButton("BTN_yes", 185, 243, 135, 34);
    addButtonGfx("BTN_yes", "PCX/tipysdwn.pcx", "PCX/tipysup.pcx", "PCX/tipysup.pcx");
    addButtonProc("BTN_yes", vide, vide, vide, passtartar);
    addButton("BTN_no", 22, 243, 135, 34);
    addButtonGfx("BTN_no", "PCX/tipnodwn.pcx", "PCX/tipnoup.pcx", "PCX/tipnoup.pcx");
    addButtonProc("BTN_no", vide, vide, vide, close_tip);
    game_ui_disable;
    mouseShape("PCX/mouse2.pcx", 0, 0);
    showWin;
end

procedure Electrical_tip
begin
    createWin("Tip_Window", (get_screen_width / 2) - 300, ((get_screen_height - 100) / 2) - 150, 600, 300);
    selectWin("Tip_Window");
    display("PCX/tipwndw.pcx");
    setFont(3);
    setTextColor(0.00000, 0.80000, 0.00000);
    format(" " + message_str(91, 18), 39, 56, 529, 149, 2);
    addButton("BTN_close", 445, 243, 135, 34);
    addButtonGfx("BTN_close", "PCX/tipcldwn.pcx", "PCX/tipclup.pcx", "PCX/tipclup.pcx");
    addButtonProc("BTN_close", vide, vide, vide, close_tip);
    game_ui_disable;
    mouseShape("PCX/mouse2.pcx", 0, 0);
    showWin;
end

procedure HMS_tip
begin
    createWin("Tip_Window", (get_screen_width / 2) - 300, ((get_screen_height - 100) / 2) - 150, 600, 300);
    selectWin("Tip_Window");
    display("PCX/tipwndw.pcx");
    displayGfx("PCX/tipncstr.pcx", 220, 114, 160, 81);
    setFont(3);
    setTextColor(0.00000, 0.80000, 0.00000);
    format(" " + message_str(91, 17), 39, 56, 529, 50, 2);
    addButton("BTN_close", 445, 243, 135, 34);
    addButtonGfx("BTN_close", "PCX/tipcldwn.pcx", "PCX/tipclup.pcx", "PCX/tipclup.pcx");
    addButtonProc("BTN_close", vide, vide, vide, close_tip);
    game_ui_disable;
    mouseShape("PCX/mouse2.pcx", 0, 0);
    showWin;
end

procedure All_Quests_tip
begin
    createWin("Tip_Window", (get_screen_width / 2) - 300, ((get_screen_height - 100) / 2) - 150, 600, 300);
    selectWin("Tip_Window");
    display("PCX/tipwndw.pcx");
    setFont(3);
    setTextColor(0.00000, 0.80000, 0.00000);
    format(" " + message_str(91, 16), 39, 56, 529, 149, 2);
    addButton("BTN_close", 445, 243, 135, 34);
    addButtonGfx("BTN_close", "PCX/tipcldwn.pcx", "PCX/tipclup.pcx", "PCX/tipclup.pcx");
    addButtonProc("BTN_close", vide, vide, vide, close_tip);
    game_ui_disable;
    mouseShape("PCX/mouse2.pcx", 0, 0);
    showWin;
end

procedure Steal_tip
begin
    createWin("Tip_Window", (get_screen_width / 2) - 300, ((get_screen_height - 100) / 2) - 150, 600, 300);
    selectWin("Tip_Window");
    display("PCX/tipwndw.pcx");
    setFont(3);
    setTextColor(0.00000, 0.80000, 0.00000);
    format(" " + message_str(91, 19), 39, 56, 529, 50, 2);
    addButton("BTN_close", 445, 243, 135, 34);
    addButtonGfx("BTN_close", "PCX/tipcldwn.pcx", "PCX/tipclup.pcx", "PCX/tipclup.pcx");
    addButtonProc("BTN_close", vide, vide, vide, close_tip);
    game_ui_disable;
    mouseShape("PCX/mouse2.pcx", 0, 0);
    showWin;
end

procedure Kill_tip
begin
    createWin("Tip_Window", (get_screen_width / 2) - 300, ((get_screen_height - 100) / 2) - 150, 600, 300);
    selectWin("Tip_Window");
    display("PCX/tipwndw.pcx");
    setFont(3);
    setTextColor(0.00000, 0.80000, 0.00000);
    format(" " + message_str(91, 20), 39, 56, 529, 50, 2);
    addButton("BTN_close", 445, 243, 135, 34);
    addButtonGfx("BTN_close", "PCX/tipcldwn.pcx", "PCX/tipclup.pcx", "PCX/tipclup.pcx");
    addButtonProc("BTN_close", vide, vide, vide, close_tip);
    game_ui_disable;
    mouseShape("PCX/mouse2.pcx", 0, 0);
    showWin;
end

procedure Karma_tip
begin
    createWin("Tip_Window", (get_screen_width / 2) - 300, ((get_screen_height - 100) / 2) - 150, 600, 300);
    selectWin("Tip_Window");
    display("PCX/tipwndw.pcx");
    setFont(3);
    setTextColor(0.00000, 0.80000, 0.00000);
    format(" " + message_str(91, 21), 39, 56, 529, 50, 2);
    addButton("BTN_close", 445, 243, 135, 34);
    addButtonGfx("BTN_close", "PCX/tipcldwn.pcx", "PCX/tipclup.pcx", "PCX/tipclup.pcx");
    addButtonProc("BTN_close", vide, vide, vide, close_tip);
    game_ui_disable;
    mouseShape("PCX/mouse2.pcx", 0, 0);
    showWin;
end

procedure Radiation_tip
begin
    createWin("Tip_Window", (get_screen_width / 2) - 300, ((get_screen_height - 100) / 2) - 150, 600, 300);
    selectWin("Tip_Window");
    display("PCX/tipwndw.pcx");
    setFont(3);
    setTextColor(0.00000, 0.80000, 0.00000);
    format(" " + message_str(91, 24), 39, 56, 529, 100, 2);
    addButton("BTN_close", 445, 243, 135, 34);
    addButtonGfx("BTN_close", "PCX/tipcldwn.pcx", "PCX/tipclup.pcx", "PCX/tipclup.pcx");
    addButtonProc("BTN_close", vide, vide, vide, close_tip);
    game_ui_disable;
    mouseShape("PCX/mouse2.pcx", 0, 0);
    showWin;
end

procedure Items_tip
begin
    createWin("Tip_Window", (get_screen_width / 2) - 300, ((get_screen_height - 100) / 2) - 150, 600, 300);
    selectWin("Tip_Window");
    display("PCX/tipwndw.pcx");
    setFont(3);
    setTextColor(0.00000, 0.80000, 0.00000);
    format(" " + message_str(91, 27), 39, 56, 529, 50, 2);
    addButton("BTN_close", 445, 243, 135, 34);
    addButtonGfx("BTN_close", "PCX/tipcldwn.pcx", "PCX/tipclup.pcx", "PCX/tipclup.pcx");
    addButtonProc("BTN_close", vide, vide, vide, close_tip);
    game_ui_disable;
    mouseShape("PCX/mouse2.pcx", 0, 0);
    showWin;
end

procedure tips_yes
begin
    set_sfall_global(1, 6);
    deleteWin("Tip_Window");
    game_ui_enable;
    set_sfall_global(7, 1);
end

procedure tips_no
begin
    set_sfall_global(1, 5);
    deleteWin("Tip_Window");
    game_ui_enable;
    set_sfall_global(7, 1);
end

procedure close_tip
begin
    deleteWin("Tip_Window");
    game_ui_enable;
end

procedure vide
begin
end

procedure passtartar
begin
    deleteWin("Tip_Window");
    game_ui_enable;
    set_sfall_global(7, 3);
    set_sfall_global(4, 2);
    set_global_var(27, 2);
    set_global_var(28, 2);
    set_global_var(29, 2);
    set_global_var(30, 2);
    set_global_var(31, 2);
    set_global_var(32, 2);
    set_global_var(33, 2);
    set_global_var(34, 2);
    set_global_var(35, 2);
    fadeOut(1500);
    load_map("tartar13", 1);
end

procedure look_at_p_proc
begin
end

procedure description_p_proc
begin
    script_overrides;
    if (local_var(3) == 0) then begin
        set_local_var(3, 1);
    end
end

procedure use_obj_on_p_proc
begin
end

