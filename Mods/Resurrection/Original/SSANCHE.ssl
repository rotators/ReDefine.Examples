variable ProtoOfItemGiven;
variable ValueOfRollCheck := 1;
variable Scenery_Creation;
variable Scenery_Creation_Hex;
variable Scenery_Creation_Count;
variable Temp_Scenery_Creation_Hex;
variable Scenery_Creation_Ptr;
variable lPartyWornArmor;
variable How_Many_Party_Members_Are_Injured;
variable How_Many_Party_Members_Armed;
variable PartyHealingItem;

procedure checkPartyMembersNearDoor;

variable global_temp;
variable dest_tile;
variable step_tile;
variable in_dialog;
variable forced_node;
variable restock_amt;
variable restock_obj;
variable restock_trash;
variable removed_qty;
variable toRemove_qty;

procedure div(variable arg0, variable arg1);
procedure start;
procedure critter_p_proc;
procedure pickup_p_proc;
procedure talk_p_proc;
procedure look_at_p_proc;
procedure description_p_proc;
procedure timed_event_p_proc;
procedure map_enter_p_proc;
procedure map_exit_p_proc;
procedure damage_p_proc;
procedure combat_p_proc;
procedure destroy_p_proc;
procedure Node998;
procedure Node999;
procedure Node999_KillGhoulsAccepted;
procedure Node999_shooting;
procedure Rodrigues_drunk_accepted;
procedure Node500;
procedure Node550;
procedure Node600;
procedure Node650;
procedure Node700;
procedure Node750;
procedure Node800;
procedure Node850;
procedure Node900;
procedure Node950;
procedure Node1000;
procedure Node1050;
procedure Node1100;
procedure Node1120;
procedure Node1150;
procedure Node1200;
procedure Node1250;
procedure Node1300;
procedure Node1350;
procedure Node1400;
procedure Node1450;
procedure Node1500;
procedure Node1550;
procedure Node1600;
procedure Node1650;
procedure Node1700;
procedure Node1750;
procedure Node1800;
procedure Node1850;
procedure Node1870;
procedure Node1900;
procedure Node1950;
procedure Node2000;
procedure Node2050;
procedure Node2100;
procedure Node2150;
procedure Node2200;
procedure Node2250;
procedure Node2300;
procedure Node2350;
procedure Node2400;
procedure Node2450;
procedure Node2500;
procedure Node2550;
procedure Node2600;
procedure Node2650;
procedure Node2700;
procedure Node2750;
procedure Node2800;
procedure Node2850;
procedure Node2900;
procedure Node2950;
procedure Node3000;
procedure Node3050;
procedure Node3100;
procedure Node3150;
procedure Node3200;
procedure Node3250;
procedure Node3300;
procedure Node3350;
procedure Node3400;
procedure Node3450;
procedure Node3500;
procedure Node3550;
procedure Node3600;
procedure Node3650;
procedure Node3700;
procedure Node3750;
procedure Node3800;
procedure In_face_of_Rodrigues1;
procedure In_face_of_Rodrigues2;
procedure Meeting_with_Tyler;
procedure Meeting_with_Raiders;
procedure Check_For_Gun;

import variable sanchez;
import variable rodrigues;

variable Gabriel_react;
variable lHandLeftPID;
variable lHandRightPID;
variable lCheckGun;


procedure checkPartyMembersNearDoor
begin
    if (party_member_obj(16777729) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777729)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777779)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777811)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777812) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777812)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777813) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777813)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777814)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777748) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777748)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777294) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777294)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778017) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778017)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778016) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778016)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778049) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778049)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778050) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778050)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778051) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778051)) <= 5) then begin
            return 1;
        end
    end
    return 0;
end

procedure div(variable arg0, variable arg1)
begin
    if (0 > arg0) then begin
        return -(-arg0 / arg1);
    end
    return arg0 / arg1;
end

procedure start
begin
    sanchez := self_obj;
end

procedure critter_p_proc
begin
    if ((local_var(5) == 2) and obj_can_see_obj(self_obj, dude_obj)) then begin
        set_local_var(5, 1);
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (global_var(770) == 1) then begin
        if (obj_can_see_obj(self_obj, dude_obj) or obj_can_hear_obj(self_obj, dude_obj)) then begin
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
    end
    if ((global_var(770) == 1) and (elevation(self_obj) == 0) and (combat_is_initialized == 0) and (tile_num(self_obj) != local_var(11)) and (art_anim(obj_art_fid(self_obj)) != 1) and (art_anim(obj_art_fid(self_obj)) != 19)) then begin
        if (tile_distance(tile_num(self_obj), local_var(11)) > 5) then begin
            animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), rotation_to_tile(tile_num(self_obj), local_var(11)), 5), 0);
        end
        else begin
            animate_move_obj_to_tile(self_obj, local_var(11), 0);
        end
    end
end

procedure pickup_p_proc
begin
    if (source_obj == dude_obj) then begin
        set_local_var(5, 2);
    end
end

procedure talk_p_proc
begin
    if (local_var(4) != 1) then begin
        anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
        anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
        start_gdialog(1463, self_obj, 4, -1, -1);
        gsay_start;
        if ((global_var(789) == 1) or (global_var(789) == 2) or (global_var(788) >= 1)) then begin
            set_local_var(9, 1);
            if (get_critter_stat(dude_obj, 34) == 0) then begin
                call Node2400();
            end
            else begin
                call Node2600();
            end
        end
        else begin
            call Node500();
        end
        gsay_end;
        end_dialogue;
        set_local_var(4, 1);
    end
    else begin
        if (local_var(10) == 1) then begin
            anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
            anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
            start_gdialog(1463, self_obj, 4, -1, -1);
            gsay_start;
            if (get_critter_stat(dude_obj, 34) == 0) then begin
                call Node3450();
            end
            else begin
                call Node3500();
            end
            gsay_end;
            end_dialogue;
        end
        else begin
            if (global_var(712) == 3) then begin
                if (get_critter_stat(dude_obj, 34) == 0) then begin
                    float_msg(self_obj, message_str(1463, 300), 8);
                end
                else begin
                    float_msg(self_obj, message_str(1463, 301), 8);
                end
            end
            else begin
                anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
                anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
                start_gdialog(1463, self_obj, 4, -1, -1);
                gsay_start;
                if (global_var(794) == 1) then begin
                    call Node1000();
                end
                else begin
                    if (global_var(794) == 2) then begin
                        if ((global_var(789) == 1) or (global_var(789) == 2) or (global_var(788) >= 1)) then begin
                            set_local_var(9, 1);
                            if (get_critter_stat(dude_obj, 34) == 0) then begin
                                call Node3550();
                            end
                            else begin
                                call Node3600();
                            end
                        end
                        else begin
                            call Node1050();
                        end
                    end
                    else begin
                        if (global_var(711) == 1) then begin
                            call Node1350();
                        end
                        else begin
                            if (global_var(711) == 2) then begin
                                call Node1400();
                            end
                            else begin
                                if (global_var(711) == 3) then begin
                                    if (get_critter_stat(dude_obj, 34) == 0) then begin
                                        call Node1550();
                                    end
                                    else begin
                                        call Node1600();
                                    end
                                end
                                else begin
                                    if (global_var(712) == 1) then begin
                                        call Node1900();
                                    end
                                    else begin
                                        if (global_var(712) == 2) then begin
                                            call Node1950();
                                        end
                                        else begin
                                            if ((global_var(789) == 1) or (global_var(789) == 2) or (global_var(788) >= 1)) then begin
                                                set_local_var(9, 1);
                                                if (get_critter_stat(dude_obj, 34) == 0) then begin
                                                    call Node2400();
                                                end
                                                else begin
                                                    call Node2600();
                                                end
                                            end
                                            else begin
                                                if (local_var(9) == 1) then begin
                                                    set_local_var(9, 0);
                                                    if (get_critter_stat(dude_obj, 34) == 0) then begin
                                                        call Node3650();
                                                    end
                                                    else begin
                                                        call Node3700();
                                                    end
                                                end
                                                else begin
                                                    call Node2200();
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
                gsay_end;
                end_dialogue;
            end
        end
    end
end

procedure look_at_p_proc
begin
    script_overrides;
    if (local_var(4) == 1) then begin
        display_msg(message_str(1463, 150));
    end
    else begin
        display_msg(message_str(1463, 100));
    end
end

procedure description_p_proc
begin
    script_overrides;
    if (local_var(4) == 1) then begin
        display_msg(message_str(1463, 250));
    end
    else begin
        display_msg(message_str(1463, 200));
    end
end

procedure timed_event_p_proc
begin
    if (fixed_param == 1) then begin
        anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
        anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
        game_ui_enable;
        gfade_in(1);
        start_gdialog(1463, self_obj, 4, -1, -1);
        gsay_start;
        call Node1650();
        gsay_end;
        end_dialogue;
    end
    if (fixed_param == 2) then begin
        anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
        anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
        game_ui_enable;
        gfade_in(1);
        start_gdialog(1463, self_obj, 4, -1, -1);
        gsay_start;
        if (global_var(721) == 1) then begin
            call Node2000();
        end
        else begin
            if (global_var(769) == 1) then begin
                call Node2150();
            end
            else begin
                call Node2100();
            end
        end
        gsay_end;
        end_dialogue;
    end
    if (fixed_param == 3) then begin
        anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
        anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
        game_ui_enable;
        gfade_in(1);
        start_gdialog(1463, self_obj, 4, -1, -1);
        gsay_start;
        if (get_critter_stat(dude_obj, 34) == 0) then begin
            call Node2300();
        end
        else begin
            call Node2350();
        end
        gsay_end;
        end_dialogue;
    end
    if (fixed_param == 4) then begin
        move_to(dude_obj, tile_num_in_direction(tile_num(self_obj), has_trait(1, self_obj, 10), 2), 0);
        anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
        anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
        set_global_var(632, global_var(632) bwand (-1 - 64));
        if (party_member_obj(16777729) != 0) then begin
            if (party_member_obj(16777729)) then begin
                if (has_trait(1, party_member_obj(16777729), 666) == 0) then begin
                    if ((global_var(632) bwand 1) != 0) then begin
                        debug_msg("unhiding party member " + obj_name(party_member_obj(16777729)));
                        set_global_var(632, global_var(632) bwand (-1 - 1));
                        set_obj_visibility(party_member_obj(16777729), 0);
                    end
                    else begin
                        debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                    end
                end
                else begin
                    debug_msg("unhiding party member " + obj_name(party_member_obj(16777729)));
                    set_global_var(632, global_var(632) bwand (-1 - 1));
                    set_obj_visibility(party_member_obj(16777729), 0);
                    debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                end
            end
        end
        if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
            if (party_member_obj(16777779)) then begin
                if (has_trait(1, party_member_obj(16777779), 666) == 0) then begin
                    if ((global_var(632) bwand 2) != 0) then begin
                        debug_msg("unhiding party member " + obj_name(party_member_obj(16777779)));
                        set_global_var(632, global_var(632) bwand (-1 - 2));
                        set_obj_visibility(party_member_obj(16777779), 0);
                    end
                    else begin
                        debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                    end
                end
                else begin
                    debug_msg("unhiding party member " + obj_name(party_member_obj(16777779)));
                    set_global_var(632, global_var(632) bwand (-1 - 2));
                    set_obj_visibility(party_member_obj(16777779), 0);
                    debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                end
            end
        end
        if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
            if (party_member_obj(16777811)) then begin
                if (has_trait(1, party_member_obj(16777811), 666) == 0) then begin
                    if ((global_var(632) bwand 4) != 0) then begin
                        debug_msg("unhiding party member " + obj_name(party_member_obj(16777811)));
                        set_global_var(632, global_var(632) bwand (-1 - 4));
                        set_obj_visibility(party_member_obj(16777811), 0);
                    end
                    else begin
                        debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                    end
                end
                else begin
                    debug_msg("unhiding party member " + obj_name(party_member_obj(16777811)));
                    set_global_var(632, global_var(632) bwand (-1 - 4));
                    set_obj_visibility(party_member_obj(16777811), 0);
                    debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                end
            end
        end
        if (party_member_obj(16777812) != 0) then begin
            if (party_member_obj(16777812)) then begin
                if (has_trait(1, party_member_obj(16777812), 666) == 0) then begin
                    if ((global_var(632) bwand 8) != 0) then begin
                        debug_msg("unhiding party member " + obj_name(party_member_obj(16777812)));
                        set_global_var(632, global_var(632) bwand (-1 - 8));
                        set_obj_visibility(party_member_obj(16777812), 0);
                    end
                    else begin
                        debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                    end
                end
                else begin
                    debug_msg("unhiding party member " + obj_name(party_member_obj(16777812)));
                    set_global_var(632, global_var(632) bwand (-1 - 8));
                    set_obj_visibility(party_member_obj(16777812), 0);
                    debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                end
            end
        end
        if (party_member_obj(16777813) != 0) then begin
            if (party_member_obj(16777813)) then begin
                if (has_trait(1, party_member_obj(16777813), 666) == 0) then begin
                    if ((global_var(632) bwand 16) != 0) then begin
                        debug_msg("unhiding party member " + obj_name(party_member_obj(16777813)));
                        set_global_var(632, global_var(632) bwand (-1 - 16));
                        set_obj_visibility(party_member_obj(16777813), 0);
                    end
                    else begin
                        debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                    end
                end
                else begin
                    debug_msg("unhiding party member " + obj_name(party_member_obj(16777813)));
                    set_global_var(632, global_var(632) bwand (-1 - 16));
                    set_obj_visibility(party_member_obj(16777813), 0);
                    debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                end
            end
        end
        if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
            if (party_member_obj(16777814)) then begin
                if (has_trait(1, party_member_obj(16777814), 666) == 0) then begin
                    if ((global_var(632) bwand 32) != 0) then begin
                        debug_msg("unhiding party member " + obj_name(party_member_obj(16777814)));
                        set_global_var(632, global_var(632) bwand (-1 - 32));
                        set_obj_visibility(party_member_obj(16777814), 0);
                    end
                    else begin
                        debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                    end
                end
                else begin
                    debug_msg("unhiding party member " + obj_name(party_member_obj(16777814)));
                    set_global_var(632, global_var(632) bwand (-1 - 32));
                    set_obj_visibility(party_member_obj(16777814), 0);
                    debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                end
            end
        end
        if (party_member_obj(16777729) != 0) then begin
            if (party_member_obj(16777729) != 0) then begin
                if (has_trait(1, party_member_obj(16777729), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
            if (party_member_obj(16777779) != 0) then begin
                if (has_trait(1, party_member_obj(16777779), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
            if (party_member_obj(16777811) != 0) then begin
                if (has_trait(1, party_member_obj(16777811), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if (party_member_obj(16777812) != 0) then begin
            if (party_member_obj(16777812) != 0) then begin
                if (has_trait(1, party_member_obj(16777812), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
            if (party_member_obj(16777814) != 0) then begin
                if (has_trait(1, party_member_obj(16777814), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if (party_member_obj(16777748) != 0) then begin
            if (party_member_obj(16777748) != 0) then begin
                if (has_trait(1, party_member_obj(16777748), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if (party_member_obj(16778017) != 0) then begin
            if (party_member_obj(16778017) != 0) then begin
                if (has_trait(1, party_member_obj(16778017), 666)) then begin
                    critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if (party_member_obj(16778016) != 0) then begin
            if (party_member_obj(16778016) != 0) then begin
                if (has_trait(1, party_member_obj(16778016), 666)) then begin
                    critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if (party_member_obj(16778049) != 0) then begin
            if (party_member_obj(16778049) != 0) then begin
                if (has_trait(1, party_member_obj(16778049), 666)) then begin
                    critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if (party_member_obj(16778050) != 0) then begin
            if (party_member_obj(16778050) != 0) then begin
                if (has_trait(1, party_member_obj(16778050), 666)) then begin
                    critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if (party_member_obj(16778051) != 0) then begin
            if (party_member_obj(16778051) != 0) then begin
                if (has_trait(1, party_member_obj(16778051), 666)) then begin
                    critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if (party_member_obj(16777294) != 0) then begin
            if (party_member_obj(16777294) != 0) then begin
                if (has_trait(1, party_member_obj(16777294), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), 0);
                end
            end
        end
        if (party_member_obj(16777729) != 0) then begin
            anim(party_member_obj(16777729), 1000, has_trait(1, dude_obj, 10));
        end
        if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
            anim(party_member_obj(16777779), 1000, has_trait(1, dude_obj, 10));
        end
        if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
            anim(party_member_obj(16777811), 1000, has_trait(1, dude_obj, 10));
        end
        if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
            anim(party_member_obj(16777814), 1000, has_trait(1, dude_obj, 10));
        end
        if (party_member_obj(16778017) != 0) then begin
            anim(party_member_obj(16778017), 1000, has_trait(1, dude_obj, 10));
        end
        if (party_member_obj(16778016) != 0) then begin
            anim(party_member_obj(16778016), 1000, has_trait(1, dude_obj, 10));
        end
        if (party_member_obj(16778049) != 0) then begin
            anim(party_member_obj(16778049), 1000, has_trait(1, dude_obj, 10));
        end
        if (party_member_obj(16778050) != 0) then begin
            anim(party_member_obj(16778050), 1000, has_trait(1, dude_obj, 10));
        end
        if (party_member_obj(16778051) != 0) then begin
            anim(party_member_obj(16778051), 1000, has_trait(1, dude_obj, 10));
        end
        if (party_member_obj(16777812) != 0) then begin
            anim(party_member_obj(16777812), 1000, has_trait(1, dude_obj, 10));
        end
        game_ui_enable;
        gfade_in(1);
        start_gdialog(1463, self_obj, 4, -1, -1);
        gsay_start;
        call Node1300();
        gsay_end;
        end_dialogue;
    end
    if (fixed_param == 5) then begin
        game_ui_disable;
        float_msg(dude_obj, message_str(1463, 310), 2);
        set_global_var(0, global_var(0) + 40);
        debug_msg("Player gains " + 40 + " Karma Points.");
        set_global_var(37, 0);
        set_global_var(38, 0);
        set_global_var(39, 0);
        set_global_var(40, 0);
        set_global_var(41, 0);
        set_global_var(42, 0);
        set_global_var(43, 0);
        set_global_var(44, 0);
        set_global_var(45, 0);
        if (global_var(0) >= 1000) then begin
            set_global_var(37, 1);
        end
        else begin
            if (global_var(0) >= 750) then begin
                set_global_var(38, 1);
            end
            else begin
                if (global_var(0) >= 500) then begin
                    set_global_var(39, 1);
                end
                else begin
                    if (global_var(0) >= 250) then begin
                        set_global_var(40, 1);
                    end
                    else begin
                        if (global_var(0) > -250) then begin
                            set_global_var(41, 1);
                        end
                        else begin
                            if (global_var(0) > -500) then begin
                                set_global_var(42, 1);
                            end
                            else begin
                                if (global_var(0) > -750) then begin
                                    set_global_var(43, 1);
                                end
                                else begin
                                    if (global_var(0) > -1000) then begin
                                        set_global_var(44, 1);
                                    end
                                    else begin
                                        set_global_var(45, 1);
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
        set_map_var(9, 1);
        add_timer_event(self_obj, game_ticks(4), 6);
    end
    if (fixed_param == 6) then begin
        gfade_out(1);
        set_map_var(9, 2);
        add_timer_event(self_obj, game_ticks(2), 7);
    end
    if (fixed_param == 7) then begin
        gfade_in(1);
        game_ui_enable;
        float_msg(dude_obj, 0, 0);
        set_local_var(5, 2);
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (fixed_param == 10) then begin
        if (global_var(770) == 1) then begin
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
        else begin
            if (local_var(4) != 1) then begin
                anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
                anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
                start_gdialog(1463, self_obj, 4, -1, -1);
                gsay_start;
                if ((global_var(789) == 1) or (global_var(789) == 2) or (global_var(788) >= 1)) then begin
                    set_local_var(9, 1);
                    if (get_critter_stat(dude_obj, 34) == 0) then begin
                        call Node3150();
                    end
                    else begin
                        call Node3250();
                    end
                end
                else begin
                    if (get_critter_stat(dude_obj, 34) == 0) then begin
                        call Node2800();
                    end
                    else begin
                        call Node2900();
                    end
                end
                gsay_end;
                end_dialogue;
                set_local_var(4, 1);
            end
            else begin
                if (local_var(10) == 1) then begin
                    anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
                    anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
                    start_gdialog(1463, self_obj, 4, -1, -1);
                    gsay_start;
                    if (get_critter_stat(dude_obj, 34) == 0) then begin
                        call Node3450();
                    end
                    else begin
                        call Node3500();
                    end
                    gsay_end;
                    end_dialogue;
                end
                else begin
                    if (global_var(712) == 3) then begin
                        anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
                        anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
                        start_gdialog(1463, self_obj, 4, -1, -1);
                        gsay_start;
                        if (get_critter_stat(dude_obj, 34) == 0) then begin
                            call Node3050();
                        end
                        else begin
                            call Node3100();
                        end
                        gsay_end;
                        end_dialogue;
                    end
                    else begin
                        anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
                        anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
                        start_gdialog(1463, self_obj, 4, -1, -1);
                        gsay_start;
                        if (global_var(794) == 1) then begin
                            call Node3000();
                        end
                        else begin
                            if (global_var(794) == 2) then begin
                                if ((global_var(789) == 1) or (global_var(789) == 2) or (global_var(788) >= 1)) then begin
                                    set_local_var(9, 1);
                                    if (get_critter_stat(dude_obj, 34) == 0) then begin
                                        call Node3550();
                                    end
                                    else begin
                                        call Node3600();
                                    end
                                end
                                else begin
                                    call Node1050();
                                end
                            end
                            else begin
                                if (global_var(711) == 1) then begin
                                    call Node3000();
                                end
                                else begin
                                    if (global_var(711) == 2) then begin
                                        call Node1400();
                                    end
                                    else begin
                                        if (global_var(711) == 3) then begin
                                            if (get_critter_stat(dude_obj, 34) == 0) then begin
                                                call Node1550();
                                            end
                                            else begin
                                                call Node1600();
                                            end
                                        end
                                        else begin
                                            if (global_var(712) == 1) then begin
                                                call Node3000();
                                            end
                                            else begin
                                                if (global_var(712) == 2) then begin
                                                    call Node1950();
                                                end
                                                else begin
                                                    if ((global_var(789) == 1) or (global_var(789) == 2) or (global_var(788) >= 1)) then begin
                                                        set_local_var(9, 1);
                                                        if (get_critter_stat(dude_obj, 34) == 0) then begin
                                                            call Node3150();
                                                        end
                                                        else begin
                                                            call Node3250();
                                                        end
                                                    end
                                                    else begin
                                                        if (local_var(9) == 1) then begin
                                                            set_local_var(9, 0);
                                                            if (get_critter_stat(dude_obj, 34) == 0) then begin
                                                                call Node3650();
                                                            end
                                                            else begin
                                                                call Node3700();
                                                            end
                                                        end
                                                        else begin
                                                            if (get_critter_stat(dude_obj, 34) == 0) then begin
                                                                call Node2800();
                                                            end
                                                            else begin
                                                                call Node2900();
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                        gsay_end;
                        end_dialogue;
                    end
                end
            end
        end
    end
end

procedure map_enter_p_proc
begin
    critter_add_trait(self_obj, 1, 6, 213);
    critter_add_trait(self_obj, 1, 5, 3);
    if (local_var(11) == 0) then begin
        set_local_var(11, tile_num(self_obj));
    end
    if (global_var(733) == 1) then begin
        add_timer_event(self_obj, 5, 4);
    end
end

procedure map_exit_p_proc
begin
    if (tile_num(self_obj) != local_var(11)) then begin
        if (global_var(770) != 1) then begin
            move_to(self_obj, local_var(11), elevation(self_obj));
            anim(self_obj, 1000, 2);
        end
    end
end

procedure damage_p_proc
begin
    if (source_obj == dude_obj) then begin
        call Node998();
        set_global_var(770, 1);
        set_global_var(1015, global_var(1015) bwand (-1 - 256));
        set_global_var(1018, global_var(1018) bwand (-1 - 1));
        set_global_var(1019, global_var(1019) bwand (-1 - 256));
    end
end

procedure combat_p_proc
begin
    if (fixed_param == 4) then begin
        if ((global_var(770) == 1) and (target_obj != dude_obj)) then begin
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
    end
end

procedure destroy_p_proc
begin
    set_global_var(0, global_var(0) + 5);
    debug_msg("Player gains " + 5 + " Karma Points.");
    set_global_var(37, 0);
    set_global_var(38, 0);
    set_global_var(39, 0);
    set_global_var(40, 0);
    set_global_var(41, 0);
    set_global_var(42, 0);
    set_global_var(43, 0);
    set_global_var(44, 0);
    set_global_var(45, 0);
    if (global_var(0) >= 1000) then begin
        set_global_var(37, 1);
    end
    else begin
        if (global_var(0) >= 750) then begin
            set_global_var(38, 1);
        end
        else begin
            if (global_var(0) >= 500) then begin
                set_global_var(39, 1);
            end
            else begin
                if (global_var(0) >= 250) then begin
                    set_global_var(40, 1);
                end
                else begin
                    if (global_var(0) > -250) then begin
                        set_global_var(41, 1);
                    end
                    else begin
                        if (global_var(0) > -500) then begin
                            set_global_var(42, 1);
                        end
                        else begin
                            if (global_var(0) > -750) then begin
                                set_global_var(43, 1);
                            end
                            else begin
                                if (global_var(0) > -1000) then begin
                                    set_global_var(44, 1);
                                end
                                else begin
                                    set_global_var(45, 1);
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    sanchez := 0;
    set_map_var(7, 1);
    if (map_var(8) == 1) then begin
        set_global_var(792, 2);
    end
end

procedure Node998
begin
    set_local_var(5, 2);
end

procedure Node999
begin
    anim(self_obj, 1000, 2);
    if ((Gabriel_react == 1) and ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0))) then begin
        add_timer_event(party_member_obj(16777811), 10, 12);
    end
    Gabriel_react := 0;
end

procedure Node999_KillGhoulsAccepted
begin
    anim(self_obj, 1000, 2);
    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
        add_timer_event(party_member_obj(16777814), 10, 14);
    end
end

procedure Node999_shooting
begin
    anim(self_obj, 1000, 2);
    Gabriel_react := 0;
    if (lCheckGun == 1) then begin
        play_sfx("WAV1XXX1");
    end
    else begin
        if (lCheckGun == 2) then begin
            play_sfx("WAA1XXX1");
        end
        else begin
            if (lCheckGun == 3) then begin
                play_sfx("WAE1XXX1");
            end
            else begin
                if (lCheckGun == 4) then begin
                    play_sfx("WAH1XXX1");
                end
                else begin
                    if (lCheckGun == 5) then begin
                        play_sfx("WAG1XXX1");
                    end
                    else begin
                        if (lCheckGun == 6) then begin
                            play_sfx("WAD2XXX1");
                        end
                        else begin
                            if (lCheckGun == 7) then begin
                                play_sfx("WAR1XXX1");
                            end
                            else begin
                                if (lCheckGun == 8) then begin
                                    play_sfx("WAC1XXX1");
                                end
                                else begin
                                    if (lCheckGun == 9) then begin
                                        play_sfx("WAF1XXX1");
                                    end
                                    else begin
                                        if (lCheckGun == 10) then begin
                                            play_sfx("WAJ1XXX1");
                                        end
                                        else begin
                                            if (lCheckGun == 11) then begin
                                                play_sfx("WAK1XXX1");
                                            end
                                            else begin
                                                if (lCheckGun == 12) then begin
                                                    play_sfx("WAL1XXX1");
                                                end
                                                else begin
                                                    if (lCheckGun == 13) then begin
                                                        play_sfx("WAM2XXX1");
                                                    end
                                                    else begin
                                                        if (lCheckGun == 14) then begin
                                                            play_sfx("WA#1XXX1");
                                                        end
                                                        else begin
                                                            if (lCheckGun == 15) then begin
                                                                play_sfx("WAU1XXX1");
                                                            end
                                                            else begin
                                                                if (lCheckGun == 16) then begin
                                                                    play_sfx("WA@1XXX1");
                                                                end
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    add_timer_event(self_obj, 0, 5);
end

procedure Rodrigues_drunk_accepted
begin
    set_global_var(794, 1);
    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
        set_global_var(1019, global_var(1019) bwor 256);
    end
    anim(self_obj, 1000, 2);
end

procedure Node500
begin
    gsay_reply(1463, 500);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
        giq_option(4, 1463, 501, Node550, 50);
        if (map_var(0) == 1) then begin
            if (map_var(5) == 1) then begin
                giq_option(4, 1463, 502, Node3800, 50);
            end
            else begin
                giq_option(4, 1463, 502, Node850, 50);
            end
        end
        giq_option(-3, 1463, 504, Node3350, 50);
    end
    if (get_critter_stat(dude_obj, 34) == 1) then begin
        giq_option(4, 1463, 501, Node600, 50);
        if (map_var(0) == 1) then begin
            if (map_var(5) == 1) then begin
                giq_option(4, 1463, 503, Node3800, 50);
            end
            else begin
                giq_option(4, 1463, 503, Node850, 50);
            end
        end
        giq_option(-3, 1463, 504, Node3400, 50);
    end
    giq_option(4, 1463, 505, Node999, 50);
end

procedure Node550
begin
    gsay_reply(1463, 550);
    giq_option(4, 1463, message_str(1463, 551) + obj_name(dude_obj), Node650, 50);
    giq_option(4, 1463, 552, Node750, 50);
end

procedure Node600
begin
    gsay_reply(1463, 600);
    giq_option(4, 1463, message_str(1463, 601) + obj_name(dude_obj), Node650, 50);
    giq_option(4, 1463, 602, Node800, 50);
end

procedure Node650
begin
    gsay_reply(1463, message_str(1463, 650) + obj_name(dude_obj) + message_str(1463, 651));
    giq_option(4, 1463, 652, Node700, 50);
    giq_option(4, 1463, 653, Node999, 50);
end

procedure Node700
begin
    gsay_reply(1463, 700);
    giq_option(4, 1463, 701, Node998, 50);
    giq_option(4, 1463, 702, Node999, 50);
end

procedure Node750
begin
    gsay_reply(1463, 750);
    if (map_var(5) == 1) then begin
        giq_option(4, 1463, 751, Node3800, 50);
    end
    else begin
        giq_option(4, 1463, 751, Node950, 50);
    end
end

procedure Node800
begin
    gsay_reply(1463, 800);
    if (map_var(5) == 1) then begin
        giq_option(4, 1463, 801, Node3800, 50);
    end
    else begin
        giq_option(4, 1463, 801, Node950, 50);
    end
end

procedure Node850
begin
    gsay_reply(1463, 850);
    set_local_var(6, 1);
    giq_option(4, 1463, 851, Rodrigues_drunk_accepted, 50);
    giq_option(4, 1463, 852, Node900, 50);
end

procedure Node900
begin
    gsay_reply(1463, 900);
    giq_option(4, 1463, 901, Node999, 50);
end

procedure Node950
begin
    gsay_reply(1463, 950);
    set_local_var(6, 1);
    giq_option(4, 1463, 951, Rodrigues_drunk_accepted, 50);
    giq_option(4, 1463, 952, Node900, 50);
end

procedure Node1000
begin
    gsay_reply(1463, 1000);
    giq_option(4, 1463, 1001, Node999, 50);
    giq_option(-3, 1463, 1002, Node999, 50);
end

procedure Node1050
begin
    gsay_reply(1463, message_str(1463, 1050) + 200 + message_str(1463, 1051));
    set_global_var(794, 3);
    set_local_var(7, 1);
    item_caps_adjust(dude_obj, 200);
    give_exp_points(350);
    display_msg(message_str(14, 100) + 350 + message_str(14, 101));
    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
        set_global_var(1019, global_var(1019) bwor 256);
    end
    if (get_critter_stat(dude_obj, 34) == 0) then begin
        giq_option(4, 1463, 1052, Node1100, 50);
    end
    if (get_critter_stat(dude_obj, 34) == 1) then begin
        giq_option(4, 1463, 1052, Node1120, 50);
    end
    giq_option(4, 1463, 1053, Node900, 50);
    giq_option(-3, 1463, 1054, Node999, 50);
end

procedure Node1100
begin
    gsay_reply(1463, 1100);
    giq_option(4, 1463, 1101, Node1150, 50);
    giq_option(4, 1463, 1102, Node900, 50);
end

procedure Node1120
begin
    gsay_reply(1463, 1120);
    giq_option(4, 1463, 1121, Node1150, 50);
    giq_option(4, 1463, 1122, Node900, 50);
end

procedure Node1150
begin
    gsay_reply(1463, 1150);
    set_global_var(733, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
        giq_option(4, 1463, 1151, Node1200, 50);
    end
    if (get_critter_stat(dude_obj, 34) == 1) then begin
        giq_option(4, 1463, 1151, Node1250, 50);
    end
end

procedure Node1200
begin
    gsay_reply(1463, 1200);
    giq_option(4, 1463, 1201, Meeting_with_Tyler, 50);
end

procedure Node1250
begin
    gsay_reply(1463, 1250);
    giq_option(4, 1463, 1251, Meeting_with_Tyler, 50);
end

procedure Node1300
begin
    gsay_reply(1463, message_str(1463, 1300) + 500 + message_str(1463, 1301));
    set_global_var(733, 2);
    set_global_var(711, 1);
    item_caps_adjust(dude_obj, 500);
    give_exp_points(350);
    display_msg(message_str(14, 100) + 350 + message_str(14, 101));
    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
        set_global_var(1015, global_var(1015) bwor 256);
    end
    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
        set_global_var(1018, global_var(1018) bwor 1);
    end
    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
        set_global_var(1019, global_var(1019) bwor 256);
    end
    giq_option(1, 1463, 1302, Node999, 50);
end

procedure Node1350
begin
    gsay_reply(1463, 1350);
    giq_option(1, 1463, 1351, Meeting_with_Raiders, 50);
end

procedure Node1400
begin
    gsay_reply(1463, message_str(1463, 1400) + 1000 + message_str(1463, 1401));
    set_global_var(711, 4);
    set_local_var(8, 1);
    item_caps_adjust(dude_obj, 1000);
    set_global_var(0, global_var(0) - 10);
    set_global_var(37, 0);
    set_global_var(38, 0);
    set_global_var(39, 0);
    set_global_var(40, 0);
    set_global_var(41, 0);
    set_global_var(42, 0);
    set_global_var(43, 0);
    set_global_var(44, 0);
    set_global_var(45, 0);
    if (global_var(0) >= 1000) then begin
        set_global_var(37, 1);
    end
    else begin
        if (global_var(0) >= 750) then begin
            set_global_var(38, 1);
        end
        else begin
            if (global_var(0) >= 500) then begin
                set_global_var(39, 1);
            end
            else begin
                if (global_var(0) >= 250) then begin
                    set_global_var(40, 1);
                end
                else begin
                    if (global_var(0) > -250) then begin
                        set_global_var(41, 1);
                    end
                    else begin
                        if (global_var(0) > -500) then begin
                            set_global_var(42, 1);
                        end
                        else begin
                            if (global_var(0) > -750) then begin
                                set_global_var(43, 1);
                            end
                            else begin
                                if (global_var(0) > -1000) then begin
                                    set_global_var(44, 1);
                                end
                                else begin
                                    set_global_var(45, 1);
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    give_exp_points(1000);
    display_msg(message_str(14, 100) + 1000 + message_str(14, 101));
    if ((metarule(16, 0) - (((global_var(910) bwand 32) != 0) and not((global_var(632) bwand 2) != 0)) - (((global_var(910) bwand 64) != 0) and not((global_var(632) bwand 4) != 0)) - (((global_var(910) bwand 128) != 0) and not((global_var(632) bwand 32) != 0)) - 1) > 0) then begin
        giq_option(4, 1463, 1402, Node1500, 50);
    end
    else begin
        giq_option(4, 1463, 1402, Node1450, 50);
    end
    giq_option(4, 1463, 1403, Node900, 50);
    giq_option(-3, 1463, 1404, Node999, 50);
end

procedure Node1450
begin
    gsay_reply(1463, 1450);
    giq_option(4, 1463, 1451, In_face_of_Rodrigues1, 50);
end

procedure Node1500
begin
    gsay_reply(1463, 1500);
    giq_option(4, 1463, 1501, In_face_of_Rodrigues1, 50);
end

procedure Node1550
begin
    gsay_reply(1463, 1550);
    giq_option(1, 1463, 1551, Node998, 50);
end

procedure Node1600
begin
    gsay_reply(1463, 1600);
    giq_option(1, 1463, 1601, Node998, 50);
end

procedure Node1650
begin
    gsay_reply(1463, 1650);
    set_global_var(712, 1);
    giq_option(4, 1463, 1651, Node1700, 50);
end

procedure Node1700
begin
    gsay_reply(1463, 1700);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
        giq_option(4, 1463, 1701, Node1750, 50);
    end
    if (get_critter_stat(dude_obj, 34) == 1) then begin
        giq_option(4, 1463, 1701, Node1800, 50);
    end
end

procedure Node1750
begin
    gsay_reply(1463, 1750);
    if (global_var(722) == 1) then begin
        giq_option(4, 1463, 1751, Node1870, 50);
    end
    else begin
        giq_option(4, 1463, 1751, Node1850, 50);
    end
end

procedure Node1800
begin
    gsay_reply(1463, 1800);
    if (global_var(722) == 1) then begin
        giq_option(4, 1463, 1801, Node1870, 50);
    end
    else begin
        giq_option(4, 1463, 1801, Node1850, 50);
    end
end

procedure Node1850
begin
    gsay_reply(1463, 1850);
    giq_option(4, 1463, 1851, Node999_KillGhoulsAccepted, 50);
end

procedure Node1870
begin
    gsay_reply(1463, 1870);
    giq_option(4, 1463, 1871, Node999_KillGhoulsAccepted, 50);
end

procedure Node1900
begin
    gsay_reply(1463, 1900);
    giq_option(1, 1463, 1901, Node999, 50);
end

procedure Node1950
begin
    gsay_reply(1463, 1950);
    giq_option(4, 1463, 1951, In_face_of_Rodrigues2, 50);
    giq_option(-3, 1463, 1952, Node999, 50);
end

procedure Node2000
begin
    gsay_reply(1463, message_str(1463, 2000) + 2000 + message_str(1463, 2001));
    set_global_var(712, 3);
    set_global_var(0, global_var(0) - 10);
    set_global_var(37, 0);
    set_global_var(38, 0);
    set_global_var(39, 0);
    set_global_var(40, 0);
    set_global_var(41, 0);
    set_global_var(42, 0);
    set_global_var(43, 0);
    set_global_var(44, 0);
    set_global_var(45, 0);
    if (global_var(0) >= 1000) then begin
        set_global_var(37, 1);
    end
    else begin
        if (global_var(0) >= 750) then begin
            set_global_var(38, 1);
        end
        else begin
            if (global_var(0) >= 500) then begin
                set_global_var(39, 1);
            end
            else begin
                if (global_var(0) >= 250) then begin
                    set_global_var(40, 1);
                end
                else begin
                    if (global_var(0) > -250) then begin
                        set_global_var(41, 1);
                    end
                    else begin
                        if (global_var(0) > -500) then begin
                            set_global_var(42, 1);
                        end
                        else begin
                            if (global_var(0) > -750) then begin
                                set_global_var(43, 1);
                            end
                            else begin
                                if (global_var(0) > -1000) then begin
                                    set_global_var(44, 1);
                                end
                                else begin
                                    set_global_var(45, 1);
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    set_global_var(48, global_var(48) + 5);
    give_exp_points(2000);
    display_msg(message_str(14, 100) + 2000 + message_str(14, 101));
    item_caps_adjust(dude_obj, 2000);
    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
        Gabriel_react := 1;
    end
    giq_option(4, 1463, 2002, Node2050, 50);
    giq_option(4, 1463, 2003, Node999, 50);
end

procedure Node2050
begin
    gsay_reply(1463, 2050);
    giq_option(4, 1463, 2051, Node999, 50);
end

procedure Node2100
begin
    gsay_reply(1463, message_str(1463, 2100) + 2000 + message_str(1463, 2101));
    set_global_var(712, 3);
    set_global_var(0, global_var(0) - 10);
    set_global_var(37, 0);
    set_global_var(38, 0);
    set_global_var(39, 0);
    set_global_var(40, 0);
    set_global_var(41, 0);
    set_global_var(42, 0);
    set_global_var(43, 0);
    set_global_var(44, 0);
    set_global_var(45, 0);
    if (global_var(0) >= 1000) then begin
        set_global_var(37, 1);
    end
    else begin
        if (global_var(0) >= 750) then begin
            set_global_var(38, 1);
        end
        else begin
            if (global_var(0) >= 500) then begin
                set_global_var(39, 1);
            end
            else begin
                if (global_var(0) >= 250) then begin
                    set_global_var(40, 1);
                end
                else begin
                    if (global_var(0) > -250) then begin
                        set_global_var(41, 1);
                    end
                    else begin
                        if (global_var(0) > -500) then begin
                            set_global_var(42, 1);
                        end
                        else begin
                            if (global_var(0) > -750) then begin
                                set_global_var(43, 1);
                            end
                            else begin
                                if (global_var(0) > -1000) then begin
                                    set_global_var(44, 1);
                                end
                                else begin
                                    set_global_var(45, 1);
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    set_global_var(48, global_var(48) + 5);
    give_exp_points(2000);
    display_msg(message_str(14, 100) + 2000 + message_str(14, 101));
    item_caps_adjust(dude_obj, 2000);
    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
        Gabriel_react := 1;
    end
    giq_option(4, 1463, 2102, Node2050, 50);
    giq_option(4, 1463, 2103, Node999, 50);
end

procedure Node2150
begin
    gsay_reply(1463, message_str(1463, 2150) + 2000 + message_str(1463, 2151));
    set_global_var(712, 3);
    set_global_var(0, global_var(0) - 10);
    set_global_var(37, 0);
    set_global_var(38, 0);
    set_global_var(39, 0);
    set_global_var(40, 0);
    set_global_var(41, 0);
    set_global_var(42, 0);
    set_global_var(43, 0);
    set_global_var(44, 0);
    set_global_var(45, 0);
    if (global_var(0) >= 1000) then begin
        set_global_var(37, 1);
    end
    else begin
        if (global_var(0) >= 750) then begin
            set_global_var(38, 1);
        end
        else begin
            if (global_var(0) >= 500) then begin
                set_global_var(39, 1);
            end
            else begin
                if (global_var(0) >= 250) then begin
                    set_global_var(40, 1);
                end
                else begin
                    if (global_var(0) > -250) then begin
                        set_global_var(41, 1);
                    end
                    else begin
                        if (global_var(0) > -500) then begin
                            set_global_var(42, 1);
                        end
                        else begin
                            if (global_var(0) > -750) then begin
                                set_global_var(43, 1);
                            end
                            else begin
                                if (global_var(0) > -1000) then begin
                                    set_global_var(44, 1);
                                end
                                else begin
                                    set_global_var(45, 1);
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    set_global_var(48, global_var(48) + 5);
    give_exp_points(2000);
    display_msg(message_str(14, 100) + 2000 + message_str(14, 101));
    item_caps_adjust(dude_obj, 2000);
    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
        Gabriel_react := 1;
    end
    giq_option(4, 1463, 2152, Node2050, 50);
    giq_option(4, 1463, 2153, Node999, 50);
end

procedure Node2200
begin
    gsay_reply(1463, 2200);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
        if (local_var(6) != 1) then begin
            giq_option(4, 1463, 2201, Node550, 50);
            if (map_var(0) == 1) then begin
                if (map_var(5) == 1) then begin
                    giq_option(4, 1463, 2202, Node3800, 50);
                end
                else begin
                    giq_option(4, 1463, 2202, Node850, 50);
                end
            end
        end
        if ((local_var(6) == 1) and (global_var(794) == 0)) then begin
            if (map_var(5) == 1) then begin
                giq_option(4, 1463, 2204, Node3800, 50);
            end
            else begin
                giq_option(4, 1463, 2204, Node950, 50);
            end
        end
        if ((local_var(7) == 1) and (global_var(733) == 0)) then begin
            giq_option(4, 1463, 2206, Node1100, 50);
        end
        if ((local_var(8) == 1) and (global_var(712) == 0)) then begin
            giq_option(4, 1463, 2206, Node2250, 50);
        end
        giq_option(-3, 1463, 2209, Node3350, 50);
    end
    if (get_critter_stat(dude_obj, 34) == 1) then begin
        if (local_var(6) != 1) then begin
            giq_option(4, 1463, 2201, Node600, 50);
            if (map_var(0) == 1) then begin
                if (map_var(5) == 1) then begin
                    giq_option(4, 1463, 2203, Node3800, 50);
                end
                else begin
                    giq_option(4, 1463, 2203, Node850, 50);
                end
            end
        end
        if ((local_var(6) == 1) and (global_var(794) == 0)) then begin
            if (map_var(5) == 1) then begin
                giq_option(4, 1463, 2205, Node3800, 50);
            end
            else begin
                giq_option(4, 1463, 2205, Node950, 50);
            end
        end
        if ((local_var(7) == 1) and (global_var(733) == 0)) then begin
            giq_option(4, 1463, 2207, Node1100, 50);
        end
        if ((local_var(8) == 1) and (global_var(712) == 0)) then begin
            giq_option(4, 1463, 2207, Node2250, 50);
        end
        giq_option(-3, 1463, 2209, Node3400, 50);
    end
    giq_option(4, 1463, 2208, Node999, 50);
end

procedure Node2250
begin
    gsay_reply(1463, 2250);
    if ((metarule(16, 0) - (((global_var(910) bwand 32) != 0) and not((global_var(632) bwand 2) != 0)) - (((global_var(910) bwand 64) != 0) and not((global_var(632) bwand 4) != 0)) - (((global_var(910) bwand 128) != 0) and not((global_var(632) bwand 32) != 0)) - 1) > 0) then begin
        giq_option(4, 1463, 2251, Node1500, 50);
    end
    else begin
        giq_option(4, 1463, 2251, Node1450, 50);
    end
    giq_option(4, 1463, 2252, Node900, 50);
end

procedure Node2300
begin
    gsay_reply(1463, 2300);
    giq_option(4, 1463, 2301, Node998, 50);
end

procedure Node2350
begin
    gsay_reply(1463, 2350);
    giq_option(4, 1463, 2351, Node998, 50);
end

procedure Node2400
begin
    gsay_reply(1463, 2400);
    lCheckGun := Check_For_Gun();
    giq_option(4, 1463, 2401, Node2450, 50);
    if (global_var(790) == 1) then begin
        giq_option(4, 1463, 2402, Node2550, 50);
        if (lCheckGun > 0) then begin
            giq_option(4, 1463, 2405, Node999_shooting, 50);
        end
    end
    giq_option(-3, 1463, 2403, Node3350, 50);
    giq_option(4, 1463, 2404, Node999, 50);
end

procedure Node2450
begin
    gsay_reply(1463, 2450);
    if (global_var(790) == 1) then begin
        giq_option(4, 1463, 2451, Node2550, 50);
        if (lCheckGun > 0) then begin
            giq_option(4, 1463, 2454, Node999_shooting, 50);
        end
    end
    giq_option(4, 1463, 2452, Node2500, 50);
    giq_option(4, 1463, 2453, Node999, 50);
end

procedure Node2500
begin
    gsay_reply(1463, 2500);
    giq_option(4, 1463, 2501, Node998, 50);
    giq_option(4, 1463, 2502, Node999, 50);
end

procedure Node2550
begin
    gsay_reply(1463, 2550);
    giq_option(4, 1463, 2551, Node998, 50);
end

procedure Node2600
begin
    gsay_reply(1463, 2600);
    lCheckGun := Check_For_Gun();
    giq_option(4, 1463, 2601, Node2650, 50);
    if (global_var(790) == 1) then begin
        giq_option(4, 1463, 2602, Node2750, 50);
        if (lCheckGun > 0) then begin
            giq_option(4, 1463, 2605, Node999_shooting, 50);
        end
    end
    giq_option(-3, 1463, 2603, Node3400, 50);
    giq_option(4, 1463, 2604, Node999, 50);
end

procedure Node2650
begin
    gsay_reply(1463, 2650);
    if (global_var(790) == 1) then begin
        giq_option(4, 1463, 2651, Node2750, 50);
        if (lCheckGun > 0) then begin
            giq_option(4, 1463, 2654, Node999_shooting, 50);
        end
    end
    giq_option(4, 1463, 2652, Node2700, 50);
    giq_option(4, 1463, 2653, Node999, 50);
end

procedure Node2700
begin
    gsay_reply(1463, 2700);
    giq_option(4, 1463, 2701, Node998, 50);
    giq_option(4, 1463, 2702, Node999, 50);
end

procedure Node2750
begin
    gsay_reply(1463, 2750);
    giq_option(4, 1463, 2751, Node998, 50);
end

procedure Node2800
begin
    gsay_reply(1463, 2800);
    if (local_var(6) != 1) then begin
        giq_option(4, 1463, 2801, Node550, 50);
        if (map_var(0) == 1) then begin
            if (map_var(5) == 1) then begin
                giq_option(4, 1463, 2802, Node3800, 50);
            end
            else begin
                giq_option(4, 1463, 2802, Node850, 50);
            end
        end
    end
    if ((local_var(6) == 1) and (global_var(794) == 0)) then begin
        if (map_var(5) == 1) then begin
            giq_option(4, 1463, 2803, Node3800, 50);
        end
        else begin
            giq_option(4, 1463, 2803, Node950, 50);
        end
    end
    if ((local_var(7) == 1) and (global_var(733) == 0)) then begin
        giq_option(4, 1463, 2804, Node1100, 50);
    end
    if ((local_var(8) == 1) and (global_var(712) == 0)) then begin
        giq_option(4, 1463, 2804, Node2250, 50);
    end
    giq_option(4, 1463, 2805, Node2850, 50);
    giq_option(-3, 1463, 2806, Node3350, 50);
    giq_option(4, 1463, 2807, Node999, 50);
end

procedure Node2850
begin
    gsay_reply(1463, 2850);
    giq_option(4, 1463, 2851, Node700, 50);
    giq_option(4, 1463, 2852, Node999, 50);
end

procedure Node2900
begin
    gsay_reply(1463, 2900);
    if (local_var(6) != 1) then begin
        giq_option(4, 1463, 2901, Node600, 50);
        if (map_var(0) == 1) then begin
            if (map_var(5) == 1) then begin
                giq_option(4, 1463, 2902, Node3800, 50);
            end
            else begin
                giq_option(4, 1463, 2902, Node850, 50);
            end
        end
    end
    if ((local_var(6) == 1) and (global_var(794) == 0)) then begin
        if (map_var(5) == 1) then begin
            giq_option(4, 1463, 2903, Node3800, 50);
        end
        else begin
            giq_option(4, 1463, 2903, Node950, 50);
        end
    end
    if ((local_var(7) == 1) and (global_var(733) == 0)) then begin
        giq_option(4, 1463, 2904, Node1100, 50);
    end
    if ((local_var(8) == 1) and (global_var(712) == 0)) then begin
        giq_option(4, 1463, 2904, Node2250, 50);
    end
    giq_option(4, 1463, 2905, Node2950, 50);
    giq_option(-3, 1463, 2906, Node3400, 50);
    giq_option(4, 1463, 2907, Node999, 50);
end

procedure Node2950
begin
    gsay_reply(1463, 2950);
    giq_option(4, 1463, 2951, Node700, 50);
    giq_option(4, 1463, 2952, Node999, 50);
end

procedure Node3000
begin
    gsay_reply(1463, 3000);
    giq_option(1, 1463, 3001, Node999, 50);
end

procedure Node3050
begin
    gsay_reply(1463, 3050);
    giq_option(1, 1463, 3051, Node999, 50);
end

procedure Node3100
begin
    gsay_reply(1463, 3100);
    giq_option(1, 1463, 3101, Node999, 50);
end

procedure Node3150
begin
    gsay_reply(1463, 3150);
    lCheckGun := Check_For_Gun();
    giq_option(4, 1463, 3151, Node2450, 50);
    if (global_var(790) == 1) then begin
        giq_option(4, 1463, 3152, Node2550, 50);
        if (lCheckGun > 0) then begin
            giq_option(4, 1463, 3156, Node999_shooting, 50);
        end
    end
    giq_option(4, 1463, 3153, Node3200, 50);
    giq_option(-3, 1463, 3154, Node3350, 50);
    giq_option(4, 1463, 3155, Node999, 50);
end

procedure Node3200
begin
    gsay_reply(1463, 3200);
    if (global_var(790) == 1) then begin
        giq_option(4, 1463, 3201, Node2550, 50);
        if (lCheckGun > 0) then begin
            giq_option(4, 1463, 3204, Node999_shooting, 50);
        end
    end
    giq_option(4, 1463, 3202, Node2500, 50);
    giq_option(4, 1463, 3203, Node999, 50);
end

procedure Node3250
begin
    gsay_reply(1463, 3250);
    lCheckGun := Check_For_Gun();
    giq_option(4, 1463, 3251, Node2650, 50);
    if (global_var(790) == 1) then begin
        giq_option(4, 1463, 3252, Node2750, 50);
        if (lCheckGun > 0) then begin
            giq_option(4, 1463, 3256, Node999_shooting, 50);
        end
    end
    giq_option(4, 1463, 3253, Node3300, 50);
    giq_option(-3, 1463, 3254, Node3400, 50);
    giq_option(4, 1463, 3255, Node999, 50);
end

procedure Node3300
begin
    gsay_reply(1463, 3300);
    if (global_var(790) == 1) then begin
        giq_option(4, 1463, 3301, Node2750, 50);
        if (lCheckGun > 0) then begin
            giq_option(4, 1463, 3304, Node999_shooting, 50);
        end
    end
    giq_option(4, 1463, 3302, Node2700, 50);
    giq_option(4, 1463, 3303, Node999, 50);
end

procedure Node3350
begin
    gsay_reply(1463, 3350);
    set_local_var(10, 1);
    giq_option(-3, 1463, 3351, Node999, 50);
end

procedure Node3400
begin
    gsay_reply(1463, 3400);
    set_local_var(10, 1);
    giq_option(-3, 1463, 3401, Node999, 50);
end

procedure Node3450
begin
    gsay_reply(1463, 3450);
    giq_option(1, 1463, 3451, Node998, 50);
end

procedure Node3500
begin
    gsay_reply(1463, 3500);
    giq_option(1, 1463, 3501, Node998, 50);
end

procedure Node3550
begin
    gsay_reply(1463, message_str(1463, 3550) + 100 + message_str(1463, 3551));
    set_global_var(794, 3);
    set_local_var(7, 1);
    item_caps_adjust(dude_obj, 100);
    give_exp_points(350);
    display_msg(message_str(14, 100) + 350 + message_str(14, 101));
    giq_option(1, 1463, 3552, Node999, 50);
end

procedure Node3600
begin
    gsay_reply(1463, message_str(1463, 3600) + 100 + message_str(1463, 3601));
    set_global_var(794, 3);
    set_local_var(7, 1);
    item_caps_adjust(dude_obj, 100);
    give_exp_points(350);
    display_msg(message_str(14, 100) + 350 + message_str(14, 101));
    giq_option(1, 1463, 3602, Node999, 50);
end

procedure Node3650
begin
    gsay_reply(1463, 3650);
    giq_option(4, 1463, 3651, Node3750, 50);
    giq_option(-3, 1463, 3652, Node3350, 50);
end

procedure Node3700
begin
    gsay_reply(1463, 3700);
    giq_option(4, 1463, 3701, Node3750, 50);
    giq_option(-3, 1463, 3702, Node3400, 50);
end

procedure Node3750
begin
    gsay_reply(1463, 3750);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
        if (local_var(6) != 1) then begin
            if (map_var(0) == 1) then begin
                if (map_var(5) == 1) then begin
                    giq_option(4, 1463, 3751, Node3800, 50);
                end
                else begin
                    giq_option(4, 1463, 3751, Node850, 50);
                end
            end
        end
        if ((local_var(6) == 1) and (global_var(794) == 0)) then begin
            if (map_var(5) == 1) then begin
                giq_option(4, 1463, 3753, Node3800, 50);
            end
            else begin
                giq_option(4, 1463, 3753, Node950, 50);
            end
        end
        if ((local_var(7) == 1) and (global_var(733) == 0)) then begin
            giq_option(4, 1463, 3755, Node1100, 50);
        end
    end
    if (get_critter_stat(dude_obj, 34) == 1) then begin
        if (local_var(6) != 1) then begin
            if (map_var(0) == 1) then begin
                if (map_var(5) == 1) then begin
                    giq_option(4, 1463, 3752, Node3800, 50);
                end
                else begin
                    giq_option(4, 1463, 3752, Node850, 50);
                end
            end
        end
        if ((local_var(6) == 1) and (global_var(794) == 0)) then begin
            if (map_var(5) == 1) then begin
                giq_option(4, 1463, 3754, Node3800, 50);
            end
            else begin
                giq_option(4, 1463, 3754, Node950, 50);
            end
        end
        if ((local_var(7) == 1) and (global_var(733) == 0)) then begin
            giq_option(4, 1463, 3756, Node1100, 50);
        end
    end
    giq_option(4, 1463, 3757, Node999, 50);
end

procedure Node3800
begin
    gsay_reply(1463, 3800 + (get_critter_stat(dude_obj, 34) == 1));
    set_global_var(794, 3);
    set_local_var(6, 1);
    set_local_var(7, 1);
    give_exp_points(350);
    display_msg(message_str(14, 100) + 350 + message_str(14, 101));
    if (get_critter_stat(dude_obj, 34) == 0) then begin
        giq_option(4, 1463, 3802, Node1100, 50);
    end
    if (get_critter_stat(dude_obj, 34) == 1) then begin
        giq_option(4, 1463, 3802, Node1120, 50);
    end
end

procedure In_face_of_Rodrigues1
begin
    game_ui_disable;
    gfade_out(1);
    set_global_var(632, global_var(632) bwor 64);
    if (party_member_obj(16777729) != 0) then begin
        if (party_member_obj(16777729)) then begin
            if (has_trait(1, party_member_obj(16777729), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777729)));
                set_global_var(632, global_var(632) bwor 1);
                set_obj_visibility(party_member_obj(16777729), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
        if (party_member_obj(16777779)) then begin
            if (has_trait(1, party_member_obj(16777779), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777779)));
                set_global_var(632, global_var(632) bwor 2);
                set_obj_visibility(party_member_obj(16777779), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
        if (party_member_obj(16777811)) then begin
            if (has_trait(1, party_member_obj(16777811), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777811)));
                set_global_var(632, global_var(632) bwor 4);
                set_obj_visibility(party_member_obj(16777811), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if (party_member_obj(16777812) != 0) then begin
        if (party_member_obj(16777812)) then begin
            if (has_trait(1, party_member_obj(16777812), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777812)));
                set_global_var(632, global_var(632) bwor 8);
                set_obj_visibility(party_member_obj(16777812), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if (party_member_obj(16777813) != 0) then begin
        if (party_member_obj(16777813)) then begin
            if (has_trait(1, party_member_obj(16777813), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777813)));
                set_global_var(632, global_var(632) bwor 16);
                set_obj_visibility(party_member_obj(16777813), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
        if (party_member_obj(16777814)) then begin
            if (has_trait(1, party_member_obj(16777814), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777814)));
                set_global_var(632, global_var(632) bwor 32);
                set_obj_visibility(party_member_obj(16777814), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    set_map_var(3, 1);
    move_to(dude_obj, 20527, 1);
    anim(dude_obj, 0, 0);
    anim(dude_obj, 1000, 5);
    add_timer_event(rodrigues, 4, 1);
end

procedure In_face_of_Rodrigues2
begin
    game_ui_disable;
    gfade_out(1);
    set_global_var(632, global_var(632) bwor 64);
    if (party_member_obj(16777729) != 0) then begin
        if (party_member_obj(16777729)) then begin
            if (has_trait(1, party_member_obj(16777729), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777729)));
                set_global_var(632, global_var(632) bwor 1);
                set_obj_visibility(party_member_obj(16777729), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
        if (party_member_obj(16777779)) then begin
            if (has_trait(1, party_member_obj(16777779), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777779)));
                set_global_var(632, global_var(632) bwor 2);
                set_obj_visibility(party_member_obj(16777779), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
        if (party_member_obj(16777811)) then begin
            if (has_trait(1, party_member_obj(16777811), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777811)));
                set_global_var(632, global_var(632) bwor 4);
                set_obj_visibility(party_member_obj(16777811), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if (party_member_obj(16777812) != 0) then begin
        if (party_member_obj(16777812)) then begin
            if (has_trait(1, party_member_obj(16777812), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777812)));
                set_global_var(632, global_var(632) bwor 8);
                set_obj_visibility(party_member_obj(16777812), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if (party_member_obj(16777813) != 0) then begin
        if (party_member_obj(16777813)) then begin
            if (has_trait(1, party_member_obj(16777813), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777813)));
                set_global_var(632, global_var(632) bwor 16);
                set_obj_visibility(party_member_obj(16777813), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
        if (party_member_obj(16777814)) then begin
            if (has_trait(1, party_member_obj(16777814), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777814)));
                set_global_var(632, global_var(632) bwor 32);
                set_obj_visibility(party_member_obj(16777814), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    set_map_var(3, 1);
    move_to(dude_obj, 20527, 1);
    anim(dude_obj, 0, 0);
    anim(dude_obj, 1000, 5);
    add_timer_event(rodrigues, 4, 2);
end

procedure Meeting_with_Tyler
begin
    game_ui_disable;
    gfade_out(1);
    set_global_var(632, global_var(632) bwor 64);
    if (party_member_obj(16777729) != 0) then begin
        if (party_member_obj(16777729)) then begin
            if (has_trait(1, party_member_obj(16777729), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777729)));
                set_global_var(632, global_var(632) bwor 1);
                set_obj_visibility(party_member_obj(16777729), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
        if (party_member_obj(16777779)) then begin
            if (has_trait(1, party_member_obj(16777779), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777779)));
                set_global_var(632, global_var(632) bwor 2);
                set_obj_visibility(party_member_obj(16777779), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
        if (party_member_obj(16777811)) then begin
            if (has_trait(1, party_member_obj(16777811), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777811)));
                set_global_var(632, global_var(632) bwor 4);
                set_obj_visibility(party_member_obj(16777811), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if (party_member_obj(16777812) != 0) then begin
        if (party_member_obj(16777812)) then begin
            if (has_trait(1, party_member_obj(16777812), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777812)));
                set_global_var(632, global_var(632) bwor 8);
                set_obj_visibility(party_member_obj(16777812), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if (party_member_obj(16777813) != 0) then begin
        if (party_member_obj(16777813)) then begin
            if (has_trait(1, party_member_obj(16777813), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777813)));
                set_global_var(632, global_var(632) bwor 16);
                set_obj_visibility(party_member_obj(16777813), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
        if (party_member_obj(16777814)) then begin
            if (has_trait(1, party_member_obj(16777814), 666)) then begin
                debug_msg("set party member hidden: " + obj_name(party_member_obj(16777814)));
                set_global_var(632, global_var(632) bwor 32);
                set_obj_visibility(party_member_obj(16777814), 1);
            end
            else begin
                debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
            end
        end
    end
    load_map(14, 0);
end

procedure Meeting_with_Raiders
begin
    game_ui_disable;
    gfade_out(1);
    load_map(87, 0);
end

procedure Check_For_Gun
begin
    variable LVar0 := 0;
    LVar0 := 0;
    lHandLeftPID := obj_pid(critter_inven_obj(dude_obj, 2));
    lHandRightPID := obj_pid(critter_inven_obj(dude_obj, 1));
    if ((lHandLeftPID > 0) or (lHandRightPID > 0)) then begin
        if ((lHandLeftPID == 300) or (lHandRightPID == 300)) then begin
            LVar0 := 1;
        end
        else begin
            if ((lHandLeftPID == 8) or (lHandRightPID == 8)) then begin
                LVar0 := 2;
            end
            else begin
                if ((lHandLeftPID == 9) or (lHandRightPID == 9)) then begin
                    LVar0 := 6;
                end
                else begin
                    if ((lHandLeftPID == 10) or (lHandRightPID == 10)) then begin
                        LVar0 := 5;
                    end
                    else begin
                        if ((lHandLeftPID == 12) or (lHandRightPID == 12)) then begin
                            LVar0 := 12;
                        end
                        else begin
                            if ((lHandLeftPID == 15) or (lHandRightPID == 15)) then begin
                                LVar0 := 11;
                            end
                            else begin
                                if ((lHandLeftPID == 16) or (lHandRightPID == 16)) then begin
                                    LVar0 := 8;
                                end
                                else begin
                                    if ((lHandLeftPID == 18) or (lHandRightPID == 18)) then begin
                                        LVar0 := 3;
                                    end
                                    else begin
                                        if ((lHandLeftPID == 22) or (lHandRightPID == 22)) then begin
                                            LVar0 := 3;
                                        end
                                        else begin
                                            if ((lHandLeftPID == 23) or (lHandRightPID == 23)) then begin
                                                LVar0 := 4;
                                            end
                                            else begin
                                                if ((lHandLeftPID == 24) or (lHandRightPID == 24)) then begin
                                                    LVar0 := 9;
                                                end
                                                else begin
                                                    if ((lHandLeftPID == 28) or (lHandRightPID == 28)) then begin
                                                        LVar0 := 13;
                                                    end
                                                    else begin
                                                        if ((lHandLeftPID == 94) or (lHandRightPID == 94)) then begin
                                                            LVar0 := 7;
                                                        end
                                                        else begin
                                                            if ((lHandLeftPID == 118) or (lHandRightPID == 118)) then begin
                                                                LVar0 := 10;
                                                            end
                                                            else begin
                                                                if ((lHandLeftPID == 120) or (lHandRightPID == 120)) then begin
                                                                    LVar0 := 14;
                                                                end
                                                                else begin
                                                                    if ((lHandLeftPID == 143) or (lHandRightPID == 143)) then begin
                                                                        LVar0 := 5;
                                                                    end
                                                                    else begin
                                                                        if ((lHandLeftPID == 161) or (lHandRightPID == 161)) then begin
                                                                            LVar0 := 15;
                                                                        end
                                                                        else begin
                                                                            if ((lHandLeftPID == 233) or (lHandRightPID == 233)) then begin
                                                                                LVar0 := 11;
                                                                            end
                                                                            else begin
                                                                                if ((lHandLeftPID == 241) or (lHandRightPID == 241)) then begin
                                                                                    LVar0 := 3;
                                                                                end
                                                                                else begin
                                                                                    if ((lHandLeftPID == 242) or (lHandRightPID == 242)) then begin
                                                                                        LVar0 := 7;
                                                                                    end
                                                                                    else begin
                                                                                        if ((lHandLeftPID == 261) or (lHandRightPID == 261)) then begin
                                                                                            LVar0 := 15;
                                                                                        end
                                                                                        else begin
                                                                                            if ((lHandLeftPID == 268) or (lHandRightPID == 268)) then begin
                                                                                                LVar0 := 7;
                                                                                            end
                                                                                            else begin
                                                                                                if ((lHandLeftPID == 287) or (lHandRightPID == 287)) then begin
                                                                                                    LVar0 := 5;
                                                                                                end
                                                                                                else begin
                                                                                                    if ((lHandLeftPID == 242) or (lHandRightPID == 242)) then begin
                                                                                                        LVar0 := 7;
                                                                                                    end
                                                                                                    else begin
                                                                                                        if ((lHandLeftPID == 299) or (lHandRightPID == 299)) then begin
                                                                                                            LVar0 := 5;
                                                                                                        end
                                                                                                        else begin
                                                                                                            if ((lHandLeftPID == 313) or (lHandRightPID == 313)) then begin
                                                                                                                LVar0 := 3;
                                                                                                            end
                                                                                                            else begin
                                                                                                                if ((lHandLeftPID == 390) or (lHandRightPID == 390)) then begin
                                                                                                                    LVar0 := 8;
                                                                                                                end
                                                                                                                else begin
                                                                                                                    if ((lHandLeftPID == 385) or (lHandRightPID == 385)) then begin
                                                                                                                        LVar0 := 7;
                                                                                                                    end
                                                                                                                    else begin
                                                                                                                        if ((lHandLeftPID == 389) or (lHandRightPID == 389)) then begin
                                                                                                                            LVar0 := 12;
                                                                                                                        end
                                                                                                                        else begin
                                                                                                                            if ((lHandLeftPID == 396) or (lHandRightPID == 396)) then begin
                                                                                                                                LVar0 := 14;
                                                                                                                            end
                                                                                                                            else begin
                                                                                                                                if ((lHandLeftPID == 398) or (lHandRightPID == 398)) then begin
                                                                                                                                    LVar0 := 3;
                                                                                                                                end
                                                                                                                                else begin
                                                                                                                                    if ((lHandLeftPID == 401) or (lHandRightPID == 401)) then begin
                                                                                                                                        LVar0 := 10;
                                                                                                                                    end
                                                                                                                                    else begin
                                                                                                                                        if ((lHandLeftPID == 402) or (lHandRightPID == 402)) then begin
                                                                                                                                            LVar0 := 8;
                                                                                                                                        end
                                                                                                                                        else begin
                                                                                                                                            if ((lHandLeftPID == 404) or (lHandRightPID == 404)) then begin
                                                                                                                                                LVar0 := 3;
                                                                                                                                            end
                                                                                                                                            else begin
                                                                                                                                                if ((lHandLeftPID == 405) or (lHandRightPID == 405)) then begin
                                                                                                                                                    LVar0 := 4;
                                                                                                                                                end
                                                                                                                                                else begin
                                                                                                                                                    if ((lHandLeftPID == 406) or (lHandRightPID == 406)) then begin
                                                                                                                                                        LVar0 := 9;
                                                                                                                                                    end
                                                                                                                                                    else begin
                                                                                                                                                        if ((lHandLeftPID == 585) or (lHandRightPID == 585)) then begin
                                                                                                                                                            LVar0 := 13;
                                                                                                                                                        end
                                                                                                                                                        else begin
                                                                                                                                                            if ((lHandLeftPID == 586) or (lHandRightPID == 586)) then begin
                                                                                                                                                                LVar0 := 16;
                                                                                                                                                            end
                                                                                                                                                            else begin
                                                                                                                                                                if ((lHandLeftPID == 587) or (lHandRightPID == 587)) then begin
                                                                                                                                                                    LVar0 := 5;
                                                                                                                                                                end
                                                                                                                                                                else begin
                                                                                                                                                                    if ((lHandLeftPID == 593) or (lHandRightPID == 593)) then begin
                                                                                                                                                                        LVar0 := 2;
                                                                                                                                                                    end
                                                                                                                                                                    else begin
                                                                                                                                                                        if ((lHandLeftPID == 594) or (lHandRightPID == 594)) then begin
                                                                                                                                                                            LVar0 := 8;
                                                                                                                                                                        end
                                                                                                                                                                        else begin
                                                                                                                                                                            if ((lHandLeftPID == 595) or (lHandRightPID == 595)) then begin
                                                                                                                                                                                LVar0 := 4;
                                                                                                                                                                            end
                                                                                                                                                                            else begin
                                                                                                                                                                                if ((lHandLeftPID == 596) or (lHandRightPID == 596)) then begin
                                                                                                                                                                                    LVar0 := 12;
                                                                                                                                                                                end
                                                                                                                                                                                else begin
                                                                                                                                                                                    if ((lHandLeftPID == 597) or (lHandRightPID == 597)) then begin
                                                                                                                                                                                        LVar0 := 11;
                                                                                                                                                                                    end
                                                                                                                                                                                    else begin
                                                                                                                                                                                        if ((lHandLeftPID == 598) or (lHandRightPID == 598)) then begin
                                                                                                                                                                                            LVar0 := 7;
                                                                                                                                                                                        end
                                                                                                                                                                                        else begin
                                                                                                                                                                                            if ((lHandLeftPID == 599) or (lHandRightPID == 599)) then begin
                                                                                                                                                                                                LVar0 := 9;
                                                                                                                                                                                            end
                                                                                                                                                                                            else begin
                                                                                                                                                                                                if ((lHandLeftPID == 602) or (lHandRightPID == 602)) then begin
                                                                                                                                                                                                    LVar0 := 6;
                                                                                                                                                                                                end
                                                                                                                                                                                                else begin
                                                                                                                                                                                                    if ((lHandLeftPID == 603) or (lHandRightPID == 603)) then begin
                                                                                                                                                                                                        LVar0 := 12;
                                                                                                                                                                                                    end
                                                                                                                                                                                                    else begin
                                                                                                                                                                                                        if ((lHandLeftPID == 605) or (lHandRightPID == 605)) then begin
                                                                                                                                                                                                            LVar0 := 8;
                                                                                                                                                                                                        end
                                                                                                                                                                                                        else begin
                                                                                                                                                                                                            if ((lHandLeftPID == 296) or (lHandRightPID == 296)) then begin
                                                                                                                                                                                                                LVar0 := 6;
                                                                                                                                                                                                            end
                                                                                                                                                                                                        end
                                                                                                                                                                                                    end
                                                                                                                                                                                                end
                                                                                                                                                                                            end
                                                                                                                                                                                        end
                                                                                                                                                                                    end
                                                                                                                                                                                end
                                                                                                                                                                            end
                                                                                                                                                                        end
                                                                                                                                                                    end
                                                                                                                                                                end
                                                                                                                                                            end
                                                                                                                                                        end
                                                                                                                                                    end
                                                                                                                                                end
                                                                                                                                            end
                                                                                                                                        end
                                                                                                                                    end
                                                                                                                                end
                                                                                                                            end
                                                                                                                        end
                                                                                                                    end
                                                                                                                end
                                                                                                            end
                                                                                                        end
                                                                                                    end
                                                                                                end
                                                                                            end
                                                                                        end
                                                                                    end
                                                                                end
                                                                            end
                                                                        end
                                                                    end
                                                                end
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    return LVar0;
end

