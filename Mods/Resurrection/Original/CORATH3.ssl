variable ProtoOfItemGiven;
variable ValueOfRollCheck := 1;
variable Scenery_Creation;
variable Scenery_Creation_Hex;
variable Scenery_Creation_Count;
variable Temp_Scenery_Creation_Hex;
variable Scenery_Creation_Ptr;
variable lPartyWornArmor;
variable How_Many_Party_Members_Are_Injured;
variable How_Many_Party_Members_Armed;
variable PartyHealingItem;

procedure checkPartyMembersNearDoor;

variable global_temp;
variable dest_tile;
variable step_tile;
variable in_dialog;
variable forced_node;
variable restock_amt;
variable restock_obj;
variable restock_trash;
variable removed_qty;
variable toRemove_qty;

procedure div(variable arg0, variable arg1);

export variable Trixie_obj;
export variable Marylin_obj;
export variable Suzan_obj;
export variable Valerie_obj;
export variable Abby_obj;
export variable Dolly_obj;
export variable Ademar_obj;
export variable map_event;
export variable nestor_door;
export variable Blasterguard_obj;
export variable items_carrier;
export variable Nestor;
export variable Bill_obj;

variable sequence;
variable sequence2;
variable sequence3;
variable miner1;
variable miner2;
variable miner3;
variable miner4;
variable miner5;
variable miner6;
variable miner7;
variable miner8;
variable police1;
variable police2;
variable police3;
variable police4;
variable police5;
variable zastupce;
variable cedrick;
variable strclovek;

procedure start;
procedure map_enter_p_proc;
procedure map_update_p_proc;
procedure map_exit_p_proc;
procedure timed_event_p_proc;
procedure Generate_Rebelion;


procedure checkPartyMembersNearDoor
begin
    if (party_member_obj(16777729) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777729)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777779)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777811)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777812) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777812)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777813) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777813)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777814)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777748) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777748)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777294) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777294)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778017) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778017)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778016) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778016)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778049) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778049)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778050) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778050)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778051) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778051)) <= 5) then begin
            return 1;
        end
    end
    return 0;
end

procedure div(variable arg0, variable arg1)
begin
    if (0 > arg0) then begin
        return -(-arg0 / arg1);
    end
    return arg0 / arg1;
end

procedure start
begin
    map_event := self_obj;
end

procedure map_enter_p_proc
begin
    if ((get_month >= 3) and (get_month < 5)) then begin
        if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
            set_light_level(game_time_hour - 600 + 40);
        end
        else begin
            if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                set_light_level(100);
            end
            else begin
                if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                    set_light_level(100 - (game_time_hour - 1800));
                end
                else begin
                    set_light_level(40);
                end
            end
        end
    end
    else begin
        if ((get_month >= 5) and (get_month < 9)) then begin
            if ((game_time_hour >= 500) and (game_time_hour < (500 + 100))) then begin
                set_light_level(game_time_hour - 500 + 40);
            end
            else begin
                if ((game_time_hour >= (500 + 100)) and (game_time_hour < 1900)) then begin
                    set_light_level(100);
                end
                else begin
                    if ((game_time_hour >= 1900) and (game_time_hour < (1900 + 100))) then begin
                        set_light_level(100 - (game_time_hour - 1900));
                    end
                    else begin
                        set_light_level(40);
                    end
                end
            end
        end
        else begin
            if ((get_month >= 9) and (get_month < 11)) then begin
                if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                    set_light_level(game_time_hour - 600 + 40);
                end
                else begin
                    if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1800));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
            else begin
                if ((game_time_hour >= 700) and (game_time_hour < (700 + 100))) then begin
                    set_light_level(game_time_hour - 700 + 40);
                end
                else begin
                    if ((game_time_hour >= (700 + 100)) and (game_time_hour < 1700)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1700) and (game_time_hour < (1700 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1700));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
        end
    end
    if ((global_var(841) == 3) and (map_var(3) == 0)) then begin
        call Generate_Rebelion();
        game_ui_disable;
        add_timer_event(self_obj, 0, 1);
    end
    if (global_var(849) == 5) then begin
        game_ui_disable;
        add_timer_event(self_obj, 0, 50);
    end
    if ((global_var(848) == 1) and not((map_var(0) bwand 64) != 0)) then begin
        strclovek := create_object_sid(16777898, 9090, 0, 1573);
        anim(strclovek, 1000, 2);
        restock_obj := create_object_sid(242, 0, 0, -1);
        add_mult_objs_to_inven(strclovek, restock_obj, 1);
        restock_obj := create_object_sid(95, 0, 0, -1);
        add_mult_objs_to_inven(strclovek, restock_obj, 1);
        wield_obj_critter(strclovek, obj_carrying_pid_obj(strclovek, 242));
        set_map_var(0, map_var(0) bwor 64);
    end
end

procedure map_update_p_proc
begin
    if ((get_month >= 3) and (get_month < 5)) then begin
        if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
            set_light_level(game_time_hour - 600 + 40);
        end
        else begin
            if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                set_light_level(100);
            end
            else begin
                if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                    set_light_level(100 - (game_time_hour - 1800));
                end
                else begin
                    set_light_level(40);
                end
            end
        end
    end
    else begin
        if ((get_month >= 5) and (get_month < 9)) then begin
            if ((game_time_hour >= 500) and (game_time_hour < (500 + 100))) then begin
                set_light_level(game_time_hour - 500 + 40);
            end
            else begin
                if ((game_time_hour >= (500 + 100)) and (game_time_hour < 1900)) then begin
                    set_light_level(100);
                end
                else begin
                    if ((game_time_hour >= 1900) and (game_time_hour < (1900 + 100))) then begin
                        set_light_level(100 - (game_time_hour - 1900));
                    end
                    else begin
                        set_light_level(40);
                    end
                end
            end
        end
        else begin
            if ((get_month >= 9) and (get_month < 11)) then begin
                if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                    set_light_level(game_time_hour - 600 + 40);
                end
                else begin
                    if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1800));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
            else begin
                if ((game_time_hour >= 700) and (game_time_hour < (700 + 100))) then begin
                    set_light_level(game_time_hour - 700 + 40);
                end
                else begin
                    if ((game_time_hour >= (700 + 100)) and (game_time_hour < 1700)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1700) and (game_time_hour < (1700 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1700));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
        end
    end
end

procedure map_exit_p_proc
begin
end

procedure timed_event_p_proc
begin
    if (map_var(3) == 0) then begin
        if (fixed_param == 1) then begin
            if (fixed_param == 1) then begin
                sequence := sequence + 1;
            end
            if (sequence == 1) then begin
                set_obj_visibility(dude_obj, 1);
                move_to(dude_obj, 8892, 0);
                metarule3(108, 10293, 0, 0);
                set_global_var(632, global_var(632) bwor 64);
                if (party_member_obj(16777729) != 0) then begin
                    if (party_member_obj(16777729)) then begin
                        if (has_trait(1, party_member_obj(16777729), 666)) then begin
                            debug_msg("set party member hidden: " + obj_name(party_member_obj(16777729)));
                            set_global_var(632, global_var(632) bwor 1);
                            set_obj_visibility(party_member_obj(16777729), 1);
                        end
                        else begin
                            debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                        end
                    end
                end
                if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                    if (party_member_obj(16777779)) then begin
                        if (has_trait(1, party_member_obj(16777779), 666)) then begin
                            debug_msg("set party member hidden: " + obj_name(party_member_obj(16777779)));
                            set_global_var(632, global_var(632) bwor 2);
                            set_obj_visibility(party_member_obj(16777779), 1);
                        end
                        else begin
                            debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                        end
                    end
                end
                if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                    if (party_member_obj(16777811)) then begin
                        if (has_trait(1, party_member_obj(16777811), 666)) then begin
                            debug_msg("set party member hidden: " + obj_name(party_member_obj(16777811)));
                            set_global_var(632, global_var(632) bwor 4);
                            set_obj_visibility(party_member_obj(16777811), 1);
                        end
                        else begin
                            debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                        end
                    end
                end
                if (party_member_obj(16777812) != 0) then begin
                    if (party_member_obj(16777812)) then begin
                        if (has_trait(1, party_member_obj(16777812), 666)) then begin
                            debug_msg("set party member hidden: " + obj_name(party_member_obj(16777812)));
                            set_global_var(632, global_var(632) bwor 8);
                            set_obj_visibility(party_member_obj(16777812), 1);
                        end
                        else begin
                            debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                        end
                    end
                end
                if (party_member_obj(16777813) != 0) then begin
                    if (party_member_obj(16777813)) then begin
                        if (has_trait(1, party_member_obj(16777813), 666)) then begin
                            debug_msg("set party member hidden: " + obj_name(party_member_obj(16777813)));
                            set_global_var(632, global_var(632) bwor 16);
                            set_obj_visibility(party_member_obj(16777813), 1);
                        end
                        else begin
                            debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                        end
                    end
                end
                if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                    if (party_member_obj(16777814)) then begin
                        if (has_trait(1, party_member_obj(16777814), 666)) then begin
                            debug_msg("set party member hidden: " + obj_name(party_member_obj(16777814)));
                            set_global_var(632, global_var(632) bwor 32);
                            set_obj_visibility(party_member_obj(16777814), 1);
                        end
                        else begin
                            debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                        end
                    end
                end
                add_timer_event(self_obj, game_ticks(1), 1);
            end
            if (sequence == 2) then begin
                metarule3(108, 10293, 0, 0);
                anim(dude_obj, 1000, 2);
                animate_move_obj_to_tile(miner1, 10692, 0);
                reg_anim_func(2, police4);
                reg_anim_func(1, 1);
                reg_anim_animate(police4, 45, -1);
                play_sfx("whd1fxx1");
                reg_anim_func(3, 0);
                reg_anim_func(2, miner2);
                reg_anim_func(1, 1);
                reg_anim_animate(miner2, 13, -1);
                reg_anim_func(3, 0);
                reg_anim_func(3, 0);
                reg_anim_func(2, miner8);
                reg_anim_func(1, 1);
                reg_anim_animate(miner8, 16, -1);
                reg_anim_func(3, 0);
                reg_anim_func(2, police1);
                reg_anim_func(1, 1);
                reg_anim_animate(police1, 14, -1);
                play_sfx("whg1sxx1");
                reg_anim_func(3, 0);
                add_timer_event(self_obj, game_ticks(1), 1);
            end
            if (sequence == 3) then begin
                play_sfx("whd1fxx1");
                reg_anim_func(2, miner1);
                reg_anim_func(1, 1);
                reg_anim_animate(miner1, 13, -1);
                reg_anim_func(3, 0);
                reg_anim_func(2, miner2);
                reg_anim_func(1, 1);
                reg_anim_animate(miner2, 20, -1);
                reg_anim_func(3, 0);
                reg_anim_func(2, police4);
                reg_anim_func(1, 1);
                reg_anim_animate(police4, 45, -1);
                play_sfx("whg1sxx1");
                reg_anim_func(3, 0);
                reg_anim_func(2, police5);
                reg_anim_func(1, 1);
                reg_anim_animate(police5, 45, -1);
                play_sfx("whd1fxx1");
                reg_anim_func(3, 0);
                add_timer_event(self_obj, game_ticks(1), 1);
            end
            if (sequence == 4) then begin
                reg_anim_func(2, miner1);
                reg_anim_func(1, 1);
                play_sfx("whd1fxx1");
                reg_anim_animate(miner1, 34, -1);
                reg_anim_func(3, 0);
                reg_anim_func(2, police3);
                reg_anim_func(1, 1);
                reg_anim_animate(police3, 45, -1);
                play_sfx("whg1sxx1");
                reg_anim_func(3, 0);
                reg_anim_func(3, 0);
                reg_anim_func(2, miner8);
                reg_anim_func(1, 1);
                reg_anim_animate(miner8, 14, -1);
                reg_anim_func(3, 0);
                reg_anim_func(2, police1);
                reg_anim_func(1, 1);
                reg_anim_animate(police1, 17, -1);
                play_sfx("whg1sxx1");
                reg_anim_func(3, 0);
                reg_anim_func(2, miner2);
                reg_anim_func(1, 1);
                reg_anim_animate(miner2, 37, -1);
                reg_anim_func(3, 0);
                add_timer_event(self_obj, game_ticks(1), 1);
            end
            if (sequence == 5) then begin
                play_sfx("whd1fxx1");
                reg_anim_func(2, police5);
                reg_anim_func(1, 1);
                reg_anim_animate(police5, 46, -1);
                play_sfx("WAD2XXX1");
                reg_anim_func(3, 0);
                reg_anim_func(2, miner2);
                reg_anim_func(1, 1);
                reg_anim_animate(miner2, 26, -1);
                play_sfx("HMXXXXBG");
                reg_anim_func(3, 0);
                reg_anim_func(2, miner8);
                reg_anim_func(1, 1);
                reg_anim_animate(miner8, 23, -1);
                reg_anim_func(3, 0);
                reg_anim_func(2, police3);
                reg_anim_func(1, 1);
                reg_anim_animate(police3, 45, -1);
                reg_anim_func(3, 0);
                anim(police4, 1000, 0);
                reg_anim_func(2, police4);
                reg_anim_func(1, 1);
                reg_anim_animate(police4, 45, -1);
                reg_anim_func(3, 0);
                anim(police2, 1000, 4);
                reg_anim_func(2, police2);
                reg_anim_func(1, 1);
                reg_anim_animate(police2, 45, -1);
                reg_anim_func(3, 0);
                add_timer_event(self_obj, game_ticks(3), 1);
            end
            if (sequence == 6) then begin
                float_msg(police5, message_str(1532, 500), 2);
                kill_critter(miner1, 34);
                kill_critter(miner2, 24);
                kill_critter(miner3, 34);
                kill_critter(miner4, 35);
                kill_critter(miner5, 34);
                kill_critter(miner6, 35);
                kill_critter(miner7, 35);
                kill_critter(miner8, 23);
                add_timer_event(self_obj, game_ticks(4), 1);
            end
            if (sequence == 7) then begin
                set_obj_visibility(dude_obj, 0);
                animate_move_obj_to_tile(dude_obj, 9492, 0);
                add_timer_event(self_obj, game_ticks(1), 1);
            end
            if (sequence == 8) then begin
                set_global_var(632, global_var(632) bwand (-1 - 64));
                if (party_member_obj(16777729) != 0) then begin
                    if (party_member_obj(16777729)) then begin
                        if (has_trait(1, party_member_obj(16777729), 666) == 0) then begin
                            if ((global_var(632) bwand 1) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777729)));
                                set_global_var(632, global_var(632) bwand (-1 - 1));
                                set_obj_visibility(party_member_obj(16777729), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777729)));
                            set_global_var(632, global_var(632) bwand (-1 - 1));
                            set_obj_visibility(party_member_obj(16777729), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                    if (party_member_obj(16777779)) then begin
                        if (has_trait(1, party_member_obj(16777779), 666) == 0) then begin
                            if ((global_var(632) bwand 2) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777779)));
                                set_global_var(632, global_var(632) bwand (-1 - 2));
                                set_obj_visibility(party_member_obj(16777779), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777779)));
                            set_global_var(632, global_var(632) bwand (-1 - 2));
                            set_obj_visibility(party_member_obj(16777779), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                    if (party_member_obj(16777811)) then begin
                        if (has_trait(1, party_member_obj(16777811), 666) == 0) then begin
                            if ((global_var(632) bwand 4) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777811)));
                                set_global_var(632, global_var(632) bwand (-1 - 4));
                                set_obj_visibility(party_member_obj(16777811), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777811)));
                            set_global_var(632, global_var(632) bwand (-1 - 4));
                            set_obj_visibility(party_member_obj(16777811), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if (party_member_obj(16777812) != 0) then begin
                    if (party_member_obj(16777812)) then begin
                        if (has_trait(1, party_member_obj(16777812), 666) == 0) then begin
                            if ((global_var(632) bwand 8) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777812)));
                                set_global_var(632, global_var(632) bwand (-1 - 8));
                                set_obj_visibility(party_member_obj(16777812), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777812)));
                            set_global_var(632, global_var(632) bwand (-1 - 8));
                            set_obj_visibility(party_member_obj(16777812), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if (party_member_obj(16777813) != 0) then begin
                    if (party_member_obj(16777813)) then begin
                        if (has_trait(1, party_member_obj(16777813), 666) == 0) then begin
                            if ((global_var(632) bwand 16) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777813)));
                                set_global_var(632, global_var(632) bwand (-1 - 16));
                                set_obj_visibility(party_member_obj(16777813), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777813)));
                            set_global_var(632, global_var(632) bwand (-1 - 16));
                            set_obj_visibility(party_member_obj(16777813), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                    if (party_member_obj(16777814)) then begin
                        if (has_trait(1, party_member_obj(16777814), 666) == 0) then begin
                            if ((global_var(632) bwand 32) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777814)));
                                set_global_var(632, global_var(632) bwand (-1 - 32));
                                set_obj_visibility(party_member_obj(16777814), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777814)));
                            set_global_var(632, global_var(632) bwand (-1 - 32));
                            set_obj_visibility(party_member_obj(16777814), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if (party_member_obj(16777729) != 0) then begin
                    if (party_member_obj(16777729) != 0) then begin
                        if (has_trait(1, party_member_obj(16777729), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                    if (party_member_obj(16777779) != 0) then begin
                        if (has_trait(1, party_member_obj(16777779), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                    if (party_member_obj(16777811) != 0) then begin
                        if (has_trait(1, party_member_obj(16777811), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16777812) != 0) then begin
                    if (party_member_obj(16777812) != 0) then begin
                        if (has_trait(1, party_member_obj(16777812), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                    if (party_member_obj(16777814) != 0) then begin
                        if (has_trait(1, party_member_obj(16777814), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16777748) != 0) then begin
                    if (party_member_obj(16777748) != 0) then begin
                        if (has_trait(1, party_member_obj(16777748), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778017) != 0) then begin
                    if (party_member_obj(16778017) != 0) then begin
                        if (has_trait(1, party_member_obj(16778017), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778016) != 0) then begin
                    if (party_member_obj(16778016) != 0) then begin
                        if (has_trait(1, party_member_obj(16778016), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778049) != 0) then begin
                    if (party_member_obj(16778049) != 0) then begin
                        if (has_trait(1, party_member_obj(16778049), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778050) != 0) then begin
                    if (party_member_obj(16778050) != 0) then begin
                        if (has_trait(1, party_member_obj(16778050), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778051) != 0) then begin
                    if (party_member_obj(16778051) != 0) then begin
                        if (has_trait(1, party_member_obj(16778051), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16777294) != 0) then begin
                    if (party_member_obj(16777294) != 0) then begin
                        if (has_trait(1, party_member_obj(16777294), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16777729) != 0) then begin
                    anim(party_member_obj(16777729), 1000, 2);
                end
                if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                    anim(party_member_obj(16777779), 1000, 2);
                end
                if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                    anim(party_member_obj(16777811), 1000, 2);
                end
                if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                    anim(party_member_obj(16777814), 1000, 2);
                end
                if (party_member_obj(16778017) != 0) then begin
                    anim(party_member_obj(16778017), 1000, 2);
                end
                if (party_member_obj(16778016) != 0) then begin
                    anim(party_member_obj(16778016), 1000, 2);
                end
                if (party_member_obj(16778049) != 0) then begin
                    anim(party_member_obj(16778049), 1000, 2);
                end
                if (party_member_obj(16778050) != 0) then begin
                    anim(party_member_obj(16778050), 1000, 2);
                end
                if (party_member_obj(16778051) != 0) then begin
                    anim(party_member_obj(16778051), 1000, 2);
                end
                if (party_member_obj(16777812) != 0) then begin
                    anim(party_member_obj(16777812), 1000, 2);
                end
                animate_move_obj_to_tile(police5, 10093, 0);
                add_timer_event(self_obj, game_ticks(3), 1);
            end
            if (sequence == 9) then begin
                game_ui_enable;
                add_timer_event(police5, game_ticks(0), 5);
            end
        end
        if (fixed_param == 2) then begin
            if (fixed_param == 2) then begin
                sequence3 := sequence3 + 1;
            end
            if (sequence3 == 1) then begin
                game_ui_disable;
                add_timer_event(self_obj, game_ticks(1), 2);
            end
            if (sequence3 == 2) then begin
                animate_move_obj_to_tile(police5, 14296, 0);
                add_timer_event(self_obj, game_ticks(2), 2);
            end
            if (sequence3 == 3) then begin
                animate_move_obj_to_tile(police1, 14094, 0);
                animate_move_obj_to_tile(police2, 14495, 0);
                animate_move_obj_to_tile(police3, 14495, 0);
                animate_move_obj_to_tile(police4, 14296, 0);
                add_timer_event(self_obj, game_ticks(6), 2);
            end
            if (sequence3 == 4) then begin
                gfade_out(600);
                add_timer_event(self_obj, game_ticks(1), 2);
            end
            if (sequence3 == 5) then begin
                destroy_object(police1);
                destroy_object(police2);
                destroy_object(police3);
                destroy_object(police4);
                destroy_object(police5);
                add_timer_event(self_obj, game_ticks(1), 2);
            end
            if (sequence3 == 6) then begin
                gfade_in(600);
                add_timer_event(self_obj, game_ticks(1), 2);
            end
            if (sequence3 == 7) then begin
                sequence := 0;
                sequence3 := 0;
                set_map_var(3, 1);
                game_ui_enable;
                rm_timer_event(self_obj);
            end
        end
    end
    if (global_var(849) == 5) then begin
        if (fixed_param == 50) then begin
            sequence2 := sequence2 + 1;
        end
        if (sequence2 == 1) then begin
            cedrick := create_object_sid(16777897, 14718, 0, -1);
            anim(cedrick, 1000, 5);
            anim(Ademar_obj, 1000, 2);
            move_to(dude_obj, 15120, 0);
            anim(dude_obj, 1000, 5);
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            metarule3(108, 14118, 0, 0);
            add_timer_event(self_obj, game_ticks(2), 50);
        end
        if (sequence2 == 2) then begin
            float_msg(Ademar_obj, message_str(1532, 1000), 2);
            add_timer_event(self_obj, game_ticks(6), 50);
        end
        if (sequence2 == 3) then begin
            float_msg(cedrick, message_str(1532, 1100), 8);
            add_timer_event(self_obj, game_ticks(6), 50);
        end
        if (sequence2 == 4) then begin
            float_msg(Ademar_obj, message_str(1532, 1200), 2);
            add_timer_event(self_obj, game_ticks(9), 50);
        end
        if (sequence2 == 5) then begin
            float_msg(dude_obj, message_str(1532, 1300), 9);
            add_timer_event(self_obj, game_ticks(4), 50);
        end
        if (sequence2 == 6) then begin
            float_msg(Ademar_obj, message_str(1532, 1400), 2);
            add_timer_event(self_obj, game_ticks(6), 50);
        end
        if (sequence2 == 7) then begin
            float_msg(cedrick, message_str(1532, 1500), 8);
            add_timer_event(self_obj, game_ticks(8), 50);
        end
        if (sequence2 == 8) then begin
            float_msg(Ademar_obj, message_str(1532, 1600), 2);
            add_timer_event(self_obj, game_ticks(5), 50);
        end
        if (sequence2 == 9) then begin
            float_msg(cedrick, message_str(1532, 1700), 8);
            add_timer_event(self_obj, game_ticks(5), 50);
        end
        if (sequence2 == 10) then begin
            float_msg(Ademar_obj, message_str(1532, 1800), 2);
            add_timer_event(self_obj, game_ticks(7), 50);
        end
        if (sequence2 == 11) then begin
            float_msg(cedrick, message_str(1532, 1900), 8);
            add_timer_event(self_obj, game_ticks(7), 50);
        end
        if (sequence2 == 12) then begin
            sequence2 := 0;
            anim(Ademar_obj, 1000, 2);
            destroy_object(cedrick);
            game_ui_enable;
            load_map("CORATH1.MAP", 0);
        end
    end
end

procedure Generate_Rebelion
begin
    play_sfx("whd1fxx1");
    miner1 := create_object_sid(16777880, 9092, 0, 1570);
    anim(miner1, 1000, 2);
    restock_obj := create_object_sid(6, 0, 0, -1);
    add_mult_objs_to_inven(miner1, restock_obj, 1);
    miner2 := create_object_sid(16777878, 10093, 0, 1570);
    anim(miner2, 1000, 2);
    restock_obj := create_object_sid(6, 0, 0, -1);
    add_mult_objs_to_inven(miner2, restock_obj, 1);
    miner3 := create_object_sid(16777879, 11693, 0, 1570);
    anim(miner3, 1000, 5);
    restock_obj := create_object_sid(6, 0, 0, -1);
    add_mult_objs_to_inven(miner3, restock_obj, 1);
    restock_obj := create_object_sid(22, 0, 0, -1);
    add_mult_objs_to_inven(miner3, restock_obj, 1);
    miner4 := create_object_sid(16777879, 9897, 0, 1570);
    anim(miner4, 1000, 2);
    restock_obj := create_object_sid(6, 0, 0, -1);
    add_mult_objs_to_inven(miner4, restock_obj, 1);
    restock_obj := create_object_sid(23, 0, 0, -1);
    add_mult_objs_to_inven(miner4, restock_obj, 1);
    miner5 := create_object_sid(16777878, 9699, 0, 1570);
    anim(miner5, 1000, 0);
    restock_obj := create_object_sid(6, 0, 0, -1);
    add_mult_objs_to_inven(miner5, restock_obj, 1);
    miner6 := create_object_sid(16777881, 10693, 0, 1570);
    anim(miner6, 1000, 3);
    miner7 := create_object_sid(16777879, 9690, 0, 1570);
    anim(miner7, 1000, 3);
    restock_obj := create_object_sid(6, 0, 0, -1);
    add_mult_objs_to_inven(miner7, restock_obj, 1);
    miner8 := create_object_sid(16777881, 9487, 0, 1570);
    anim(miner8, 1000, 0);
    police1 := create_object_sid(16777895, 9286, 0, 1571);
    anim(police1, 1000, 3);
    police2 := create_object_sid(16777895, 10691, 0, 1571);
    anim(police2, 1000, 5);
    police3 := create_object_sid(16777894, 9699, 0, 1571);
    anim(police3, 1000, 1);
    police4 := create_object_sid(16777894, 10695, 0, 1571);
    anim(police4, 1000, 5);
    police5 := create_object_sid(16777894, 11293, 0, 526);
    anim(police5, 1000, 5);
    restock_obj := create_object_sid(18, 0, 0, -1);
    add_mult_objs_to_inven(police1, restock_obj, 1);
    restock_obj := create_object_sid(23, 0, 0, -1);
    add_mult_objs_to_inven(police2, restock_obj, 1);
    restock_obj := create_object_sid(18, 0, 0, -1);
    add_mult_objs_to_inven(police3, restock_obj, 1);
    restock_obj := create_object_sid(23, 0, 0, -1);
    add_mult_objs_to_inven(police4, restock_obj, 1);
    restock_obj := create_object_sid(23, 0, 0, -1);
    add_mult_objs_to_inven(police5, restock_obj, 1);
    wield_obj_critter(police1, obj_carrying_pid_obj(police1, 18));
    wield_obj_critter(police2, obj_carrying_pid_obj(police2, 23));
    wield_obj_critter(police3, obj_carrying_pid_obj(police3, 18));
    wield_obj_critter(police4, obj_carrying_pid_obj(police4, 23));
    wield_obj_critter(police5, obj_carrying_pid_obj(police5, 23));
    reg_anim_func(2, miner2);
    reg_anim_func(2, miner4);
    reg_anim_func(2, miner5);
    reg_anim_func(2, miner6);
    reg_anim_func(2, miner7);
    reg_anim_func(1, 1);
    reg_anim_animate(miner3, 34, -1);
    play_sfx("whd1fxx1");
    reg_anim_func(3, 0);
    reg_anim_func(1, 1);
    reg_anim_animate(miner4, 35, -1);
    reg_anim_func(3, 0);
    reg_anim_func(1, 1);
    reg_anim_animate(miner5, 34, -1);
    reg_anim_func(3, 0);
    reg_anim_func(1, 1);
    reg_anim_animate(miner6, 35, -1);
    reg_anim_func(3, 0);
    reg_anim_func(1, 1);
    reg_anim_animate(miner7, 35, -1);
    reg_anim_func(3, 0);
    float_msg(miner1, message_str(1532, 409), 2);
    float_msg(miner2, message_str(1532, 410), 2);
    float_msg(miner8, message_str(1532, 411), 2);
end

