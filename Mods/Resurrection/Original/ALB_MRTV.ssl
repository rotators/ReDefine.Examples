variable ProtoOfItemGiven;
variable ValueOfRollCheck := 1;
variable Scenery_Creation;
variable Scenery_Creation_Hex;
variable Scenery_Creation_Count;
variable Temp_Scenery_Creation_Hex;
variable Scenery_Creation_Ptr;
variable lPartyWornArmor;
variable How_Many_Party_Members_Are_Injured;
variable How_Many_Party_Members_Armed;
variable PartyHealingItem;

procedure checkPartyMembersNearDoor;

variable global_temp;
variable dest_tile;
variable step_tile;
variable in_dialog;
variable forced_node;
variable restock_amt;
variable restock_obj;
variable restock_trash;
variable removed_qty;
variable toRemove_qty;

procedure div(variable arg0, variable arg1);
procedure start;
procedure map_enter_p_proc;
procedure map_update_p_proc;
procedure map_exit_p_proc;
procedure timed_event_p_proc;
procedure Generate_Ghouls;
procedure Generate_Primitives;
procedure Generate_Primitives_Own_Attack;
procedure Generate_Primitives_Own_Attack_With_Imperial;
procedure Generate_Imperial_Soldiers;
procedure Generate_Dead_Soldiers;
procedure Generate_Exploded_Soldiers;
procedure Generate_Arans_Soldiers;
procedure Generate_Dude_Soldiers;

export variable Map_event;
export variable Dutch_obj;
export variable Ghouls_obj;
export variable HunterFloater_obj;
export variable hunter_guard1;
export variable hunter_guard2;
export variable Falber_obj;
export variable Hunar_obj;
export variable Gurgan_obj;
export variable Primit1_obj;
export variable Primit2_obj;
export variable Primit3_obj;
export variable Primit4_obj;
export variable Primit5_obj;
export variable Primit6_obj;
export variable Primit7_obj;
export variable Doktor1_obj;
export variable Doktor2_obj;
export variable Doktor3_obj;
export variable Doktor4_obj;
export variable Doktor5_obj;
export variable EmperorSoldier1_obj;
export variable EmperorSoldier2_obj;
export variable EmperorSoldier3_obj;
export variable EmperorSoldier4_obj;
export variable EmperorSoldier5_obj;
export variable Anozol1_obj;
export variable Anozol2_obj;
export variable Anozol3_obj;
export variable Anozol4_obj;
export variable Elisa_obj;
export variable Aran_obj;
export variable Vez1_obj;
export variable Vez2_obj;
export variable Vez3_obj;
export variable Vez4_obj;
export variable Vez5_obj;
export variable Vez6_obj;
export variable cisvoj_obj;
export variable cisdoor_obj;
export variable AnemDoor1;
export variable AnemDoor2;
export variable AnemDoor3;
export variable AnonymGuard_Obj;

variable enemy_lovci;
variable special_event;
variable enemy_hospital;
variable Projed_smycku;
variable to_see_anim_hunters;
variable to_see_anim_emeror;
variable to_see_anim_shelter;
variable sequence;
variable sequence2;
variable lorian;
variable catherine;
variable sophia;
variable gh1;
variable gh2;
variable gh3;
variable gh4;
variable gh5;
variable gh6;
variable gurgan;
variable pr1;
variable pr2;
variable pr3;
variable pr4;
variable pr5;
variable pr6;
variable pr7;
variable is1;
variable is2;
variable is3;
variable is4;
variable is5;
variable is6;
variable is7;
variable is8;
variable is9;
variable is10;
variable aran;
variable nm1;
variable nm2;
variable nm3;
variable nm4;
variable nm5;
variable nm6;
variable ubozak;
variable fetak;
variable mario;


procedure checkPartyMembersNearDoor
begin
    if (party_member_obj(16777729) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777729)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777779)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777811)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777812) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777812)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777813) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777813)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777814)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777748) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777748)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777294) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777294)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778017) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778017)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778016) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778016)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778049) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778049)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778050) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778050)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778051) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778051)) <= 5) then begin
            return 1;
        end
    end
    return 0;
end

procedure div(variable arg0, variable arg1)
begin
    if (0 > arg0) then begin
        return -(-arg0 / arg1);
    end
    return arg0 / arg1;
end

procedure start
begin
    Map_event := self_obj;
end

procedure map_enter_p_proc
begin
    if (elevation(dude_obj) == 0) then begin
        if ((get_month >= 3) and (get_month < 5)) then begin
            if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                set_light_level(game_time_hour - 600 + 40);
            end
            else begin
                if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                    set_light_level(100);
                end
                else begin
                    if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                        set_light_level(100 - (game_time_hour - 1800));
                    end
                    else begin
                        set_light_level(40);
                    end
                end
            end
        end
        else begin
            if ((get_month >= 5) and (get_month < 9)) then begin
                if ((game_time_hour >= 500) and (game_time_hour < (500 + 100))) then begin
                    set_light_level(game_time_hour - 500 + 40);
                end
                else begin
                    if ((game_time_hour >= (500 + 100)) and (game_time_hour < 1900)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1900) and (game_time_hour < (1900 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1900));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
            else begin
                if ((get_month >= 9) and (get_month < 11)) then begin
                    if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                        set_light_level(game_time_hour - 600 + 40);
                    end
                    else begin
                        if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                            set_light_level(100);
                        end
                        else begin
                            if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                                set_light_level(100 - (game_time_hour - 1800));
                            end
                            else begin
                                set_light_level(40);
                            end
                        end
                    end
                end
                else begin
                    if ((game_time_hour >= 700) and (game_time_hour < (700 + 100))) then begin
                        set_light_level(game_time_hour - 700 + 40);
                    end
                    else begin
                        if ((game_time_hour >= (700 + 100)) and (game_time_hour < 1700)) then begin
                            set_light_level(100);
                        end
                        else begin
                            if ((game_time_hour >= 1700) and (game_time_hour < (1700 + 100))) then begin
                                set_light_level(100 - (game_time_hour - 1700));
                            end
                            else begin
                                set_light_level(40);
                            end
                        end
                    end
                end
            end
        end
    end
    else begin
        set_light_level(50);
    end
    Projed_smycku := 0;
    if (not(metarule(22, 0))) then begin
        special_event := 0;
        if (((global_var(904) bwand 67108864) != 0) and ((game_time - global_var(1003)) > (24 * (60 * (60 * 10)) * 6)) and not((map_var(0) bwand 16384) != 0)) then begin
            if ((map_var(0) bwand 262144) != 0) then begin
                set_map_var(0, map_var(0) bwand (-1 - 262144));
            end
            if ((map_var(0) bwand 524288) != 0) then begin
                set_map_var(0, map_var(0) bwand (-1 - 524288));
            end
            if ((map_var(0) bwand 1048576) != 0) then begin
                set_map_var(0, map_var(0) bwand (-1 - 1048576));
            end
            if ((map_var(0) bwand 2097152) != 0) then begin
                set_map_var(0, map_var(0) bwand (-1 - 2097152));
            end
        end
        if ((global_var(876) == 2) or (global_var(883) == 1)) then begin
        end
        else begin
            if ((global_var(876) == 1) and (global_var(891) < 6) and ((game_time - global_var(1031)) > (24 * (60 * (60 * 10)) * 3))) then begin
                set_global_var(893, 7);
                set_global_var(865, global_var(865) bwor 32768);
                set_global_var(876, 0);
                set_global_var(1019, global_var(1019) bwand (-1 - 65536));
                if ((global_var(1017) bwand 4) != 0) then begin
                    to_see_anim_emeror := 1;
                end
                if ((global_var(1017) bwand 2) != 0) then begin
                    to_see_anim_hunters := 1;
                end
                if ((global_var(1017) bwand 8) != 0) then begin
                    to_see_anim_shelter := 1;
                end
                special_event := 1;
            end
            if ((global_var(1017) bwand 1) != 0) then begin
                if (((global_var(904) bwand 1) != 0) or (((global_var(1017) bwand 2048) != 0) and ((global_var(904) bwand 8192) != 0) or (global_var(1029) == 2)) and not((map_var(0) bwand 32768) != 0)) then begin
                    set_map_var(0, map_var(0) bwor 32768);
                    if ((map_var(4) == 0) and ((global_var(865) bwand 32768) != 0)) then begin
                        set_map_var(4, 3);
                        set_global_var(867, global_var(867) bwor 512);
                    end
                    special_event := 1;
                end
                if ((special_event == 0) and ((global_var(904) bwand 67108864) != 0) and ((game_time - global_var(1003)) > (24 * (60 * (60 * 10)) * 6)) and not((map_var(0) bwand 16384) != 0)) then begin
                    set_map_var(0, map_var(0) bwor 262144);
                end
                set_global_var(1017, global_var(1017) bwand (-1 - 1));
            end
            if ((global_var(1017) bwand 2) != 0) then begin
                if (((global_var(904) bwand 1) != 0) or (((global_var(1017) bwand 2048) != 0) and ((global_var(904) bwand 8192) != 0) or (global_var(1029) == 2)) and not((map_var(0) bwand 65536) != 0)) then begin
                    set_map_var(0, map_var(0) bwor 65536);
                    if ((map_var(4) == 0) and ((global_var(865) bwand 32768) != 0)) then begin
                        set_map_var(4, 3);
                        set_global_var(867, global_var(867) bwor 512);
                    end
                    special_event := 1;
                end
                if ((special_event == 0) and ((global_var(904) bwand 67108864) != 0) and ((game_time - global_var(1003)) > (24 * (60 * (60 * 10)) * 6)) and not((map_var(0) bwand 16384) != 0)) then begin
                    set_map_var(0, map_var(0) bwor 524288);
                end
                set_global_var(1017, global_var(1017) bwand (-1 - 2));
            end
            if ((global_var(1017) bwand 4) != 0) then begin
                if (((global_var(904) bwand 1) != 0) or (((global_var(1017) bwand 2048) != 0) and ((global_var(904) bwand 8192) != 0) or (global_var(1029) == 2)) and not((map_var(0) bwand 131072) != 0)) then begin
                    move_to(dude_obj, 14703, 0);
                    anim(dude_obj, 1000, 2);
                    if (party_member_obj(16777729) != 0) then begin
                        if (party_member_obj(16777729) != 0) then begin
                            if (has_trait(1, party_member_obj(16777729), 666)) then begin
                                critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                        if (party_member_obj(16777779) != 0) then begin
                            if (has_trait(1, party_member_obj(16777779), 666)) then begin
                                critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                        if (party_member_obj(16777811) != 0) then begin
                            if (has_trait(1, party_member_obj(16777811), 666)) then begin
                                critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if (party_member_obj(16777812) != 0) then begin
                        if (party_member_obj(16777812) != 0) then begin
                            if (has_trait(1, party_member_obj(16777812), 666)) then begin
                                critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                        if (party_member_obj(16777814) != 0) then begin
                            if (has_trait(1, party_member_obj(16777814), 666)) then begin
                                critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if (party_member_obj(16777748) != 0) then begin
                        if (party_member_obj(16777748) != 0) then begin
                            if (has_trait(1, party_member_obj(16777748), 666)) then begin
                                critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if (party_member_obj(16778017) != 0) then begin
                        if (party_member_obj(16778017) != 0) then begin
                            if (has_trait(1, party_member_obj(16778017), 666)) then begin
                                critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if (party_member_obj(16778016) != 0) then begin
                        if (party_member_obj(16778016) != 0) then begin
                            if (has_trait(1, party_member_obj(16778016), 666)) then begin
                                critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if (party_member_obj(16778049) != 0) then begin
                        if (party_member_obj(16778049) != 0) then begin
                            if (has_trait(1, party_member_obj(16778049), 666)) then begin
                                critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if (party_member_obj(16778050) != 0) then begin
                        if (party_member_obj(16778050) != 0) then begin
                            if (has_trait(1, party_member_obj(16778050), 666)) then begin
                                critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if (party_member_obj(16778051) != 0) then begin
                        if (party_member_obj(16778051) != 0) then begin
                            if (has_trait(1, party_member_obj(16778051), 666)) then begin
                                critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if (party_member_obj(16777294) != 0) then begin
                        if (party_member_obj(16777294) != 0) then begin
                            if (has_trait(1, party_member_obj(16777294), 666)) then begin
                                critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                            end
                        end
                    end
                    if (party_member_obj(16777729) != 0) then begin
                        anim(party_member_obj(16777729), 1000, 2);
                    end
                    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                        anim(party_member_obj(16777779), 1000, 2);
                    end
                    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                        anim(party_member_obj(16777811), 1000, 2);
                    end
                    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                        anim(party_member_obj(16777814), 1000, 2);
                    end
                    if (party_member_obj(16778017) != 0) then begin
                        anim(party_member_obj(16778017), 1000, 2);
                    end
                    if (party_member_obj(16778016) != 0) then begin
                        anim(party_member_obj(16778016), 1000, 2);
                    end
                    if (party_member_obj(16778049) != 0) then begin
                        anim(party_member_obj(16778049), 1000, 2);
                    end
                    if (party_member_obj(16778050) != 0) then begin
                        anim(party_member_obj(16778050), 1000, 2);
                    end
                    if (party_member_obj(16778051) != 0) then begin
                        anim(party_member_obj(16778051), 1000, 2);
                    end
                    if (party_member_obj(16777812) != 0) then begin
                        anim(party_member_obj(16777812), 1000, 2);
                    end
                    set_map_var(0, map_var(0) bwor 131072);
                    special_event := 1;
                    if ((map_var(4) == 0) and ((global_var(865) bwand 32768) != 0)) then begin
                        set_map_var(4, 3);
                        set_global_var(867, global_var(867) bwor 512);
                    end
                    add_timer_event(self_obj, game_ticks(0), 30);
                end
                if ((special_event == 0) and ((global_var(904) bwand 67108864) != 0) and ((game_time - global_var(1003)) > (24 * (60 * (60 * 10)) * 6)) and not((map_var(0) bwand 16384) != 0)) then begin
                    set_map_var(0, map_var(0) bwor 2097152);
                end
                set_global_var(1017, global_var(1017) bwand (-1 - 4));
            end
            if ((global_var(1017) bwand 8) != 0) then begin
                if ((special_event == 0) and ((global_var(904) bwand 67108864) != 0) and ((game_time - global_var(1003)) > (24 * (60 * (60 * 10)) * 6)) and not((map_var(0) bwand 16384) != 0)) then begin
                    set_map_var(0, map_var(0) bwor 1048576);
                end
                set_global_var(1017, global_var(1017) bwand (-1 - 8));
            end
            special_event := 0;
        end
        if ((global_var(992) == 2) and (Projed_smycku == 0)) then begin
            move_to(dude_obj, 14057, 2);
            anim(dude_obj, 1000, 3);
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777729) != 0) then begin
                anim(party_member_obj(16777729), 1000, 3);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 3);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 3);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 3);
            end
            if (party_member_obj(16778017) != 0) then begin
                anim(party_member_obj(16778017), 1000, 3);
            end
            if (party_member_obj(16778016) != 0) then begin
                anim(party_member_obj(16778016), 1000, 3);
            end
            if (party_member_obj(16778049) != 0) then begin
                anim(party_member_obj(16778049), 1000, 3);
            end
            if (party_member_obj(16778050) != 0) then begin
                anim(party_member_obj(16778050), 1000, 3);
            end
            if (party_member_obj(16778051) != 0) then begin
                anim(party_member_obj(16778051), 1000, 3);
            end
            if (party_member_obj(16777812) != 0) then begin
                anim(party_member_obj(16777812), 1000, 3);
            end
            call Generate_Dude_Soldiers();
            Projed_smycku := 1;
            if ((map_var(4) == 0) and ((global_var(865) bwand 32768) != 0)) then begin
                set_map_var(4, 3);
                set_global_var(867, global_var(867) bwor 512);
            end
            add_timer_event(self_obj, game_ticks(0), 10);
        end
        if ((global_var(998) != 1) and not((global_var(1000) bwand 32) != 0)) then begin
            if ((global_var(574) == 1) and (global_var(992) == 0) and (global_var(1008) == 0) and not((global_var(1000) bwand 8) != 0)) then begin
                set_global_var(1000, global_var(1000) bwor 32);
                create_object_sid(16777804, 0, 0, 107);
            end
            if ((global_var(898) < 4) and ((global_var(882) != 4) and (global_var(881) != 2) and (global_var(883) != 2)) and (global_var(859) == 0) and ((global_var(1000) bwand 16) == 0) and not((global_var(867) bwand 33554432) != 0) and ((global_var(1017) bwand 131072) == 0)) then begin
                if ((global_var(574) == 1) and ((global_var(1006) == 0) and ((global_var(904) bwand 2) != 0) and not((global_var(904) bwand 8192) != 0) or ((global_var(1007) == 0) and ((global_var(904) bwand 1) != 0)))) then begin
                    set_global_var(1000, global_var(1000) bwor 32);
                    create_object_sid(16777804, 0, 0, 107);
                end
            end
            if ((global_var(574) == 1) and ((global_var(1017) bwand 131072) == 0) and ((global_var(1017) bwand 65536) != 0) and (global_var(864) == 0) and ((global_var(1000) bwand 16) == 0) and ((global_var(882) == 4) or (global_var(881) == 2) or (global_var(883) == 2))) then begin
                set_global_var(1000, global_var(1000) bwor 32);
                create_object_sid(16777804, 0, 0, 107);
            end
        end
        if (((global_var(865) bwand 4) != 0) and (Projed_smycku == 0) and (global_var(869) != 2)) then begin
            move_to(dude_obj, 12503, 0);
            anim(dude_obj, 1000, 5);
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777729) != 0) then begin
                anim(party_member_obj(16777729), 1000, 5);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 5);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 5);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 5);
            end
            if (party_member_obj(16778017) != 0) then begin
                anim(party_member_obj(16778017), 1000, 5);
            end
            if (party_member_obj(16778016) != 0) then begin
                anim(party_member_obj(16778016), 1000, 5);
            end
            if (party_member_obj(16778049) != 0) then begin
                anim(party_member_obj(16778049), 1000, 5);
            end
            if (party_member_obj(16778050) != 0) then begin
                anim(party_member_obj(16778050), 1000, 5);
            end
            if (party_member_obj(16778051) != 0) then begin
                anim(party_member_obj(16778051), 1000, 5);
            end
            if (party_member_obj(16777812) != 0) then begin
                anim(party_member_obj(16777812), 1000, 5);
            end
            lorian := create_object_sid(16777975, 9899, 0, -1);
            anim(lorian, 1000, 2);
            catherine := create_object_sid(16777938, 11700, 0, -1);
            anim(catherine, 1000, 5);
            sophia := create_object_sid(16777939, 11100, 0, -1);
            anim(sophia, 1000, 5);
            add_timer_event(self_obj, game_ticks(0), 1);
            if ((map_var(4) == 0) and ((global_var(865) bwand 32768) != 0)) then begin
                set_map_var(4, 3);
                set_global_var(867, global_var(867) bwor 512);
            end
            Projed_smycku := 1;
        end
        if ((global_var(883) == 1) and (Projed_smycku == 0) and not((map_var(0) bwand 16) != 0)) then begin
            call Generate_Ghouls();
            move_to(dude_obj, 23950, 0);
            anim(dude_obj, 1000, 5);
            set_global_var(857, 0);
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777729) != 0) then begin
                anim(party_member_obj(16777729), 1000, 5);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 5);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 5);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 5);
            end
            if (party_member_obj(16778017) != 0) then begin
                anim(party_member_obj(16778017), 1000, 5);
            end
            if (party_member_obj(16778016) != 0) then begin
                anim(party_member_obj(16778016), 1000, 5);
            end
            if (party_member_obj(16778049) != 0) then begin
                anim(party_member_obj(16778049), 1000, 5);
            end
            if (party_member_obj(16778050) != 0) then begin
                anim(party_member_obj(16778050), 1000, 5);
            end
            if (party_member_obj(16778051) != 0) then begin
                anim(party_member_obj(16778051), 1000, 5);
            end
            if (party_member_obj(16777812) != 0) then begin
                anim(party_member_obj(16777812), 1000, 5);
            end
            set_map_var(0, map_var(0) bwor 16);
            if ((map_var(4) == 0) and ((global_var(865) bwand 32768) != 0)) then begin
                set_map_var(4, 3);
                set_global_var(867, global_var(867) bwor 512);
            end
            add_timer_event(self_obj, game_ticks(0), 2);
            Projed_smycku := 1;
        end
        if ((global_var(876) == 2) and (Projed_smycku == 0) and not((map_var(0) bwand 64) != 0) and not((global_var(867) bwand 512) != 0)) then begin
            set_global_var(863, 0);
            if (global_var(864) == 1) then begin
                set_global_var(864, 0);
                enemy_lovci := 1;
            end
            call Generate_Primitives();
            if (((global_var(865) bwand 65536) != 0) and (global_var(998) == 0)) then begin
                call Generate_Imperial_Soldiers();
            end
            move_to(dude_obj, 28884, 0);
            anim(dude_obj, 1000, 5);
            set_global_var(857, 0);
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777729) != 0) then begin
                anim(party_member_obj(16777729), 1000, 5);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 5);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 5);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 5);
            end
            if (party_member_obj(16778017) != 0) then begin
                anim(party_member_obj(16778017), 1000, 5);
            end
            if (party_member_obj(16778016) != 0) then begin
                anim(party_member_obj(16778016), 1000, 5);
            end
            if (party_member_obj(16778049) != 0) then begin
                anim(party_member_obj(16778049), 1000, 5);
            end
            if (party_member_obj(16778050) != 0) then begin
                anim(party_member_obj(16778050), 1000, 5);
            end
            if (party_member_obj(16778051) != 0) then begin
                anim(party_member_obj(16778051), 1000, 5);
            end
            if (party_member_obj(16777812) != 0) then begin
                anim(party_member_obj(16777812), 1000, 5);
            end
            set_map_var(0, map_var(0) bwor 64);
            add_timer_event(self_obj, game_ticks(1), 4);
            Projed_smycku := 1;
        end
        if (((game_time - map_var(3)) > (24 * (60 * (60 * 10)) * 3)) and (global_var(891) >= 6) and not((map_var(0) bwand 512) != 0)) then begin
            set_map_var(0, map_var(0) bwor 512);
            create_object_sid(16777967, 24093, 0, 1684);
            create_object_sid(16777968, 25898, 0, 1684);
            create_object_sid(16777969, 25889, 0, 1684);
            create_object_sid(16777970, 24271, 0, 1684);
            create_object_sid(16777971, 23283, 0, 1684);
            create_object_sid(16777972, 21898, 0, 1684);
            create_object_sid(16777974, 26270, 0, 1684);
            create_object_sid(16777804, 22070, 0, 1433);
            create_object_sid(16777805, 21076, 0, 1433);
            create_object_sid(16777807, 21083, 0, 1433);
        end
        if ((map_var(4) == 0) and ((global_var(865) bwand 32768) != 0)) then begin
            game_ui_disable;
            call Generate_Primitives_Own_Attack();
            if (((global_var(865) bwand 65536) != 0) and (global_var(998) == 0)) then begin
                set_global_var(891, 6);
                call Generate_Primitives_Own_Attack_With_Imperial();
            end
            set_obj_visibility(dude_obj, 1);
            set_global_var(632, global_var(632) bwor 64);
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729)) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        debug_msg("set party member hidden: " + obj_name(party_member_obj(16777729)));
                        set_global_var(632, global_var(632) bwor 1);
                        set_obj_visibility(party_member_obj(16777729), 1);
                    end
                    else begin
                        debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779)) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        debug_msg("set party member hidden: " + obj_name(party_member_obj(16777779)));
                        set_global_var(632, global_var(632) bwor 2);
                        set_obj_visibility(party_member_obj(16777779), 1);
                    end
                    else begin
                        debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811)) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        debug_msg("set party member hidden: " + obj_name(party_member_obj(16777811)));
                        set_global_var(632, global_var(632) bwor 4);
                        set_obj_visibility(party_member_obj(16777811), 1);
                    end
                    else begin
                        debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812)) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        debug_msg("set party member hidden: " + obj_name(party_member_obj(16777812)));
                        set_global_var(632, global_var(632) bwor 8);
                        set_obj_visibility(party_member_obj(16777812), 1);
                    end
                    else begin
                        debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                    end
                end
            end
            if (party_member_obj(16777813) != 0) then begin
                if (party_member_obj(16777813)) then begin
                    if (has_trait(1, party_member_obj(16777813), 666)) then begin
                        debug_msg("set party member hidden: " + obj_name(party_member_obj(16777813)));
                        set_global_var(632, global_var(632) bwor 16);
                        set_obj_visibility(party_member_obj(16777813), 1);
                    end
                    else begin
                        debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814)) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        debug_msg("set party member hidden: " + obj_name(party_member_obj(16777814)));
                        set_global_var(632, global_var(632) bwor 32);
                        set_obj_visibility(party_member_obj(16777814), 1);
                    end
                    else begin
                        debug_msg("PARTY.H:::: no party member hidden because they already are invisible");
                    end
                end
            end
            set_global_var(867, global_var(867) bwor 512);
            set_map_var(4, 1);
            if (global_var(864) == 1) then begin
                set_global_var(864, 0);
                enemy_lovci := 1;
            end
            if (global_var(863) == 1) then begin
                set_global_var(863, 0);
                enemy_hospital := 1;
            end
            Projed_smycku := 1;
            add_timer_event(self_obj, 2, 5);
        end
        if ((global_var(994) == 2) and not((map_var(0) bwand 2048) != 0)) then begin
            call Generate_Exploded_Soldiers();
            set_map_var(0, map_var(0) bwor 2048);
        end
        if ((global_var(995) >= 3) and not((map_var(0) bwand 2048) != 0)) then begin
            call Generate_Dead_Soldiers();
            set_map_var(0, map_var(0) bwor 2048);
        end
        if (((global_var(904) bwand 67108864) != 0) and (Projed_smycku == 0) and ((game_time - global_var(1003)) > (24 * (60 * (60 * 10)) * 6)) and not((map_var(0) bwand 16384) != 0)) then begin
            if ((map_var(0) bwand 2097152) != 0) then begin
                set_map_var(0, map_var(0) bwand (-1 - 2097152));
            end
            else begin
                mario := create_object_sid(16777813, 0, 0, 109);
                if ((map_var(0) bwand 262144) != 0) then begin
                    critter_attempt_placement(mario, 29487, 0);
                end
                if ((map_var(0) bwand 524288) != 0) then begin
                    critter_attempt_placement(mario, 17473, 0);
                end
                if ((map_var(0) bwand 1048576) != 0) then begin
                    critter_attempt_placement(mario, 24722, 0);
                end
                set_map_var(0, map_var(0) bwor 16384);
                Projed_smycku := 1;
            end
        end
    end
    Projed_smycku := 0;
end

procedure map_update_p_proc
begin
    if ((global_var(990) == 2) and (elevation(dude_obj) == 1)) then begin
        call Generate_Dead_Soldiers();
        set_global_var(990, 3);
        set_global_var(1020, global_var(1020) bwand (-1 - 8));
        if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
            set_global_var(1020, global_var(1020) bwor 16);
        end
        display_msg(message_str(1635, 2300));
    end
    if ((global_var(994) == 2) and (elevation(dude_obj) == 1) and ((map_var(0) bwand 33554432) == 0)) then begin
        set_map_var(0, map_var(0) bwor 33554432);
        display_msg(message_str(1635, 2202));
    end
    if ((global_var(996) == 2) and ((map_var(0) bwand 4096) != 0) and (elevation(dude_obj) == 2) and (global_var(998) == 0)) then begin
        anim(dude_obj, 1000, 2);
        game_ui_disable;
        add_timer_event(self_obj, game_ticks(1), 8);
        sequence := 0;
        set_map_var(0, map_var(0) bwand (-1 - 4096));
    end
    if (elevation(dude_obj) == 0) then begin
        if ((get_month >= 3) and (get_month < 5)) then begin
            if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                set_light_level(game_time_hour - 600 + 40);
            end
            else begin
                if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                    set_light_level(100);
                end
                else begin
                    if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                        set_light_level(100 - (game_time_hour - 1800));
                    end
                    else begin
                        set_light_level(40);
                    end
                end
            end
        end
        else begin
            if ((get_month >= 5) and (get_month < 9)) then begin
                if ((game_time_hour >= 500) and (game_time_hour < (500 + 100))) then begin
                    set_light_level(game_time_hour - 500 + 40);
                end
                else begin
                    if ((game_time_hour >= (500 + 100)) and (game_time_hour < 1900)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1900) and (game_time_hour < (1900 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1900));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
            else begin
                if ((get_month >= 9) and (get_month < 11)) then begin
                    if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                        set_light_level(game_time_hour - 600 + 40);
                    end
                    else begin
                        if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                            set_light_level(100);
                        end
                        else begin
                            if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                                set_light_level(100 - (game_time_hour - 1800));
                            end
                            else begin
                                set_light_level(40);
                            end
                        end
                    end
                end
                else begin
                    if ((game_time_hour >= 700) and (game_time_hour < (700 + 100))) then begin
                        set_light_level(game_time_hour - 700 + 40);
                    end
                    else begin
                        if ((game_time_hour >= (700 + 100)) and (game_time_hour < 1700)) then begin
                            set_light_level(100);
                        end
                        else begin
                            if ((game_time_hour >= 1700) and (game_time_hour < (1700 + 100))) then begin
                                set_light_level(100 - (game_time_hour - 1700));
                            end
                            else begin
                                set_light_level(40);
                            end
                        end
                    end
                end
            end
        end
    end
    else begin
        set_light_level(50);
    end
end

procedure map_exit_p_proc
begin
    if (tile_in_tile_rect(8703, 8695, 9703, 9695, tile_num(dude_obj))) then begin
        set_global_var(1017, global_var(1017) bwor 32);
    end
    set_global_var(857, 0);
    if ((map_var(3) == 0) and (global_var(891) >= 6)) then begin
        set_map_var(3, game_time);
    end
end

procedure timed_event_p_proc
begin
    if ((fixed_param == 1) and ((global_var(865) bwand 4) != 0) and (global_var(869) != 2)) then begin
        if (fixed_param == 1) then begin
            sequence := sequence + 1;
        end
        if (sequence == 1) then begin
            metarule3(108, 10299, 0, 0);
            game_ui_disable;
            anim(sophia, 1000, 2);
            add_timer_event(self_obj, game_ticks(2), 1);
        end
        if (sequence == 2) then begin
            float_msg(catherine, message_str(1635, 100), 8);
            add_timer_event(self_obj, game_ticks(6), 1);
        end
        if (sequence == 3) then begin
            float_msg(sophia, message_str(1635, 101), 2);
            add_timer_event(self_obj, game_ticks(5), 1);
        end
        if (sequence == 4) then begin
            float_msg(catherine, message_str(1635, 102), 8);
            add_timer_event(self_obj, game_ticks(6), 1);
        end
        if (sequence == 5) then begin
            float_msg(sophia, message_str(1635, 103), 2);
            add_timer_event(self_obj, game_ticks(5), 1);
        end
        if (sequence == 6) then begin
            float_msg(catherine, message_str(1635, 104), 8);
            add_timer_event(self_obj, game_ticks(5), 1);
        end
        if (sequence == 7) then begin
            float_msg(sophia, message_str(1635, 105), 2);
            add_timer_event(self_obj, game_ticks(5), 1);
        end
        if (sequence == 8) then begin
            float_msg(catherine, message_str(1635, 106), 8);
            add_timer_event(self_obj, game_ticks(3), 1);
        end
        if (sequence == 9) then begin
            anim(sophia, 1000, 5);
            animate_move_obj_to_tile(sophia, 9900, 0);
            add_timer_event(self_obj, 5, 1);
        end
        if (sequence == 10) then begin
            float_msg(catherine, message_str(1635, 107), 8);
            add_timer_event(self_obj, game_ticks(5), 1);
        end
        if (sequence == 11) then begin
            float_msg(lorian, message_str(1635, 108), 3);
            reg_anim_func(2, sophia);
            anim(sophia, 1000, 2);
            add_timer_event(self_obj, game_ticks(4), 1);
        end
        if (sequence == 12) then begin
            gfade_out(600);
            add_timer_event(self_obj, game_ticks(1), 1);
        end
        if (sequence == 13) then begin
            destroy_object(sophia);
            destroy_object(lorian);
            destroy_object(catherine);
            add_timer_event(self_obj, 5, 1);
        end
        if (sequence == 14) then begin
            gfade_in(600);
            add_timer_event(self_obj, 2, 1);
        end
        if (sequence == 15) then begin
            game_ui_enable;
            sequence := 0;
            set_global_var(869, 2);
            give_exp_points(1000);
            display_msg(message_str(14, 100) + 1000 + message_str(14, 101));
            set_global_var(0, global_var(0) + 30);
            debug_msg("Player gains " + 30 + " Karma Points.");
            set_global_var(37, 0);
            set_global_var(38, 0);
            set_global_var(39, 0);
            set_global_var(40, 0);
            set_global_var(41, 0);
            set_global_var(42, 0);
            set_global_var(43, 0);
            set_global_var(44, 0);
            set_global_var(45, 0);
            if (global_var(0) >= 1000) then begin
                set_global_var(37, 1);
            end
            else begin
                if (global_var(0) >= 750) then begin
                    set_global_var(38, 1);
                end
                else begin
                    if (global_var(0) >= 500) then begin
                        set_global_var(39, 1);
                    end
                    else begin
                        if (global_var(0) >= 250) then begin
                            set_global_var(40, 1);
                        end
                        else begin
                            if (global_var(0) > -250) then begin
                                set_global_var(41, 1);
                            end
                            else begin
                                if (global_var(0) > -500) then begin
                                    set_global_var(42, 1);
                                end
                                else begin
                                    if (global_var(0) > -750) then begin
                                        set_global_var(43, 1);
                                    end
                                    else begin
                                        if (global_var(0) > -1000) then begin
                                            set_global_var(44, 1);
                                        end
                                        else begin
                                            set_global_var(45, 1);
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
            set_global_var(51, global_var(51) + 3);
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                set_global_var(1019, global_var(1019) bwor 134217728);
            end
        end
    end
    if ((fixed_param == 2) and (global_var(883) == 1)) then begin
        if (fixed_param == 2) then begin
            sequence2 := sequence2 + 1;
        end
        if (sequence2 == 1) then begin
            metarule3(108, 21548, 0, 0);
            game_ui_disable;
            animate_move_obj_to_tile(dude_obj, 20950, 0);
            animate_move_obj_to_tile(Dutch_obj, 21152, 0);
            gfade_in(1);
            add_timer_event(self_obj, game_ticks(3), 2);
        end
        if (sequence2 == 2) then begin
            animate_move_obj_to_tile(gh1, 20754, 1);
            animate_move_obj_to_tile(gh2, 20351, 1);
            animate_move_obj_to_tile(gh3, 20556, 1);
            animate_move_obj_to_tile(gh4, 19551, 1);
            animate_move_obj_to_tile(gh5, 20152, 1);
            animate_move_obj_to_tile(gh6, 19150, 1);
            add_timer_event(self_obj, game_ticks(2), 2);
        end
        if (sequence2 == 3) then begin
            float_msg(Dutch_obj, message_str(1631, 404), 8);
            add_timer_event(self_obj, 1, 2);
        end
        if (sequence2 == 4) then begin
            game_ui_enable;
            sequence2 := 0;
            set_map_var(0, map_var(0) bwor 32);
        end
    end
    if (fixed_param == 3) then begin
        if (fixed_param == 3) then begin
            sequence := sequence + 1;
        end
        if (sequence == 1) then begin
            set_global_var(863, 0);
            game_ui_disable;
            add_timer_event(self_obj, 2, 3);
        end
        if (sequence == 2) then begin
            gfade_out(600);
            add_timer_event(self_obj, 5, 3);
        end
        if (sequence == 3) then begin
            set_map_var(0, map_var(0) bwor 256);
            add_timer_event(self_obj, game_ticks(1), 3);
        end
        if (sequence == 4) then begin
            gfade_in(600);
            add_timer_event(self_obj, 5, 3);
        end
        if (sequence == 5) then begin
            game_ui_enable;
            set_global_var(863, 1);
        end
    end
    if (fixed_param == 4) then begin
        game_ui_enable;
        float_msg(gurgan, message_str(1617, 410), 2);
        set_global_var(863, 1);
        set_global_var(876, 3);
        if (enemy_lovci == 1) then begin
            set_global_var(864, 1);
        end
        if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
            set_global_var(1018, global_var(1018) bwor 2097152);
        end
    end
    if (fixed_param == 5) then begin
        if (fixed_param == 5) then begin
            sequence := sequence + 1;
        end
        if (sequence == 1) then begin
            move_to(dude_obj, 27284, 0);
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            add_timer_event(self_obj, game_ticks(1), 5);
        end
        if (sequence == 2) then begin
            reg_anim_func(2, gurgan);
            reg_anim_func(2, pr1);
            reg_anim_func(2, pr2);
            reg_anim_func(2, nm1);
            reg_anim_func(2, nm2);
            reg_anim_func(2, nm2);
            reg_anim_func(2, nm3);
            add_timer_event(self_obj, game_ticks(1), 5);
        end
        if (sequence == 3) then begin
            animate_move_obj_to_tile(pr2, 27284, 0);
            reg_anim_func(2, nm4);
            reg_anim_func(1, 1);
            reg_anim_animate(nm4, 45, -1);
            play_sfx("whg1sxx1");
            reg_anim_func(3, 0);
            reg_anim_func(2, pr2);
            reg_anim_func(1, 1);
            reg_anim_animate(pr2, 13, -1);
            reg_anim_func(3, 0);
            reg_anim_func(2, gurgan);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(gurgan, sfx_build_char_name(nm1, 42, 2), 0);
            reg_anim_animate(gurgan, 41, -1);
            reg_anim_func(3, 0);
            reg_anim_func(2, nm1);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(nm1, sfx_build_char_name(nm1, 42, 2), 0);
            reg_anim_animate(nm1, 13, -1);
            reg_anim_func(3, 0);
            add_timer_event(self_obj, game_ticks(1), 5);
        end
        if (sequence == 4) then begin
            reg_anim_func(2, pr2);
            animate_move_obj_to_tile(pr2, 27284, 0);
            reg_anim_func(2, nm3);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(nm3, sfx_build_char_name(nm3, 17, 4), 0);
            reg_anim_animate(nm3, 17, -1);
            reg_anim_func(3, 0);
            reg_anim_func(2, pr1);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(pr1, sfx_build_char_name(pr1, 14, 4), 0);
            reg_anim_animate(pr1, 14, -1);
            reg_anim_func(3, 0);
            add_timer_event(self_obj, game_ticks(1), 5);
        end
        if (sequence == 5) then begin
            if (((global_var(865) bwand 65536) != 0) and (global_var(998) == 0)) then begin
                animate_move_obj_to_tile(is1, 28097, 1);
                animate_move_obj_to_tile(is2, 28498, 1);
                animate_move_obj_to_tile(is3, 27900, 1);
                animate_move_obj_to_tile(is4, 28501, 1);
            end
            reg_anim_func(2, nm4);
            reg_anim_func(1, 1);
            reg_anim_animate(nm4, 45, -1);
            play_sfx("whg1sxx1");
            reg_anim_func(3, 0);
            reg_anim_func(2, pr2);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(pr2, sfx_build_char_name(pr2, 14, 4), 0);
            reg_anim_animate(pr2, 14, -1);
            reg_anim_func(3, 0);
            reg_anim_func(2, gurgan);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(gurgan, sfx_build_char_name(nm1, 14, 4), 0);
            reg_anim_animate(gurgan, 14, -1);
            reg_anim_func(3, 0);
            reg_anim_func(2, nm1);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(nm1, sfx_build_char_name(nm1, 42, 4), 0);
            reg_anim_animate(nm1, 42, -1);
            reg_anim_func(3, 0);
            add_timer_event(self_obj, game_ticks(1), 5);
        end
        if (sequence == 6) then begin
            reg_anim_func(2, pr2);
            animate_move_obj_to_tile(pr2, 27284, 1);
            reg_anim_func(2, nm3);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(nm3, sfx_build_char_name(nm3, 14, 4), 0);
            reg_anim_animate(nm3, 14, -1);
            reg_anim_func(3, 0);
            reg_anim_func(2, pr1);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(pr1, sfx_build_char_name(pr1, 42, 4), 0);
            reg_anim_animate(pr1, 41, -1);
            reg_anim_func(3, 0);
            add_timer_event(self_obj, game_ticks(1), 5);
        end
        if (sequence == 7) then begin
            reg_anim_func(2, nm1);
            reg_anim_func(2, nm4);
            reg_anim_func(1, 1);
            reg_anim_animate(nm4, 45, -1);
            play_sfx("whg1sxx1");
            reg_anim_func(3, 0);
            reg_anim_func(2, pr2);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(pr2, sfx_build_char_name(pr2, 14, 4), 0);
            reg_anim_animate(pr2, 14, -1);
            reg_anim_func(3, 0);
            reg_anim_func(2, gurgan);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(gurgan, sfx_build_char_name(nm1, 42, 4), 0);
            reg_anim_animate(gurgan, 41, -1);
            reg_anim_func(3, 0);
            reg_anim_func(2, nm1);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(nm1, sfx_build_char_name(nm1, 20, 3), 0);
            reg_anim_animate(nm1, 34, -1);
            reg_anim_func(3, 0);
            add_timer_event(self_obj, game_ticks(1), 5);
        end
        if (sequence == 8) then begin
            anim(gurgan, 1000, 1);
            reg_anim_func(2, nm4);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(nm4, sfx_build_char_name(nm4, 14, 4), 0);
            reg_anim_animate(nm4, 14, -1);
            reg_anim_func(3, 0);
            reg_anim_func(2, pr2);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(pr2, sfx_build_char_name(pr2, 16, 4), 0);
            reg_anim_animate(pr2, 16, -1);
            reg_anim_func(3, 0);
            reg_anim_func(2, nm3);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(nm3, sfx_build_char_name(nm3, 16, 4), 0);
            reg_anim_animate(nm3, 16, -1);
            reg_anim_func(3, 0);
            reg_anim_func(2, pr1);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(pr1, sfx_build_char_name(pr1, 20, 3), 0);
            reg_anim_animate(pr1, 34, -1);
            reg_anim_func(3, 0);
            add_timer_event(self_obj, game_ticks(1), 5);
        end
        if (sequence == 9) then begin
            animate_move_obj_to_tile(nm2, 27894, 1);
            reg_anim_func(2, gurgan);
            animate_move_obj_to_tile(gurgan, 27285, 0);
            reg_anim_func(2, nm3);
            animate_move_obj_to_tile(nm3, 28284, 0);
            reg_anim_func(2, nm4);
            reg_anim_func(1, 1);
            reg_anim_animate(nm4, 45, -1);
            play_sfx("whg1sxx1");
            reg_anim_func(3, 0);
            reg_anim_func(2, pr2);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(pr2, sfx_build_char_name(pr1, 20, 3), 0);
            reg_anim_animate(pr2, 34, -1);
            reg_anim_func(3, 0);
            add_timer_event(self_obj, game_ticks(1), 5);
        end
        if (sequence == 10) then begin
            anim(nm4, 1000, 3);
            reg_anim_func(2, gurgan);
            animate_move_obj_to_tile(gurgan, 27285, 0);
            reg_anim_func(2, nm3);
            animate_move_obj_to_tile(nm3, 28284, 0);
            reg_anim_func(2, nm2);
            reg_anim_func(1, 1);
            reg_anim_animate(nm2, 45, -1);
            play_sfx("whg1sxx1");
            reg_anim_func(3, 0);
            reg_anim_func(2, gurgan);
            reg_anim_func(1, 1);
            reg_anim_animate(gurgan, 34, -1);
            reg_anim_func(3, 0);
            if (((global_var(865) bwand 65536) != 0) and (global_var(998) == 0)) then begin
                add_timer_event(self_obj, game_ticks(2), 5);
            end
            else begin
                add_timer_event(self_obj, game_ticks(3), 5);
            end
        end
        if (((global_var(865) bwand 65536) != 0) and (global_var(998) == 0)) then begin
            if (sequence == 11) then begin
                anim(nm3, 1000, 3);
                anim(nm4, 1000, 3);
                reg_anim_func(2, is1);
                reg_anim_func(1, 1);
                reg_anim_animate(is1, 45, -1);
                reg_anim_func(3, 0);
                reg_anim_func(2, is2);
                reg_anim_func(1, 1);
                reg_anim_animate(is2, 45, -1);
                play_sfx("WAC1XXX1");
                reg_anim_func(3, 0);
                reg_anim_func(2, nm3);
                reg_anim_func(1, 1);
                reg_anim_animate(nm3, 14, -1);
                reg_anim_func(3, 0);
                reg_anim_func(2, nm4);
                reg_anim_func(1, 1);
                reg_anim_animate(nm4, 14, -1);
                reg_anim_func(3, 0);
                add_timer_event(self_obj, 6, 5);
            end
        end
        else begin
            if (sequence == 11) then begin
                gfade_out(600);
                add_timer_event(self_obj, game_ticks(1), 5);
            end
        end
        if (((global_var(865) bwand 65536) != 0) and (global_var(998) == 0)) then begin
            if (sequence == 12) then begin
                reg_anim_func(2, is3);
                reg_anim_func(1, 1);
                reg_anim_animate(is3, 45, -1);
                reg_anim_func(3, 0);
                reg_anim_func(2, is3);
                reg_anim_func(1, 1);
                reg_anim_animate(is3, 45, -1);
                play_sfx("WAC1XXX1");
                reg_anim_func(3, 0);
                reg_anim_func(2, nm2);
                reg_anim_func(1, 1);
                reg_anim_animate(nm2, 35, -1);
                reg_anim_func(3, 0);
                add_timer_event(self_obj, game_ticks(1), 5);
            end
        end
        else begin
            if (sequence == 12) then begin
                if (to_see_anim_emeror == 1) then begin
                    move_to(dude_obj, 10299, elevation(self_obj));
                    metarule3(108, 11499, 0, 0);
                    anim(dude_obj, 1000, 2);
                    if (party_member_obj(16777729) != 0) then begin
                        anim(party_member_obj(16777729), 1000, 2);
                    end
                    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                        anim(party_member_obj(16777779), 1000, 2);
                    end
                    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                        anim(party_member_obj(16777811), 1000, 2);
                    end
                    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                        anim(party_member_obj(16777814), 1000, 2);
                    end
                    if (party_member_obj(16778017) != 0) then begin
                        anim(party_member_obj(16778017), 1000, 2);
                    end
                    if (party_member_obj(16778016) != 0) then begin
                        anim(party_member_obj(16778016), 1000, 2);
                    end
                    if (party_member_obj(16778049) != 0) then begin
                        anim(party_member_obj(16778049), 1000, 2);
                    end
                    if (party_member_obj(16778050) != 0) then begin
                        anim(party_member_obj(16778050), 1000, 2);
                    end
                    if (party_member_obj(16778051) != 0) then begin
                        anim(party_member_obj(16778051), 1000, 2);
                    end
                    if (party_member_obj(16777812) != 0) then begin
                        anim(party_member_obj(16777812), 1000, 2);
                    end
                end
                else begin
                    if (to_see_anim_hunters == 1) then begin
                        move_to(dude_obj, 18461, elevation(self_obj));
                        metarule3(108, 18670, 0, 0);
                        anim(dude_obj, 1000, 3);
                        if (party_member_obj(16777729) != 0) then begin
                            anim(party_member_obj(16777729), 1000, 3);
                        end
                        if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                            anim(party_member_obj(16777779), 1000, 3);
                        end
                        if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                            anim(party_member_obj(16777811), 1000, 3);
                        end
                        if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                            anim(party_member_obj(16777814), 1000, 3);
                        end
                        if (party_member_obj(16778017) != 0) then begin
                            anim(party_member_obj(16778017), 1000, 3);
                        end
                        if (party_member_obj(16778016) != 0) then begin
                            anim(party_member_obj(16778016), 1000, 3);
                        end
                        if (party_member_obj(16778049) != 0) then begin
                            anim(party_member_obj(16778049), 1000, 3);
                        end
                        if (party_member_obj(16778050) != 0) then begin
                            anim(party_member_obj(16778050), 1000, 3);
                        end
                        if (party_member_obj(16778051) != 0) then begin
                            anim(party_member_obj(16778051), 1000, 3);
                        end
                        if (party_member_obj(16777812) != 0) then begin
                            anim(party_member_obj(16777812), 1000, 3);
                        end
                    end
                    else begin
                        if (to_see_anim_shelter == 1) then begin
                            move_to(dude_obj, 24315, elevation(self_obj));
                            metarule3(108, 24315, 0, 0);
                            anim(dude_obj, 1000, 2);
                            if (party_member_obj(16777729) != 0) then begin
                                anim(party_member_obj(16777729), 1000, 2);
                            end
                            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                                anim(party_member_obj(16777779), 1000, 2);
                            end
                            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                                anim(party_member_obj(16777811), 1000, 2);
                            end
                            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                                anim(party_member_obj(16777814), 1000, 2);
                            end
                            if (party_member_obj(16778017) != 0) then begin
                                anim(party_member_obj(16778017), 1000, 2);
                            end
                            if (party_member_obj(16778016) != 0) then begin
                                anim(party_member_obj(16778016), 1000, 2);
                            end
                            if (party_member_obj(16778049) != 0) then begin
                                anim(party_member_obj(16778049), 1000, 2);
                            end
                            if (party_member_obj(16778050) != 0) then begin
                                anim(party_member_obj(16778050), 1000, 2);
                            end
                            if (party_member_obj(16778051) != 0) then begin
                                anim(party_member_obj(16778051), 1000, 2);
                            end
                            if (party_member_obj(16777812) != 0) then begin
                                anim(party_member_obj(16777812), 1000, 2);
                            end
                        end
                        else begin
                            move_to(dude_obj, 31277, elevation(self_obj));
                            metarule3(108, 29677, 0, 0);
                            anim(dude_obj, 1000, 5);
                            if (party_member_obj(16777729) != 0) then begin
                                anim(party_member_obj(16777729), 1000, 5);
                            end
                            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                                anim(party_member_obj(16777779), 1000, 5);
                            end
                            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                                anim(party_member_obj(16777811), 1000, 5);
                            end
                            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                                anim(party_member_obj(16777814), 1000, 5);
                            end
                            if (party_member_obj(16778017) != 0) then begin
                                anim(party_member_obj(16778017), 1000, 5);
                            end
                            if (party_member_obj(16778016) != 0) then begin
                                anim(party_member_obj(16778016), 1000, 5);
                            end
                            if (party_member_obj(16778049) != 0) then begin
                                anim(party_member_obj(16778049), 1000, 5);
                            end
                            if (party_member_obj(16778050) != 0) then begin
                                anim(party_member_obj(16778050), 1000, 5);
                            end
                            if (party_member_obj(16778051) != 0) then begin
                                anim(party_member_obj(16778051), 1000, 5);
                            end
                            if (party_member_obj(16777812) != 0) then begin
                                anim(party_member_obj(16777812), 1000, 5);
                            end
                        end
                    end
                end
                set_obj_visibility(dude_obj, 0);
                set_global_var(632, global_var(632) bwand (-1 - 64));
                if (party_member_obj(16777729) != 0) then begin
                    if (party_member_obj(16777729)) then begin
                        if (has_trait(1, party_member_obj(16777729), 666) == 0) then begin
                            if ((global_var(632) bwand 1) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777729)));
                                set_global_var(632, global_var(632) bwand (-1 - 1));
                                set_obj_visibility(party_member_obj(16777729), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777729)));
                            set_global_var(632, global_var(632) bwand (-1 - 1));
                            set_obj_visibility(party_member_obj(16777729), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                    if (party_member_obj(16777779)) then begin
                        if (has_trait(1, party_member_obj(16777779), 666) == 0) then begin
                            if ((global_var(632) bwand 2) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777779)));
                                set_global_var(632, global_var(632) bwand (-1 - 2));
                                set_obj_visibility(party_member_obj(16777779), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777779)));
                            set_global_var(632, global_var(632) bwand (-1 - 2));
                            set_obj_visibility(party_member_obj(16777779), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                    if (party_member_obj(16777811)) then begin
                        if (has_trait(1, party_member_obj(16777811), 666) == 0) then begin
                            if ((global_var(632) bwand 4) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777811)));
                                set_global_var(632, global_var(632) bwand (-1 - 4));
                                set_obj_visibility(party_member_obj(16777811), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777811)));
                            set_global_var(632, global_var(632) bwand (-1 - 4));
                            set_obj_visibility(party_member_obj(16777811), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if (party_member_obj(16777812) != 0) then begin
                    if (party_member_obj(16777812)) then begin
                        if (has_trait(1, party_member_obj(16777812), 666) == 0) then begin
                            if ((global_var(632) bwand 8) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777812)));
                                set_global_var(632, global_var(632) bwand (-1 - 8));
                                set_obj_visibility(party_member_obj(16777812), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777812)));
                            set_global_var(632, global_var(632) bwand (-1 - 8));
                            set_obj_visibility(party_member_obj(16777812), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if (party_member_obj(16777813) != 0) then begin
                    if (party_member_obj(16777813)) then begin
                        if (has_trait(1, party_member_obj(16777813), 666) == 0) then begin
                            if ((global_var(632) bwand 16) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777813)));
                                set_global_var(632, global_var(632) bwand (-1 - 16));
                                set_obj_visibility(party_member_obj(16777813), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777813)));
                            set_global_var(632, global_var(632) bwand (-1 - 16));
                            set_obj_visibility(party_member_obj(16777813), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                    if (party_member_obj(16777814)) then begin
                        if (has_trait(1, party_member_obj(16777814), 666) == 0) then begin
                            if ((global_var(632) bwand 32) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777814)));
                                set_global_var(632, global_var(632) bwand (-1 - 32));
                                set_obj_visibility(party_member_obj(16777814), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777814)));
                            set_global_var(632, global_var(632) bwand (-1 - 32));
                            set_obj_visibility(party_member_obj(16777814), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if (party_member_obj(16777729) != 0) then begin
                    if (party_member_obj(16777729) != 0) then begin
                        if (has_trait(1, party_member_obj(16777729), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                    if (party_member_obj(16777779) != 0) then begin
                        if (has_trait(1, party_member_obj(16777779), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                    if (party_member_obj(16777811) != 0) then begin
                        if (has_trait(1, party_member_obj(16777811), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16777812) != 0) then begin
                    if (party_member_obj(16777812) != 0) then begin
                        if (has_trait(1, party_member_obj(16777812), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                    if (party_member_obj(16777814) != 0) then begin
                        if (has_trait(1, party_member_obj(16777814), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16777748) != 0) then begin
                    if (party_member_obj(16777748) != 0) then begin
                        if (has_trait(1, party_member_obj(16777748), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778017) != 0) then begin
                    if (party_member_obj(16778017) != 0) then begin
                        if (has_trait(1, party_member_obj(16778017), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778016) != 0) then begin
                    if (party_member_obj(16778016) != 0) then begin
                        if (has_trait(1, party_member_obj(16778016), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778049) != 0) then begin
                    if (party_member_obj(16778049) != 0) then begin
                        if (has_trait(1, party_member_obj(16778049), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778050) != 0) then begin
                    if (party_member_obj(16778050) != 0) then begin
                        if (has_trait(1, party_member_obj(16778050), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778051) != 0) then begin
                    if (party_member_obj(16778051) != 0) then begin
                        if (has_trait(1, party_member_obj(16778051), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16777294) != 0) then begin
                    if (party_member_obj(16777294) != 0) then begin
                        if (has_trait(1, party_member_obj(16777294), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                destroy_object(nm1);
                destroy_object(nm2);
                destroy_object(nm3);
                destroy_object(nm4);
                destroy_object(nm5);
                destroy_object(nm6);
                destroy_object(pr1);
                destroy_object(pr2);
                destroy_object(pr3);
                destroy_object(pr4);
                destroy_object(pr5);
                destroy_object(pr6);
                destroy_object(pr7);
                destroy_object(gurgan);
                create_object_sid(33555756, 28295, 0, -1);
                create_object_sid(33555758, 28888, 0, -1);
                create_object_sid(33555755, 29282, 0, -1);
                create_object_sid(33555757, 28479, 0, -1);
                create_object_sid(33555758, 26885, 0, -1);
                create_object_sid(33555756, 27886, 0, -1);
                create_object_sid(33555757, 27878, 0, -1);
                create_object_sid(33555757, 28284, 0, -1);
                set_map_var(4, 2);
                add_timer_event(self_obj, game_ticks(1), 5);
            end
        end
        if (((global_var(865) bwand 65536) != 0) and (global_var(998) == 0)) then begin
            if (sequence == 13) then begin
                gfade_out(600);
                play_sfx("WAC1XXX1");
                play_sfx("whg1sxx1");
                add_timer_event(self_obj, game_ticks(1), 5);
            end
        end
        else begin
            if (sequence == 13) then begin
                reg_anim_func(2, dude_obj);
                if (to_see_anim_emeror == 1) then begin
                    animate_move_obj_to_tile(dude_obj, 11299, 0);
                end
                else begin
                    if (to_see_anim_hunters == 1) then begin
                        animate_move_obj_to_tile(dude_obj, 18866, 0);
                    end
                    else begin
                        if (to_see_anim_shelter == 1) then begin
                        end
                        else begin
                            animate_move_obj_to_tile(dude_obj, 30077, 0);
                        end
                    end
                end
                to_see_anim_hunters := 0;
                to_see_anim_emeror := 0;
                to_see_anim_shelter := 0;
                add_timer_event(self_obj, 5, 5);
            end
        end
        if (((global_var(865) bwand 65536) != 0) and (global_var(998) == 0)) then begin
            if (sequence == 14) then begin
                play_sfx("WAC1XXX1");
                if (to_see_anim_emeror == 1) then begin
                    move_to(dude_obj, 10299, elevation(self_obj));
                    metarule3(108, 11499, 0, 0);
                    anim(dude_obj, 1000, 2);
                    if (party_member_obj(16777729) != 0) then begin
                        anim(party_member_obj(16777729), 1000, 2);
                    end
                    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                        anim(party_member_obj(16777779), 1000, 2);
                    end
                    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                        anim(party_member_obj(16777811), 1000, 2);
                    end
                    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                        anim(party_member_obj(16777814), 1000, 2);
                    end
                    if (party_member_obj(16778017) != 0) then begin
                        anim(party_member_obj(16778017), 1000, 2);
                    end
                    if (party_member_obj(16778016) != 0) then begin
                        anim(party_member_obj(16778016), 1000, 2);
                    end
                    if (party_member_obj(16778049) != 0) then begin
                        anim(party_member_obj(16778049), 1000, 2);
                    end
                    if (party_member_obj(16778050) != 0) then begin
                        anim(party_member_obj(16778050), 1000, 2);
                    end
                    if (party_member_obj(16778051) != 0) then begin
                        anim(party_member_obj(16778051), 1000, 2);
                    end
                    if (party_member_obj(16777812) != 0) then begin
                        anim(party_member_obj(16777812), 1000, 2);
                    end
                end
                else begin
                    if (to_see_anim_hunters == 1) then begin
                        move_to(dude_obj, 18461, elevation(self_obj));
                        metarule3(108, 18670, 0, 0);
                        anim(dude_obj, 1000, 3);
                        if (party_member_obj(16777729) != 0) then begin
                            anim(party_member_obj(16777729), 1000, 3);
                        end
                        if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                            anim(party_member_obj(16777779), 1000, 3);
                        end
                        if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                            anim(party_member_obj(16777811), 1000, 3);
                        end
                        if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                            anim(party_member_obj(16777814), 1000, 3);
                        end
                        if (party_member_obj(16778017) != 0) then begin
                            anim(party_member_obj(16778017), 1000, 3);
                        end
                        if (party_member_obj(16778016) != 0) then begin
                            anim(party_member_obj(16778016), 1000, 3);
                        end
                        if (party_member_obj(16778049) != 0) then begin
                            anim(party_member_obj(16778049), 1000, 3);
                        end
                        if (party_member_obj(16778050) != 0) then begin
                            anim(party_member_obj(16778050), 1000, 3);
                        end
                        if (party_member_obj(16778051) != 0) then begin
                            anim(party_member_obj(16778051), 1000, 3);
                        end
                        if (party_member_obj(16777812) != 0) then begin
                            anim(party_member_obj(16777812), 1000, 3);
                        end
                    end
                    else begin
                        if (to_see_anim_shelter == 1) then begin
                            move_to(dude_obj, 24315, elevation(self_obj));
                            metarule3(108, 24315, 0, 0);
                            anim(dude_obj, 1000, 2);
                            if (party_member_obj(16777729) != 0) then begin
                                anim(party_member_obj(16777729), 1000, 2);
                            end
                            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                                anim(party_member_obj(16777779), 1000, 2);
                            end
                            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                                anim(party_member_obj(16777811), 1000, 2);
                            end
                            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                                anim(party_member_obj(16777814), 1000, 2);
                            end
                            if (party_member_obj(16778017) != 0) then begin
                                anim(party_member_obj(16778017), 1000, 2);
                            end
                            if (party_member_obj(16778016) != 0) then begin
                                anim(party_member_obj(16778016), 1000, 2);
                            end
                            if (party_member_obj(16778049) != 0) then begin
                                anim(party_member_obj(16778049), 1000, 2);
                            end
                            if (party_member_obj(16778050) != 0) then begin
                                anim(party_member_obj(16778050), 1000, 2);
                            end
                            if (party_member_obj(16778051) != 0) then begin
                                anim(party_member_obj(16778051), 1000, 2);
                            end
                            if (party_member_obj(16777812) != 0) then begin
                                anim(party_member_obj(16777812), 1000, 2);
                            end
                        end
                        else begin
                            move_to(dude_obj, 31277, elevation(self_obj));
                            metarule3(108, 29677, 0, 0);
                            anim(dude_obj, 1000, 5);
                            if (party_member_obj(16777729) != 0) then begin
                                anim(party_member_obj(16777729), 1000, 5);
                            end
                            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                                anim(party_member_obj(16777779), 1000, 5);
                            end
                            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                                anim(party_member_obj(16777811), 1000, 5);
                            end
                            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                                anim(party_member_obj(16777814), 1000, 5);
                            end
                            if (party_member_obj(16778017) != 0) then begin
                                anim(party_member_obj(16778017), 1000, 5);
                            end
                            if (party_member_obj(16778016) != 0) then begin
                                anim(party_member_obj(16778016), 1000, 5);
                            end
                            if (party_member_obj(16778049) != 0) then begin
                                anim(party_member_obj(16778049), 1000, 5);
                            end
                            if (party_member_obj(16778050) != 0) then begin
                                anim(party_member_obj(16778050), 1000, 5);
                            end
                            if (party_member_obj(16778051) != 0) then begin
                                anim(party_member_obj(16778051), 1000, 5);
                            end
                            if (party_member_obj(16777812) != 0) then begin
                                anim(party_member_obj(16777812), 1000, 5);
                            end
                        end
                    end
                end
                set_obj_visibility(dude_obj, 0);
                set_global_var(632, global_var(632) bwand (-1 - 64));
                if (party_member_obj(16777729) != 0) then begin
                    if (party_member_obj(16777729)) then begin
                        if (has_trait(1, party_member_obj(16777729), 666) == 0) then begin
                            if ((global_var(632) bwand 1) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777729)));
                                set_global_var(632, global_var(632) bwand (-1 - 1));
                                set_obj_visibility(party_member_obj(16777729), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777729)));
                            set_global_var(632, global_var(632) bwand (-1 - 1));
                            set_obj_visibility(party_member_obj(16777729), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                    if (party_member_obj(16777779)) then begin
                        if (has_trait(1, party_member_obj(16777779), 666) == 0) then begin
                            if ((global_var(632) bwand 2) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777779)));
                                set_global_var(632, global_var(632) bwand (-1 - 2));
                                set_obj_visibility(party_member_obj(16777779), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777779)));
                            set_global_var(632, global_var(632) bwand (-1 - 2));
                            set_obj_visibility(party_member_obj(16777779), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                    if (party_member_obj(16777811)) then begin
                        if (has_trait(1, party_member_obj(16777811), 666) == 0) then begin
                            if ((global_var(632) bwand 4) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777811)));
                                set_global_var(632, global_var(632) bwand (-1 - 4));
                                set_obj_visibility(party_member_obj(16777811), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777811)));
                            set_global_var(632, global_var(632) bwand (-1 - 4));
                            set_obj_visibility(party_member_obj(16777811), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if (party_member_obj(16777812) != 0) then begin
                    if (party_member_obj(16777812)) then begin
                        if (has_trait(1, party_member_obj(16777812), 666) == 0) then begin
                            if ((global_var(632) bwand 8) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777812)));
                                set_global_var(632, global_var(632) bwand (-1 - 8));
                                set_obj_visibility(party_member_obj(16777812), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777812)));
                            set_global_var(632, global_var(632) bwand (-1 - 8));
                            set_obj_visibility(party_member_obj(16777812), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if (party_member_obj(16777813) != 0) then begin
                    if (party_member_obj(16777813)) then begin
                        if (has_trait(1, party_member_obj(16777813), 666) == 0) then begin
                            if ((global_var(632) bwand 16) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777813)));
                                set_global_var(632, global_var(632) bwand (-1 - 16));
                                set_obj_visibility(party_member_obj(16777813), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777813)));
                            set_global_var(632, global_var(632) bwand (-1 - 16));
                            set_obj_visibility(party_member_obj(16777813), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                    if (party_member_obj(16777814)) then begin
                        if (has_trait(1, party_member_obj(16777814), 666) == 0) then begin
                            if ((global_var(632) bwand 32) != 0) then begin
                                debug_msg("unhiding party member " + obj_name(party_member_obj(16777814)));
                                set_global_var(632, global_var(632) bwand (-1 - 32));
                                set_obj_visibility(party_member_obj(16777814), 0);
                            end
                            else begin
                                debug_msg("PARTY.H:::: party member wasn't hidden by my macro");
                            end
                        end
                        else begin
                            debug_msg("unhiding party member " + obj_name(party_member_obj(16777814)));
                            set_global_var(632, global_var(632) bwand (-1 - 32));
                            set_obj_visibility(party_member_obj(16777814), 0);
                            debug_msg("PARTY.H:::: party member wasn't hidden.. clearing my state");
                        end
                    end
                end
                if (party_member_obj(16777729) != 0) then begin
                    if (party_member_obj(16777729) != 0) then begin
                        if (has_trait(1, party_member_obj(16777729), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                    if (party_member_obj(16777779) != 0) then begin
                        if (has_trait(1, party_member_obj(16777779), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                    if (party_member_obj(16777811) != 0) then begin
                        if (has_trait(1, party_member_obj(16777811), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16777812) != 0) then begin
                    if (party_member_obj(16777812) != 0) then begin
                        if (has_trait(1, party_member_obj(16777812), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                    if (party_member_obj(16777814) != 0) then begin
                        if (has_trait(1, party_member_obj(16777814), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16777748) != 0) then begin
                    if (party_member_obj(16777748) != 0) then begin
                        if (has_trait(1, party_member_obj(16777748), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778017) != 0) then begin
                    if (party_member_obj(16778017) != 0) then begin
                        if (has_trait(1, party_member_obj(16778017), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778016) != 0) then begin
                    if (party_member_obj(16778016) != 0) then begin
                        if (has_trait(1, party_member_obj(16778016), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778049) != 0) then begin
                    if (party_member_obj(16778049) != 0) then begin
                        if (has_trait(1, party_member_obj(16778049), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778050) != 0) then begin
                    if (party_member_obj(16778050) != 0) then begin
                        if (has_trait(1, party_member_obj(16778050), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16778051) != 0) then begin
                    if (party_member_obj(16778051) != 0) then begin
                        if (has_trait(1, party_member_obj(16778051), 666)) then begin
                            critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                if (party_member_obj(16777294) != 0) then begin
                    if (party_member_obj(16777294) != 0) then begin
                        if (has_trait(1, party_member_obj(16777294), 666)) then begin
                            critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                        end
                    end
                end
                destroy_object(is1);
                destroy_object(is2);
                destroy_object(is3);
                destroy_object(is4);
                destroy_object(nm1);
                destroy_object(nm2);
                destroy_object(nm3);
                destroy_object(nm4);
                destroy_object(nm5);
                destroy_object(nm6);
                destroy_object(pr1);
                destroy_object(pr2);
                destroy_object(pr3);
                destroy_object(pr4);
                destroy_object(pr5);
                destroy_object(pr6);
                destroy_object(pr7);
                destroy_object(gurgan);
                create_object_sid(33555756, 28295, 0, -1);
                create_object_sid(33555758, 28888, 0, -1);
                create_object_sid(33555755, 29282, 0, -1);
                create_object_sid(33555757, 28479, 0, -1);
                create_object_sid(33555758, 26885, 0, -1);
                create_object_sid(33555756, 27886, 0, -1);
                create_object_sid(33555757, 27878, 0, -1);
                set_map_var(4, 2);
                metarule3(108, 29677, 0, 0);
                add_timer_event(self_obj, game_ticks(1), 5);
            end
        end
        else begin
            if (sequence == 14) then begin
                gfade_in(600);
                add_timer_event(self_obj, game_ticks(1), 5);
            end
        end
        if (((global_var(865) bwand 65536) != 0) and (global_var(998) == 0)) then begin
            if (sequence == 15) then begin
                reg_anim_func(2, dude_obj);
                if (to_see_anim_emeror == 1) then begin
                    animate_move_obj_to_tile(dude_obj, 11299, 0);
                end
                else begin
                    if (to_see_anim_hunters == 1) then begin
                        animate_move_obj_to_tile(dude_obj, 18866, 0);
                    end
                    else begin
                        if (to_see_anim_shelter == 1) then begin
                        end
                        else begin
                            animate_move_obj_to_tile(dude_obj, 30077, 0);
                        end
                    end
                end
                to_see_anim_hunters := 0;
                to_see_anim_emeror := 0;
                to_see_anim_shelter := 0;
                add_timer_event(self_obj, 5, 5);
            end
        end
        else begin
            if (sequence == 15) then begin
                game_ui_enable;
                set_map_var(4, 3);
                sequence := 0;
                if (enemy_lovci == 1) then begin
                    set_global_var(864, 1);
                end
                if (enemy_hospital == 1) then begin
                    set_global_var(863, 1);
                end
            end
        end
        if (((global_var(865) bwand 65536) != 0) and (global_var(998) == 0)) then begin
            if (sequence == 16) then begin
                gfade_in(600);
                metarule3(108, tile_num(dude_obj), 0, 0);
                add_timer_event(self_obj, game_ticks(1), 5);
            end
        end
        if (((global_var(865) bwand 65536) != 0) and (global_var(998) == 0)) then begin
            if (sequence == 17) then begin
                game_ui_enable;
                set_map_var(4, 3);
                sequence := 0;
                set_global_var(891, 6);
                if (enemy_lovci == 1) then begin
                    set_global_var(864, 1);
                end
                if (enemy_hospital == 1) then begin
                    set_global_var(863, 1);
                end
            end
        end
    end
    if (fixed_param == 6) then begin
        kill_critter(is1, 62);
        kill_critter(is2, 54);
        kill_critter(is3, 53);
        kill_critter(is4, 53);
        if ((global_var(990) == 2) or (global_var(990) == 3) or (global_var(995) >= 3)) then begin
            kill_critter(is5, 54);
        end
        kill_critter(is6, 61);
        kill_critter(is7, 53);
        kill_critter(is8, 53);
        kill_critter(is9, 56);
        kill_critter(is10, 53);
    end
    if (fixed_param == 7) then begin
        if (get_critter_stat(dude_obj, 34) == 0) then begin
            display_msg(message_str(1635, 2200));
        end
        else begin
            display_msg(message_str(1635, 2201));
        end
    end
    if (fixed_param == 8) then begin
        if (fixed_param == 8) then begin
            sequence := sequence + 1;
        end
        if (sequence == 1) then begin
            gfade_out(600);
            add_timer_event(self_obj, game_ticks(1), 8);
        end
        if (sequence == 2) then begin
            move_to(dude_obj, 14057, 2);
            anim(dude_obj, 1000, 3);
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777729) != 0) then begin
                anim(party_member_obj(16777729), 1000, 3);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 3);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 3);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 3);
            end
            if (party_member_obj(16778017) != 0) then begin
                anim(party_member_obj(16778017), 1000, 3);
            end
            if (party_member_obj(16778016) != 0) then begin
                anim(party_member_obj(16778016), 1000, 3);
            end
            if (party_member_obj(16778049) != 0) then begin
                anim(party_member_obj(16778049), 1000, 3);
            end
            if (party_member_obj(16778050) != 0) then begin
                anim(party_member_obj(16778050), 1000, 3);
            end
            if (party_member_obj(16778051) != 0) then begin
                anim(party_member_obj(16778051), 1000, 3);
            end
            if (party_member_obj(16777812) != 0) then begin
                anim(party_member_obj(16777812), 1000, 3);
            end
            game_time_advance(1 * (60 * (60 * 10)));
            add_timer_event(self_obj, game_ticks(1), 8);
        end
        if (sequence == 3) then begin
            gfade_in(600);
            display_msg(message_str(1635, 2000));
            add_timer_event(self_obj, game_ticks(1), 8);
        end
        if (sequence == 4) then begin
            float_msg(Anozol1_obj, message_str(1635, 2001), 8);
            add_timer_event(self_obj, game_ticks(1), 8);
        end
        if (sequence == 5) then begin
            set_obj_visibility(Elisa_obj, 0);
            add_timer_event(self_obj, game_ticks(4), 8);
        end
        if (sequence == 6) then begin
            animate_move_obj_to_tile(Elisa_obj, 14461, 0);
            float_msg(Anozol2_obj, message_str(1635, 2002), 8);
            add_timer_event(self_obj, game_ticks(10), 8);
        end
        if (sequence == 7) then begin
            anim(Elisa_obj, 1000, 0);
            add_timer_event(self_obj, game_ticks(3), 8);
        end
        if (sequence == 8) then begin
            sequence := 0;
            game_ui_enable;
            add_timer_event(Elisa_obj, game_ticks(0), 1);
        end
    end
    if (fixed_param == 9) then begin
        if (fixed_param == 9) then begin
            sequence2 := sequence2 + 1;
        end
        if (sequence2 == 1) then begin
            game_ui_disable;
            gfade_out(600);
            add_timer_event(self_obj, game_ticks(1), 9);
        end
        if (sequence2 == 2) then begin
            call Generate_Arans_Soldiers();
            set_map_var(0, map_var(0) bwor 8192);
            destroy_object(Elisa_obj);
            game_time_advance(3 * (60 * (60 * 10)));
            add_timer_event(self_obj, game_ticks(2), 9);
        end
        if (sequence2 == 3) then begin
            gfade_in(600);
            display_msg(message_str(1635, 2100));
            float_msg(Anozol3_obj, message_str(1635, 2101), 8);
            set_map_var(0, map_var(0) bwand (-1 - 8192));
            add_timer_event(self_obj, game_ticks(2), 9);
        end
        if (sequence2 == 4) then begin
            float_msg(Anozol1_obj, message_str(1635, 2102), 8);
            add_timer_event(self_obj, game_ticks(5), 9);
        end
        if (sequence2 == 5) then begin
            float_msg(Anozol2_obj, message_str(1635, 2103), 8);
            add_timer_event(self_obj, game_ticks(3), 9);
        end
        if (sequence2 == 6) then begin
            float_msg(Anozol4_obj, message_str(1635, 2104), 8);
            add_timer_event(self_obj, game_ticks(3), 9);
        end
        if (sequence2 == 7) then begin
            float_msg(aran, message_str(1635, 2105), 2);
            add_timer_event(self_obj, game_ticks(6), 9);
        end
        if (sequence2 == 8) then begin
            float_msg(Anozol2_obj, message_str(1635, 2106), 8);
            add_timer_event(self_obj, game_ticks(6), 9);
        end
        if (sequence2 == 9) then begin
            float_msg(aran, message_str(1635, 2107), 2);
            add_timer_event(self_obj, game_ticks(6), 9);
        end
        if (sequence2 == 10) then begin
            float_msg(Anozol2_obj, message_str(1635, 2108), 8);
            add_timer_event(self_obj, game_ticks(6), 9);
        end
        if (sequence2 == 11) then begin
            float_msg(Anozol1_obj, message_str(1635, 2109), 8);
            add_timer_event(self_obj, game_ticks(5), 9);
        end
        if (sequence2 == 12) then begin
            float_msg(aran, message_str(1635, 2110), 2);
            add_timer_event(self_obj, game_ticks(4), 9);
        end
        if (sequence2 == 13) then begin
            float_msg(aran, message_str(1635, 2111), 2);
            add_timer_event(self_obj, game_ticks(2), 9);
        end
        if (sequence2 == 14) then begin
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                add_timer_event(party_member_obj(16777814), 0, 28);
            end
            game_ui_enable;
            set_global_var(996, 3);
            attack_setup(is1, Anozol1_obj);
        end
    end
    if (fixed_param == 10) then begin
        if (fixed_param == 10) then begin
            sequence2 := sequence2 + 1;
        end
        if (sequence2 == 1) then begin
            game_ui_disable;
            add_timer_event(self_obj, game_ticks(2), 10);
        end
        if (sequence2 == 2) then begin
            float_msg(is7, message_str(1635, 1500), 8);
            add_timer_event(self_obj, game_ticks(6), 10);
        end
        if (sequence2 == 3) then begin
            float_msg(is8, message_str(1635, 1501), 8);
            add_timer_event(self_obj, game_ticks(4), 10);
        end
        if (sequence2 == 4) then begin
            call Generate_Arans_Soldiers();
            add_timer_event(self_obj, game_ticks(1), 10);
        end
        if (sequence2 == 5) then begin
            float_msg(dude_obj, message_str(1635, 1502), 4);
            add_timer_event(self_obj, game_ticks(10), 10);
        end
        if (sequence2 == 6) then begin
            game_ui_enable;
            add_timer_event(aran, game_ticks(0), 1);
        end
    end
    if (fixed_param == 11) then begin
        float_msg(is8, message_str(1635, 1600), 2);
        attack_setup(is8, is2);
    end
    if (fixed_param == 12) then begin
        if (fixed_param == 12) then begin
            sequence := sequence + 1;
        end
        if (sequence == 1) then begin
            game_ui_disable;
            add_timer_event(self_obj, game_ticks(1), 12);
        end
        if (sequence == 2) then begin
            float_msg(aran, message_str(1635, 1700), 2);
            add_timer_event(self_obj, game_ticks(5), 12);
        end
        if (sequence == 3) then begin
            float_msg(is8, message_str(1635, 1701), 8);
            add_timer_event(self_obj, game_ticks(7), 12);
        end
        if (sequence == 4) then begin
            float_msg(is8, message_str(1635, 1702), 8);
            add_timer_event(self_obj, game_ticks(6), 12);
        end
        if (sequence == 5) then begin
            float_msg(aran, message_str(1635, 1703), 2);
            add_timer_event(self_obj, game_ticks(6), 12);
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0) and (global_var(1008) != 2)) then begin
                add_timer_event(party_member_obj(16777814), game_ticks(1), 40);
            end
        end
        if (sequence == 6) then begin
            gfade_out(600);
            add_timer_event(self_obj, game_ticks(1), 12);
        end
        if (sequence == 7) then begin
            destroy_object(is1);
            destroy_object(is2);
            destroy_object(is3);
            destroy_object(is4);
            destroy_object(is5);
            destroy_object(is6);
            destroy_object(is7);
            destroy_object(is8);
            destroy_object(is9);
            destroy_object(is10);
            destroy_object(aran);
            add_timer_event(self_obj, game_ticks(1), 12);
        end
        if (sequence == 8) then begin
            game_ui_enable;
            if (global_var(1008) != 2) then begin
                gfade_in(600);
                set_global_var(998, 1);
            end
            else begin
                game_time_advance(7 * (60 * (60 * 10)));
                if (get_critter_stat(dude_obj, 35) < get_critter_stat(dude_obj, 7)) then begin
                    critter_heal(dude_obj, get_critter_stat(dude_obj, 7) - get_critter_stat(dude_obj, 35));
                end
                if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0) and (get_critter_stat(party_member_obj(16777779), 35) < get_critter_stat(party_member_obj(16777779), 7))) then begin
                    critter_heal(party_member_obj(16777779), get_critter_stat(party_member_obj(16777779), 7) - get_critter_stat(party_member_obj(16777779), 35));
                end
                if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0) and (get_critter_stat(party_member_obj(16777811), 35) < get_critter_stat(party_member_obj(16777811), 7))) then begin
                    critter_heal(party_member_obj(16777811), get_critter_stat(party_member_obj(16777811), 7) - get_critter_stat(party_member_obj(16777811), 35));
                end
                if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0) and (get_critter_stat(party_member_obj(16777814), 35) < get_critter_stat(party_member_obj(16777814), 7))) then begin
                    critter_heal(party_member_obj(16777814), get_critter_stat(party_member_obj(16777814), 7) - get_critter_stat(party_member_obj(16777814), 35));
                end
                if ((party_member_obj(16777729) != 0) and (get_critter_stat(party_member_obj(16777729), 35) < get_critter_stat(party_member_obj(16777729), 7))) then begin
                    critter_heal(party_member_obj(16777729), get_critter_stat(party_member_obj(16777729), 7) - get_critter_stat(party_member_obj(16777729), 35));
                end
                load_map(23, 0);
            end
        end
    end
    if (fixed_param == 20) then begin
        if (get_critter_stat(dude_obj, 4) > 5) then begin
            display_msg(message_str(1635, 2301));
        end
        else begin
            display_msg(message_str(1635, 2302));
        end
    end
    if (fixed_param == 30) then begin
        move_to(dude_obj, 14703, 0);
        anim(dude_obj, 1000, 2);
        if (party_member_obj(16777729) != 0) then begin
            if (party_member_obj(16777729) != 0) then begin
                if (has_trait(1, party_member_obj(16777729), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
            if (party_member_obj(16777779) != 0) then begin
                if (has_trait(1, party_member_obj(16777779), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
            if (party_member_obj(16777811) != 0) then begin
                if (has_trait(1, party_member_obj(16777811), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if (party_member_obj(16777812) != 0) then begin
            if (party_member_obj(16777812) != 0) then begin
                if (has_trait(1, party_member_obj(16777812), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
            if (party_member_obj(16777814) != 0) then begin
                if (has_trait(1, party_member_obj(16777814), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if (party_member_obj(16777748) != 0) then begin
            if (party_member_obj(16777748) != 0) then begin
                if (has_trait(1, party_member_obj(16777748), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if (party_member_obj(16778017) != 0) then begin
            if (party_member_obj(16778017) != 0) then begin
                if (has_trait(1, party_member_obj(16778017), 666)) then begin
                    critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if (party_member_obj(16778016) != 0) then begin
            if (party_member_obj(16778016) != 0) then begin
                if (has_trait(1, party_member_obj(16778016), 666)) then begin
                    critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if (party_member_obj(16778049) != 0) then begin
            if (party_member_obj(16778049) != 0) then begin
                if (has_trait(1, party_member_obj(16778049), 666)) then begin
                    critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if (party_member_obj(16778050) != 0) then begin
            if (party_member_obj(16778050) != 0) then begin
                if (has_trait(1, party_member_obj(16778050), 666)) then begin
                    critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if (party_member_obj(16778051) != 0) then begin
            if (party_member_obj(16778051) != 0) then begin
                if (has_trait(1, party_member_obj(16778051), 666)) then begin
                    critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if (party_member_obj(16777294) != 0) then begin
            if (party_member_obj(16777294) != 0) then begin
                if (has_trait(1, party_member_obj(16777294), 666)) then begin
                    critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                end
            end
        end
        if (party_member_obj(16777729) != 0) then begin
            anim(party_member_obj(16777729), 1000, 2);
        end
        if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
            anim(party_member_obj(16777779), 1000, 2);
        end
        if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
            anim(party_member_obj(16777811), 1000, 2);
        end
        if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
            anim(party_member_obj(16777814), 1000, 2);
        end
        if (party_member_obj(16778017) != 0) then begin
            anim(party_member_obj(16778017), 1000, 2);
        end
        if (party_member_obj(16778016) != 0) then begin
            anim(party_member_obj(16778016), 1000, 2);
        end
        if (party_member_obj(16778049) != 0) then begin
            anim(party_member_obj(16778049), 1000, 2);
        end
        if (party_member_obj(16778050) != 0) then begin
            anim(party_member_obj(16778050), 1000, 2);
        end
        if (party_member_obj(16778051) != 0) then begin
            anim(party_member_obj(16778051), 1000, 2);
        end
        if (party_member_obj(16777812) != 0) then begin
            anim(party_member_obj(16777812), 1000, 2);
        end
    end
    if (fixed_param == 40) then begin
        game_ui_enable;
        gfade_in(1);
        set_global_var(998, 1);
        set_global_var(904, global_var(904) bwor 1024);
    end
end

procedure Generate_Ghouls
begin
    gh1 := create_object_sid(16778019, 17151, 0, 1719);
    gh2 := create_object_sid(16777821, 18149, 0, 1719);
    gh3 := create_object_sid(16778019, 17156, 0, 1719);
    gh4 := create_object_sid(16777821, 17953, 0, 1719);
    gh5 := create_object_sid(16778019, 16356, 0, 1719);
    gh6 := create_object_sid(16777821, 19155, 0, 1719);
    restock_obj := create_object_sid(116, 0, 0, -1);
    add_mult_objs_to_inven(gh1, restock_obj, 1);
    restock_obj := create_object_sid(143, 0, 0, -1);
    add_mult_objs_to_inven(gh2, restock_obj, 1);
    restock_obj := create_object_sid(118, 0, 0, -1);
    add_mult_objs_to_inven(gh3, restock_obj, 1);
    restock_obj := create_object_sid(143, 0, 0, -1);
    add_mult_objs_to_inven(gh4, restock_obj, 1);
    restock_obj := create_object_sid(118, 0, 0, -1);
    add_mult_objs_to_inven(gh5, restock_obj, 1);
    restock_obj := create_object_sid(94, 0, 0, -1);
    add_mult_objs_to_inven(gh6, restock_obj, 1);
    wield_obj_critter(gh1, obj_carrying_pid_obj(gh1, 116));
    wield_obj_critter(gh2, obj_carrying_pid_obj(gh2, 143));
    wield_obj_critter(gh3, obj_carrying_pid_obj(gh3, 118));
    wield_obj_critter(gh4, obj_carrying_pid_obj(gh4, 143));
    wield_obj_critter(gh5, obj_carrying_pid_obj(gh5, 118));
    wield_obj_critter(gh6, obj_carrying_pid_obj(gh6, 94));
    restock_obj := create_object_sid(309, 0, 0, -1);
    add_mult_objs_to_inven(gh1, restock_obj, 1);
    restock_obj := create_object_sid(309, 0, 0, -1);
    add_mult_objs_to_inven(gh2, restock_obj, 1);
    restock_obj := create_object_sid(309, 0, 0, -1);
    add_mult_objs_to_inven(gh3, restock_obj, 1);
    restock_obj := create_object_sid(309, 0, 0, -1);
    add_mult_objs_to_inven(gh4, restock_obj, 1);
    restock_obj := create_object_sid(309, 0, 0, -1);
    add_mult_objs_to_inven(gh5, restock_obj, 1);
    restock_obj := create_object_sid(309, 0, 0, -1);
    add_mult_objs_to_inven(gh6, restock_obj, 1);
end

procedure Generate_Primitives
begin
    gurgan := create_object_sid(16777913, 28887, 0, 1742);
    pr1 := create_object_sid(16777917, 29491, 0, 1742);
    pr2 := create_object_sid(16777917, 30092, 0, 1742);
    pr3 := create_object_sid(16777917, 30077, 0, 1742);
    pr4 := create_object_sid(16777917, 30886, 0, 1742);
    pr5 := create_object_sid(16777917, 29885, 0, 1742);
    pr6 := create_object_sid(16777917, 30483, 0, 1742);
    pr7 := create_object_sid(16777917, 29280, 0, 1742);
    anim(gurgan, 1000, 5);
    anim(pr1, 1000, 5);
    anim(pr2, 1000, 5);
    anim(pr3, 1000, 5);
    anim(pr4, 1000, 5);
    anim(pr5, 1000, 5);
    anim(pr6, 1000, 5);
    anim(pr7, 1000, 5);
    restock_obj := create_object_sid(280, 0, 0, -1);
    add_mult_objs_to_inven(gurgan, restock_obj, 1);
    restock_obj := create_object_sid(280, 0, 0, -1);
    add_mult_objs_to_inven(pr1, restock_obj, 1);
    restock_obj := create_object_sid(280, 0, 0, -1);
    add_mult_objs_to_inven(pr2, restock_obj, 1);
    restock_obj := create_object_sid(280, 0, 0, -1);
    add_mult_objs_to_inven(pr3, restock_obj, 1);
    restock_obj := create_object_sid(280, 0, 0, -1);
    add_mult_objs_to_inven(pr4, restock_obj, 1);
    restock_obj := create_object_sid(280, 0, 0, -1);
    add_mult_objs_to_inven(pr5, restock_obj, 1);
    restock_obj := create_object_sid(280, 0, 0, -1);
    add_mult_objs_to_inven(pr6, restock_obj, 1);
    restock_obj := create_object_sid(280, 0, 0, -1);
    add_mult_objs_to_inven(pr7, restock_obj, 1);
    wield_obj_critter(gurgan, obj_carrying_pid_obj(gurgan, 280));
    wield_obj_critter(pr1, obj_carrying_pid_obj(pr1, 280));
    wield_obj_critter(pr2, obj_carrying_pid_obj(pr2, 280));
    wield_obj_critter(pr3, obj_carrying_pid_obj(pr3, 280));
    wield_obj_critter(pr4, obj_carrying_pid_obj(pr4, 280));
    wield_obj_critter(pr5, obj_carrying_pid_obj(pr5, 280));
    wield_obj_critter(pr6, obj_carrying_pid_obj(pr6, 280));
    wield_obj_critter(pr7, obj_carrying_pid_obj(pr7, 280));
end

procedure Generate_Primitives_Own_Attack
begin
    gurgan := create_object_sid(16777913, 28090, 0, 1742);
    pr1 := create_object_sid(16777917, 28481, 0, 1742);
    pr2 := create_object_sid(16777917, 29284, 0, 1742);
    anim(gurgan, 1000, 4);
    anim(pr1, 1000, 0);
    anim(pr2, 1000, 5);
    restock_obj := create_object_sid(280, 0, 0, -1);
    add_mult_objs_to_inven(gurgan, restock_obj, 1);
    restock_obj := create_object_sid(280, 0, 0, -1);
    add_mult_objs_to_inven(pr1, restock_obj, 1);
    restock_obj := create_object_sid(280, 0, 0, -1);
    add_mult_objs_to_inven(pr2, restock_obj, 1);
    wield_obj_critter(gurgan, obj_carrying_pid_obj(gurgan, 280));
    wield_obj_critter(pr1, obj_carrying_pid_obj(pr1, 280));
    wield_obj_critter(pr2, obj_carrying_pid_obj(pr2, 280));
    nm2 := create_object_sid(16777929, 27700, 0, -1);
    nm1 := create_object_sid(16777928, 28091, 0, -1);
    nm3 := create_object_sid(16777928, 28280, 0, -1);
    nm4 := create_object_sid(16777929, 27084, 0, -1);
    anim(nm1, 1000, 1);
    anim(nm2, 1000, 2);
    anim(nm3, 1000, 3);
    anim(nm4, 1000, 2);
    restock_obj := create_object_sid(601, 0, 0, -1);
    add_mult_objs_to_inven(nm1, restock_obj, 1);
    restock_obj := create_object_sid(9, 0, 0, -1);
    add_mult_objs_to_inven(nm2, restock_obj, 1);
    restock_obj := create_object_sid(601, 0, 0, -1);
    add_mult_objs_to_inven(nm3, restock_obj, 1);
    restock_obj := create_object_sid(18, 0, 0, -1);
    add_mult_objs_to_inven(nm4, restock_obj, 1);
    wield_obj_critter(nm1, obj_carrying_pid_obj(nm1, 601));
    wield_obj_critter(nm2, obj_carrying_pid_obj(nm2, 9));
    wield_obj_critter(nm3, obj_carrying_pid_obj(nm3, 601));
    wield_obj_critter(nm4, obj_carrying_pid_obj(nm4, 18));
    pr3 := create_object_sid(16777917, 28295, 0, 1742);
    pr4 := create_object_sid(16777917, 28888, 0, 1742);
    pr5 := create_object_sid(16777917, 29282, 0, 1742);
    pr6 := create_object_sid(16777917, 28479, 0, 1742);
    pr7 := create_object_sid(16777917, 26885, 0, 1742);
    anim(pr3, 1000, 1);
    anim(pr4, 1000, 5);
    anim(pr5, 1000, 2);
    anim(pr6, 1000, 5);
    anim(pr7, 1000, 3);
    reg_anim_func(2, pr3);
    anim(pr3, 48, 0);
    reg_anim_func(2, pr4);
    anim(pr4, 62, 0);
    reg_anim_func(2, pr5);
    anim(pr5, 62, 0);
    reg_anim_func(2, pr6);
    anim(pr6, 62, 0);
    reg_anim_func(2, pr7);
    anim(pr7, 62, 0);
    nm5 := create_object_sid(16777928, 27878, 0, -1);
    nm6 := create_object_sid(16777929, 27886, 0, -1);
    anim(nm5, 1000, 1);
    anim(nm6, 1000, 2);
    reg_anim_func(2, nm6);
    anim(nm6, 62, 0);
    reg_anim_func(2, nm5);
    anim(nm5, 62, 0);
end

procedure Generate_Primitives_Own_Attack_With_Imperial
begin
    is1 := create_object_sid(16778031, 20308, 0, 141);
    is2 := create_object_sid(16778032, 20106, 0, 141);
    is3 := create_object_sid(16778031, 19708, 0, 141);
    is4 := create_object_sid(16778031, 19705, 0, 141);
    anim(is1, 1000, 3);
    anim(is2, 1000, 3);
    anim(is3, 1000, 3);
    anim(is4, 1000, 3);
    restock_obj := create_object_sid(24, 0, 0, -1);
    add_mult_objs_to_inven(is1, restock_obj, 1);
    restock_obj := create_object_sid(24, 0, 0, -1);
    add_mult_objs_to_inven(is2, restock_obj, 1);
    restock_obj := create_object_sid(24, 0, 0, -1);
    add_mult_objs_to_inven(is3, restock_obj, 1);
    restock_obj := create_object_sid(16, 0, 0, -1);
    add_mult_objs_to_inven(is4, restock_obj, 1);
    wield_obj_critter(is1, obj_carrying_pid_obj(is1, 24));
    wield_obj_critter(is2, obj_carrying_pid_obj(is2, 24));
    wield_obj_critter(is3, obj_carrying_pid_obj(is3, 24));
    wield_obj_critter(is4, obj_carrying_pid_obj(is4, 16));
end

procedure Generate_Imperial_Soldiers
begin
    is1 := create_object_sid(16778031, 29098, 0, 141);
    is2 := create_object_sid(16778032, 29701, 0, 141);
    is3 := create_object_sid(16778045, 29102, 0, 141);
    is4 := create_object_sid(16778032, 29904, 0, 141);
    is5 := create_object_sid(16778031, 30100, 0, 141);
    anim(is1, 1000, 0);
    anim(is2, 1000, 0);
    anim(is3, 1000, 0);
    anim(is4, 1000, 0);
    anim(is5, 1000, 0);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(is1, restock_obj, 1);
    restock_obj := create_object_sid(24, 0, 0, -1);
    add_mult_objs_to_inven(is2, restock_obj, 1);
    restock_obj := create_object_sid(24, 0, 0, -1);
    add_mult_objs_to_inven(is3, restock_obj, 1);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(is4, restock_obj, 1);
    restock_obj := create_object_sid(16, 0, 0, -1);
    add_mult_objs_to_inven(is5, restock_obj, 1);
    restock_obj := create_object_sid(38, 0, 0, -1);
    add_mult_objs_to_inven(is1, restock_obj, 1);
    restock_obj := create_object_sid(38, 0, 0, -1);
    add_mult_objs_to_inven(is2, restock_obj, 1);
    restock_obj := create_object_sid(38, 0, 0, -1);
    add_mult_objs_to_inven(is3, restock_obj, 1);
    restock_obj := create_object_sid(38, 0, 0, -1);
    add_mult_objs_to_inven(is4, restock_obj, 1);
    restock_obj := create_object_sid(38, 0, 0, -1);
    add_mult_objs_to_inven(is5, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is1, restock_obj, 2);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is2, restock_obj, 2);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is3, restock_obj, 2);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is4, restock_obj, 2);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is5, restock_obj, 2);
    wield_obj_critter(is1, obj_carrying_pid_obj(is1, 599));
    wield_obj_critter(is2, obj_carrying_pid_obj(is2, 24));
    wield_obj_critter(is3, obj_carrying_pid_obj(is3, 24));
    wield_obj_critter(is4, obj_carrying_pid_obj(is4, 599));
    wield_obj_critter(is5, obj_carrying_pid_obj(is5, 16));
end

procedure Generate_Dead_Soldiers
begin
    is1 := create_object_sid(16778031, 16911, 1, -1);
    is2 := create_object_sid(16778032, 16917, 1, -1);
    is3 := create_object_sid(16778031, 17114, 1, -1);
    is4 := create_object_sid(16778032, 17510, 1, -1);
    is5 := create_object_sid(16778045, 17316, 1, -1);
    is6 := create_object_sid(16778031, 17712, 1, -1);
    is7 := create_object_sid(16778032, 17110, 1, -1);
    is8 := create_object_sid(16778045, 17319, 1, -1);
    is9 := create_object_sid(16778032, 16515, 1, -1);
    is10 := create_object_sid(16778031, 16519, 1, -1);
    anim(is1, 1000, 1);
    anim(is2, 1000, 0);
    anim(is3, 1000, 3);
    anim(is4, 1000, 2);
    anim(is5, 1000, 4);
    anim(is6, 1000, 5);
    anim(is7, 1000, 0);
    anim(is8, 1000, 3);
    anim(is9, 1000, 3);
    anim(is10, 1000, 2);
    reg_anim_func(2, is1);
    anim(is1, 62, 0);
    reg_anim_func(2, is2);
    anim(is2, 54, 0);
    reg_anim_func(2, is3);
    anim(is3, 53, 0);
    reg_anim_func(2, is4);
    anim(is4, 53, 0);
    reg_anim_func(2, is5);
    anim(is5, 54, 0);
    reg_anim_func(2, is6);
    anim(is6, 61, 0);
    reg_anim_func(2, is7);
    anim(is7, 53, 0);
    reg_anim_func(2, is8);
    anim(is8, 53, 0);
    reg_anim_func(2, is9);
    anim(is9, 56, 0);
    reg_anim_func(2, is10);
    anim(is10, 53, 0);
    add_timer_event(self_obj, game_ticks(1), 6);
end

procedure Generate_Exploded_Soldiers
begin
    is1 := create_object_sid(16778031, 16911, 1, -1);
    is2 := create_object_sid(16778032, 16917, 1, -1);
    is3 := create_object_sid(16778045, 17114, 1, -1);
    is4 := create_object_sid(16778032, 17517, 1, -1);
    is6 := create_object_sid(16778031, 17712, 1, -1);
    is7 := create_object_sid(16778032, 17110, 1, -1);
    is8 := create_object_sid(16778045, 17319, 1, -1);
    is9 := create_object_sid(16778032, 16515, 1, -1);
    is10 := create_object_sid(16778031, 16519, 1, -1);
    anim(is1, 1000, 1);
    anim(is2, 1000, 0);
    anim(is3, 1000, 3);
    anim(is4, 1000, 2);
    anim(is6, 1000, 5);
    anim(is7, 1000, 0);
    anim(is8, 1000, 3);
    anim(is9, 1000, 3);
    anim(is10, 1000, 2);
    reg_anim_func(2, is1);
    anim(is1, 62, 0);
    reg_anim_func(2, is2);
    anim(is2, 54, 0);
    reg_anim_func(2, is3);
    anim(is3, 53, 0);
    reg_anim_func(2, is4);
    anim(is4, 53, 0);
    reg_anim_func(2, is6);
    anim(is6, 61, 0);
    reg_anim_func(2, is7);
    anim(is7, 53, 0);
    reg_anim_func(2, is8);
    anim(is8, 53, 0);
    reg_anim_func(2, is9);
    anim(is9, 56, 0);
    reg_anim_func(2, is10);
    anim(is10, 53, 0);
    restock_obj := create_object_sid(16, 0, 0, -1);
    add_mult_objs_to_inven(is3, restock_obj, 1);
    restock_obj := create_object_sid(24, 0, 0, -1);
    add_mult_objs_to_inven(is9, restock_obj, 1);
    add_timer_event(self_obj, game_ticks(1), 6);
end

procedure Generate_Arans_Soldiers
begin
    is1 := create_object_sid(16778031, 11871, 2, 142);
    is2 := create_object_sid(16778031, 12064, 2, 142);
    is3 := create_object_sid(16778031, 11869, 2, 142);
    is4 := create_object_sid(16778032, 12468, 2, 142);
    is5 := create_object_sid(16778031, 12268, 2, 142);
    aran := create_object_sid(16778022, 12668, 2, 94);
    anim(is1, 1000, 2);
    anim(is2, 1000, 2);
    anim(is3, 1000, 2);
    anim(is4, 1000, 2);
    anim(is5, 1000, 2);
    anim(aran, 1000, 2);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(is1, restock_obj, 1);
    restock_obj := create_object_sid(118, 0, 0, -1);
    add_mult_objs_to_inven(is2, restock_obj, 1);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(is3, restock_obj, 1);
    restock_obj := create_object_sid(402, 0, 0, -1);
    add_mult_objs_to_inven(is4, restock_obj, 1);
    restock_obj := create_object_sid(406, 0, 0, -1);
    add_mult_objs_to_inven(is5, restock_obj, 1);
    restock_obj := create_object_sid(406, 0, 0, -1);
    add_mult_objs_to_inven(aran, restock_obj, 1);
    restock_obj := create_object_sid(38, 0, 0, -1);
    add_mult_objs_to_inven(aran, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is1, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is2, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is3, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is4, restock_obj, 2);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is5, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(aran, restock_obj, 2);
    wield_obj_critter(is1, obj_carrying_pid_obj(is1, 599));
    wield_obj_critter(is2, obj_carrying_pid_obj(is2, 118));
    wield_obj_critter(is3, obj_carrying_pid_obj(is3, 599));
    wield_obj_critter(is4, obj_carrying_pid_obj(is4, 402));
    wield_obj_critter(is5, obj_carrying_pid_obj(is5, 406));
    wield_obj_critter(aran, obj_carrying_pid_obj(aran, 406));
    if ((global_var(1008) >= 2) and (global_var(1008) != 10)) then begin
        critter_add_trait(aran, 1, 6, 0);
    end
    else begin
        critter_add_trait(aran, 1, 6, 282);
    end
    critter_add_trait(aran, 1, 5, 29);
end

procedure Generate_Dude_Soldiers
begin
    is6 := create_object_sid(16778045, 15256, 2, 140);
    is7 := create_object_sid(16778031, 14456, 2, 140);
    is8 := create_object_sid(16778045, 13458, 2, 140);
    is9 := create_object_sid(16778031, 12656, 2, 140);
    is10 := create_object_sid(16778032, 13453, 2, 140);
    anim(is6, 1000, 3);
    anim(is7, 1000, 3);
    anim(is8, 1000, 3);
    anim(is9, 1000, 3);
    anim(is10, 1000, 3);
    restock_obj := create_object_sid(24, 0, 0, -1);
    add_mult_objs_to_inven(is6, restock_obj, 1);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(is7, restock_obj, 1);
    restock_obj := create_object_sid(406, 0, 0, -1);
    add_mult_objs_to_inven(is8, restock_obj, 1);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(is9, restock_obj, 1);
    restock_obj := create_object_sid(24, 0, 0, -1);
    add_mult_objs_to_inven(is10, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is6, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is7, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is8, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is9, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is10, restock_obj, 1);
    wield_obj_critter(is6, obj_carrying_pid_obj(is6, 24));
    wield_obj_critter(is7, obj_carrying_pid_obj(is7, 599));
    wield_obj_critter(is8, obj_carrying_pid_obj(is8, 406));
    wield_obj_critter(is9, obj_carrying_pid_obj(is9, 599));
    wield_obj_critter(is10, obj_carrying_pid_obj(is10, 24));
end

