variable ProtoOfItemGiven;
variable ValueOfRollCheck := 1;
variable Scenery_Creation;
variable Scenery_Creation_Hex;
variable Scenery_Creation_Count;
variable Temp_Scenery_Creation_Hex;
variable Scenery_Creation_Ptr;
variable lPartyWornArmor;
variable How_Many_Party_Members_Are_Injured;
variable How_Many_Party_Members_Armed;
variable PartyHealingItem;

procedure checkPartyMembersNearDoor;

variable global_temp;
variable dest_tile;
variable step_tile;
variable in_dialog;
variable forced_node;
variable restock_amt;
variable restock_obj;
variable restock_trash;
variable removed_qty;
variable toRemove_qty;

procedure div(variable arg0, variable arg1);
procedure start;
procedure map_enter_p_proc;
procedure map_update_p_proc;
procedure map_exit_p_proc;
procedure timed_event_p_proc;
procedure Generate_Gate_Guards;
procedure Generate_Arans_Soldiers;
procedure Generate_New_Soldiers;
procedure Generate_Attack_Soldier;

variable brad_partym;
variable sequence;
variable sequence2;
variable sequence3;
variable sequence4;
variable sequence5;
variable sequence6;
variable death_body_tile;
variable is1;
variable is2;
variable is3;
variable is4;
variable is5;
variable is6;
variable is7;
variable is8;
variable is10;
variable is11;
variable is12;
variable is13;
variable is14;
variable is15;
variable is16;
variable is17;
variable is20;
variable as1;
variable as2;
variable as3;
variable gateguard1;
variable gateguard2;
variable gateguard3;
variable gateguard4;
variable gateguard5;
variable gateguard6;
variable remove_corpse;
variable tulsa;

export variable Map_event;
export variable Sophie_obj;
export variable margaret_obj;
export variable margaret_table_swap;
export variable margaret_table_trade;
export variable margaret_door;
export variable Parlson_obj;
export variable Browman_obj;
export variable Elisa_obj;
export variable Aran_obj;
export variable Myzrael_obj;
export variable zacdoor_door;
export variable Myzrael_door;
export variable Palace_door;
export variable Elisas_table;
export variable Vault_elevator_door;
export variable Palace_door_guard1;
export variable Palace_door_guard2;
export variable Parlson_substitution;
export variable obyv_palace_food;
export variable obyv_barman;
export variable forcefield_1;
export variable forcefield_2;
export variable forcefield_3;
export variable forcefield_4;


procedure checkPartyMembersNearDoor
begin
    if (party_member_obj(16777729) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777729)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777779)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777811)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777812) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777812)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777813) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777813)) <= 5) then begin
            return 1;
        end
    end
    if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777814)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777748) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777748)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777294) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777294)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778017) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778017)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778016) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778016)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778049) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778049)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778050) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778050)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16778051) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16778051)) <= 5) then begin
            return 1;
        end
    end
    return 0;
end

procedure div(variable arg0, variable arg1)
begin
    if (0 > arg0) then begin
        return -(-arg0 / arg1);
    end
    return arg0 / arg1;
end

procedure start
begin
    Map_event := self_obj;
end

procedure map_enter_p_proc
begin
    if ((get_month >= 3) and (get_month < 5)) then begin
        if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
            set_light_level(game_time_hour - 600 + 40);
        end
        else begin
            if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                set_light_level(100);
            end
            else begin
                if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                    set_light_level(100 - (game_time_hour - 1800));
                end
                else begin
                    set_light_level(40);
                end
            end
        end
    end
    else begin
        if ((get_month >= 5) and (get_month < 9)) then begin
            if ((game_time_hour >= 500) and (game_time_hour < (500 + 100))) then begin
                set_light_level(game_time_hour - 500 + 40);
            end
            else begin
                if ((game_time_hour >= (500 + 100)) and (game_time_hour < 1900)) then begin
                    set_light_level(100);
                end
                else begin
                    if ((game_time_hour >= 1900) and (game_time_hour < (1900 + 100))) then begin
                        set_light_level(100 - (game_time_hour - 1900));
                    end
                    else begin
                        set_light_level(40);
                    end
                end
            end
        end
        else begin
            if ((get_month >= 9) and (get_month < 11)) then begin
                if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                    set_light_level(game_time_hour - 600 + 40);
                end
                else begin
                    if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1800));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
            else begin
                if ((game_time_hour >= 700) and (game_time_hour < (700 + 100))) then begin
                    set_light_level(game_time_hour - 700 + 40);
                end
                else begin
                    if ((game_time_hour >= (700 + 100)) and (game_time_hour < 1700)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1700) and (game_time_hour < (1700 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1700));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
        end
    end
    if (not((global_var(865) bwand 1) != 0)) then begin
        set_global_var(865, global_var(865) bwor 1);
    end
    if (not(metarule(22, 0))) then begin
        if ((global_var(1029) == 3) or (global_var(1029) == 4) and (global_var(998) == 0) and not((map_var(0) bwand 268435456) != 0)) then begin
            set_map_var(0, map_var(0) bwor 268435456);
            add_timer_event(Myzrael_door, game_ticks(0), 3);
            set_global_var(967, 2);
            if (not((global_var(904) bwand 32) != 0)) then begin
                set_global_var(904, global_var(904) bwor 32);
            end
            if (not((global_var(904) bwand 2) != 0)) then begin
                set_global_var(904, global_var(904) bwor 2);
            end
            is1 := create_object_sid(16778031, 15279, 0, 130);
            is2 := create_object_sid(16778032, 15285, 0, 130);
            restock_obj := create_object_sid(406, 0, 0, -1);
            add_mult_objs_to_inven(is1, restock_obj, 1);
            restock_obj := create_object_sid(406, 0, 0, -1);
            add_mult_objs_to_inven(is2, restock_obj, 1);
            restock_obj := create_object_sid(40, 0, 0, -1);
            add_mult_objs_to_inven(is1, restock_obj, 2);
            restock_obj := create_object_sid(40, 0, 0, -1);
            add_mult_objs_to_inven(is2, restock_obj, 2);
            anim(is1, 1000, 2);
            anim(is2, 1000, 2);
            is3 := create_object_sid(16778031, 15671, 0, 130);
            is4 := create_object_sid(16778031, 19491, 0, 130);
            restock_obj := create_object_sid(599, 0, 0, -1);
            add_mult_objs_to_inven(is3, restock_obj, 1);
            restock_obj := create_object_sid(599, 0, 0, -1);
            add_mult_objs_to_inven(is4, restock_obj, 1);
            restock_obj := create_object_sid(40, 0, 0, -1);
            add_mult_objs_to_inven(is3, restock_obj, 2);
            restock_obj := create_object_sid(40, 0, 0, -1);
            add_mult_objs_to_inven(is4, restock_obj, 2);
            anim(is3, 1000, 3);
            anim(is4, 1000, 0);
            move_to(Elisa_obj, 15882, 0);
            anim(self_obj, 1000, 2);
            add_timer_event(self_obj, 5, 101);
        end
        if ((global_var(1017) bwand 16) != 0) then begin
            if ((global_var(998) != 1) and (global_var(1008) != 3) and ((global_var(904) bwand 8388608) != 0) and ((game_time - global_var(1001)) >= (60 * (60 * 10) * 8))) then begin
                if (not((map_var(0) bwand 16777216) != 0)) then begin
                    set_map_var(0, map_var(0) bwor 16777216);
                end
            end
            set_global_var(1017, global_var(1017) bwand (-1 - 16));
        end
        if ((global_var(1000) bwand 268435456) != 0) then begin
            move_to(dude_obj, 21464, 0);
            anim(dude_obj, 1000, 2);
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 1), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777729) != 0) then begin
                reg_anim_func(2, party_member_obj(16777729));
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777779));
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777811));
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777814));
            end
            if (party_member_obj(16778017) != 0) then begin
                reg_anim_func(2, party_member_obj(16778017));
            end
            if (party_member_obj(16778016) != 0) then begin
                reg_anim_func(2, party_member_obj(16778016));
            end
            if (party_member_obj(16778049) != 0) then begin
                reg_anim_func(2, party_member_obj(16778049));
            end
            if (party_member_obj(16778050) != 0) then begin
                reg_anim_func(2, party_member_obj(16778050));
            end
            if (party_member_obj(16778051) != 0) then begin
                reg_anim_func(2, party_member_obj(16778051));
            end
            if (party_member_obj(16777812) != 0) then begin
                reg_anim_func(2, party_member_obj(16777812));
            end
            if (party_member_obj(16777729) != 0) then begin
                anim(party_member_obj(16777729), 1000, 2);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 2);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 2);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 2);
            end
            if (party_member_obj(16778017) != 0) then begin
                anim(party_member_obj(16778017), 1000, 2);
            end
            if (party_member_obj(16778016) != 0) then begin
                anim(party_member_obj(16778016), 1000, 2);
            end
            if (party_member_obj(16778049) != 0) then begin
                anim(party_member_obj(16778049), 1000, 2);
            end
            if (party_member_obj(16778050) != 0) then begin
                anim(party_member_obj(16778050), 1000, 2);
            end
            if (party_member_obj(16778051) != 0) then begin
                anim(party_member_obj(16778051), 1000, 2);
            end
            if (party_member_obj(16777812) != 0) then begin
                anim(party_member_obj(16777812), 1000, 2);
            end
            add_timer_event(Vault_elevator_door, game_ticks(0), 3);
        end
        if ((global_var(998) != 1) and not((global_var(1000) bwand 32) != 0)) then begin
            if ((global_var(574) == 1) and (global_var(992) == 0) and (global_var(1008) == 0) and not((global_var(1000) bwand 8) != 0)) then begin
                set_global_var(1000, global_var(1000) bwor 32);
                create_object_sid(16777804, 0, 0, 107);
            end
            if ((global_var(898) < 4) and ((global_var(882) != 4) and (global_var(881) != 2) and (global_var(883) != 2)) and (global_var(859) == 0) and ((global_var(1000) bwand 16) == 0) and not((global_var(867) bwand 33554432) != 0) and ((global_var(1017) bwand 131072) == 0)) then begin
                if ((global_var(574) == 1) and ((global_var(1006) == 0) and ((global_var(904) bwand 2) != 0) and not((global_var(904) bwand 8192) != 0) or ((global_var(1007) == 0) and ((global_var(904) bwand 1) != 0)))) then begin
                    set_global_var(1000, global_var(1000) bwor 32);
                    create_object_sid(16777804, 0, 0, 107);
                end
            end
            if ((global_var(574) == 1) and ((global_var(1017) bwand 131072) == 0) and ((global_var(1017) bwand 65536) != 0) and (global_var(864) == 0) and ((global_var(1000) bwand 16) == 0) and ((global_var(882) == 4) or (global_var(881) == 2) or (global_var(883) == 2))) then begin
                set_global_var(1000, global_var(1000) bwor 32);
                create_object_sid(16777804, 0, 0, 107);
            end
        end
        if ((global_var(1008) == 3) and not(metarule(22, 0))) then begin
            call Generate_Gate_Guards();
            call Generate_Arans_Soldiers();
            set_map_var(0, map_var(0) bwand (-1 - 16384));
            set_global_var(1011, 0);
            game_ui_disable;
            add_timer_event(self_obj, game_ticks(0), 5);
        end
        if ((global_var(998) != 1) and (global_var(1008) != 3) and ((global_var(904) bwand 8388608) != 0) and ((game_time - global_var(1001)) >= (60 * (60 * 10) * 8))) then begin
            if ((map_var(0) bwand 16777216) != 0) then begin
                game_ui_disable;
                brad_partym := create_object_sid(16778026, 29505, 0, 118);
                restock_obj := create_object_sid(16, 0, 0, -1);
                add_mult_objs_to_inven(brad_partym, restock_obj, 1);
                wield_obj_critter(brad_partym, obj_carrying_pid_obj(brad_partym, 16));
                gateguard1 := create_object_sid(16778031, 29103, 0, 130);
                gateguard2 := create_object_sid(16778045, 29107, 0, 130);
                restock_obj := create_object_sid(24, 0, 0, -1);
                add_mult_objs_to_inven(gateguard1, restock_obj, 1);
                restock_obj := create_object_sid(24, 0, 0, -1);
                add_mult_objs_to_inven(gateguard2, restock_obj, 1);
                wield_obj_critter(gateguard1, obj_carrying_pid_obj(gateguard1, 24));
                wield_obj_critter(gateguard2, obj_carrying_pid_obj(gateguard2, 24));
                anim(brad_partym, 1000, 2);
                anim(gateguard1, 1000, 2);
                anim(gateguard2, 1000, 2);
                add_timer_event(brad_partym, game_ticks(2), 20);
            end
        end
        if ((global_var(998) != 1) and (global_var(1008) != 3) and (global_var(997) == 2) and not((global_var(904) bwand 2097152) != 0)) then begin
            set_global_var(904, global_var(904) bwor 2097152);
            brad_partym := create_object_sid(16778026, tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj), 118);
            anim(brad_partym, 1000, has_trait(1, dude_obj, 10));
            restock_obj := create_object_sid(16, 0, 0, -1);
            add_mult_objs_to_inven(brad_partym, restock_obj, 1);
            wield_obj_critter(brad_partym, obj_carrying_pid_obj(brad_partym, 16));
            critter_add_trait(brad_partym, 1, 6, 0);
            add_timer_event(brad_partym, game_ticks(random(10, 20)), 1);
            add_timer_event(brad_partym, game_ticks(1), 70);
        end
    end
end

procedure map_update_p_proc
begin
    if ((get_month >= 3) and (get_month < 5)) then begin
        if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
            set_light_level(game_time_hour - 600 + 40);
        end
        else begin
            if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                set_light_level(100);
            end
            else begin
                if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                    set_light_level(100 - (game_time_hour - 1800));
                end
                else begin
                    set_light_level(40);
                end
            end
        end
    end
    else begin
        if ((get_month >= 5) and (get_month < 9)) then begin
            if ((game_time_hour >= 500) and (game_time_hour < (500 + 100))) then begin
                set_light_level(game_time_hour - 500 + 40);
            end
            else begin
                if ((game_time_hour >= (500 + 100)) and (game_time_hour < 1900)) then begin
                    set_light_level(100);
                end
                else begin
                    if ((game_time_hour >= 1900) and (game_time_hour < (1900 + 100))) then begin
                        set_light_level(100 - (game_time_hour - 1900));
                    end
                    else begin
                        set_light_level(40);
                    end
                end
            end
        end
        else begin
            if ((get_month >= 9) and (get_month < 11)) then begin
                if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                    set_light_level(game_time_hour - 600 + 40);
                end
                else begin
                    if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1800));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
            else begin
                if ((game_time_hour >= 700) and (game_time_hour < (700 + 100))) then begin
                    set_light_level(game_time_hour - 700 + 40);
                end
                else begin
                    if ((game_time_hour >= (700 + 100)) and (game_time_hour < 1700)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1700) and (game_time_hour < (1700 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1700));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
        end
    end
    if ((Parlson_obj != 0) and (critter_state(Parlson_obj) == 1)) then begin
        Parlson_obj := 0;
    end
    if ((Parlson_substitution != 0) and (critter_state(Parlson_substitution) == 1)) then begin
        Parlson_substitution := 0;
    end
end

procedure map_exit_p_proc
begin
    if ((global_var(1008) >= 2) and (global_var(1008) != 10) and (tile_in_tile_rect(32310, 32300, 33710, 33700, tile_num(dude_obj)) or tile_in_tile_rect(20370, 20361, 24970, 24961, tile_num(dude_obj)))) then begin
        if (get_critter_stat(dude_obj, 34) == 0) then begin
            display_msg(message_str(1633, 4500));
        end
        else begin
            display_msg(message_str(1633, 4501));
        end
        set_global_var(998, 1);
        set_global_var(904, global_var(904) bwor 64);
        if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
            set_global_var(1020, global_var(1020) bwor 64);
        end
        set_global_var(1008, 1);
    end
end

procedure timed_event_p_proc
begin
    if ((fixed_param == 1) and (global_var(990) == 2) and (global_var(998) == 0)) then begin
        if (fixed_param == 1) then begin
            sequence := sequence + 1;
        end
        if (sequence == 1) then begin
            float_msg(Aran_obj, message_str(1633, 2000), 2);
            add_timer_event(self_obj, game_ticks(6), 1);
        end
        if (sequence == 2) then begin
            if (get_critter_stat(dude_obj, 34) == 0) then begin
                float_msg(Elisa_obj, message_str(1633, 2050), 8);
            end
            else begin
                float_msg(Elisa_obj, message_str(1633, 2051), 8);
            end
            add_timer_event(self_obj, game_ticks(6), 1);
        end
        if (sequence == 3) then begin
            float_msg(Aran_obj, message_str(1633, 2100), 2);
        end
    end
    if ((fixed_param == 2) and (global_var(993) == 3)) then begin
        if (fixed_param == 2) then begin
            sequence := sequence + 1;
        end
        if (sequence == 1) then begin
            gfade_out(600);
            set_map_var(0, map_var(0) bwor 4096);
            set_map_var(0, map_var(0) bwor 262144);
            add_timer_event(self_obj, game_ticks(1), 2);
        end
        if (sequence == 2) then begin
            move_to(dude_obj, 17283, 0);
            anim(dude_obj, 1000, 5);
            metarule3(108, 16483, 0, 0);
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777729) != 0) then begin
                reg_anim_func(2, party_member_obj(16777729));
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777779));
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777811));
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777814));
            end
            if (party_member_obj(16778017) != 0) then begin
                reg_anim_func(2, party_member_obj(16778017));
            end
            if (party_member_obj(16778016) != 0) then begin
                reg_anim_func(2, party_member_obj(16778016));
            end
            if (party_member_obj(16778049) != 0) then begin
                reg_anim_func(2, party_member_obj(16778049));
            end
            if (party_member_obj(16778050) != 0) then begin
                reg_anim_func(2, party_member_obj(16778050));
            end
            if (party_member_obj(16778051) != 0) then begin
                reg_anim_func(2, party_member_obj(16778051));
            end
            if (party_member_obj(16777812) != 0) then begin
                reg_anim_func(2, party_member_obj(16777812));
            end
            if (party_member_obj(16777729) != 0) then begin
                anim(party_member_obj(16777729), 1000, 5);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 5);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 5);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 5);
            end
            if (party_member_obj(16778017) != 0) then begin
                anim(party_member_obj(16778017), 1000, 5);
            end
            if (party_member_obj(16778016) != 0) then begin
                anim(party_member_obj(16778016), 1000, 5);
            end
            if (party_member_obj(16778049) != 0) then begin
                anim(party_member_obj(16778049), 1000, 5);
            end
            if (party_member_obj(16778050) != 0) then begin
                anim(party_member_obj(16778050), 1000, 5);
            end
            if (party_member_obj(16778051) != 0) then begin
                anim(party_member_obj(16778051), 1000, 5);
            end
            if (party_member_obj(16777812) != 0) then begin
                anim(party_member_obj(16777812), 1000, 5);
            end
            move_to(Elisa_obj, 16486, 0);
            anim(Elisa_obj, 1000, 1);
            move_to(Aran_obj, 16480, 0);
            anim(Aran_obj, 1000, 3);
            add_timer_event(Myzrael_door, game_ticks(0), 3);
            move_to(Myzrael_obj, 14082, 0);
            anim(Myzrael_obj, 1000, 3);
            animate_move_obj_to_tile(Myzrael_obj, 15883, 0);
            add_timer_event(self_obj, game_ticks(1), 2);
        end
        if (sequence == 3) then begin
            gfade_in(600);
            add_timer_event(self_obj, game_ticks(5), 2);
        end
        if (sequence == 4) then begin
            float_msg(Elisa_obj, message_str(1633, 100), 8);
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 5) then begin
            float_msg(Myzrael_obj, message_str(1633, 200), 9);
            add_timer_event(self_obj, game_ticks(5), 2);
        end
        if (sequence == 6) then begin
            float_msg(Myzrael_obj, message_str(1633, 201), 9);
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 7) then begin
            if (get_critter_stat(dude_obj, 34) == 0) then begin
                float_msg(Elisa_obj, message_str(1633, 300), 8);
            end
            else begin
                float_msg(Elisa_obj, message_str(1633, 301), 8);
            end
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 8) then begin
            float_msg(Aran_obj, message_str(1633, 400), 2);
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 9) then begin
            float_msg(Myzrael_obj, message_str(1633, 500), 9);
            add_timer_event(self_obj, game_ticks(5), 2);
        end
        if (sequence == 10) then begin
            float_msg(Myzrael_obj, message_str(1633, 501), 9);
            add_timer_event(self_obj, game_ticks(5), 2);
        end
        if (sequence == 11) then begin
            float_msg(dude_obj, message_str(1633, 600), 4);
            add_timer_event(self_obj, game_ticks(9), 2);
        end
        if (sequence == 12) then begin
            float_msg(dude_obj, message_str(1633, 601), 4);
            add_timer_event(self_obj, game_ticks(8), 2);
        end
        if (sequence == 13) then begin
            if (get_critter_stat(dude_obj, 34) == 0) then begin
                float_msg(Aran_obj, message_str(1633, 700), 2);
            end
            else begin
                float_msg(Aran_obj, message_str(1633, 701), 2);
            end
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 14) then begin
            if (get_critter_stat(dude_obj, 34) == 0) then begin
                float_msg(dude_obj, message_str(1633, 800), 4);
            end
            else begin
                float_msg(dude_obj, message_str(1633, 801), 4);
            end
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 15) then begin
            float_msg(Aran_obj, message_str(1633, 900), 2);
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 16) then begin
            float_msg(Elisa_obj, message_str(1633, 1000), 8);
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 17) then begin
            float_msg(Aran_obj, message_str(1633, 1100), 2);
            add_timer_event(self_obj, game_ticks(5), 2);
        end
        if (sequence == 18) then begin
            float_msg(Aran_obj, message_str(1633, 1101), 2);
            add_timer_event(self_obj, game_ticks(5), 2);
        end
        if (sequence == 19) then begin
            float_msg(Myzrael_obj, message_str(1633, 1200), 9);
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 20) then begin
            float_msg(Myzrael_obj, message_str(1633, 1201), 9);
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 21) then begin
            float_msg(Elisa_obj, message_str(1633, 1300), 8);
            add_timer_event(self_obj, game_ticks(5), 2);
        end
        if (sequence == 22) then begin
            float_msg(Aran_obj, message_str(1633, 1400), 2);
            add_timer_event(self_obj, game_ticks(5), 2);
        end
        if (sequence == 23) then begin
            float_msg(Myzrael_obj, message_str(1633, 1500), 9);
            add_timer_event(self_obj, game_ticks(7), 2);
        end
        if (sequence == 24) then begin
            animate_move_obj_to_tile(Myzrael_obj, 14082, 0);
            add_timer_event(self_obj, game_ticks(4), 2);
        end
        if (sequence == 25) then begin
            animate_move_obj_to_tile(Myzrael_obj, 12682, 0);
            add_timer_event(Myzrael_door, game_ticks(2), 2);
            add_timer_event(self_obj, game_ticks(3), 2);
        end
        if (sequence == 26) then begin
            float_msg(dude_obj, message_str(1633, 1600), 4);
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 27) then begin
            float_msg(Elisa_obj, message_str(1633, 1700 + (get_critter_stat(dude_obj, 34) == 1)), 8);
            add_timer_event(self_obj, game_ticks(6), 2);
        end
        if (sequence == 28) then begin
            game_ui_enable;
            set_global_var(910, global_var(910) bwand (-1 - 4194304));
            set_map_var(0, map_var(0) bwand (-1 - 262144));
            set_map_var(0, map_var(0) bwand (-1 - 4096));
        end
    end
    if ((fixed_param == 3) and (global_var(990) == 3)) then begin
        if (fixed_param == 3) then begin
            sequence := sequence + 1;
        end
        if (sequence == 1) then begin
            gfade_out(600);
            set_map_var(0, map_var(0) bwor 4096);
            set_map_var(0, map_var(0) bwor 262144);
            add_timer_event(self_obj, game_ticks(1), 3);
        end
        if (sequence == 2) then begin
            move_to(dude_obj, 17283, 0);
            anim(dude_obj, 1000, 5);
            metarule3(108, 16483, 0, 0);
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777729) != 0) then begin
                reg_anim_func(2, party_member_obj(16777729));
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777779));
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777811));
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777814));
            end
            if (party_member_obj(16778017) != 0) then begin
                reg_anim_func(2, party_member_obj(16778017));
            end
            if (party_member_obj(16778016) != 0) then begin
                reg_anim_func(2, party_member_obj(16778016));
            end
            if (party_member_obj(16778049) != 0) then begin
                reg_anim_func(2, party_member_obj(16778049));
            end
            if (party_member_obj(16778050) != 0) then begin
                reg_anim_func(2, party_member_obj(16778050));
            end
            if (party_member_obj(16778051) != 0) then begin
                reg_anim_func(2, party_member_obj(16778051));
            end
            if (party_member_obj(16777812) != 0) then begin
                reg_anim_func(2, party_member_obj(16777812));
            end
            if (party_member_obj(16777729) != 0) then begin
                anim(party_member_obj(16777729), 1000, 5);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 5);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 5);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 5);
            end
            if (party_member_obj(16778017) != 0) then begin
                anim(party_member_obj(16778017), 1000, 5);
            end
            if (party_member_obj(16778016) != 0) then begin
                anim(party_member_obj(16778016), 1000, 5);
            end
            if (party_member_obj(16778049) != 0) then begin
                anim(party_member_obj(16778049), 1000, 5);
            end
            if (party_member_obj(16778050) != 0) then begin
                anim(party_member_obj(16778050), 1000, 5);
            end
            if (party_member_obj(16778051) != 0) then begin
                anim(party_member_obj(16778051), 1000, 5);
            end
            if (party_member_obj(16777812) != 0) then begin
                anim(party_member_obj(16777812), 1000, 5);
            end
            move_to(Elisa_obj, 16486, 0);
            anim(Elisa_obj, 1000, 1);
            move_to(Aran_obj, 16480, 0);
            anim(Aran_obj, 1000, 3);
            add_timer_event(Myzrael_door, game_ticks(0), 3);
            move_to(Myzrael_obj, 14082, 0);
            anim(Myzrael_obj, 1000, 3);
            animate_move_obj_to_tile(Myzrael_obj, 15883, 0);
            add_timer_event(self_obj, game_ticks(1), 3);
        end
        if (sequence == 3) then begin
            gfade_in(600);
            add_timer_event(self_obj, game_ticks(5), 3);
        end
        if (sequence == 4) then begin
            float_msg(Elisa_obj, message_str(1633, 2500), 8);
            add_timer_event(self_obj, game_ticks(6), 3);
        end
        if (sequence == 5) then begin
            float_msg(Myzrael_obj, message_str(1633, 2550), 9);
            add_timer_event(self_obj, game_ticks(6), 3);
        end
        if (sequence == 6) then begin
            if (get_critter_stat(dude_obj, 34) == 0) then begin
                float_msg(Elisa_obj, message_str(1633, 2600), 8);
            end
            else begin
                float_msg(Elisa_obj, message_str(1633, 2601), 8);
            end
            add_timer_event(self_obj, game_ticks(8), 3);
        end
        if (sequence == 7) then begin
            if (get_critter_stat(dude_obj, 34) == 0) then begin
                float_msg(Elisa_obj, message_str(1633, 2602), 8);
            end
            else begin
                float_msg(Elisa_obj, message_str(1633, 2603), 8);
            end
            add_timer_event(self_obj, game_ticks(5), 3);
        end
        if (sequence == 8) then begin
            if (get_critter_stat(dude_obj, 34) == 0) then begin
                float_msg(dude_obj, message_str(1633, 2650), 4);
            end
            else begin
                float_msg(dude_obj, message_str(1633, 2651), 4);
            end
            add_timer_event(self_obj, game_ticks(6), 3);
        end
        if (sequence == 9) then begin
            float_msg(Aran_obj, message_str(1633, 2700), 2);
            add_timer_event(self_obj, game_ticks(5), 3);
        end
        if (sequence == 10) then begin
            float_msg(dude_obj, message_str(1633, 2750), 4);
            add_timer_event(self_obj, game_ticks(8), 3);
        end
        if (sequence == 11) then begin
            float_msg(Aran_obj, message_str(1633, 2800), 2);
            add_timer_event(self_obj, game_ticks(6), 3);
        end
        if (sequence == 12) then begin
            float_msg(Aran_obj, message_str(1633, 2801), 2);
            add_timer_event(self_obj, game_ticks(4), 3);
        end
        if (sequence == 13) then begin
            float_msg(Elisa_obj, message_str(1633, 2850), 8);
            add_timer_event(self_obj, game_ticks(5), 3);
        end
        if (sequence == 14) then begin
            float_msg(Aran_obj, message_str(1633, 2900), 2);
            add_timer_event(self_obj, game_ticks(7), 3);
        end
        if (sequence == 15) then begin
            float_msg(Aran_obj, message_str(1633, 2901), 2);
            add_timer_event(self_obj, game_ticks(5), 3);
        end
        if (sequence == 16) then begin
            set_map_var(0, map_var(0) bwor 8192);
            add_timer_event(self_obj, game_ticks(2), 3);
        end
        if (sequence == 17) then begin
            float_msg(Aran_obj, message_str(1633, 2902), 2);
            add_timer_event(self_obj, game_ticks(5), 3);
        end
        if (sequence == 18) then begin
            float_msg(Myzrael_obj, message_str(1633, 2950), 9);
            add_timer_event(self_obj, game_ticks(5), 3);
        end
        if (sequence == 19) then begin
            float_msg(Myzrael_obj, message_str(1633, 2951), 9);
            add_timer_event(self_obj, game_ticks(6), 3);
        end
        if (sequence == 20) then begin
            float_msg(Myzrael_obj, message_str(1633, 2952), 9);
            add_timer_event(self_obj, game_ticks(4), 3);
        end
        if (sequence == 21) then begin
            animate_move_obj_to_tile(Myzrael_obj, 14082, 0);
            add_timer_event(self_obj, game_ticks(4), 3);
        end
        if (sequence == 22) then begin
            animate_move_obj_to_tile(Myzrael_obj, 12682, 0);
            add_timer_event(Myzrael_door, game_ticks(2), 2);
            add_timer_event(self_obj, game_ticks(3), 3);
        end
        if (sequence == 23) then begin
            anim(Elisa_obj, 1000, rotation_to_tile(tile_num(Elisa_obj), tile_num(dude_obj)));
            add_timer_event(self_obj, game_ticks(1), 3);
        end
        if (sequence == 24) then begin
            game_ui_enable;
            set_global_var(910, global_var(910) bwand (-1 - 4194304));
            set_global_var(990, 4);
            set_map_var(0, map_var(0) bwand (-1 - 262144));
            add_timer_event(Elisa_obj, game_ticks(0), 1);
        end
    end
    if (fixed_param == 5) then begin
        move_to(Aran_obj, 29706, 0);
        restock_obj := create_object_sid(40, 0, 0, -1);
        add_mult_objs_to_inven(Aran_obj, restock_obj, 2);
        anim(Aran_obj, 1000, 5);
        wield_obj_critter(Aran_obj, obj_carrying_pid_obj(Aran_obj, 406));
        add_timer_event(self_obj, game_ticks(1), 6);
    end
    if (fixed_param == 6) then begin
        set_global_var(1008, 4);
        game_ui_enable;
        if (not((global_var(1000) bwand 128) != 0)) then begin
            attack_setup(is1, gateguard1);
        end
        else begin
            attack_setup(Aran_obj, gateguard1);
        end
    end
    if (fixed_param == 10) then begin
        if (fixed_param == 10) then begin
            sequence2 := sequence2 + 1;
        end
        if (sequence2 == 1) then begin
            metarule3(108, 27905, 0, 0);
            call Generate_New_Soldiers();
            add_timer_event(self_obj, game_ticks(1), 10);
        end
        if (sequence2 == 2) then begin
            add_timer_event(Palace_door, game_ticks(0), 1);
            add_timer_event(self_obj, game_ticks(1), 10);
        end
        if (sequence2 == 3) then begin
            animate_move_obj_to_tile(is6, 28105, 0);
            animate_move_obj_to_tile(is8, 27903, 0);
            add_timer_event(self_obj, game_ticks(1), 10);
        end
        if (sequence2 == 4) then begin
            animate_move_obj_to_tile(is6, 28105, 0);
            animate_move_obj_to_tile(is8, 27903, 0);
            add_timer_event(self_obj, game_ticks(1), 10);
        end
        if (sequence2 == 5) then begin
            animate_move_obj_to_tile(is6, 28105, 0);
            animate_move_obj_to_tile(is7, 27907, 0);
            animate_move_obj_to_tile(is8, 27903, 0);
            add_timer_event(self_obj, game_ticks(1), 10);
        end
        if (sequence2 == 6) then begin
            anim(is6, 1000, 2);
            animate_move_obj_to_tile(is7, 27907, 0);
            animate_move_obj_to_tile(is8, 27903, 0);
            add_timer_event(self_obj, game_ticks(2), 10);
        end
        if (sequence2 == 7) then begin
            anim(is7, 1000, 2);
            anim(is8, 1000, 2);
            add_timer_event(self_obj, game_ticks(1), 10);
        end
        if (sequence2 == 8) then begin
            float_msg(is6, message_str(1633, 3000), 8);
            add_timer_event(self_obj, game_ticks(8), 10);
        end
        if (sequence2 == 9) then begin
            float_msg(Aran_obj, message_str(1633, 3050), 2);
            add_timer_event(self_obj, game_ticks(8), 10);
        end
        if (sequence2 == 10) then begin
            float_msg(is6, message_str(1633, 3100), 8);
            add_timer_event(self_obj, game_ticks(4), 10);
        end
        if (sequence2 == 11) then begin
            set_global_var(1008, 5);
            add_timer_event(self_obj, game_ticks(1), 10);
        end
        if (sequence2 == 12) then begin
            game_ui_enable;
        end
    end
    if (fixed_param == 11) then begin
        if (fixed_param == 11) then begin
            sequence4 := sequence4 + 1;
        end
        if (sequence4 == 1) then begin
            game_ui_disable;
            set_global_var(910, global_var(910) bwor 262144);
            reg_anim_func(2, Aran_obj);
            animate_move_obj_to_tile(Aran_obj, 20071, 0);
            reg_anim_func(2, dude_obj);
            animate_move_obj_to_tile(dude_obj, 20074, 0);
            add_timer_event(self_obj, game_ticks(2), 11);
        end
        if (sequence4 == 2) then begin
            set_global_var(1000, global_var(1000) bwor 4096);
            add_timer_event(self_obj, game_ticks(2), 11);
        end
        if (sequence4 == 3) then begin
            gfade_out(600);
            add_timer_event(self_obj, game_ticks(2), 11);
        end
        if (sequence4 == 4) then begin
            reg_anim_func(2, Aran_obj);
            reg_anim_func(2, dude_obj);
            move_to(Aran_obj, 17880, 0);
            anim(Aran_obj, 1000, 5);
            move_to(dude_obj, 18283, 0);
            anim(dude_obj, 1000, 5);
            metarule3(108, 16479, 0, 0);
            call Generate_Attack_Soldier();
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777729) != 0) then begin
                reg_anim_func(2, party_member_obj(16777729));
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777779));
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777811));
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777814));
            end
            if (party_member_obj(16778017) != 0) then begin
                reg_anim_func(2, party_member_obj(16778017));
            end
            if (party_member_obj(16778016) != 0) then begin
                reg_anim_func(2, party_member_obj(16778016));
            end
            if (party_member_obj(16778049) != 0) then begin
                reg_anim_func(2, party_member_obj(16778049));
            end
            if (party_member_obj(16778050) != 0) then begin
                reg_anim_func(2, party_member_obj(16778050));
            end
            if (party_member_obj(16778051) != 0) then begin
                reg_anim_func(2, party_member_obj(16778051));
            end
            if (party_member_obj(16777812) != 0) then begin
                reg_anim_func(2, party_member_obj(16777812));
            end
            if (party_member_obj(16777729) != 0) then begin
                anim(party_member_obj(16777729), 1000, 5);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 5);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 5);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 5);
            end
            if (party_member_obj(16778017) != 0) then begin
                anim(party_member_obj(16778017), 1000, 5);
            end
            if (party_member_obj(16778016) != 0) then begin
                anim(party_member_obj(16778016), 1000, 5);
            end
            if (party_member_obj(16778049) != 0) then begin
                anim(party_member_obj(16778049), 1000, 5);
            end
            if (party_member_obj(16778050) != 0) then begin
                anim(party_member_obj(16778050), 1000, 5);
            end
            if (party_member_obj(16778051) != 0) then begin
                anim(party_member_obj(16778051), 1000, 5);
            end
            if (party_member_obj(16777812) != 0) then begin
                anim(party_member_obj(16777812), 1000, 5);
            end
            add_timer_event(self_obj, game_ticks(3), 11);
        end
        if (sequence4 == 5) then begin
            gfade_in(600);
            reg_anim_func(2, Aran_obj);
            reg_anim_func(2, dude_obj);
            add_timer_event(self_obj, game_ticks(1), 11);
        end
        if (sequence4 == 6) then begin
            float_msg(Aran_obj, message_str(1633, 3500), 2);
            add_timer_event(self_obj, game_ticks(5), 11);
        end
        if (sequence4 == 7) then begin
            float_msg(Aran_obj, message_str(1633, 3501), 2);
            add_timer_event(self_obj, game_ticks(6), 11);
        end
        if (sequence4 == 8) then begin
            float_msg(Myzrael_obj, message_str(1633, 3550), 9);
            add_timer_event(self_obj, game_ticks(1), 11);
        end
        if (sequence4 == 9) then begin
            animate_move_obj_to_tile(Myzrael_obj, 17480, 0);
            add_timer_event(self_obj, game_ticks(1), 11);
        end
        if (sequence4 == 10) then begin
            if (not(obj_is_carrying_obj_pid(Elisa_obj, 402))) then begin
                restock_obj := create_object_sid(402, 0, 0, -1);
                add_mult_objs_to_inven(Elisa_obj, restock_obj, 1);
            end
            wield_obj_critter(Elisa_obj, obj_carrying_pid_obj(Elisa_obj, 402));
            add_timer_event(self_obj, game_ticks(1), 11);
        end
        if (sequence4 == 11) then begin
            if (not((global_var(904) bwand 1073741824) != 0)) then begin
                set_global_var(904, global_var(904) bwor 1073741824);
            end
            reg_anim_func(2, Elisa_obj);
            reg_anim_func(1, 1);
            reg_anim_animate(Elisa_obj, 45, -1);
            play_sfx("WAC1XXX1");
            reg_anim_func(3, 0);
            reg_anim_func(2, Myzrael_obj);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(Myzrael_obj, sfx_build_char_name(Myzrael_obj, 20, 3), 0);
            reg_anim_animate(Myzrael_obj, 35, -1);
            reg_anim_func(3, 0);
            add_timer_event(self_obj, game_ticks(1), 11);
        end
        if (sequence4 == 12) then begin
            add_timer_event(Myzrael_obj, game_ticks(0), 66);
            set_global_var(904, global_var(904) bwor 32);
            add_timer_event(self_obj, game_ticks(1), 11);
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                add_timer_event(party_member_obj(16777814), 5, 31);
            end
        end
        if (sequence4 == 13) then begin
            kill_critter(Myzrael_obj, 62);
            float_msg(Aran_obj, message_str(1633, 3600), 2);
            add_timer_event(self_obj, game_ticks(5), 11);
        end
        if (sequence4 == 14) then begin
            float_msg(Elisa_obj, message_str(1633, 3650), 8);
            add_timer_event(self_obj, game_ticks(6), 11);
        end
        if (sequence4 == 15) then begin
            float_msg(Aran_obj, message_str(1633, 3700), 2);
            add_timer_event(self_obj, game_ticks(6), 11);
        end
        if (sequence4 == 16) then begin
            float_msg(Elisa_obj, message_str(1633, 3701), 8);
            add_timer_event(self_obj, game_ticks(8), 11);
        end
        if (sequence4 == 17) then begin
            float_msg(Elisa_obj, message_str(1633, 3702), 8);
            add_timer_event(self_obj, game_ticks(6), 11);
        end
        if (sequence4 == 18) then begin
            float_msg(Elisa_obj, message_str(1633, 3703), 8);
            add_timer_event(self_obj, game_ticks(7), 11);
        end
        if (sequence4 == 19) then begin
            float_msg(Aran_obj, message_str(1633, 3750), 2);
            add_timer_event(self_obj, game_ticks(5), 11);
        end
        if (sequence4 == 20) then begin
            float_msg(Elisa_obj, message_str(1633, 3800), 8);
            add_timer_event(self_obj, game_ticks(4), 11);
        end
        if (sequence4 == 21) then begin
            float_msg(Elisa_obj, message_str(1633, 3801), 8);
            add_timer_event(self_obj, game_ticks(4), 11);
        end
        if (sequence4 == 22) then begin
            set_global_var(910, global_var(910) bwand (-1 - 262144));
            game_ui_enable;
            set_global_var(1008, 8);
        end
    end
    if (fixed_param == 12) then begin
        if (not((global_var(904) bwand 1073741824) != 0)) then begin
            set_global_var(904, global_var(904) bwor 1073741824);
        end
        game_ui_disable;
        set_map_var(0, map_var(0) bwor 524288);
        add_timer_event(self_obj, game_ticks(2), 13);
    end
    if (fixed_param == 13) then begin
        set_map_var(0, map_var(0) bwor 1048576);
        add_timer_event(self_obj, game_ticks(2), 14);
    end
    if (fixed_param == 14) then begin
        set_map_var(0, map_var(0) bwor 8388608);
        if (((map_var(0) bwand 2097152) != 0) and ((map_var(0) bwand 4194304) != 0)) then begin
            add_timer_event(self_obj, game_ticks(2), 15);
        end
        else begin
            add_timer_event(self_obj, game_ticks(1), 20);
        end
    end
    if (fixed_param == 15) then begin
        float_msg(Aran_obj, message_str(1633, 4150), 2);
        add_timer_event(self_obj, game_ticks(6), 16);
    end
    if (fixed_param == 16) then begin
        float_msg(Aran_obj, message_str(1633, 4151), 2);
        if (global_var(1011) < 13) then begin
            add_timer_event(self_obj, game_ticks(6), 17);
        end
        else begin
            add_timer_event(self_obj, game_ticks(6), 20);
        end
    end
    if (fixed_param == 17) then begin
        float_msg(Aran_obj, message_str(1633, 4152), 2);
        add_timer_event(self_obj, game_ticks(6), 20);
    end
    if (fixed_param == 20) then begin
        float_msg(Aran_obj, message_str(1633, 4153), 2);
        add_timer_event(self_obj, game_ticks(6), 21);
    end
    if (fixed_param == 21) then begin
        if (fixed_param == 21) then begin
            sequence5 := sequence5 + 1;
        end
        if (sequence5 == 1) then begin
            gfade_out(600);
            add_timer_event(self_obj, game_ticks(1), 21);
        end
        if (sequence5 == 2) then begin
            move_to(Aran_obj, 15882, 0);
            anim(Aran_obj, 1000, 2);
            move_to(dude_obj, 16882, 0);
            anim(dude_obj, 1000, 5);
            metarule3(108, 15882, 0, 0);
            add_timer_event(Aran_obj, game_ticks(0), 2);
            set_global_var(904, global_var(904) bwor 1);
            set_global_var(865, global_var(865) bwor 262144);
            if (not((global_var(904) bwand 1073741824) != 0)) then begin
                set_global_var(904, global_var(904) bwor 1073741824);
            end
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777729) != 0) then begin
                reg_anim_func(2, party_member_obj(16777729));
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777779));
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777811));
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                reg_anim_func(2, party_member_obj(16777814));
            end
            if (party_member_obj(16778017) != 0) then begin
                reg_anim_func(2, party_member_obj(16778017));
            end
            if (party_member_obj(16778016) != 0) then begin
                reg_anim_func(2, party_member_obj(16778016));
            end
            if (party_member_obj(16778049) != 0) then begin
                reg_anim_func(2, party_member_obj(16778049));
            end
            if (party_member_obj(16778050) != 0) then begin
                reg_anim_func(2, party_member_obj(16778050));
            end
            if (party_member_obj(16778051) != 0) then begin
                reg_anim_func(2, party_member_obj(16778051));
            end
            if (party_member_obj(16777812) != 0) then begin
                reg_anim_func(2, party_member_obj(16777812));
            end
            if (party_member_obj(16777729) != 0) then begin
                anim(party_member_obj(16777729), 1000, 5);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 5);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 5);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 5);
            end
            if (party_member_obj(16778017) != 0) then begin
                anim(party_member_obj(16778017), 1000, 5);
            end
            if (party_member_obj(16778016) != 0) then begin
                anim(party_member_obj(16778016), 1000, 5);
            end
            if (party_member_obj(16778049) != 0) then begin
                anim(party_member_obj(16778049), 1000, 5);
            end
            if (party_member_obj(16778050) != 0) then begin
                anim(party_member_obj(16778050), 1000, 5);
            end
            if (party_member_obj(16778051) != 0) then begin
                anim(party_member_obj(16778051), 1000, 5);
            end
            if (party_member_obj(16777812) != 0) then begin
                anim(party_member_obj(16777812), 1000, 5);
            end
            as1 := create_object_sid(16778031, 17474, 0, 130);
            as2 := create_object_sid(16778045, 14480, 0, 130);
            as3 := create_object_sid(16778032, 15274, 0, 130);
            restock_obj := create_object_sid(118, 0, 0, -1);
            add_mult_objs_to_inven(as1, restock_obj, 1);
            restock_obj := create_object_sid(406, 0, 0, -1);
            add_mult_objs_to_inven(as2, restock_obj, 1);
            restock_obj := create_object_sid(406, 0, 0, -1);
            add_mult_objs_to_inven(as3, restock_obj, 1);
            restock_obj := create_object_sid(40, 0, 0, -1);
            add_mult_objs_to_inven(as1, restock_obj, 2);
            restock_obj := create_object_sid(40, 0, 0, -1);
            add_mult_objs_to_inven(as2, restock_obj, 2);
            restock_obj := create_object_sid(40, 0, 0, -1);
            add_mult_objs_to_inven(as3, restock_obj, 2);
            wield_obj_critter(as1, obj_carrying_pid_obj(as1, 118));
            wield_obj_critter(as2, obj_carrying_pid_obj(as2, 406));
            wield_obj_critter(as3, obj_carrying_pid_obj(as3, 406));
            anim(as1, 1000, 3);
            anim(as2, 1000, 2);
            anim(as3, 1000, 3);
            set_map_var(0, map_var(0) bwand (-1 - 2048));
            add_timer_event(forcefield_1, game_ticks(0), 2);
            add_timer_event(forcefield_2, game_ticks(0), 2);
            add_timer_event(forcefield_3, game_ticks(0), 2);
            add_timer_event(forcefield_4, game_ticks(0), 2);
            if (tile_contains_pid_obj(map_var(3), 0, 16778020)) then begin
                remove_corpse := tile_contains_pid_obj(map_var(3), 0, 16778020);
                destroy_object(remove_corpse);
            end
            if (tile_contains_pid_obj(map_var(4), 0, 16778028)) then begin
                remove_corpse := tile_contains_pid_obj(map_var(4), 0, 16778028);
                destroy_object(remove_corpse);
            end
            if (map_var(5) != 0) then begin
                death_body_tile := map_var(5);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(6) != 0) then begin
                death_body_tile := map_var(6);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(7) != 0) then begin
                death_body_tile := map_var(7);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(8) != 0) then begin
                death_body_tile := map_var(8);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(9) != 0) then begin
                death_body_tile := map_var(9);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(10) != 0) then begin
                death_body_tile := map_var(10);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(11) != 0) then begin
                death_body_tile := map_var(11);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(12) != 0) then begin
                death_body_tile := map_var(12);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(13) != 0) then begin
                death_body_tile := map_var(13);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(14) != 0) then begin
                death_body_tile := map_var(14);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(15) != 0) then begin
                death_body_tile := map_var(15);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(16) != 0) then begin
                death_body_tile := map_var(16);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(17) != 0) then begin
                death_body_tile := map_var(17);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(18) != 0) then begin
                death_body_tile := map_var(18);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(19) != 0) then begin
                death_body_tile := map_var(19);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(20) != 0) then begin
                death_body_tile := map_var(20);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(21) != 0) then begin
                death_body_tile := map_var(21);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(22) != 0) then begin
                death_body_tile := map_var(22);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(23) != 0) then begin
                death_body_tile := map_var(23);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(24) != 0) then begin
                death_body_tile := map_var(24);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(25) != 0) then begin
                death_body_tile := map_var(25);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(26) != 0) then begin
                death_body_tile := map_var(26);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(27) != 0) then begin
                death_body_tile := map_var(27);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (map_var(28) != 0) then begin
                death_body_tile := map_var(28);
                if (tile_contains_pid_obj(death_body_tile, 0, 16778031)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778031);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778032)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778032);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16778045)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16778045);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777291)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777291);
                    destroy_object(remove_corpse);
                end
                if (tile_contains_pid_obj(death_body_tile, 0, 16777293)) then begin
                    remove_corpse := tile_contains_pid_obj(death_body_tile, 0, 16777293);
                    destroy_object(remove_corpse);
                end
            end
            if (party_member_obj(16777729) != 0) then begin
                if (party_member_obj(16777729) != 0) then begin
                    if (has_trait(1, party_member_obj(16777729), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777729), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0)) then begin
                if (party_member_obj(16777779) != 0) then begin
                    if (has_trait(1, party_member_obj(16777779), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777779), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0)) then begin
                if (party_member_obj(16777811) != 0) then begin
                    if (has_trait(1, party_member_obj(16777811), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777811), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777812) != 0) then begin
                if (party_member_obj(16777812) != 0) then begin
                    if (has_trait(1, party_member_obj(16777812), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777812), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0)) then begin
                if (party_member_obj(16777814) != 0) then begin
                    if (has_trait(1, party_member_obj(16777814), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777814), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777748) != 0) then begin
                if (party_member_obj(16777748) != 0) then begin
                    if (has_trait(1, party_member_obj(16777748), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777748), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778017) != 0) then begin
                if (party_member_obj(16778017) != 0) then begin
                    if (has_trait(1, party_member_obj(16778017), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778017), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778016) != 0) then begin
                if (party_member_obj(16778016) != 0) then begin
                    if (has_trait(1, party_member_obj(16778016), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778016), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778049) != 0) then begin
                if (party_member_obj(16778049) != 0) then begin
                    if (has_trait(1, party_member_obj(16778049), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778049), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778050) != 0) then begin
                if (party_member_obj(16778050) != 0) then begin
                    if (has_trait(1, party_member_obj(16778050), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778050), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16778051) != 0) then begin
                if (party_member_obj(16778051) != 0) then begin
                    if (has_trait(1, party_member_obj(16778051), 666)) then begin
                        critter_attempt_placement(party_member_obj(16778051), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            if (party_member_obj(16777294) != 0) then begin
                if (party_member_obj(16777294) != 0) then begin
                    if (has_trait(1, party_member_obj(16777294), 666)) then begin
                        critter_attempt_placement(party_member_obj(16777294), tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
                    end
                end
            end
            add_timer_event(self_obj, game_ticks(2), 21);
        end
        if (sequence5 == 3) then begin
            gfade_in(600);
            add_timer_event(self_obj, game_ticks(1), 21);
        end
        if (sequence5 == 4) then begin
            add_timer_event(self_obj, game_ticks(1), 21);
        end
        if (sequence5 == 5) then begin
            game_ui_enable;
            if (not((global_var(904) bwand 1073741824) != 0)) then begin
                set_global_var(904, global_var(904) bwor 1073741824);
            end
            add_timer_event(Aran_obj, game_ticks(0), 1);
        end
    end
    if ((fixed_param == 30) and ((global_var(1007) == 2) or (global_var(1006) == 2))) then begin
        if (fixed_param == 30) then begin
            sequence6 := sequence6 + 1;
        end
        if (sequence6 == 1) then begin
            game_ui_disable;
            reg_anim_func(2, dude_obj);
            animate_move_obj_to_tile(dude_obj, 18281, 0);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 2) then begin
            gfade_out(600);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 3) then begin
            metarule3(108, 16281, 0, 0);
            tulsa := create_object_sid(16777953, 17283, 0, -1);
            anim(tulsa, 1000, 5);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 4) then begin
            gfade_in(600);
            metarule3(108, 16281, 0, 0);
            if ((tile_num(dude_obj) == 18281) and (has_trait(1, dude_obj, 10) != 5)) then begin
                anim(dude_obj, 1000, 5);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0) and (art_anim(obj_art_fid(party_member_obj(16777814))) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 5);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0) and (art_anim(obj_art_fid(party_member_obj(16777779))) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 5);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0) and (art_anim(obj_art_fid(party_member_obj(16777811))) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 5);
            end
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 5) then begin
            float_msg(tulsa, message_str(1633, 5000), 2);
            metarule3(108, 16281, 0, 0);
            if ((tile_num(dude_obj) == 18281) and (has_trait(1, dude_obj, 10) != 5)) then begin
                anim(dude_obj, 1000, 5);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0) and (art_anim(obj_art_fid(party_member_obj(16777814))) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 5);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0) and (art_anim(obj_art_fid(party_member_obj(16777779))) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 5);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0) and (art_anim(obj_art_fid(party_member_obj(16777811))) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 5);
            end
            add_timer_event(self_obj, game_ticks(6), 30);
        end
        if (sequence6 == 6) then begin
            float_msg(tulsa, message_str(1633, 5001), 2);
            if ((tile_num(dude_obj) == 18281) and (has_trait(1, dude_obj, 10) != 5)) then begin
                anim(dude_obj, 1000, 5);
            end
            if ((party_member_obj(16777814) != 0) and ((global_var(910) bwand 128) == 0) and (art_anim(obj_art_fid(party_member_obj(16777814))) == 0)) then begin
                anim(party_member_obj(16777814), 1000, 5);
            end
            if ((party_member_obj(16777779) != 0) and ((global_var(910) bwand 32) == 0) and (art_anim(obj_art_fid(party_member_obj(16777779))) == 0)) then begin
                anim(party_member_obj(16777779), 1000, 5);
            end
            if ((party_member_obj(16777811) != 0) and ((global_var(910) bwand 64) == 0) and (art_anim(obj_art_fid(party_member_obj(16777811))) == 0)) then begin
                anim(party_member_obj(16777811), 1000, 5);
            end
            add_timer_event(self_obj, game_ticks(6), 30);
        end
        if (sequence6 == 7) then begin
            if ((global_var(904) bwand 1) != 0) then begin
                float_msg(Aran_obj, message_str(1633, 5050), 9);
            end
            else begin
                float_msg(Elisa_obj, message_str(1633, 5050), 9);
            end
            add_timer_event(self_obj, game_ticks(7), 30);
        end
        if (sequence6 == 8) then begin
            if ((global_var(904) bwand 1) != 0) then begin
                float_msg(Aran_obj, message_str(1633, 5051), 9);
            end
            else begin
                float_msg(Elisa_obj, message_str(1633, 5051), 9);
            end
            add_timer_event(self_obj, game_ticks(7), 30);
        end
        if (sequence6 == 9) then begin
            float_msg(tulsa, message_str(1633, 5100), 2);
            add_timer_event(self_obj, game_ticks(5), 30);
        end
        if (sequence6 == 10) then begin
            if ((global_var(904) bwand 1) != 0) then begin
                float_msg(Aran_obj, message_str(1633, 5150), 9);
            end
            else begin
                float_msg(Elisa_obj, message_str(1633, 5150), 9);
            end
            add_timer_event(self_obj, game_ticks(5), 30);
        end
        if (sequence6 == 11) then begin
            reg_anim_func(2, tulsa);
            anim(tulsa, 1000, 2);
            metarule3(108, 16281, 0, 0);
            float_msg(tulsa, message_str(1633, 5200), 2);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 12) then begin
            reg_anim_func(2, tulsa);
            animate_move_obj_to_tile(tulsa, 20483, 0);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 13) then begin
            animate_move_obj_to_tile(tulsa, 20483, 0);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 14) then begin
            set_global_var(866, global_var(866) bwor 1073741824);
            float_msg(tulsa, message_str(1633, 5201), 2);
            animate_move_obj_to_tile(tulsa, 20483, 0);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 15) then begin
            reg_anim_func(2, tulsa);
            animate_move_obj_to_tile(tulsa, 19672, 0);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 16) then begin
            animate_move_obj_to_tile(tulsa, 19672, 0);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 17) then begin
            animate_move_obj_to_tile(tulsa, 19672, 0);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 18) then begin
            reg_anim_func(2, tulsa);
            animate_move_obj_to_tile(tulsa, 21672, 0);
            add_timer_event(self_obj, game_ticks(2), 30);
        end
        if (sequence6 == 19) then begin
            if (obj_on_screen(tulsa) == 0) then begin
                destroy_object(tulsa);
                sequence6 := 22;
            end
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 20) then begin
            gfade_out(600);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 21) then begin
            destroy_object(tulsa);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 22) then begin
            gfade_in(600);
            add_timer_event(self_obj, game_ticks(1), 30);
        end
        if (sequence6 == 23) then begin
            game_ui_enable;
        end
    end
    if (fixed_param == 75) then begin
        if (fixed_param == 75) then begin
            sequence3 := sequence3 + 1;
        end
        if (sequence3 == 1) then begin
            float_msg(dude_obj, message_str(1633, 4503), 4);
            display_msg(message_str(1633, 4504));
            add_timer_event(self_obj, game_ticks(5), 75);
        end
        if (sequence3 == 2) then begin
            gfade_out(1);
            game_ui_enable;
            critter_heal(dude_obj, -get_critter_stat(dude_obj, 7));
        end
    end
    if (fixed_param == 80) then begin
        if (fixed_param == 80) then begin
            sequence4 := sequence4 + 1;
        end
        if (sequence4 == 1) then begin
            game_ui_disable;
            metarule3(100, self_obj, 80, 0);
            if (combat_is_initialized) then begin
                terminate_combat;
            end
            add_timer_event(self_obj, 2, 80);
        end
        if (sequence4 == 2) then begin
            if (not(game_ui_is_disabled)) then begin
                game_ui_disable;
            end
            if (not(obj_is_carrying_obj_pid(Elisa_obj, 402))) then begin
                restock_obj := create_object_sid(402, 0, 0, -1);
                add_mult_objs_to_inven(Elisa_obj, restock_obj, 1);
            end
            wield_obj_critter(Elisa_obj, obj_carrying_pid_obj(Elisa_obj, 402));
            add_timer_event(self_obj, game_ticks(1), 80);
        end
        if (sequence4 == 3) then begin
            reg_anim_func(2, Elisa_obj);
            reg_anim_func(1, 1);
            reg_anim_animate(Elisa_obj, 45, -1);
            play_sfx("WAC1XXX1");
            reg_anim_func(3, 0);
            reg_anim_func(2, Myzrael_obj);
            reg_anim_func(1, 1);
            reg_anim_play_sfx(Myzrael_obj, sfx_build_char_name(Myzrael_obj, 20, 3), 0);
            reg_anim_animate(Myzrael_obj, 35, -1);
            reg_anim_func(3, 0);
            add_timer_event(self_obj, game_ticks(1), 80);
        end
        if (sequence4 == 4) then begin
            add_timer_event(Myzrael_obj, game_ticks(0), 66);
            set_global_var(904, global_var(904) bwor 32);
            add_timer_event(self_obj, game_ticks(1), 80);
        end
        if (sequence4 == 5) then begin
            kill_critter(Myzrael_obj, 62);
            game_ui_enable;
            add_timer_event(self_obj, 2, 80);
        end
        if (sequence4 == 6) then begin
            set_global_var(1008, 8);
            if (tile_contains_obj_pid(15273, 0, 16778031)) then begin
                animate_move_obj_to_tile(tile_contains_pid_obj(17085, 0, 16778031), tile_num(dude_obj), 1);
            end
        end
    end
    if (fixed_param == 101) then begin
        wield_obj_critter(is1, obj_carrying_pid_obj(is1, 406));
        wield_obj_critter(is2, obj_carrying_pid_obj(is2, 406));
        wield_obj_critter(is3, obj_carrying_pid_obj(is3, 599));
        wield_obj_critter(is4, obj_carrying_pid_obj(is4, 599));
    end
end

procedure Generate_Gate_Guards
begin
    gateguard1 := create_object_sid(16778031, 27909, 0, 142);
    gateguard2 := create_object_sid(16778032, 27902, 0, 142);
    gateguard3 := create_object_sid(16778045, 28905, 0, 142);
    gateguard4 := create_object_sid(16778031, 28501, 0, 142);
    gateguard5 := create_object_sid(16778032, 28911, 0, 142);
    gateguard6 := create_object_sid(16778031, 28105, 0, 142);
    anim(gateguard1, 1000, 2);
    anim(gateguard2, 1000, 2);
    anim(gateguard3, 1000, 2);
    anim(gateguard4, 1000, 2);
    anim(gateguard5, 1000, 2);
    anim(gateguard6, 1000, 2);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(gateguard1, restock_obj, 1);
    restock_obj := create_object_sid(406, 0, 0, -1);
    add_mult_objs_to_inven(gateguard2, restock_obj, 1);
    restock_obj := create_object_sid(24, 0, 0, -1);
    add_mult_objs_to_inven(gateguard3, restock_obj, 1);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(gateguard4, restock_obj, 1);
    restock_obj := create_object_sid(118, 0, 0, -1);
    add_mult_objs_to_inven(gateguard5, restock_obj, 1);
    restock_obj := create_object_sid(406, 0, 0, -1);
    add_mult_objs_to_inven(gateguard6, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(gateguard1, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(gateguard2, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(gateguard3, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(gateguard4, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(gateguard5, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(gateguard6, restock_obj, 1);
    wield_obj_critter(gateguard1, obj_carrying_pid_obj(gateguard1, 599));
    wield_obj_critter(gateguard2, obj_carrying_pid_obj(gateguard2, 406));
    wield_obj_critter(gateguard3, obj_carrying_pid_obj(gateguard3, 24));
    wield_obj_critter(gateguard4, obj_carrying_pid_obj(gateguard4, 599));
    wield_obj_critter(gateguard5, obj_carrying_pid_obj(gateguard5, 118));
    wield_obj_critter(gateguard6, obj_carrying_pid_obj(gateguard6, 406));
end

procedure Generate_Arans_Soldiers
begin
    if (not((global_var(1000) bwand 128) != 0)) then begin
        is1 := create_object_sid(16778031, 30309, 0, 140);
    end
    if (not((global_var(1000) bwand 256) != 0)) then begin
        is2 := create_object_sid(16778031, 30501, 0, 140);
    end
    if (not((global_var(1000) bwand 512) != 0)) then begin
        is3 := create_object_sid(16778031, 30907, 0, 140);
    end
    if (not((global_var(1000) bwand 1024) != 0)) then begin
        is4 := create_object_sid(16778032, 31301, 0, 140);
    end
    if (not((global_var(1000) bwand 2048) != 0)) then begin
        is5 := create_object_sid(16778031, 31511, 0, 140);
    end
    if (not((global_var(1000) bwand 128) != 0)) then begin
        anim(is1, 1000, 5);
    end
    if (not((global_var(1000) bwand 256) != 0)) then begin
        anim(is2, 1000, 5);
    end
    if (not((global_var(1000) bwand 512) != 0)) then begin
        anim(is3, 1000, 5);
    end
    if (not((global_var(1000) bwand 1024) != 0)) then begin
        anim(is4, 1000, 5);
    end
    if (not((global_var(1000) bwand 2048) != 0)) then begin
        anim(is5, 1000, 5);
    end
    if (not((global_var(1000) bwand 128) != 0)) then begin
        restock_obj := create_object_sid(599, 0, 0, -1);
    end
    add_mult_objs_to_inven(is1, restock_obj, 1);
    if (not((global_var(1000) bwand 256) != 0)) then begin
        restock_obj := create_object_sid(118, 0, 0, -1);
    end
    add_mult_objs_to_inven(is2, restock_obj, 1);
    if (not((global_var(1000) bwand 512) != 0)) then begin
        restock_obj := create_object_sid(599, 0, 0, -1);
    end
    add_mult_objs_to_inven(is3, restock_obj, 1);
    if (not((global_var(1000) bwand 1024) != 0)) then begin
        restock_obj := create_object_sid(402, 0, 0, -1);
    end
    add_mult_objs_to_inven(is4, restock_obj, 1);
    if (not((global_var(1000) bwand 2048) != 0)) then begin
        restock_obj := create_object_sid(406, 0, 0, -1);
    end
    add_mult_objs_to_inven(is5, restock_obj, 1);
    if (not((global_var(1000) bwand 128) != 0)) then begin
        restock_obj := create_object_sid(38, 0, 0, -1);
    end
    add_mult_objs_to_inven(is1, restock_obj, 1);
    if (not((global_var(1000) bwand 256) != 0)) then begin
        restock_obj := create_object_sid(39, 0, 0, -1);
    end
    add_mult_objs_to_inven(is2, restock_obj, 1);
    if (not((global_var(1000) bwand 512) != 0)) then begin
        restock_obj := create_object_sid(38, 0, 0, -1);
    end
    add_mult_objs_to_inven(is3, restock_obj, 1);
    if (not((global_var(1000) bwand 1024) != 0)) then begin
        restock_obj := create_object_sid(38, 0, 0, -1);
    end
    add_mult_objs_to_inven(is4, restock_obj, 1);
    if (not((global_var(1000) bwand 2048) != 0)) then begin
        restock_obj := create_object_sid(38, 0, 0, -1);
    end
    add_mult_objs_to_inven(is5, restock_obj, 1);
    if (not((global_var(1000) bwand 128) != 0)) then begin
        restock_obj := create_object_sid(40, 0, 0, -1);
    end
    add_mult_objs_to_inven(is1, restock_obj, 1);
    if (not((global_var(1000) bwand 256) != 0)) then begin
        restock_obj := create_object_sid(40, 0, 0, -1);
    end
    add_mult_objs_to_inven(is2, restock_obj, 1);
    if (not((global_var(1000) bwand 512) != 0)) then begin
        restock_obj := create_object_sid(40, 0, 0, -1);
    end
    add_mult_objs_to_inven(is3, restock_obj, 1);
    if (not((global_var(1000) bwand 1024) != 0)) then begin
        restock_obj := create_object_sid(40, 0, 0, -1);
    end
    add_mult_objs_to_inven(is4, restock_obj, 1);
    if (not((global_var(1000) bwand 2048) != 0)) then begin
        restock_obj := create_object_sid(40, 0, 0, -1);
    end
    add_mult_objs_to_inven(is5, restock_obj, 1);
    if (not((global_var(1000) bwand 128) != 0)) then begin
        wield_obj_critter(is1, obj_carrying_pid_obj(is1, 599));
    end
    if (not((global_var(1000) bwand 256) != 0)) then begin
        wield_obj_critter(is2, obj_carrying_pid_obj(is2, 118));
    end
    if (not((global_var(1000) bwand 512) != 0)) then begin
        wield_obj_critter(is3, obj_carrying_pid_obj(is3, 599));
    end
    if (not((global_var(1000) bwand 1024) != 0)) then begin
        wield_obj_critter(is4, obj_carrying_pid_obj(is4, 402));
    end
    if (not((global_var(1000) bwand 2048) != 0)) then begin
        wield_obj_critter(is5, obj_carrying_pid_obj(is5, 406));
    end
end

procedure Generate_New_Soldiers
begin
    is6 := create_object_sid(16778031, 27104, 0, 140);
    is7 := create_object_sid(16778032, 27106, 0, 140);
    is8 := create_object_sid(16778045, 27303, 0, 140);
    anim(is6, 1000, 2);
    anim(is7, 1000, 2);
    anim(is8, 1000, 2);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(is6, restock_obj, 1);
    restock_obj := create_object_sid(406, 0, 0, -1);
    add_mult_objs_to_inven(is7, restock_obj, 1);
    restock_obj := create_object_sid(406, 0, 0, -1);
    add_mult_objs_to_inven(is8, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is6, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is7, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is8, restock_obj, 1);
    wield_obj_critter(is6, obj_carrying_pid_obj(is6, 599));
    wield_obj_critter(is7, obj_carrying_pid_obj(is7, 406));
    wield_obj_critter(is8, obj_carrying_pid_obj(is8, 406));
    move_to(Elisa_obj, 16279, 0);
    anim(Elisa_obj, 1000, 2);
    move_to(Myzrael_obj, 16280, 0);
    anim(Myzrael_obj, 1000, 2);
    add_timer_event(Myzrael_obj, 1, 66);
    is10 := create_object_sid(16778031, 15273, 0, 142);
    is11 := create_object_sid(16778032, 15488, 0, 142);
    is12 := create_object_sid(16778045, 16476, 0, 142);
    is13 := create_object_sid(16778031, 17085, 0, 142);
    is14 := create_object_sid(16778032, 14882, 0, 142);
    is16 := create_object_sid(16778045, 15685, 0, 142);
    is17 := create_object_sid(16778032, 16488, 0, 142);
    anim(is10, 1000, 2);
    anim(is11, 1000, 2);
    anim(is12, 1000, 2);
    anim(is13, 1000, 2);
    anim(is14, 1000, 2);
    anim(is16, 1000, 2);
    anim(is17, 1000, 2);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(is10, restock_obj, 1);
    restock_obj := create_object_sid(406, 0, 0, -1);
    add_mult_objs_to_inven(is11, restock_obj, 1);
    restock_obj := create_object_sid(402, 0, 0, -1);
    add_mult_objs_to_inven(is12, restock_obj, 1);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(is13, restock_obj, 1);
    restock_obj := create_object_sid(599, 0, 0, -1);
    add_mult_objs_to_inven(is14, restock_obj, 1);
    restock_obj := create_object_sid(406, 0, 0, -1);
    add_mult_objs_to_inven(is16, restock_obj, 1);
    restock_obj := create_object_sid(118, 0, 0, -1);
    add_mult_objs_to_inven(is17, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is10, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is11, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is12, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is13, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is14, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is16, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is17, restock_obj, 1);
    wield_obj_critter(is10, obj_carrying_pid_obj(is10, 599));
    wield_obj_critter(is11, obj_carrying_pid_obj(is11, 406));
    wield_obj_critter(is12, obj_carrying_pid_obj(is12, 402));
    wield_obj_critter(is13, obj_carrying_pid_obj(is13, 599));
    wield_obj_critter(is14, obj_carrying_pid_obj(is14, 599));
    wield_obj_critter(is16, obj_carrying_pid_obj(is16, 406));
    wield_obj_critter(is17, obj_carrying_pid_obj(is17, 118));
end

procedure Generate_Attack_Soldier
begin
    is15 := create_object_sid(16778031, 15877, 0, 142);
    anim(is15, 1000, 2);
    restock_obj := create_object_sid(406, 0, 0, -1);
    add_mult_objs_to_inven(is15, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is15, restock_obj, 1);
    wield_obj_critter(is15, obj_carrying_pid_obj(is15, 406));
    is20 := create_object_sid(16778031, 21271, 0, 140);
    anim(is20, 1000, 2);
    restock_obj := create_object_sid(406, 0, 0, -1);
    add_mult_objs_to_inven(is20, restock_obj, 1);
    restock_obj := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(is20, restock_obj, 1);
    wield_obj_critter(is20, obj_carrying_pid_obj(is8, 406));
    set_map_var(0, map_var(0) bwor 32768);
end

