diff --git a/Mods/MegaMod/Original/FSEMPTER.ssl b/Mods/MegaMod/ReDefine/FSEMPTER.ssl
index 7ac91e0..d2486b3 100644
--- a/Mods/MegaMod/Original/FSEMPTER.ssl
+++ b/Mods/MegaMod/ReDefine/FSEMPTER.ssl
@@ -256,7 +256,7 @@ begin
     end
     if (ffield == 1) then begin
         ffield := 0;
-        set_global_var(361, global_var(361) bwand (-1 - 4194304));
+        set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwand (-1 - 4194304));
     end
     set_local_var(4, 1);
 end
@@ -269,17 +269,17 @@ procedure look_at_p_proc
 begin
     script_overrides;
     if (local_var(4) == 0) then begin
-        display_msg(message_str(853, 100));
+        display_mstr(100);
     end
     else begin
-        display_msg(message_str(853, 101));
+        display_mstr(101);
     end
 end
 
 procedure description_p_proc
 begin
     script_overrides;
-    display_msg(message_str(853, 102));
+    display_mstr(102);
 end
 
 procedure use_skill_on_p_proc
@@ -289,27 +289,27 @@ end
 
 procedure use_obj_on_p_proc
 begin
-    if ((obj_pid(obj_being_used_with) == 584) and (global_var(1066) == 1)) then begin
+    if ((obj_pid(obj_being_used_with) == 584) and (global_var(GVAR_NEED_BIOGEL_EPA) == 1)) then begin
         script_overrides;
-        if (has_skill(dude_obj, 12) > 139) then begin
-            set_global_var(1066, 2);
-            float_msg(self_obj, message_str(853, 801), 8);
+        if (has_skill(dude_obj, SKILL_SCIENCE) > 139) then begin
+            set_global_var(GVAR_NEED_BIOGEL_EPA, 2);
+            float_msg(self_obj, mstr(801), FLOAT_MSG_YELLOW);
         end
         else begin
-            display_msg(message_str(853, 803));
-            float_msg(self_obj, message_str(853, 802), 2);
-            set_global_var(361, global_var(361) bwor 1);
+            display_mstr(803);
+            float_msg(self_obj, mstr(802), FLOAT_MSG_RED);
+            set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwor 1);
         end
     end
     else begin
-        display_msg(message_str(853, 214));
+        display_mstr(214);
     end
 end
 
 procedure damage_p_proc
 begin
     if (not(combat_is_initialized)) then begin
-        set_global_var(361, global_var(361) bwor 1);
+        set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwor 1);
         call DoCallGuards();
     end
 end
@@ -321,11 +321,11 @@ end
 procedure use_p_proc
 begin
     script_overrides;
-    if (not((global_var(361) bwand 1024) != 0)) then begin
+    if (not((global_var(GVAR_SAN_FRAN_FLAGS) bwand 1024) != 0)) then begin
         dialogue_system_enter;
     end
     else begin
-        display_msg(message_str(853, 215));
+        display_mstr(215);
     end
 end
 
@@ -342,101 +342,101 @@ end
 
 procedure Node001
 begin
-    gsay_reply(853, 103);
-    giq_option(-3, 853, 104, Node999, 50);
-    if ((global_var(361) bwand 2048) != 0) then begin
+    Reply(103);
+    giq_option(-3, NAME, 104, Node999, NEUTRAL_REACTION);
+    if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 2048) != 0) then begin
         SVar21 := 1;
-        giq_option(4, 853, 105, Node002, 50);
+        giq_option(4, NAME, 105, Node002, NEUTRAL_REACTION);
     end
-    giq_option(4, 853, 106, Node003, 50);
-    giq_option(4, 853, 107, Node003, 50);
-    giq_option(4, 853, 108, NodeHack, 50);
-    giq_option(4, 853, 109, Node999, 50);
+    giq_option(4, NAME, 106, Node003, NEUTRAL_REACTION);
+    giq_option(4, NAME, 107, Node003, NEUTRAL_REACTION);
+    giq_option(4, NAME, 108, NodeHack, NEUTRAL_REACTION);
+    giq_option(4, NAME, 109, Node999, NEUTRAL_REACTION);
 end
 
 procedure Node002
 begin
     if (SVar21) then begin
         SVar21 := 0;
-        gsay_reply(853, 110);
+        Reply(110);
     end
     else begin
-        gsay_reply(853, 111);
+        Reply(111);
     end
-    giq_option(4, 853, 220, Node027, 50);
-    giq_option(4, 853, 112, Node005, 50);
-    giq_option(4, 853, 113, Node006, 50);
-    giq_option(4, 853, 114, Node007, 50);
-    if ((global_var(1066) == 1) and has_trait(0, dude_obj, 40)) then begin
-        giq_option(4, 853, 800, Node002a, 50);
+    giq_option(4, NAME, 220, Node027, NEUTRAL_REACTION);
+    giq_option(4, NAME, 112, Node005, NEUTRAL_REACTION);
+    giq_option(4, NAME, 113, Node006, NEUTRAL_REACTION);
+    giq_option(4, NAME, 114, Node007, NEUTRAL_REACTION);
+    if ((global_var(GVAR_NEED_BIOGEL_EPA) == 1) and has_trait(TRAIT_PERK, dude_obj, PERK_scrounger)) then begin
+        giq_option(4, NAME, 800, Node002a, NEUTRAL_REACTION);
     end
-    giq_option(4, 853, 115, Node999, 50);
+    giq_option(4, NAME, 115, Node999, NEUTRAL_REACTION);
 end
 
 procedure Node002a
 begin
-    set_global_var(1066, 2);
+    set_global_var(GVAR_NEED_BIOGEL_EPA, 2);
     game_time_advance(60 * 10 * 5);
-    gsay_reply(853, 804);
-    giq_option(4, 853, 805, Node002, 50);
+    Reply(804);
+    giq_option(4, NAME, 805, Node002, NEUTRAL_REACTION);
 end
 
 procedure Node003
 begin
-    gsay_reply(853, 116);
-    giq_option(4, 853, 117, NodeHack, 50);
-    giq_option(4, 853, 118, Node999, 50);
+    Reply(116);
+    giq_option(4, NAME, 117, NodeHack, NEUTRAL_REACTION);
+    giq_option(4, NAME, 118, Node999, NEUTRAL_REACTION);
 end
 
 procedure Node004
 begin
     set_local_var(7, 1);
     ffield := 1;
-    set_global_var(364, 1);
-    set_global_var(361, global_var(361) bwor 1);
+    set_global_var(GVAR_SAN_FRAN_SHIHACKED, 1);
+    set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwor 1);
     salert := 1;
-    gsay_reply(853, 119);
-    giq_option(4, 853, 120, Node999, 50);
+    Reply(119);
+    giq_option(4, NAME, 120, Node999, NEUTRAL_REACTION);
 end
 
 procedure Node005
 begin
-    gsay_reply(853, 121);
-    giq_option(4, 853, 122, Node008, 50);
-    giq_option(4, 853, 123, Node009, 50);
-    giq_option(4, 853, 124, Node010, 50);
-    giq_option(4, 853, 125, Node002, 50);
+    Reply(121);
+    giq_option(4, NAME, 122, Node008, NEUTRAL_REACTION);
+    giq_option(4, NAME, 123, Node009, NEUTRAL_REACTION);
+    giq_option(4, NAME, 124, Node010, NEUTRAL_REACTION);
+    giq_option(4, NAME, 125, Node002, NEUTRAL_REACTION);
 end
 
 procedure Node006
 begin
-    gsay_reply(853, 126);
-    if ((global_var(361) bwand 4096) != 0) then begin
-        giq_option(4, 853, 127, Node013, 50);
+    Reply(126);
+    if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 4096) != 0) then begin
+        giq_option(4, NAME, 127, Node013, NEUTRAL_REACTION);
     end
-    if ((global_var(361) bwand 8192) != 0) then begin
-        giq_option(4, 853, 128, Node017, 50);
+    if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 8192) != 0) then begin
+        giq_option(4, NAME, 128, Node017, NEUTRAL_REACTION);
     end
-    if ((global_var(361) bwand 16384) != 0) then begin
-        giq_option(4, 853, 129, Node022, 50);
+    if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 16384) != 0) then begin
+        giq_option(4, NAME, 129, Node022, NEUTRAL_REACTION);
     end
-    giq_option(4, 853, 130, Node029a, 50);
-    giq_option(4, 853, 131, Node002, 50);
+    giq_option(4, NAME, 130, Node029a, NEUTRAL_REACTION);
+    giq_option(4, NAME, 131, Node002, NEUTRAL_REACTION);
 end
 
 procedure Node007
 begin
     variable LVar0 := 0;
     LVar0 := random(132, 140);
-    if ((LVar0 == 132) and not(global_var(1) >= 2)) then begin
+    if ((LVar0 == 132) and not(global_var(GVAR_CHILDKILLER_REPUTATION) >= 2)) then begin
         LVar0 := 133;
     end
-    if ((LVar0 == 133) and (global_var(0) > 0)) then begin
+    if ((LVar0 == 133) and (global_var(GVAR_PLAYER_REPUTATION) > 0)) then begin
         LVar0 := 134;
     end
-    gsay_reply(853, LVar0);
-    giq_option(4, 853, 141, Node007, 50);
-    giq_option(4, 853, 142, Node002, 50);
+    Reply(LVar0);
+    giq_option(4, NAME, 141, Node007, NEUTRAL_REACTION);
+    giq_option(4, NAME, 142, Node002, NEUTRAL_REACTION);
     return 0;
     LVar0 := 0;
 end
@@ -444,228 +444,228 @@ end
 procedure Node008
 begin
     variable LVar0 := 0;
-    if ((global_var(361) bwand 4096) != 0) then begin
-        LVar0 := message_str(853, 143);
+    if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 4096) != 0) then begin
+        LVar0 := mstr(143);
     end
     else begin
-        LVar0 := message_str(853, 144);
+        LVar0 := mstr(144);
     end
-    if ((global_var(361) bwand 8192) != 0) then begin
-        LVar0 := LVar0 + (" - " + message_str(853, 145));
+    if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 8192) != 0) then begin
+        LVar0 := LVar0 + (" - " + mstr(145));
     end
     else begin
-        LVar0 := LVar0 + (" - " + message_str(853, 146));
+        LVar0 := LVar0 + (" - " + mstr(146));
     end
-    if ((global_var(361) bwand 16384) != 0) then begin
-        LVar0 := LVar0 + (" - " + message_str(853, 147));
+    if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 16384) != 0) then begin
+        LVar0 := LVar0 + (" - " + mstr(147));
     end
     else begin
-        LVar0 := LVar0 + (" - " + message_str(853, 148));
+        LVar0 := LVar0 + (" - " + mstr(148));
     end
-    gsay_reply(853, LVar0);
-    if ((global_var(361) bwand 4096) != 0) then begin
-        giq_option(4, 853, 149, NodeBioOff, 50);
-        giq_option(4, 853, 152, Node013, 50);
+    Reply(LVar0);
+    if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 4096) != 0) then begin
+        giq_option(4, NAME, 149, NodeBioOff, NEUTRAL_REACTION);
+        giq_option(4, NAME, 152, Node013, NEUTRAL_REACTION);
     end
-    if ((global_var(361) bwand 8192) != 0) then begin
-        giq_option(4, 853, 150, NodeChemOff, 50);
-        giq_option(4, 853, 153, Node017, 50);
+    if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 8192) != 0) then begin
+        giq_option(4, NAME, 150, NodeChemOff, NEUTRAL_REACTION);
+        giq_option(4, NAME, 153, Node017, NEUTRAL_REACTION);
     end
-    if ((global_var(361) bwand 16384) != 0) then begin
-        giq_option(4, 853, 151, NodePhyOff, 50);
-        giq_option(4, 853, 154, Node022, 50);
+    if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 16384) != 0) then begin
+        giq_option(4, NAME, 151, NodePhyOff, NEUTRAL_REACTION);
+        giq_option(4, NAME, 154, Node022, NEUTRAL_REACTION);
     end
-    if (not((global_var(361) bwand 4096) != 0)) then begin
-        giq_option(4, 853, 155, NodeBioOn, 50);
+    if (not((global_var(GVAR_SAN_FRAN_FLAGS) bwand 4096) != 0)) then begin
+        giq_option(4, NAME, 155, NodeBioOn, NEUTRAL_REACTION);
     end
-    if (not((global_var(361) bwand 8192) != 0)) then begin
-        giq_option(4, 853, 156, NodeChemOn, 50);
+    if (not((global_var(GVAR_SAN_FRAN_FLAGS) bwand 8192) != 0)) then begin
+        giq_option(4, NAME, 156, NodeChemOn, NEUTRAL_REACTION);
     end
-    if (not((global_var(361) bwand 16384) != 0)) then begin
-        giq_option(4, 853, 157, NodePhyOn, 50);
+    if (not((global_var(GVAR_SAN_FRAN_FLAGS) bwand 16384) != 0)) then begin
+        giq_option(4, NAME, 157, NodePhyOn, NEUTRAL_REACTION);
     end
-    giq_option(4, 853, 158, Node005, 50);
+    giq_option(4, NAME, 158, Node005, NEUTRAL_REACTION);
     return 0;
     LVar0 := 0;
 end
 
 procedure Node009
 begin
-    gsay_reply(853, 159);
-    giq_option(4, 853, 160, Node011, 50);
-    giq_option(4, 853, 161, Node005, 50);
+    Reply(159);
+    giq_option(4, NAME, 160, Node011, NEUTRAL_REACTION);
+    giq_option(4, NAME, 161, Node005, NEUTRAL_REACTION);
 end
 
 procedure Node010
 begin
-    gsay_reply(853, 162);
-    giq_option(4, 853, 163, Node005, 50);
+    Reply(162);
+    giq_option(4, NAME, 163, Node005, NEUTRAL_REACTION);
 end
 
 procedure Node011
 begin
-    gsay_reply(853, 164);
-    giq_option(4, 853, 165, Node012, 50);
-    giq_option(4, 853, 166, Node005, 50);
+    Reply(164);
+    giq_option(4, NAME, 165, Node012, NEUTRAL_REACTION);
+    giq_option(4, NAME, 166, Node005, NEUTRAL_REACTION);
 end
 
 procedure Node012
 begin
-    set_global_var(361, global_var(361) bwor 1);
-    set_global_var(361, global_var(361) bwor 1024);
-    if (global_var(555) == 1) then begin
-        set_global_var(555, 3);
+    set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwor 1);
+    set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwor 1024);
+    if (global_var(GVAR_SAN_FRAN_KILL_OZ9_QST) == 1) then begin
+        set_global_var(GVAR_SAN_FRAN_KILL_OZ9_QST, 3);
     end
     salert := 1;
-    gsay_reply(853, 167);
-    giq_option(4, 853, 168, Node999, 50);
+    Reply(167);
+    giq_option(4, NAME, 168, Node999, NEUTRAL_REACTION);
 end
 
 procedure Node013
 begin
-    gsay_reply(853, 169);
-    giq_option(4, 853, 170, Node014, 50);
-    giq_option(4, 853, 171, Node015, 50);
-    giq_option(4, 853, 172, Node016, 50);
-    giq_option(4, 853, 700, Node100, 50);
-    giq_option(4, 853, 173, Node006, 50);
+    Reply(169);
+    giq_option(4, NAME, 170, Node014, NEUTRAL_REACTION);
+    giq_option(4, NAME, 171, Node015, NEUTRAL_REACTION);
+    giq_option(4, NAME, 172, Node016, NEUTRAL_REACTION);
+    giq_option(4, NAME, 700, Node100, NEUTRAL_REACTION);
+    giq_option(4, NAME, 173, Node006, NEUTRAL_REACTION);
 end
 
 procedure Node014
 begin
     game_time_advance(60 * 10 * 20);
-    gsay_reply(853, 174);
-    giq_option(4, 853, 175, Node015, 50);
-    giq_option(4, 853, 176, Node016, 50);
-    giq_option(4, 853, 700, Node100, 50);
-    giq_option(4, 853, 177, Node013, 50);
+    Reply(174);
+    giq_option(4, NAME, 175, Node015, NEUTRAL_REACTION);
+    giq_option(4, NAME, 176, Node016, NEUTRAL_REACTION);
+    giq_option(4, NAME, 700, Node100, NEUTRAL_REACTION);
+    giq_option(4, NAME, 177, Node013, NEUTRAL_REACTION);
 end
 
 procedure Node015
 begin
     game_time_advance(60 * 10 * 20);
-    gsay_reply(853, 178);
-    giq_option(4, 853, 179, Node014, 50);
-    giq_option(4, 853, 180, Node016, 50);
-    giq_option(4, 853, 700, Node100, 50);
-    giq_option(4, 853, 181, Node013, 50);
+    Reply(178);
+    giq_option(4, NAME, 179, Node014, NEUTRAL_REACTION);
+    giq_option(4, NAME, 180, Node016, NEUTRAL_REACTION);
+    giq_option(4, NAME, 700, Node100, NEUTRAL_REACTION);
+    giq_option(4, NAME, 181, Node013, NEUTRAL_REACTION);
 end
 
 procedure Node016
 begin
-    gsay_reply(853, 182);
-    giq_option(4, 853, 183, Node014, 50);
-    giq_option(4, 853, 184, Node015, 50);
-    giq_option(4, 853, 700, Node100, 50);
-    giq_option(4, 853, 185, Node013, 50);
+    Reply(182);
+    giq_option(4, NAME, 183, Node014, NEUTRAL_REACTION);
+    giq_option(4, NAME, 184, Node015, NEUTRAL_REACTION);
+    giq_option(4, NAME, 700, Node100, NEUTRAL_REACTION);
+    giq_option(4, NAME, 185, Node013, NEUTRAL_REACTION);
 end
 
 procedure Node017
 begin
-    gsay_reply(853, 186);
-    giq_option(4, 853, 187, Node018, 50);
-    giq_option(4, 853, 188, Node019, 50);
-    giq_option(4, 853, 189, Node006, 50);
+    Reply(186);
+    giq_option(4, NAME, 187, Node018, NEUTRAL_REACTION);
+    giq_option(4, NAME, 188, Node019, NEUTRAL_REACTION);
+    giq_option(4, NAME, 189, Node006, NEUTRAL_REACTION);
 end
 
 procedure Node018
 begin
     if (is_success(roll_vs_skill(dude_obj, 12, -100))) then begin
         game_time_advance(60 * (60 * 10));
-        gsay_reply(853, 190);
+        Reply(190);
     end
     else begin
         game_time_advance(60 * 10 * 15);
-        gsay_reply(853, 191);
+        Reply(191);
     end
-    if (not((global_var(363) bwand 8) != 0) and not((global_var(361) bwand 32768) != 0)) then begin
-        if ((global_var(363) bwand 1) != 0) then begin
-            giq_option(4, 853, 192, NodeTanker2120, 50);
+    if (not((global_var(GVAR_SAN_FRAN_TANKER) bwand 8) != 0) and not((global_var(GVAR_SAN_FRAN_FLAGS) bwand 32768) != 0)) then begin
+        if ((global_var(GVAR_SAN_FRAN_TANKER) bwand 1) != 0) then begin
+            giq_option(4, NAME, 192, NodeTanker2120, NEUTRAL_REACTION);
         end
-        if ((global_var(361) bwand 65536) != 0) then begin
-            giq_option(4, 853, 193, NodeElron20, 50);
+        if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 65536) != 0) then begin
+            giq_option(4, NAME, 193, NodeElron20, NEUTRAL_REACTION);
         end
     end
-    giq_option(4, 853, 194, Node017, 50);
+    giq_option(4, NAME, 194, Node017, NEUTRAL_REACTION);
 end
 
 procedure Node019
 begin
     game_time_advance(60 * 10 * 15);
-    gsay_reply(853, 195);
-    giq_option(4, 853, 196, Node017, 50);
+    Reply(195);
+    giq_option(4, NAME, 196, Node017, NEUTRAL_REACTION);
 end
 
 procedure Node020
 begin
-    set_global_var(364, 1);
-    gsay_reply(853, 197);
-    giq_option(4, 853, 198, Node999, 50);
+    set_global_var(GVAR_SAN_FRAN_SHIHACKED, 1);
+    Reply(197);
+    giq_option(4, NAME, 198, Node999, NEUTRAL_REACTION);
 end
 
 procedure Node021
 begin
-    gsay_reply(853, 199);
-    giq_option(4, 853, 200, Node999, 50);
+    Reply(199);
+    giq_option(4, NAME, 200, Node999, NEUTRAL_REACTION);
 end
 
 procedure Node022
 begin
-    gsay_reply(853, 201);
-    giq_option(4, 853, 202, Node2324, 50);
-    giq_option(4, 853, 203, Node025, 50);
-    giq_option(4, 853, 204, Node006, 50);
+    Reply(201);
+    giq_option(4, NAME, 202, Node2324, NEUTRAL_REACTION);
+    giq_option(4, NAME, 203, Node025, NEUTRAL_REACTION);
+    giq_option(4, NAME, 204, Node006, NEUTRAL_REACTION);
 end
 
 procedure Node023
 begin
-    gsay_reply(853, 205);
-    if ((global_var(427) == 4) or ((global_var(361) bwand 33554432) != 0)) then begin
-        giq_option(4, 853, 206, NodeCopy, 50);
+    Reply(205);
+    if ((global_var(GVAR_SAN_FRAN_ELRON_WHIRLY) == 4) or ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 33554432) != 0)) then begin
+        giq_option(4, NAME, 206, NodeCopy, NEUTRAL_REACTION);
     end
-    giq_option(4, 853, 207, Node022, 50);
+    giq_option(4, NAME, 207, Node022, NEUTRAL_REACTION);
 end
 
 procedure Node024
 begin
-    gsay_reply(853, 208);
-    giq_option(4, 853, 209, Node022, 50);
+    Reply(208);
+    giq_option(4, NAME, 209, Node022, NEUTRAL_REACTION);
 end
 
 procedure Node025
 begin
     game_time_advance(60 * 10 * 20);
-    gsay_reply(853, 210);
-    giq_option(4, 853, 211, Node022, 50);
+    Reply(210);
+    giq_option(4, NAME, 211, Node022, NEUTRAL_REACTION);
 end
 
 procedure Node026
 begin
-    gsay_reply(853, 212);
-    giq_option(4, 853, 213, Node008, 50);
+    Reply(212);
+    giq_option(4, NAME, 213, Node008, NEUTRAL_REACTION);
 end
 
 procedure Node027
 begin
-    gsay_reply(853, 221);
-    if ((global_var(494) >= 4) and (global_var(494) < 8)) then begin
-        giq_option(4, 853, 222, Node028, 50);
+    Reply(221);
+    if ((global_var(GVAR_FALLOUT_2) >= 4) and (global_var(GVAR_FALLOUT_2) < 8)) then begin
+        giq_option(4, NAME, 222, Node028, NEUTRAL_REACTION);
     end
-    giq_option(4, 853, 213, Node002, 50);
+    giq_option(4, NAME, 213, Node002, NEUTRAL_REACTION);
 end
 
 procedure Node028
 begin
-    gsay_reply(853, 223);
-    giq_option(4, 853, 213, Node002, 50);
+    Reply(223);
+    giq_option(4, NAME, 213, Node002, NEUTRAL_REACTION);
 end
 
 procedure Node029a
 begin
     if (local_var(9) == 0) then begin
         set_local_var(9, 1);
-        gsay_reply(853, 230);
-        giq_option(4, 853, message_str(14, 353), Node029, 50);
+        Reply(230);
+        giq_option(4, NAME, g_mstr(353), Node029, NEUTRAL_REACTION);
     end
     else begin
         call Node029();
@@ -674,98 +674,98 @@ end
 
 procedure Node029
 begin
-    gsay_reply(853, 231);
-    giq_option(4, 853, 232, Node030, 50);
-    giq_option(4, 853, 233, Node040a, 50);
-    giq_option(4, 853, 234, Node050, 50);
-    giq_option(4, 853, 235, Node051, 50);
-    giq_option(4, 853, 236, Node006, 50);
+    Reply(231);
+    giq_option(4, NAME, 232, Node030, NEUTRAL_REACTION);
+    giq_option(4, NAME, 233, Node040a, NEUTRAL_REACTION);
+    giq_option(4, NAME, 234, Node050, NEUTRAL_REACTION);
+    giq_option(4, NAME, 235, Node051, NEUTRAL_REACTION);
+    giq_option(4, NAME, 236, Node006, NEUTRAL_REACTION);
 end
 
 procedure Node030
 begin
-    gsay_reply(853, 240);
-    giq_option(4, 853, 241, Node031, 50);
+    Reply(240);
+    giq_option(4, NAME, 241, Node031, NEUTRAL_REACTION);
 end
 
 procedure Node031
 begin
-    gsay_reply(853, 250);
-    giq_option(4, 853, 251, Node032, 50);
+    Reply(250);
+    giq_option(4, NAME, 251, Node032, NEUTRAL_REACTION);
 end
 
 procedure Node032
 begin
-    gsay_reply(853, 260);
-    giq_option(4, 853, 261, Node033, 50);
-    giq_option(4, 853, 262, Node068, 50);
-    giq_option(4, 853, 263, Node035, 50);
-    giq_option(4, 853, 264, Node029, 50);
+    Reply(260);
+    giq_option(4, NAME, 261, Node033, NEUTRAL_REACTION);
+    giq_option(4, NAME, 262, Node068, NEUTRAL_REACTION);
+    giq_option(4, NAME, 263, Node035, NEUTRAL_REACTION);
+    giq_option(4, NAME, 264, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node033
 begin
-    gsay_reply(853, 270);
-    giq_option(4, 853, 271, Node034, 50);
+    Reply(270);
+    giq_option(4, NAME, 271, Node034, NEUTRAL_REACTION);
 end
 
 procedure Node034
 begin
-    gsay_reply(853, 275);
-    giq_option(4, 853, 276, Node032, 50);
+    Reply(275);
+    giq_option(4, NAME, 276, Node032, NEUTRAL_REACTION);
 end
 
 procedure Node035
 begin
-    gsay_reply(853, 280);
-    if (global_var(362) < 4) then begin
-        giq_option(4, 853, 281, Node036, 50);
+    Reply(280);
+    if (global_var(GVAR_SAN_FRAN_SUB) < 4) then begin
+        giq_option(4, NAME, 281, Node036, NEUTRAL_REACTION);
     end
-    giq_option(4, 853, 282, Node032, 50);
+    giq_option(4, NAME, 282, Node032, NEUTRAL_REACTION);
 end
 
 procedure Node036
 begin
-    gsay_reply(853, 290);
-    giq_option(4, 853, message_str(14, 353), Node037, 50);
+    Reply(290);
+    giq_option(4, NAME, g_mstr(353), Node037, NEUTRAL_REACTION);
 end
 
 procedure Node037
 begin
-    gsay_reply(853, 291);
-    giq_option(4, 853, 292, Node038, 50);
-    giq_option(4, 853, 293, Node032, 50);
+    Reply(291);
+    giq_option(4, NAME, 292, Node038, NEUTRAL_REACTION);
+    giq_option(4, NAME, 293, Node032, NEUTRAL_REACTION);
 end
 
 procedure Node038
 begin
-    gsay_reply(853, 300);
-    giq_option(4, 853, 301, Node039, 50);
+    Reply(300);
+    giq_option(4, NAME, 301, Node039, NEUTRAL_REACTION);
 end
 
 procedure Node039
 begin
-    gsay_reply(853, 310);
-    giq_option(4, 853, 311, Node032, 50);
-    display_msg(message_str(853, 320));
+    Reply(310);
+    giq_option(4, NAME, 311, Node032, NEUTRAL_REACTION);
+    display_mstr(320);
     give_exp_points(1000);
-    display_msg(message_str(14, 100) + 1000 + message_str(14, 101));
-    if (global_var(362) < 4) then begin
-        set_global_var(362, 4);
+    display_msg(g_mstr(100) + 1000 + g_mstr(101));
+    if (global_var(GVAR_SAN_FRAN_SUB) < 4) then begin
+        set_global_var(GVAR_SAN_FRAN_SUB, 4);
     end
 end
 
 procedure Node040
 begin
-    gsay_reply(853, 331);
-    giq_option(4, 853, 332, Node042, 50);
-    giq_option(4, 853, 333, Node043, 50);
-    giq_option(4, 853, 334, Node044, 50);
-    giq_option(4, 853, 335, Node045, 50);
-    giq_option(4, 853, 336, Node046, 50);
-    giq_option(4, 853, 337, Node047, 50);
-    giq_option(4, 853, 341, Node041, 50);
-    giq_option(4, 853, 342, Node029, 50);
+    Reply(331);
+    giq_option(4, NAME, 332, Node042, NEUTRAL_REACTION);
+    giq_option(4, NAME, 333, Node043, NEUTRAL_REACTION);
+    giq_option(4, NAME, 334, Node044, NEUTRAL_REACTION);
+    giq_option(4, NAME, 335, Node045, NEUTRAL_REACTION);
+    giq_option(4, NAME, 336, Node046, NEUTRAL_REACTION);
+    giq_option(4, NAME, 337, Node047, NEUTRAL_REACTION);
+    giq_option(4, NAME, 341, Node041, NEUTRAL_REACTION);
+    giq_option(4, NAME, 342, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node040a
@@ -782,8 +782,8 @@ procedure Node040b
 begin
     if (local_var(10) == 0) then begin
         set_local_var(10, 1);
-        gsay_reply(853, 330);
-        giq_option(4, 853, message_str(14, 353), Node040, 50);
+        Reply(330);
+        giq_option(4, NAME, g_mstr(353), Node040, NEUTRAL_REACTION);
     end
     else begin
         call Node040();
@@ -792,82 +792,82 @@ end
 
 procedure Node040c
 begin
-    gsay_reply(853, 325);
-    giq_option(4, 853, 236, Node029, 50);
+    Reply(325);
+    giq_option(4, NAME, 236, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node041
 begin
-    gsay_reply(853, 340);
-    giq_option(4, 853, 338, Node048, 50);
-    giq_option(4, 853, 339, Node049, 50);
-    giq_option(4, 853, 342, Node040, 50);
+    Reply(340);
+    giq_option(4, NAME, 338, Node048, NEUTRAL_REACTION);
+    giq_option(4, NAME, 339, Node049, NEUTRAL_REACTION);
+    giq_option(4, NAME, 342, Node040, NEUTRAL_REACTION);
 end
 
 procedure Node042
 begin
-    gsay_reply(853, 345);
-    giq_option(4, 853, 346, Node040, 50);
+    Reply(345);
+    giq_option(4, NAME, 346, Node040, NEUTRAL_REACTION);
 end
 
 procedure Node043
 begin
-    gsay_reply(853, 350);
-    giq_option(4, 853, 351, Node040, 50);
+    Reply(350);
+    giq_option(4, NAME, 351, Node040, NEUTRAL_REACTION);
 end
 
 procedure Node044
 begin
-    gsay_reply(853, 360);
-    giq_option(4, 853, 361, Node040, 50);
+    Reply(360);
+    giq_option(4, NAME, 361, Node040, NEUTRAL_REACTION);
 end
 
 procedure Node045
 begin
-    gsay_reply(853, 370);
-    giq_option(4, 853, 371, Node040, 50);
+    Reply(370);
+    giq_option(4, NAME, 371, Node040, NEUTRAL_REACTION);
 end
 
 procedure Node046
 begin
-    gsay_reply(853, 380);
-    giq_option(4, 853, 381, Node040, 50);
+    Reply(380);
+    giq_option(4, NAME, 381, Node040, NEUTRAL_REACTION);
 end
 
 procedure Node047
 begin
-    gsay_reply(853, 390);
-    giq_option(4, 853, 391, Node040, 50);
+    Reply(390);
+    giq_option(4, NAME, 391, Node040, NEUTRAL_REACTION);
 end
 
 procedure Node048
 begin
-    gsay_reply(853, 400);
-    giq_option(4, 853, 401, Node041, 50);
+    Reply(400);
+    giq_option(4, NAME, 401, Node041, NEUTRAL_REACTION);
 end
 
 procedure Node049
 begin
-    gsay_reply(853, 410);
-    giq_option(4, 853, 411, Node041, 50);
+    Reply(410);
+    giq_option(4, NAME, 411, Node041, NEUTRAL_REACTION);
 end
 
 procedure Node050
 begin
-    gsay_reply(853, 420);
-    giq_option(4, 853, 421, Node029, 50);
+    Reply(420);
+    giq_option(4, NAME, 421, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node051
 begin
-    gsay_reply(853, 430);
-    giq_option(4, 853, 431, Node052, 50);
+    Reply(430);
+    giq_option(4, NAME, 431, Node052, NEUTRAL_REACTION);
 end
 
 procedure Node052
 begin
-    gsay_reply(853, 440);
-    giq_option(4, 853, 441, Node054, 50);
+    Reply(440);
+    giq_option(4, NAME, 441, Node054, NEUTRAL_REACTION);
 end
 
 procedure Node053
@@ -876,124 +876,124 @@ end
 
 procedure Node054
 begin
-    gsay_reply(853, 450);
-    giq_option(4, 853, 451, Node055, 50);
-    giq_option(4, 853, 452, Node029, 50);
+    Reply(450);
+    giq_option(4, NAME, 451, Node055, NEUTRAL_REACTION);
+    giq_option(4, NAME, 452, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node055
 begin
-    gsay_reply(853, 460);
-    giq_option(4, 853, 461, Node056, 50);
-    giq_option(4, 853, 462, Node029, 50);
+    Reply(460);
+    giq_option(4, NAME, 461, Node056, NEUTRAL_REACTION);
+    giq_option(4, NAME, 462, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node056
 begin
-    gsay_reply(853, 470);
-    giq_option(4, 853, 471, Node057, 50);
-    giq_option(4, 853, 472, Node029, 50);
+    Reply(470);
+    giq_option(4, NAME, 471, Node057, NEUTRAL_REACTION);
+    giq_option(4, NAME, 472, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node057
 begin
-    gsay_reply(853, 480);
-    giq_option(4, 853, 481, Node058, 50);
-    giq_option(4, 853, 482, Node029, 50);
+    Reply(480);
+    giq_option(4, NAME, 481, Node058, NEUTRAL_REACTION);
+    giq_option(4, NAME, 482, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node058
 begin
-    gsay_reply(853, 490);
-    giq_option(4, 853, 491, Node059, 50);
-    giq_option(4, 853, 492, Node029, 50);
+    Reply(490);
+    giq_option(4, NAME, 491, Node059, NEUTRAL_REACTION);
+    giq_option(4, NAME, 492, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node059
 begin
-    gsay_reply(853, 500);
-    giq_option(4, 853, 501, Node060, 50);
-    giq_option(4, 853, 502, Node029, 50);
+    Reply(500);
+    giq_option(4, NAME, 501, Node060, NEUTRAL_REACTION);
+    giq_option(4, NAME, 502, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node060
 begin
-    gsay_reply(853, 510);
-    giq_option(4, 853, 511, Node061, 50);
-    giq_option(4, 853, 512, Node029, 50);
+    Reply(510);
+    giq_option(4, NAME, 511, Node061, NEUTRAL_REACTION);
+    giq_option(4, NAME, 512, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node061
 begin
-    gsay_reply(853, 520);
-    giq_option(4, 853, 521, Node062, 50);
-    giq_option(4, 853, 522, Node029, 50);
+    Reply(520);
+    giq_option(4, NAME, 521, Node062, NEUTRAL_REACTION);
+    giq_option(4, NAME, 522, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node062
 begin
-    gsay_reply(853, 530);
-    giq_option(4, 853, 531, Node063, 50);
-    giq_option(4, 853, 532, Node029, 50);
+    Reply(530);
+    giq_option(4, NAME, 531, Node063, NEUTRAL_REACTION);
+    giq_option(4, NAME, 532, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node063
 begin
-    gsay_reply(853, 540);
-    giq_option(4, 853, 541, Node064, 50);
-    giq_option(4, 853, 542, Node029, 50);
+    Reply(540);
+    giq_option(4, NAME, 541, Node064, NEUTRAL_REACTION);
+    giq_option(4, NAME, 542, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node064
 begin
-    gsay_reply(853, 550);
-    giq_option(4, 853, 551, Node065, 50);
-    giq_option(4, 853, 552, Node029, 50);
+    Reply(550);
+    giq_option(4, NAME, 551, Node065, NEUTRAL_REACTION);
+    giq_option(4, NAME, 552, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node065
 begin
-    gsay_reply(853, 560);
-    giq_option(4, 853, 561, Node066, 50);
-    giq_option(4, 853, 562, Node029, 50);
+    Reply(560);
+    giq_option(4, NAME, 561, Node066, NEUTRAL_REACTION);
+    giq_option(4, NAME, 562, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node066
 begin
-    gsay_reply(853, 570);
-    giq_option(4, 853, 571, Node067, 50);
-    giq_option(4, 853, 572, Node029, 50);
+    Reply(570);
+    giq_option(4, NAME, 571, Node067, NEUTRAL_REACTION);
+    giq_option(4, NAME, 572, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node067
 begin
-    gsay_reply(853, 580);
-    giq_option(4, 853, 581, Node029, 50);
+    Reply(580);
+    giq_option(4, NAME, 581, Node029, NEUTRAL_REACTION);
 end
 
 procedure Node068
 begin
-    gsay_reply(853, 590);
-    giq_option(4, 853, 591, Node069, 50);
+    Reply(590);
+    giq_option(4, NAME, 591, Node069, NEUTRAL_REACTION);
 end
 
 procedure Node069
 begin
-    gsay_reply(853, 600);
-    giq_option(4, 853, 601, Node070, 50);
+    Reply(600);
+    giq_option(4, NAME, 601, Node070, NEUTRAL_REACTION);
 end
 
 procedure Node070
 begin
-    gsay_reply(853, 610);
-    giq_option(4, 853, 611, Node071, 50);
+    Reply(610);
+    giq_option(4, NAME, 611, Node071, NEUTRAL_REACTION);
 end
 
 procedure Node071
 begin
-    gsay_reply(853, 620);
-    giq_option(4, 853, 621, Node032, 50);
-    giq_option(4, 853, 622, Node999, 50);
+    Reply(620);
+    giq_option(4, NAME, 621, Node032, NEUTRAL_REACTION);
+    giq_option(4, NAME, 622, Node999, NEUTRAL_REACTION);
 end
 
 procedure DoCallGuards
@@ -1002,13 +1002,13 @@ begin
     LVar0 := tile_contains_pid_obj(17851, elevation(self_obj), 16777518);
     debug_msg("fsempter: should be attacking: " + LVar0);
     if (LVar0) then begin
-        float_msg(LVar0, message_str(853, random(216, 219)), 2);
+        float_msg(LVar0, mstr(random(216, 219)), FLOAT_MSG_RED);
         attack_setup(LVar0, dude_obj);
     end
     LVar0 := tile_contains_pid_obj(17845, elevation(self_obj), 16777518);
     debug_msg("fsempter: should be attacking: " + LVar0);
     if (LVar0) then begin
-        float_msg(LVar0, message_str(853, random(216, 219)), 2);
+        float_msg(LVar0, mstr(random(216, 219)), FLOAT_MSG_RED);
         attack_setup(LVar0, dude_obj);
     end
     return 0;
@@ -1018,26 +1018,26 @@ end
 procedure NodeHack
 begin
     if (is_success(roll_vs_skill(dude_obj, 12, 0))) then begin
-        if (has_skill(dude_obj, 12) >= 115) then begin
+        if (has_skill(dude_obj, SKILL_SCIENCE) >= 115) then begin
             SVar21 := 1;
             if (local_var(8) == 0) then begin
                 set_local_var(8, 1);
                 give_exp_points(7000);
-                display_msg(message_str(14, 100) + 7000 + message_str(14, 101));
+                display_msg(g_mstr(100) + 7000 + g_mstr(101));
             end
             call Node002();
         end
         else begin
-            set_global_var(364, 1);
-            set_global_var(361, global_var(361) bwor 1);
+            set_global_var(GVAR_SAN_FRAN_SHIHACKED, 1);
+            set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwor 1);
             if (local_var(8) == 0) then begin
                 set_local_var(8, 1);
-                set_global_var(0, global_var(0) + -10);
+                set_global_var(GVAR_PLAYER_REPUTATION, global_var(GVAR_PLAYER_REPUTATION) + -10);
                 debug_msg("Player gains " + -10 + " Karma Points.");
                 call adjustkarma();
-                set_global_var(61, global_var(61) + -10);
+                set_global_var(GVAR_TOWN_REP_SAN_FRANCISCO, global_var(GVAR_TOWN_REP_SAN_FRANCISCO) + -10);
                 give_exp_points(3000);
-                display_msg(message_str(14, 100) + 3000 + message_str(14, 101));
+                display_msg(g_mstr(100) + 3000 + g_mstr(101));
             end
             SVar21 := 1;
             call Node002();
@@ -1050,55 +1050,55 @@ end
 
 procedure NodeBioOn
 begin
-    set_global_var(361, global_var(361) bwor 4096);
+    set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwor 4096);
     call Node008();
 end
 
 procedure NodeChemOn
 begin
-    set_global_var(361, global_var(361) bwor 8192);
+    set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwor 8192);
     call Node008();
 end
 
 procedure NodePhyOn
 begin
-    set_global_var(361, global_var(361) bwor 16384);
+    set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwor 16384);
     call Node008();
 end
 
 procedure NodeBioOff
 begin
-    set_global_var(361, global_var(361) bwand (-1 - 4096));
+    set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwand (-1 - 4096));
     call Node008();
 end
 
 procedure NodeChemOff
 begin
-    set_global_var(361, global_var(361) bwand (-1 - 8192));
+    set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwand (-1 - 8192));
     call Node008();
 end
 
 procedure NodePhyOff
 begin
-    set_global_var(361, global_var(361) bwand (-1 - 16384));
+    set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwand (-1 - 16384));
     call Node008();
 end
 
 procedure NodeTanker2120
 begin
-    set_global_var(363, global_var(363) bwor 8);
-    if (((global_var(363) bwand 8) != 0) and ((global_var(363) bwand 4) != 0)) then begin
-        if (global_var(494) < 7) then begin
-            set_global_var(494, 7);
+    set_global_var(GVAR_SAN_FRAN_TANKER, global_var(GVAR_SAN_FRAN_TANKER) bwor 8);
+    if (((global_var(GVAR_SAN_FRAN_TANKER) bwand 8) != 0) and ((global_var(GVAR_SAN_FRAN_TANKER) bwand 4) != 0)) then begin
+        if (global_var(GVAR_FALLOUT_2) < 7) then begin
+            set_global_var(GVAR_FALLOUT_2, 7);
         end
     end
-    set_global_var(0, global_var(0) + 5);
+    set_global_var(GVAR_PLAYER_REPUTATION, global_var(GVAR_PLAYER_REPUTATION) + 5);
     debug_msg("Player gains " + 5 + " Karma Points.");
     call adjustkarma();
     give_exp_points(5000);
-    display_msg(message_str(14, 100) + 5000 + message_str(14, 101));
-    set_global_var(532, 2);
-    if ((global_var(361) bwand 2048) != 0) then begin
+    display_msg(g_mstr(100) + 5000 + g_mstr(101));
+    set_global_var(GVAR_SAN_FRAN_FUEL_TANK_QST, 2);
+    if ((global_var(GVAR_SAN_FRAN_FLAGS) bwand 2048) != 0) then begin
         call Node021();
     end
     else begin
@@ -1108,20 +1108,20 @@ end
 
 procedure NodeElron20
 begin
-    set_global_var(0, global_var(0) + -25);
+    set_global_var(GVAR_PLAYER_REPUTATION, global_var(GVAR_PLAYER_REPUTATION) + -25);
     debug_msg("Player gains " + -25 + " Karma Points.");
     call adjustkarma();
     give_exp_points(6000);
-    display_msg(message_str(14, 100) + 6000 + message_str(14, 101));
-    set_global_var(61, global_var(61) + -5);
-    set_global_var(361, global_var(361) bwor 32768);
-    set_global_var(535, 2);
+    display_msg(g_mstr(100) + 6000 + g_mstr(101));
+    set_global_var(GVAR_TOWN_REP_SAN_FRANCISCO, global_var(GVAR_TOWN_REP_SAN_FRANCISCO) + -5);
+    set_global_var(GVAR_SAN_FRAN_FLAGS, global_var(GVAR_SAN_FRAN_FLAGS) bwor 32768);
+    set_global_var(GVAR_SAN_FRAN_ELRON_GAS_QST, 2);
     call Node020();
 end
 
 procedure Node2324
 begin
-    if (global_var(519) == 8) then begin
+    if (global_var(GVAR_SAN_FRAN_SHI_WHIRLY) == 8) then begin
         call Node023();
     end
     else begin
@@ -1132,7 +1132,7 @@ end
 procedure NodeCopy
 begin
     variable LVar0 := 0;
-    LVar0 := create_object_sid(446, 0, 0, -1);
+    LVar0 := create_object(446, 0, 0);
     add_obj_to_inven(dude_obj, LVar0);
     call Node022();
     return 0;
@@ -1141,52 +1141,52 @@ end
 
 procedure adjustkarma
 begin
-    set_global_var(37, 0);
-    set_global_var(38, 0);
-    set_global_var(39, 0);
-    set_global_var(40, 0);
-    set_global_var(41, 0);
-    set_global_var(42, 0);
-    set_global_var(43, 0);
-    set_global_var(44, 0);
-    set_global_var(45, 0);
-    tmp_gen_rep := global_var(0);
-    if (has_trait(0, dude_obj, 95)) then begin
-        tmp_gen_rep := global_var(0) * 2;
+    set_global_var(GVAR_KARMA_HOLY_WARRIOR, 0);
+    set_global_var(GVAR_KARMA_GUARDIAN_OF_THE_WASTES, 0);
+    set_global_var(GVAR_KARMA_SHIELD_OF_HOPE, 0);
+    set_global_var(GVAR_KARMA_DEFENDER, 0);
+    set_global_var(GVAR_KARMA_WANDERER, 0);
+    set_global_var(GVAR_KARMA_BETRAYER, 0);
+    set_global_var(GVAR_KARMA_SWORD_OF_DESPAIR, 0);
+    set_global_var(GVAR_KARMA_SCOURGE_OF_THE_WASTE, 0);
+    set_global_var(GVAR_KARMA_DEMON_SPAWN, 0);
+    tmp_gen_rep := global_var(GVAR_PLAYER_REPUTATION);
+    if (has_trait(TRAIT_PERK, dude_obj, PERK_karma_beacon_perk)) then begin
+        tmp_gen_rep := global_var(GVAR_PLAYER_REPUTATION) * 2;
     end
     if (tmp_gen_rep >= 1000) then begin
-        set_global_var(37, 1);
+        set_global_var(GVAR_KARMA_HOLY_WARRIOR, 1);
     end
     else begin
         if (tmp_gen_rep >= 750) then begin
-            set_global_var(38, 1);
+            set_global_var(GVAR_KARMA_GUARDIAN_OF_THE_WASTES, 1);
         end
         else begin
             if (tmp_gen_rep >= 500) then begin
-                set_global_var(39, 1);
+                set_global_var(GVAR_KARMA_SHIELD_OF_HOPE, 1);
             end
             else begin
                 if (tmp_gen_rep >= 250) then begin
-                    set_global_var(40, 1);
+                    set_global_var(GVAR_KARMA_DEFENDER, 1);
                 end
                 else begin
                     if (tmp_gen_rep > -250) then begin
-                        set_global_var(41, 1);
+                        set_global_var(GVAR_KARMA_WANDERER, 1);
                     end
                     else begin
                         if (tmp_gen_rep > -500) then begin
-                            set_global_var(42, 1);
+                            set_global_var(GVAR_KARMA_BETRAYER, 1);
                         end
                         else begin
                             if (tmp_gen_rep > -750) then begin
-                                set_global_var(43, 1);
+                                set_global_var(GVAR_KARMA_SWORD_OF_DESPAIR, 1);
                             end
                             else begin
                                 if (tmp_gen_rep > -1000) then begin
-                                    set_global_var(44, 1);
+                                    set_global_var(GVAR_KARMA_SCOURGE_OF_THE_WASTE, 1);
                                 end
                                 else begin
-                                    set_global_var(45, 1);
+                                    set_global_var(GVAR_KARMA_DEMON_SPAWN, 1);
                                 end
                             end
                         end
@@ -1199,11 +1199,10 @@ end
 
 procedure Node100
 begin
-    set_global_var(782, 1);
-    gsay_reply(853, 701);
-    giq_option(4, 853, 170, Node014, 50);
-    giq_option(4, 853, 171, Node015, 50);
-    giq_option(4, 853, 172, Node016, 50);
-    giq_option(4, 853, 173, Node013, 50);
+    set_global_var(GVAR_TOWN_REP_MONKS, 1);
+    Reply(701);
+    giq_option(4, NAME, 170, Node014, NEUTRAL_REACTION);
+    giq_option(4, NAME, 171, Node015, NEUTRAL_REACTION);
+    giq_option(4, NAME, 172, Node016, NEUTRAL_REACTION);
+    giq_option(4, NAME, 173, Node013, NEUTRAL_REACTION);
 end
-
