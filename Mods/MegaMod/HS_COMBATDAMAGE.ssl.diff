diff --git a/Mods/MegaMod/Original/HS_COMBATDAMAGE.ssl b/Mods/MegaMod/ReDefine/HS_COMBATDAMAGE.ssl
index 303d90f..4844324 100644
--- a/Mods/MegaMod/Original/HS_COMBATDAMAGE.ssl
+++ b/Mods/MegaMod/ReDefine/HS_COMBATDAMAGE.ssl
@@ -501,7 +501,7 @@ begin
             end
         end
     end
-    if (has_trait(2, attacker, 4)) then begin
+    if (has_trait(TRAIT_TRAIT, attacker, TRAIT_finesse)) then begin
         value := value + 10;
     end
     if (attacker == dude_obj) then begin
@@ -867,7 +867,7 @@ begin
     end
     if ((Get_Skill() == 2) or (Get_Skill() == 1) or (Get_Skill() == 0)) then begin
         if (attacker == dude_obj) then begin
-            attack_min := attack_min + proto_minimum_damage + (has_fake_perk("Minimum Range Damage") * get_sfall_global_int(114)) + (2 * has_trait(0, dude_obj, 4));
+            attack_min := attack_min + proto_minimum_damage + (has_fake_perk("Minimum Range Damage") * get_sfall_global_int(114)) + (2 * has_trait(TRAIT_PERK, dude_obj, PERK_bonus_ranged_damage));
         end
         else begin
             attack_min := attack_min + proto_minimum_damage;
@@ -967,7 +967,7 @@ begin
     end
     if ((Get_Skill() == 2) or (Get_Skill() == 1) or (Get_Skill() == 0)) then begin
         if (attacker == dude_obj) then begin
-            attack_max := attack_max + (has_fake_perk("Bonus Ranged Damage") * get_sfall_global_int(28)) + proto_maximum_damage + (2 * has_trait(0, dude_obj, 4));
+            attack_max := attack_max + (has_fake_perk("Bonus Ranged Damage") * get_sfall_global_int(28)) + proto_maximum_damage + (2 * has_trait(TRAIT_PERK, dude_obj, PERK_bonus_ranged_damage));
         end
         else begin
             attack_max := attack_max + proto_maximum_damage;
@@ -1248,7 +1248,7 @@ procedure BonusDamage(variable arg0, variable arg1)
 begin
     value := 0;
     if (attacker == dude_obj) then begin
-        if (has_trait(0, dude_obj, 97) and (get_proto_data(obj_pid(target), 388) != 2)) then begin
+        if (has_trait(TRAIT_PERK, dude_obj, PERK_living_anatomy_perk) and (get_proto_data(obj_pid(target), 388) != 2)) then begin
             value := value + 5;
         end
         if ((DamageType() == 1) and has_fake_perk("Bonus Damage(Laser)")) then begin
@@ -1315,7 +1315,7 @@ begin
     call Roll_Critical_Check(arg3, arg4);
     cycle_value := Get_Burst();
     if ((target == dude_obj) and has_fake_perk("Lightning Reflexes")) then begin
-        anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(attacker)));
+        anim(dude_obj, 1000, rotation_to_tile(dude_tile, tile_num(attacker)));
     end
     while (cycles < cycle_value) do begin
         if (LVar7 == 0) then begin
@@ -1546,7 +1546,7 @@ begin
     if (((party_member_obj(obj_pid(target)) != 0) == 0) and (target != dude_obj) or ((target != dude_obj) and (get_sfall_global_int(4306) == 1))) then begin
         resistance := resistance + get_sfall_global_int(2192);
     end
-    if (has_trait(2, attacker, 4)) then begin
+    if (has_trait(TRAIT_TRAIT, attacker, TRAIT_finesse)) then begin
         resistance := resistance + 30;
     end
     if (Is_Ap_Ammo() and (resistance > 0)) then begin
@@ -1627,13 +1627,13 @@ begin
                 if (has_fake_perk("HtH/Melee Criticals Multiplied") > 0) then begin
                     perk_math := perk_math + (has_fake_perk("HtH/Melee Criticals Multiplied") * GetFloatValue(get_sfall_global_int(102)));
                 end
-                if (has_trait(0, dude_obj, 21)) then begin
+                if (has_trait(TRAIT_PERK, dude_obj, PERK_better_criticals)) then begin
                     perk_math := perk_math + 0.20000;
                 end
                 perk_mod_math := perk_math * random_damage;
                 random_damage := random_damage * GetFloatValue(get_sfall_global_int(4305));
                 random_damage := floor(random_damage + perk_mod_math);
-                if (has_trait(0, dude_obj, 23)) then begin
+                if (has_trait(TRAIT_PERK, dude_obj, PERK_slayer)) then begin
                     if (random(1, 100) > (100 - get_sfall_global_int(4308))) then begin
                         if (target != dude_obj) then begin
                             eight := 1;
@@ -1677,7 +1677,7 @@ begin
                     if (has_fake_perk("Ranged Criticals Multiplied") > 0) then begin
                         perk_math := perk_math + (has_fake_perk("Ranged Criticals Multiplied") * GetFloatValue(get_sfall_global_int(4269)));
                     end
-                    if (has_trait(0, dude_obj, 21)) then begin
+                    if (has_trait(TRAIT_PERK, dude_obj, PERK_better_criticals)) then begin
                         perk_math := perk_math + 0.20000;
                     end
                     perk_mod_math := perk_math * random_damage;
@@ -1714,7 +1714,7 @@ begin
         else begin
             if (ten == 1) then begin
                 if (attacker == dude_obj) then begin
-                    if (has_trait(0, dude_obj, 21)) then begin
+                    if (has_trait(TRAIT_PERK, dude_obj, PERK_better_criticals)) then begin
                         perk_math := perk_math + 0.20000;
                     end
                     perk_mod_math := perk_math * random_damage;
@@ -2053,7 +2053,7 @@ begin
     random_roll := random(1, 100);
     if ((Get_Skill() == 3) or (Get_Skill() == 4)) then begin
         if (attacker == dude_obj) then begin
-            if ((random_roll > (100 - CalcCrit(arg0))) or has_trait(0, dude_obj, 23)) then begin
+            if ((random_roll > (100 - CalcCrit(arg0))) or has_trait(TRAIT_PERK, dude_obj, PERK_slayer)) then begin
                 ten := 1;
             end
         end
@@ -2075,7 +2075,7 @@ begin
     else begin
         if ((Get_Skill() == 2) or (Get_Skill() == 1) or (Get_Skill() == 0)) then begin
             if (attacker == dude_obj) then begin
-                if (has_trait(0, dude_obj, 24) and (random(1, 100) >= (100 - (get_sfall_global_int(4266) - get_critter_stat(dude_obj, 6)))) or (random_roll > (100 - CalcCrit(arg0)))) then begin
+                if (has_trait(TRAIT_PERK, dude_obj, PERK_sniper) and (random(1, 100) >= (100 - (get_sfall_global_int(4266) - dude_luck))) or (random_roll > (100 - CalcCrit(arg0)))) then begin
                     ten := 1;
                 end
             end
@@ -2193,19 +2193,19 @@ begin
     if ((arg0 == dude_obj) and has_fake_perk("Lightning Reflexes")) then begin
         return 1;
     end
-    if (has_trait(1, arg1, 10) == has_trait(1, arg0, 10)) then begin
+    if (obj_get_rot(arg1) == obj_get_rot(arg0)) then begin
         return 4;
     end
     else begin
-        if ((has_trait(1, arg1, 10) == (has_trait(1, arg0, 10) + 1)) or (has_trait(1, arg1, 10) == (has_trait(1, arg0, 10) - 1))) then begin
+        if ((obj_get_rot(arg1) == (obj_get_rot(arg0) + 1)) or (obj_get_rot(arg1) == (obj_get_rot(arg0) - 1))) then begin
             return 3;
         end
         else begin
-            if ((has_trait(1, arg1, 10) == (has_trait(1, arg0, 10) + 2)) or (has_trait(1, arg1, 10) == (has_trait(1, arg0, 10) - 2))) then begin
+            if ((obj_get_rot(arg1) == (obj_get_rot(arg0) + 2)) or (obj_get_rot(arg1) == (obj_get_rot(arg0) - 2))) then begin
                 return 2;
             end
             else begin
-                if ((has_trait(1, arg1, 10) == (has_trait(1, arg0, 10) + 3)) or (has_trait(1, arg1, 10) == (has_trait(1, arg0, 10) - 3))) then begin
+                if ((obj_get_rot(arg1) == (obj_get_rot(arg0) + 3)) or (obj_get_rot(arg1) == (obj_get_rot(arg0) - 3))) then begin
                     return 1;
                 end
             end
@@ -2240,11 +2240,11 @@ end
 procedure Back_Stab(variable arg0)
 begin
     if (attacker == dude_obj) then begin
-        anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(target)));
+        anim(dude_obj, 1000, rotation_to_tile(dude_tile, tile_num(target)));
     end
     if ((attacker == dude_obj) and has_fake_perk("Backstab") and (Get_Facing(target, attacker) == 4) and (tile_distance_objs(attacker, target) <= 1)) then begin
         arg0 := floor(arg0 * GetFloatValue(get_sfall_global_int(4538)));
-        float_msg(dude_obj, "Backstab!", 3);
+        float_msg(dude_obj, "Backstab!", FLOAT_MSG_GREEN);
     end
     return arg0;
 end
@@ -2321,16 +2321,16 @@ begin
                 end
             end
             if (get_sfall_global_int(2190) > 0) then begin
-                if ((get_critter_extra_stat(arg0, 8) + get_critter_base_stat(arg0, 8) + get_sfall_global_int(2190)) > (get_pc_stat(1) + 5)) then begin
-                    set_critter_extra_stat(arg0, 8, get_pc_stat(1) + 5 - (get_critter_extra_stat(arg0, 8) + get_critter_base_stat(arg0, 8)));
+                if ((get_critter_extra_stat(arg0, 8) + get_critter_base_stat(arg0, 8) + get_sfall_global_int(2190)) > (get_pc_stat(PCSTAT_level) + 5)) then begin
+                    set_critter_extra_stat(arg0, 8, get_pc_stat(PCSTAT_level) + 5 - (get_critter_extra_stat(arg0, 8) + get_critter_base_stat(arg0, 8)));
                 end
                 else begin
                     set_critter_extra_stat(arg0, 8, get_critter_extra_stat(arg0, 8) + get_sfall_global_int(2190));
                 end
             end
             if (get_sfall_global_int(2196) > 0) then begin
-                if ((get_critter_extra_stat(arg0, 9) + get_critter_base_stat(arg0, 9) + get_sfall_global_int(2196)) > (get_pc_stat(1) + 5)) then begin
-                    set_critter_extra_stat(arg0, 9, get_pc_stat(1) + 5 - (get_critter_extra_stat(arg0, 9) + get_critter_base_stat(arg0, 9)));
+                if ((get_critter_extra_stat(arg0, 9) + get_critter_base_stat(arg0, 9) + get_sfall_global_int(2196)) > (get_pc_stat(PCSTAT_level) + 5)) then begin
+                    set_critter_extra_stat(arg0, 9, get_pc_stat(PCSTAT_level) + 5 - (get_critter_extra_stat(arg0, 9) + get_critter_base_stat(arg0, 9)));
                 end
                 else begin
                     set_critter_extra_stat(arg0, 9, get_critter_extra_stat(arg0, 9) + get_sfall_global_int(2196));
@@ -2344,7 +2344,7 @@ procedure CalculateBonuses
 begin
     math := 0;
     if (get_sfall_global_int(2161) > 0) then begin
-        math := get_pc_stat(1) / get_sfall_global_int(2161);
+        math := get_pc_stat(PCSTAT_level) / get_sfall_global_int(2161);
     end
     if ((get_sfall_global_int(2162) > 0) and (math > 0)) then begin
         math := math * get_sfall_global_int(2162);
@@ -2365,13 +2365,13 @@ begin
             math := 0;
         end
     end
-    if (math > (get_pc_stat(1) + 5)) then begin
-        math := get_pc_stat(1) + 5;
+    if (math > (get_pc_stat(PCSTAT_level) + 5)) then begin
+        math := get_pc_stat(PCSTAT_level) + 5;
     end
     set_sfall_global(2190, math);
     math := 0;
     if (get_sfall_global_int(2164) > 0) then begin
-        math := get_pc_stat(1) / get_sfall_global_int(2164);
+        math := get_pc_stat(PCSTAT_level) / get_sfall_global_int(2164);
     end
     if ((get_sfall_global_int(2165) > 0) and (math > 0)) then begin
         math := math * get_sfall_global_int(2165);
@@ -2398,7 +2398,7 @@ begin
     set_sfall_global(2191, math);
     math := 0;
     if (get_sfall_global_int(2167) > 0) then begin
-        math := get_pc_stat(1) / get_sfall_global_int(2167);
+        math := get_pc_stat(PCSTAT_level) / get_sfall_global_int(2167);
     end
     if ((get_sfall_global_int(2168) > 0) and (math > 0)) then begin
         math := math * get_sfall_global_int(2168);
@@ -2425,7 +2425,7 @@ begin
     set_sfall_global(2192, math);
     math := 0;
     if (get_sfall_global_int(2170) > 0) then begin
-        math := get_pc_stat(1) / get_sfall_global_int(2170);
+        math := get_pc_stat(PCSTAT_level) / get_sfall_global_int(2170);
     end
     if ((get_sfall_global_int(2171) > 0) and (math > 0)) then begin
         math := math * get_sfall_global_int(2171);
@@ -2446,13 +2446,13 @@ begin
             math := 0;
         end
     end
-    if (math > (get_pc_stat(1) + 5)) then begin
-        math := get_pc_stat(1) + 5;
+    if (math > (get_pc_stat(PCSTAT_level) + 5)) then begin
+        math := get_pc_stat(PCSTAT_level) + 5;
     end
     set_sfall_global(2193, math);
     math := 0;
     if (get_sfall_global_int(2173) > 0) then begin
-        math := get_pc_stat(1) / get_sfall_global_int(2173);
+        math := get_pc_stat(PCSTAT_level) / get_sfall_global_int(2173);
     end
     if ((get_sfall_global_int(2174) > 0) and (math > 0)) then begin
         math := math * get_sfall_global_int(2174);
@@ -2479,7 +2479,7 @@ begin
     set_sfall_global(2194, math);
     math := 0;
     if (get_sfall_global_int(2176) > 0) then begin
-        math := get_pc_stat(1) / get_sfall_global_int(2176);
+        math := get_pc_stat(PCSTAT_level) / get_sfall_global_int(2176);
     end
     if ((get_sfall_global_int(2177) > 0) and (math > 0)) then begin
         math := math * get_sfall_global_int(2177);
@@ -2506,7 +2506,7 @@ begin
     set_sfall_global(2195, math);
     math := 0;
     if (get_sfall_global_int(2179) > 0) then begin
-        math := get_pc_stat(1) / get_sfall_global_int(2179);
+        math := get_pc_stat(PCSTAT_level) / get_sfall_global_int(2179);
     end
     if ((get_sfall_global_int(2180) > 0) and (math > 0)) then begin
         math := math * get_sfall_global_int(2180);
@@ -2527,13 +2527,13 @@ begin
             math := 0;
         end
     end
-    if (math > (get_pc_stat(1) + 5)) then begin
-        math := get_pc_stat(1) + 5;
+    if (math > (get_pc_stat(PCSTAT_level) + 5)) then begin
+        math := get_pc_stat(PCSTAT_level) + 5;
     end
     set_sfall_global(2196, math);
     math := 0;
     if (get_sfall_global_int(2182) > 0) then begin
-        math := get_pc_stat(1) * get_sfall_global_int(2182);
+        math := get_pc_stat(PCSTAT_level) * get_sfall_global_int(2182);
     end
     if (get_sfall_global_int(2183) > 0) then begin
         if (math > 0) then begin
@@ -2557,7 +2557,7 @@ begin
     set_sfall_global(2197, math);
     math := 0;
     if (get_sfall_global_int(2184) > 0) then begin
-        math := get_pc_stat(1) / get_sfall_global_int(2184);
+        math := get_pc_stat(PCSTAT_level) / get_sfall_global_int(2184);
     end
     if ((get_sfall_global_int(2185) > 0) and (math > 0)) then begin
         math := math * get_sfall_global_int(2185);
@@ -2584,7 +2584,7 @@ begin
     set_sfall_global(2198, math);
     math := 0;
     if (get_sfall_global_int(2187) > 0) then begin
-        math := get_pc_stat(1) / get_sfall_global_int(2187);
+        math := get_pc_stat(PCSTAT_level) / get_sfall_global_int(2187);
     end
     if ((get_sfall_global_int(2188) > 0) and (math > 0)) then begin
         math := math * get_sfall_global_int(2188);
@@ -2611,7 +2611,7 @@ begin
     set_sfall_global(2199, math);
     math := 0;
     if (get_sfall_global_int(4259) > 0) then begin
-        math := get_pc_stat(1) / get_sfall_global_int(4259);
+        math := get_pc_stat(PCSTAT_level) / get_sfall_global_int(4259);
     end
     if ((get_sfall_global_int(4260) > 0) and (math > 0)) then begin
         math := math * get_sfall_global_int(4260);
@@ -2638,7 +2638,7 @@ begin
     set_sfall_global(4262, math);
     math := 0;
     if (get_sfall_global_int(4297) > 0) then begin
-        math := get_pc_stat(1) / get_sfall_global_int(4297);
+        math := get_pc_stat(PCSTAT_level) / get_sfall_global_int(4297);
     end
     if ((get_sfall_global_int(4298) > 0) and (math > 0)) then begin
         math := math * get_sfall_global_int(4298);
@@ -2689,4 +2689,3 @@ begin
     end
     return arg0;
 end
-
