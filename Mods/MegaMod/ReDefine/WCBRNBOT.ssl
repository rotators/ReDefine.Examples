variable global_temp;
variable tmp_gen_rep;
variable float_now;

procedure start;
procedure critter_p_proc;
procedure pickup_p_proc;
procedure talk_p_proc;
procedure destroy_p_proc;
procedure look_at_p_proc;
procedure description_p_proc;
procedure use_skill_on_p_proc;
procedure damage_p_proc;
procedure map_update_p_proc;
procedure map_enter_p_proc;
procedure timed_event_p_proc;
procedure push_p_proc;
procedure use_obj_on_p_proc;
procedure Node998;
procedure Node999;
procedure Node001;
procedure Node001a;
procedure Node001b;
procedure Node002;
procedure Node003;
procedure Node004;
procedure Node005;
procedure Node006;
procedure Node006a;
procedure Node007;
procedure Node008;
procedure Node010;
procedure Node011;
procedure Node012;
procedure Node013;
procedure Node013b;
procedure Node014;
procedure Node015;
procedure Node016;
procedure Node017;
procedure Node017a;
procedure Node018;
procedure Node019;
procedure Node020;
procedure Node020a;
procedure Node020b;
procedure Node020c;
procedure Node021;
procedure Node022;
procedure Node023;
procedure Node024;
procedure Kill_The_Party;
procedure local_floats;

variable waiting;


procedure start
begin
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    variable LVar3 := 0;
    variable LVar4 := 0;
    variable LVar5 := 0;
    if (local_var(15) == 0) then begin
        set_local_var(15, 1);
        critter_add_trait(self_obj, TRAIT_OBJECT, OBJECT_TEAM_NUM, 52);
        add_timer_event(self_obj, game_ticks(75), 321);
        if (global_var(GVAR_V23_QUEST) == 0) then begin
            set_global_var(GVAR_V23_QUEST, 1);
        end
        if (proto_data(obj_pid(self_obj), 3) == 16777282) then begin
            if (global_var(GVAR_BRAIN_BOT_BRAIN) > 1) then begin
                LVar0 := create_object(274, 0, 0);
                LVar1 := create_object(36, 0, 0);
                LVar2 := random(2, 3);
                LVar3 := random(1, 3);
                add_mult_objs_to_inven(self_obj, LVar0, LVar2);
                add_mult_objs_to_inven(self_obj, LVar1, LVar3);
            end
            LVar4 := create_object(12, 0, 0);
            LVar5 := create_object(270, 0, 0);
            add_mult_objs_to_inven(self_obj, LVar4, 1);
            add_mult_objs_to_inven(self_obj, LVar5, 1);
        end
    end
    return 0;
    LVar0 := 0;
    LVar1 := 0;
    LVar2 := 0;
    LVar3 := 0;
    LVar4 := 0;
    LVar5 := 0;
end

procedure critter_p_proc
begin
    if ((CUR_MAP_NEWR1) and (self_obj == party_member_obj(16777295)) and (map_var(2) == party_member_obj(16777295))) then begin
        set_map_var(2, 0);
        waiting := 1;
        if (self_strength < 10) then begin
            use_obj_on_obj(create_object(482, 0, 0), self_obj);
        end
    end
    if ((CUR_MAP_DEPOLV1) and (global_var(GVAR_SIERRA_BASE_ENEMY) == 1) and (local_var(5) == 0)) then begin
        if (local_var(13) == 0) then begin
            set_local_var(13, local_var(13) + 1);
            call Kill_The_Party();
        end
    end
    if (local_var(5) == 2) then begin
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
            float_msg(self_obj, mstr(173), FLOAT_MSG_YELLOW);
            attack(dude_obj);
        end
        else begin
            animate_move_obj_to_tile(self_obj, tile_num_in_direction(dude_tile, random(0, 5), random(1, 4)), 0);
        end
    end
    if ((CUR_MAP_DEPOLVA) and ((local_var(9) == 0) or (local_var(10) == 0) or (local_var(11) == 0))) then begin
        if (local_var(5) != 2) then begin
            call Node024();
        end
    end
    if (waiting != 1) then begin
        if ((local_var(8) == 0) and not(global_var(GVAR_PARTY_NO_FOLLOW) != 0)) then begin
            if (tile_distance_objs(self_obj, dude_obj) > (2 * local_var(7))) then begin
                animate_move_obj_to_tile(self_obj, tile_num_in_direction(dude_tile, random(0, 5), 3), 1);
            end
            else begin
                if (tile_distance_objs(self_obj, dude_obj) > local_var(7)) then begin
                    animate_move_obj_to_tile(self_obj, tile_num_in_direction(dude_tile, random(0, 5), 6), 1);
                end
            end
        end
    end
    if (float_now == 1) then begin
        float_now := 0;
        if ((combat_is_initialized == 0) and (random(1, 3) != 2)) then begin
            call local_floats();
        end
    end
end

procedure pickup_p_proc
begin
    if ((source_obj == dude_obj) and (party_member_obj(obj_pid(self_obj)) != 0)) then begin
        set_local_var(5, 2);
    end
end

procedure talk_p_proc
begin
    if (local_var(12) == 0) then begin
        start_gdialog(167, self_obj, 4, -1, -1);
        gsay_start;
        call Node001();
        gsay_end;
        end_dialogue;
    end
    else begin
        if (local_var(8) == 1) then begin
            start_gdialog(167, self_obj, 4, -1, -1);
            gsay_start;
            call Node007();
            gsay_end;
            end_dialogue;
        end
        else begin
            if (local_var(8) == 2) then begin
                start_gdialog(167, self_obj, 4, -1, -1);
                gsay_start;
                call Node008();
                gsay_end;
                end_dialogue;
            end
            else begin
                if (global_var(GVAR_BRAIN_BOT_BRAIN) == 1) then begin
                    start_gdialog(167, self_obj, 4, -1, -1);
                    gsay_start;
                    call Node002();
                    gsay_end;
                    end_dialogue;
                end
                else begin
                    if (global_var(GVAR_BRAIN_BOT_BRAIN) == 2) then begin
                        start_gdialog(167, self_obj, 4, -1, -1);
                        gsay_start;
                        call Node003();
                        gsay_end;
                        end_dialogue;
                    end
                    else begin
                        if (global_var(GVAR_BRAIN_BOT_BRAIN) == 3) then begin
                            start_gdialog(167, self_obj, 4, -1, -1);
                            gsay_start;
                            call Node004();
                            gsay_end;
                            end_dialogue;
                        end
                        else begin
                            if ((global_var(GVAR_BRAIN_BOT_BRAIN) == 4) and (global_var(GVAR_SIERRA_BASE_ENEMY) == 1) and (local_var(5) == 0)) then begin
                                start_gdialog(167, self_obj, 4, -1, -1);
                                gsay_start;
                                call Node005();
                                gsay_end;
                                end_dialogue;
                            end
                            else begin
                                if (global_var(GVAR_BRAIN_BOT_BRAIN) == 4) then begin
                                    start_gdialog(167, self_obj, 4, -1, -1);
                                    gsay_start;
                                    call Node006();
                                    gsay_end;
                                    end_dialogue;
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end

procedure destroy_p_proc
begin
    if (source_obj == dude_obj) then begin
        set_global_var(GVAR_GOOD_MONSTER, global_var(GVAR_GOOD_MONSTER) + 1);
        if (((global_var(GVAR_BAD_MONSTER) + global_var(GVAR_GOOD_MONSTER)) >= 25) and ((global_var(4) > (3 * global_var(GVAR_GOOD_MONSTER))) or (global_var(GVAR_CHAMPION_REPUTATION) == 1)) and (global_var(GVAR_CHILDKILLER_REPUTATION) == 0)) then begin
            set_global_var(GVAR_CHAMPION_REPUTATION, 1);
            set_global_var(GVAR_BERSERKER_REPUTATION, 0);
        end
        if (((global_var(GVAR_BAD_MONSTER) + global_var(GVAR_GOOD_MONSTER)) >= 25) and ((global_var(GVAR_GOOD_MONSTER) > (2 * global_var(GVAR_BAD_MONSTER))) or (global_var(GVAR_BERSERKER_REPUTATION) == 1))) then begin
            set_global_var(GVAR_BERSERKER_REPUTATION, 1);
            set_global_var(GVAR_CHAMPION_REPUTATION, 0);
        end
        set_global_var(GVAR_PLAYER_REPUTATION, global_var(GVAR_PLAYER_REPUTATION) + -10);
        debug_msg("Player gains " + -10 + " Karma Points.");
        set_global_var(GVAR_KARMA_HOLY_WARRIOR, 0);
        set_global_var(GVAR_KARMA_GUARDIAN_OF_THE_WASTES, 0);
        set_global_var(GVAR_KARMA_SHIELD_OF_HOPE, 0);
        set_global_var(GVAR_KARMA_DEFENDER, 0);
        set_global_var(GVAR_KARMA_WANDERER, 0);
        set_global_var(GVAR_KARMA_BETRAYER, 0);
        set_global_var(GVAR_KARMA_SWORD_OF_DESPAIR, 0);
        set_global_var(GVAR_KARMA_SCOURGE_OF_THE_WASTE, 0);
        set_global_var(GVAR_KARMA_DEMON_SPAWN, 0);
        tmp_gen_rep := global_var(GVAR_PLAYER_REPUTATION);
        if (has_trait(TRAIT_PERK, dude_obj, PERK_karma_beacon_perk)) then begin
            tmp_gen_rep := global_var(GVAR_PLAYER_REPUTATION) * 2;
        end
        if (tmp_gen_rep >= 1000) then begin
            set_global_var(GVAR_KARMA_HOLY_WARRIOR, 1);
        end
        else begin
            if (tmp_gen_rep >= 750) then begin
                set_global_var(GVAR_KARMA_GUARDIAN_OF_THE_WASTES, 1);
            end
            else begin
                if (tmp_gen_rep >= 500) then begin
                    set_global_var(GVAR_KARMA_SHIELD_OF_HOPE, 1);
                end
                else begin
                    if (tmp_gen_rep >= 250) then begin
                        set_global_var(GVAR_KARMA_DEFENDER, 1);
                    end
                    else begin
                        if (tmp_gen_rep > -250) then begin
                            set_global_var(GVAR_KARMA_WANDERER, 1);
                        end
                        else begin
                            if (tmp_gen_rep > -500) then begin
                                set_global_var(GVAR_KARMA_BETRAYER, 1);
                            end
                            else begin
                                if (tmp_gen_rep > -750) then begin
                                    set_global_var(GVAR_KARMA_SWORD_OF_DESPAIR, 1);
                                end
                                else begin
                                    if (tmp_gen_rep > -1000) then begin
                                        set_global_var(GVAR_KARMA_SCOURGE_OF_THE_WASTE, 1);
                                    end
                                    else begin
                                        set_global_var(GVAR_KARMA_DEMON_SPAWN, 1);
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end

procedure look_at_p_proc
begin
    script_overrides;
    display_mstr(1000);
end

procedure description_p_proc
begin
    script_overrides;
    display_mstr(101);
end

procedure use_skill_on_p_proc
begin
    if (action_being_used == 13) then begin
        script_overrides;
        display_mstr(610);
    end
end

procedure damage_p_proc
begin
    if ((source_obj == dude_obj) and (local_var(12) == 0)) then begin
        set_local_var(5, 2);
    end
end

procedure map_update_p_proc
begin
    if ((local_var(12) == 0) or (local_var(8) != 0)) then begin
        critter_add_trait(self_obj, TRAIT_OBJECT, OBJECT_TEAM_NUM, 52);
    end
    else begin
        critter_add_trait(self_obj, TRAIT_OBJECT, OBJECT_TEAM_NUM, 0);
    end
    if (waiting == 1) then begin
        waiting := 0;
    end
end

procedure map_enter_p_proc
begin
    if ((CUR_MAP_MODINN) or (CUR_MAP_V15ENT) or (CUR_MAP_V15ENTB)) then begin
        if ((elevation(self_obj) != elevation(dude_obj)) and (local_var(8) != 0)) then begin
            move_to(self_obj, tile_num(self_obj), elevation(dude_obj));
        end
    end
    if (global_var(GVAR_BRAIN_BOT_BRAIN) == 4) then begin
        if (party_member_obj(obj_pid(self_obj)) != 0) then begin
            float_now := 1;
            metarule3(100, self_obj, 321, 0);
            add_timer_event(self_obj, game_ticks(random(40, 60)), 321);
        end
        else begin
            float_now := 0;
        end
    end
end

procedure timed_event_p_proc
begin
    if (fixed_param == 2) then begin
        call Kill_The_Party();
    end
    if (fixed_param == 321) then begin
        if (not(combat_is_initialized) and obj_is_visible_flag(self_obj)) then begin
            if (party_member_obj(obj_pid(self_obj)) != 0) then begin
                float_msg(self_obj, mstr(random(534, 582)), FLOAT_MSG_YELLOW);
            end
        end
        if (global_var(GVAR_BRAIN_BOT_BRAIN) == 4) then begin
            metarule3(100, self_obj, 321, 0);
            add_timer_event(self_obj, game_ticks(random(40, 60)), 321);
        end
    end
    if (fixed_param == 40893) then begin
        set_local_var(8, 2);
        party_remove(self_obj);
        move_to(self_obj, 20687, elevation(self_obj));
        critter_attempt_placement(self_obj, 15698, 0);
    end
end

procedure push_p_proc
begin
    if ((global_var(GVAR_BRAIN_BOT_BRAIN) == 1) or (global_var(GVAR_BRAIN_BOT_BRAIN) == 2)) then begin
        float_msg(self_obj, mstr(410), FLOAT_MSG_YELLOW);
    end
    else begin
        if (global_var(GVAR_BRAIN_BOT_BRAIN) == 3) then begin
            float_msg(self_obj, mstr(420), FLOAT_MSG_YELLOW);
        end
        else begin
            float_msg(self_obj, mstr(random(430, 432)), FLOAT_MSG_YELLOW);
        end
    end
end

procedure use_obj_on_p_proc
begin
    variable LVar0 := 0;
    variable LVar1 := 0;
    if ((obj_pid(obj_being_used_with) == 39) or (obj_pid(obj_being_used_with) == 38)) then begin
        script_overrides;
        display_mstr(600);
    end
    if ((obj_pid(obj_being_used_with) == 14) or (obj_pid(obj_being_used_with) == 37) or (obj_pid(obj_being_used_with) == 35) or (obj_pid(obj_being_used_with) == 36)) then begin
        if (proto_data(obj_pid(self_obj), 3) == 16777282) then begin
            script_overrides;
            rm_obj_from_inven(dude_obj, obj_being_used_with);
            destroy_object(obj_being_used_with);
            if ((obj_pid(obj_being_used_with) == 14) or (obj_pid(obj_being_used_with) == 37)) then begin
                LVar0 := create_object(274, 0, 0);
                add_mult_objs_to_inven(self_obj, LVar0, 1);
                display_mstr(216);
            end
            if ((obj_pid(obj_being_used_with) == 35) or (obj_pid(obj_being_used_with) == 36)) then begin
                LVar1 := create_object(36, 0, 0);
                add_mult_objs_to_inven(self_obj, LVar1, 1);
                display_mstr(217);
            end
        end
    end
    if (obj_pid(obj_being_used_with) == 412) then begin
        script_overrides;
        if (global_var(GVAR_BRAIN_BOT_BRAIN) > 3) then begin
            float_msg(self_obj, mstr(601), FLOAT_MSG_GREEN);
        end
        if (global_var(GVAR_BRAIN_BOT_BRAIN) < 3) then begin
            float_msg(self_obj, mstr(603), FLOAT_MSG_GREEN);
        end
        if (global_var(GVAR_BRAIN_BOT_BRAIN) == 3) then begin
            float_msg(self_obj, mstr(604), FLOAT_MSG_GREEN);
        end
        display_mstr(602);
    end
    if ((obj_pid(obj_being_used_with) == 40) or (obj_pid(obj_being_used_with) == 47) or (obj_pid(obj_being_used_with) == 71) or (obj_pid(obj_being_used_with) == 91) or (obj_pid(obj_being_used_with) == 144) or (obj_pid(obj_being_used_with) == 259) or (obj_pid(obj_being_used_with) == 87) or (obj_pid(obj_being_used_with) == 110) or (obj_pid(obj_being_used_with) == 273)) then begin
        script_overrides;
        display_mstr(611);
    end
    if ((obj_pid(obj_being_used_with) == 75) or (obj_pid(obj_being_used_with) == 308)) then begin
        script_overrides;
        display_mstr(610);
    end
    if ((obj_pid(obj_being_used_with) == 81) or (obj_pid(obj_being_used_with) == 103) or (obj_pid(obj_being_used_with) == 284) or (obj_pid(obj_being_used_with) == 378) or (obj_pid(obj_being_used_with) == 617)) then begin
        script_overrides;
        display_mstr(613);
    end
    if ((obj_pid(obj_being_used_with) == 106) or (obj_pid(obj_being_used_with) == 124) or (obj_pid(obj_being_used_with) == 125) or (obj_pid(obj_being_used_with) == 310) or (obj_pid(obj_being_used_with) == 311) or (obj_pid(obj_being_used_with) == 469) or (obj_pid(obj_being_used_with) == 662)) then begin
        script_overrides;
        display_mstr(612);
    end
    return 0;
    LVar0 := 0;
    LVar1 := 0;
end

procedure Node998
begin
    set_local_var(5, 2);
end

procedure Node999
begin
end

procedure Node001
begin
    if ((global_var(GVAR_SIERRA_BASE_ENEMY) == 1) and (global_var(GVAR_BRAIN_BOT_BRAIN) == 4)) then begin
        Reply(102);
        giq_option(1, NAME, 109, Node001b, NEUTRAL_REACTION);
    end
    else begin
        if (global_var(GVAR_BRAIN_BOT_BRAIN) == 4) then begin
            Reply(mstr(103) + mstr(104) + mstr(105) + mstr(106));
        end
        else begin
            Reply(306);
        end
        giq_option(4, NAME, 107, Node001a, NEUTRAL_REACTION);
        giq_option(4, NAME, 108, Node011, NEUTRAL_REACTION);
        giq_option(-3, NAME, 110, Node999, NEUTRAL_REACTION);
    end
end

procedure Node001a
begin
    debug_msg("Checking Party Size");
    if (((party_member_count(0) - 1) >= (floor(dude_charisma / 2) + has_trait(TRAIT_PERK, dude_obj, PERK_magnetic_personality_perk))) or ((party_member_count(0) - 1) >= 5)) then begin
        call Node012();
    end
    else begin
        call Node010();
    end
    debug_msg("Finished Checking Party Size");
end

procedure Node001b
begin
    party_add(self_obj);
    set_local_var(12, 1);
    if (local_var(8) != 0) then begin
        set_local_var(8, 0);
    end
    call Node999();
end

procedure Node002
begin
    Reply(111);
    giq_option(4, NAME, 114, Node999, NEUTRAL_REACTION);
    giq_option(-3, NAME, 115, Node999, NEUTRAL_REACTION);
end

procedure Node003
begin
    Reply(116);
    giq_option(4, NAME, 118, Node021, NEUTRAL_REACTION);
    giq_option(4, NAME, 120, Node999, NEUTRAL_REACTION);
    giq_option(-3, NAME, 121, Node999, NEUTRAL_REACTION);
end

procedure Node004
begin
    Reply(122);
    giq_option(4, NAME, 124, Node021, NEUTRAL_REACTION);
    giq_option(4, NAME, 125, Node022, NEUTRAL_REACTION);
    giq_option(4, NAME, 126, Node013, NEUTRAL_REACTION);
    giq_option(4, NAME, 128, Node999, NEUTRAL_REACTION);
    giq_option(-3, NAME, 129, Node999, NEUTRAL_REACTION);
end

procedure Node005
begin
    Reply(mstr(130) + mstr(131));
    giq_option(4, NAME, 132, Node999, NEUTRAL_REACTION);
    giq_option(-3, NAME, 133, Node999, NEUTRAL_REACTION);
end

procedure Node006
begin
    Reply(134);
    giq_option(4, NAME, 136, Node021, NEUTRAL_REACTION);
    giq_option(4, NAME, 137, Node022, NEUTRAL_REACTION);
    giq_option(4, NAME, 138, Node017, NEUTRAL_REACTION);
    if (get_critter_stat(self_obj, STAT_max_hp) != get_critter_stat(self_obj, STAT_current_hp)) then begin
        giq_option(4, NAME, 140, Node006a, NEUTRAL_REACTION);
    end
    giq_option(4, NAME, 141, Node020, NEUTRAL_REACTION);
    giq_option(4, NAME, 142, Node019, NEUTRAL_REACTION);
    giq_option(4, NAME, 143, Node999, NEUTRAL_REACTION);
    giq_option(-3, NAME, 144, Node999, NEUTRAL_REACTION);
end

procedure Node006a
begin
    variable LVar0 := 0;
    LVar0 := get_critter_stat(self_obj, STAT_max_hp) - get_critter_stat(self_obj, STAT_current_hp);
    critter_heal(self_obj, LVar0);
    gfade_out(600);
    gfade_in(600);
    game_time_advance(2 * (60 * (60 * 10)));
    call Node018();
    return 0;
    LVar0 := 0;
end

procedure Node007
begin
    if (global_var(GVAR_BRAIN_BOT_BRAIN) == 4) then begin
        Reply(mstr(145) + mstr(147));
    end
    else begin
        Reply(mstr(146) + mstr(147));
    end
    giq_option(4, NAME, 148, Node010, NEUTRAL_REACTION);
    giq_option(4, NAME, 149, Node021, NEUTRAL_REACTION);
    giq_option(-3, NAME, 144, Node999, NEUTRAL_REACTION);
end

procedure Node008
begin
    if (global_var(GVAR_BRAIN_BOT_BRAIN) == 4) then begin
        Reply(150);
        giq_option(4, NAME, 615, Node010, NEUTRAL_REACTION);
    end
    else begin
        Reply(146);
    end
    giq_option(4, NAME, 152, Node010, NEUTRAL_REACTION);
    giq_option(4, NAME, 153, Node999, NEUTRAL_REACTION);
    giq_option(-3, NAME, 144, Node999, NEUTRAL_REACTION);
end

procedure Node010
begin
    if (((party_member_count(0) - 1) >= (floor(dude_charisma / 2) + has_trait(TRAIT_PERK, dude_obj, PERK_magnetic_personality_perk))) or ((party_member_count(0) - 1) >= 5)) then begin
        Reply(650);
        giq_option(4, NAME, 651, Node999, NEUTRAL_REACTION);
    end
    else begin
        if (local_var(12) == 0) then begin
            set_local_var(12, 1);
        end
        party_add(self_obj);
        if (has_trait(TRAIT_OBJECT, self_obj, OBJECT_TEAM_NUM) != 0) then begin
            critter_add_trait(self_obj, TRAIT_OBJECT, OBJECT_TEAM_NUM, 0);
        end
        set_local_var(8, 0);
        if (global_var(GVAR_BRAIN_BOT_BRAIN) == 4) then begin
            Reply(154);
        end
        else begin
            if (global_var(GVAR_BRAIN_BOT_BRAIN) == 3) then begin
                Reply(155);
            end
            else begin
                Reply(156);
            end
        end
        giq_option(4, NAME, 157, Node999, NEUTRAL_REACTION);
        giq_option(-3, NAME, 144, Node999, NEUTRAL_REACTION);
    end
end

procedure Node011
begin
    if (global_var(GVAR_BRAIN_BOT_BRAIN) == 4) then begin
        Reply(158);
    end
    else begin
        Reply(159);
    end
    giq_option(4, NAME, 160, Node999, NEUTRAL_REACTION);
end

procedure Node012
begin
    if (((party_member_count(0) - 1) >= (floor(dude_charisma / 2) + has_trait(TRAIT_PERK, dude_obj, PERK_magnetic_personality_perk))) or ((party_member_count(0) - 1) >= 5)) then begin
        Reply(162);
    end
    else begin
        Reply(162);
    end
    giq_option(4, NAME, 163, Node999, NEUTRAL_REACTION);
end

procedure Node013
begin
    Reply(mstr(164) + mstr(165) + mstr(166));
    giq_option(4, NAME, 400, Node013b, NEUTRAL_REACTION);
    giq_option(4, NAME, 168, Node004, NEUTRAL_REACTION);
    giq_option(4, NAME, 169, Node999, NEUTRAL_REACTION);
end

procedure Node013b
begin
    inven_unwield(self_obj);
    if (global_var(GVAR_BRAIN_BOT_BRAIN) != 4) then begin
        call Node014();
    end
    else begin
        call Node018();
    end
end

procedure Node014
begin
    Reply(170);
    giq_option(4, NAME, 171, Node004, NEUTRAL_REACTION);
    giq_option(4, NAME, 172, Node999, NEUTRAL_REACTION);
end

procedure Node015
begin
    debug_msg("In Node015");
    set_local_var(5, 2);
    party_remove(self_obj);
    set_local_var(12, 0);
    critter_add_trait(self_obj, TRAIT_OBJECT, OBJECT_TEAM_NUM, 52);
end

procedure Node016
begin
    float_msg(self_obj, mstr(random(175, 177)), FLOAT_MSG_LIGHT_RED);
end

procedure Node017
begin
    if (proto_data(obj_pid(self_obj), 3) == 16777282) then begin
        Reply(210);
    end
    else begin
        Reply(178);
    end
    if (proto_data(obj_pid(self_obj), 3) == 16777282) then begin
        giq_option(4, NAME, 211, Node017a, NEUTRAL_REACTION);
    end
    if ((obj_item_subtype(critter_inven_obj(self_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(self_obj, 2)) == 3)) then begin
        giq_option(4, NAME, 400, Node013b, NEUTRAL_REACTION);
    end
    giq_option(4, NAME, 180, Node006, NEUTRAL_REACTION);
    giq_option(4, NAME, 181, Node999, NEUTRAL_REACTION);
end

procedure Node017a
begin
    variable LVar0 := 0;
    LVar0 := create_object(274, 0, 0);
    if (obj_is_carrying_obj_pid(self_obj, 274) == 0) then begin
        Reply(214);
    end
    if (obj_is_carrying_obj_pid(self_obj, 274) == 1) then begin
        Reply(215);
    end
    if (obj_is_carrying_obj_pid(self_obj, 274) > 1) then begin
        Reply(mstr(212) + obj_is_carrying_obj_pid(self_obj, 274) + mstr(213));
    end
    giq_option(4, NAME, 180, Node006, NEUTRAL_REACTION);
    giq_option(4, NAME, 181, Node999, NEUTRAL_REACTION);
    return 0;
    LVar0 := 0;
end

procedure Node018
begin
    Reply(182);
    giq_option(4, NAME, 183, Node006, NEUTRAL_REACTION);
    giq_option(4, NAME, 184, Node999, NEUTRAL_REACTION);
end

procedure Node019
begin
    Reply(185);
    giq_option(4, NAME, 186, Node006, NEUTRAL_REACTION);
    giq_option(4, NAME, 187, Node999, NEUTRAL_REACTION);
end

procedure Node020
begin
    Reply(188);
    giq_option(4, NAME, 189, Node020a, NEUTRAL_REACTION);
    giq_option(4, NAME, 190, Node020b, NEUTRAL_REACTION);
    giq_option(4, NAME, 191, Node020c, NEUTRAL_REACTION);
    giq_option(4, NAME, 192, Node006, NEUTRAL_REACTION);
    giq_option(4, NAME, 193, Node999, NEUTRAL_REACTION);
end

procedure Node020a
begin
    set_local_var(7, 12);
    call Node018();
end

procedure Node020b
begin
    set_local_var(7, 6);
    call Node018();
end

procedure Node020c
begin
    set_local_var(7, 3);
    call Node018();
end

procedure Node021
begin
    set_local_var(8, 2);
    party_remove(self_obj);
    if (global_var(GVAR_BRAIN_BOT_BRAIN) == 4) then begin
        Reply(194);
    end
    else begin
        if (global_var(GVAR_BRAIN_BOT_BRAIN) == 3) then begin
            Reply(195);
        end
        else begin
            Reply(196);
        end
    end
    giq_option(4, NAME, 197, Node999, NEUTRAL_REACTION);
end

procedure Node022
begin
    party_remove(self_obj);
    set_local_var(8, 1);
    if (global_var(GVAR_BRAIN_BOT_BRAIN) == 4) then begin
        Reply(198);
    end
    else begin
        Reply(199);
    end
    giq_option(4, NAME, 200, Node999, NEUTRAL_REACTION);
end

procedure Node023
begin
    set_local_var(8, 0);
    set_local_var(12, 1);
    party_add(self_obj);
    if (global_var(GVAR_BRAIN_BOT_BRAIN) == 4) then begin
        Reply(201);
    end
    else begin
        Reply(202);
    end
    giq_option(4, NAME, 203, Node999, NEUTRAL_REACTION);
end

procedure Node024
begin
    if (CUR_MAP_DEPOLVA) then begin
        if ((map_var(49) == 1) and (elevation(self_obj) == 0)) then begin
            set_global_var(GVAR_SIERRA_BASE_ALERT, 0);
            set_global_var(GVAR_SIERRA_BASE_SECURITY, 0);
            float_msg(self_obj, mstr(204), FLOAT_MSG_YELLOW);
            set_map_var(49, 0);
        end
        else begin
            if ((map_var(50) == 1) and (elevation(self_obj) == 1)) then begin
                set_global_var(GVAR_SIERRA_BASE_ALERT, 0);
                set_global_var(GVAR_SIERRA_BASE_SECURITY, 0);
                float_msg(self_obj, mstr(205), FLOAT_MSG_YELLOW);
                set_map_var(50, 0);
            end
            else begin
                if ((map_var(51) == 1) and (elevation(self_obj) == 2)) then begin
                    set_global_var(GVAR_SIERRA_BASE_ALERT, 0);
                    set_global_var(GVAR_SIERRA_BASE_SECURITY, 0);
                    float_msg(self_obj, mstr(206), FLOAT_MSG_YELLOW);
                    set_map_var(51, 0);
                end
            end
        end
    end
    else begin
        if (CUR_MAP_DEPOLVB) then begin
            if (map_var(133) == 1) then begin
                set_global_var(GVAR_SIERRA_BASE_ALERT, 0);
                set_global_var(GVAR_SIERRA_BASE_SECURITY, 0);
                float_msg(self_obj, mstr(207), FLOAT_MSG_YELLOW);
                set_map_var(133, 0);
            end
        end
    end
end

procedure Kill_The_Party
begin
    if (party_member_obj(16777278) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777278)) < 2) then begin
            critter_dmg(party_member_obj(16777278), 1000, 6);
        end
        else begin
            animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777278)), random(0, 5), 1), 1);
            set_local_var(14, 1);
            add_timer_event(self_obj, game_ticks(3), 2);
        end
    end
    else begin
        if (party_member_obj(16777376) != 0) then begin
            if (tile_distance_objs(self_obj, party_member_obj(16777376)) < 2) then begin
                critter_dmg(party_member_obj(16777376), 1000, 6);
            end
            else begin
                animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777376)), random(0, 5), 1), 1);
                set_local_var(14, 2);
                add_timer_event(self_obj, game_ticks(3), 2);
            end
        end
        else begin
            if (party_member_obj(16777313) != 0) then begin
                if (tile_distance_objs(self_obj, party_member_obj(16777313)) < 2) then begin
                    critter_dmg(party_member_obj(16777313), 1000, 6);
                end
                else begin
                    animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777313)), random(0, 5), 1), 1);
                    set_local_var(14, 3);
                    add_timer_event(self_obj, game_ticks(3), 2);
                end
            end
            else begin
                if (party_member_obj(16777323) != 0) then begin
                    if (tile_distance_objs(self_obj, party_member_obj(16777323)) < 2) then begin
                        critter_dmg(party_member_obj(16777323), 1000, 6);
                    end
                    else begin
                        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777323)), random(0, 5), 1), 1);
                        set_local_var(14, 4);
                        add_timer_event(self_obj, game_ticks(3), 2);
                    end
                end
                else begin
                    if (party_member_obj(16777305) != 0) then begin
                        if (tile_distance_objs(self_obj, party_member_obj(16777305)) < 2) then begin
                            critter_dmg(party_member_obj(16777305), 1000, 6);
                        end
                        else begin
                            animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777305)), random(0, 5), 1), 1);
                            set_local_var(14, 5);
                            add_timer_event(self_obj, game_ticks(3), 2);
                        end
                    end
                    else begin
                        if (party_member_obj(16777379) != 0) then begin
                            if (tile_distance_objs(self_obj, party_member_obj(16777379)) < 2) then begin
                                critter_dmg(party_member_obj(16777379), 1000, 6);
                            end
                            else begin
                                animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777379)), random(0, 5), 1), 1);
                                set_local_var(14, 6);
                                add_timer_event(self_obj, game_ticks(3), 2);
                            end
                        end
                        else begin
                            if (party_member_obj(16777380) != 0) then begin
                                if (tile_distance_objs(self_obj, party_member_obj(16777380)) < 2) then begin
                                    critter_dmg(party_member_obj(16777380), 1000, 6);
                                end
                                else begin
                                    animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777380)), random(0, 5), 1), 1);
                                    set_local_var(14, 7);
                                    add_timer_event(self_obj, game_ticks(3), 2);
                                end
                            end
                            else begin
                                if (party_member_obj(16777875) != 0) then begin
                                    if (tile_distance_objs(self_obj, party_member_obj(16777875)) < 2) then begin
                                        critter_dmg(party_member_obj(16777875), 1000, 6);
                                    end
                                    else begin
                                        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777875)), random(0, 5), 1), 1);
                                        set_local_var(14, 8);
                                        add_timer_event(self_obj, game_ticks(3), 2);
                                    end
                                end
                                else begin
                                    if (party_member_obj(16777876) != 0) then begin
                                        if (tile_distance_objs(self_obj, party_member_obj(16777876)) < 2) then begin
                                            critter_dmg(party_member_obj(16777876), 1000, 6);
                                        end
                                        else begin
                                            animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777876)), random(0, 5), 1), 1);
                                            set_local_var(14, 9);
                                            add_timer_event(self_obj, game_ticks(3), 2);
                                        end
                                    end
                                    else begin
                                        if (party_member_obj(16777874) != 0) then begin
                                            if (tile_distance_objs(self_obj, party_member_obj(16777874)) < 2) then begin
                                                critter_dmg(party_member_obj(16777874), 1000, 6);
                                            end
                                            else begin
                                                animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777874)), random(0, 5), 1), 1);
                                                set_local_var(14, 10);
                                                add_timer_event(self_obj, game_ticks(3), 2);
                                            end
                                        end
                                        else begin
                                            if (party_member_obj(16777801) != 0) then begin
                                                if (tile_distance_objs(self_obj, party_member_obj(16777801)) < 2) then begin
                                                    critter_dmg(party_member_obj(16777801), 1000, 6);
                                                end
                                                else begin
                                                    animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777801)), random(0, 5), 1), 1);
                                                    set_local_var(14, 11);
                                                    add_timer_event(self_obj, game_ticks(3), 2);
                                                end
                                            end
                                            else begin
                                                if (party_member_obj(16777872) != 0) then begin
                                                    if (tile_distance_objs(self_obj, party_member_obj(16777872)) < 2) then begin
                                                        critter_dmg(party_member_obj(16777872), 1000, 6);
                                                    end
                                                    else begin
                                                        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777872)), random(0, 5), 1), 1);
                                                        set_local_var(14, 12);
                                                        add_timer_event(self_obj, game_ticks(3), 2);
                                                    end
                                                end
                                                else begin
                                                    if (party_member_obj(16777859) != 0) then begin
                                                        if (tile_distance_objs(self_obj, party_member_obj(16777859)) < 2) then begin
                                                            critter_dmg(party_member_obj(16777859), 1000, 6);
                                                        end
                                                        else begin
                                                            animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(party_member_obj(16777859)), random(0, 5), 1), 1);
                                                            set_local_var(14, 13);
                                                            add_timer_event(self_obj, game_ticks(3), 2);
                                                        end
                                                    end
                                                    else begin
                                                        if (tile_distance_objs(self_obj, dude_obj) < 2) then begin
                                                            call Node015();
                                                        end
                                                        else begin
                                                            animate_move_obj_to_tile(self_obj, tile_num_in_direction(dude_tile, random(0, 5), 1), 1);
                                                            set_local_var(14, 14);
                                                            add_timer_event(self_obj, game_ticks(3), 2);
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end

procedure local_floats
begin
    if (75 >= random(1, 100)) then begin
        if (cur_town == 0) then begin
            float_msg(self_obj, mstr(502), FLOAT_MSG_YELLOW);
        end
        else begin
            if (cur_town == 1) then begin
                float_msg(self_obj, mstr(503), FLOAT_MSG_YELLOW);
            end
            else begin
                if (cur_town == 2) then begin
                    float_msg(self_obj, mstr(504), FLOAT_MSG_YELLOW);
                end
                else begin
                    if (cur_town == 3) then begin
                        float_msg(self_obj, mstr(505), FLOAT_MSG_YELLOW);
                    end
                    else begin
                        if (cur_town == 4) then begin
                            float_msg(self_obj, mstr(506), FLOAT_MSG_YELLOW);
                        end
                        else begin
                            if (cur_town == 5) then begin
                                float_msg(self_obj, mstr(507), FLOAT_MSG_YELLOW);
                            end
                            else begin
                                if (cur_town == 6) then begin
                                    float_msg(self_obj, mstr(508), FLOAT_MSG_YELLOW);
                                end
                                else begin
                                    if (cur_town == 7) then begin
                                        float_msg(self_obj, mstr(509), FLOAT_MSG_YELLOW);
                                    end
                                    else begin
                                        if (cur_town == 8) then begin
                                            float_msg(self_obj, mstr(510), FLOAT_MSG_YELLOW);
                                        end
                                        else begin
                                            if (cur_town == 9) then begin
                                                float_msg(self_obj, mstr(511), FLOAT_MSG_YELLOW);
                                            end
                                            else begin
                                                if (cur_town == 10) then begin
                                                    float_msg(self_obj, mstr(512), FLOAT_MSG_YELLOW);
                                                end
                                                else begin
                                                    if (cur_town == 11) then begin
                                                        float_msg(self_obj, mstr(513), FLOAT_MSG_YELLOW);
                                                    end
                                                    else begin
                                                        if (cur_town == 12) then begin
                                                            float_msg(self_obj, mstr(514), FLOAT_MSG_YELLOW);
                                                        end
                                                        else begin
                                                            if (cur_town == 13) then begin
                                                                float_msg(self_obj, mstr(515), FLOAT_MSG_YELLOW);
                                                            end
                                                            else begin
                                                                if (cur_town == 14) then begin
                                                                    float_msg(self_obj, mstr(516), FLOAT_MSG_YELLOW);
                                                                end
                                                                else begin
                                                                    if (cur_town == 15) then begin
                                                                        float_msg(self_obj, mstr(517), FLOAT_MSG_YELLOW);
                                                                    end
                                                                    else begin
                                                                        if (cur_town == 16) then begin
                                                                            float_msg(self_obj, mstr(518), FLOAT_MSG_YELLOW);
                                                                        end
                                                                        else begin
                                                                            if (cur_town == 34) then begin
                                                                                float_msg(self_obj, mstr(499), FLOAT_MSG_YELLOW);
                                                                            end
                                                                            else begin
                                                                                if (cur_town == 40) then begin
                                                                                    float_msg(self_obj, mstr(500), FLOAT_MSG_YELLOW);
                                                                                end
                                                                                else begin
                                                                                    if (cur_town == 49) then begin
                                                                                        float_msg(self_obj, mstr(519), FLOAT_MSG_YELLOW);
                                                                                    end
                                                                                    else begin
                                                                                        if (cur_town == 51) then begin
                                                                                            float_msg(self_obj, mstr(520), FLOAT_MSG_YELLOW);
                                                                                        end
                                                                                        else begin
                                                                                            if (cur_town == 52) then begin
                                                                                                float_msg(self_obj, mstr(521), FLOAT_MSG_YELLOW);
                                                                                            end
                                                                                            else begin
                                                                                                if (cur_town == 53) then begin
                                                                                                    float_msg(self_obj, mstr(522), FLOAT_MSG_YELLOW);
                                                                                                end
                                                                                                else begin
                                                                                                    if (cur_town == 54) then begin
                                                                                                        float_msg(self_obj, mstr(523), FLOAT_MSG_YELLOW);
                                                                                                    end
                                                                                                    else begin
                                                                                                        if (cur_town == 56) then begin
                                                                                                            float_msg(self_obj, mstr(524), FLOAT_MSG_YELLOW);
                                                                                                        end
                                                                                                        else begin
                                                                                                            if (cur_town == 58) then begin
                                                                                                                float_msg(self_obj, mstr(525), FLOAT_MSG_YELLOW);
                                                                                                            end
                                                                                                            else begin
                                                                                                                if (cur_town == 72) then begin
                                                                                                                    float_msg(self_obj, mstr(526), FLOAT_MSG_YELLOW);
                                                                                                                end
                                                                                                                else begin
                                                                                                                    if (cur_town == 73) then begin
                                                                                                                        float_msg(self_obj, mstr(527), FLOAT_MSG_YELLOW);
                                                                                                                    end
                                                                                                                    else begin
                                                                                                                        if (cur_town == 78) then begin
                                                                                                                            float_msg(self_obj, mstr(528), FLOAT_MSG_YELLOW);
                                                                                                                        end
                                                                                                                        else begin
                                                                                                                            if (cur_town == 81) then begin
                                                                                                                                float_msg(self_obj, mstr(529), FLOAT_MSG_YELLOW);
                                                                                                                            end
                                                                                                                            else begin
                                                                                                                                if (cur_town == 83) then begin
                                                                                                                                    float_msg(self_obj, mstr(530), FLOAT_MSG_YELLOW);
                                                                                                                                end
                                                                                                                                else begin
                                                                                                                                    if (cur_town == 87) then begin
                                                                                                                                        float_msg(self_obj, mstr(532), FLOAT_MSG_YELLOW);
                                                                                                                                    end
                                                                                                                                    else begin
                                                                                                                                        if (cur_town == 89) then begin
                                                                                                                                            float_msg(self_obj, mstr(533), FLOAT_MSG_YELLOW);
                                                                                                                                        end
                                                                                                                                    end
                                                                                                                                end
                                                                                                                            end
                                                                                                                        end
                                                                                                                    end
                                                                                                                end
                                                                                                            end
                                                                                                        end
                                                                                                    end
                                                                                                end
                                                                                            end
                                                                                        end
                                                                                    end
                                                                                end
                                                                            end
                                                                        end
                                                                    end
                                                                end
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end
