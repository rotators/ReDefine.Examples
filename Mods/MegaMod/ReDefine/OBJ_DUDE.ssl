variable global_temp;
variable dest_tile;
variable step_tile;
variable in_dialog;
variable forced_node;
variable restock_amt;
variable restock_obj;
variable restock_trash;
variable removed_qty;
variable restock_amt2;
variable restock_obj2;
variable removed_qty2;

procedure atoim(variable arg0, variable arg1);
procedure get_char(variable arg0, variable arg1);
procedure wordar(variable arg0, variable arg1);

variable mode;
variable cur_section_start;
variable cur_pos;
variable cur_pid;
variable cur_pcx;
variable cur_size;
variable cur_gvar;
variable cur_time;
variable cur_undo;
variable items_avail;
variable max;
variable max_undo;
variable can_batch;
variable can_undo;
variable start0;
variable start1;
variable start2;
variable start3;
variable start4;
variable start5;
variable start6;

procedure item_options_0;
procedure item_options_1;
procedure item_options_2;
procedure item_options_3;
procedure item_options_4;
procedure item_options_5;
procedure item_options_6;
procedure display_next_option(variable arg0);
procedure count_items_avail;
procedure draw_item_properties;
procedure draw_item_pcx;
procedure parse_skill_name(variable arg0);
procedure display_items_list;
procedure display_items_avail;
procedure list_next_one;
procedure list_back;
procedure display_item_options;
procedure display_batch_ok;
procedure display_undo_ok;
procedure exit_mode;
procedure items_list_mode;
procedure item_options_mode;
procedure batch_ok_mode;
procedure undo_ok_mode;
procedure batch_item(variable arg0);
procedure undo_batch(variable arg0);
procedure batch_one_item;
procedure batch_all_items;
procedure undo_one_item;
procedure undo_all_items;
procedure loop_mode;
procedure batch_init;
procedure redraw_win_dscr;
procedure redraw_win_idle;

variable last_timed_obj;
variable last_timed_param;
variable check_still_kill;
variable stored_msg;
variable stored_node;
variable top_msg;
variable var_num;

procedure ChooseFromList;
procedure CLICK_PREV;
procedure CLICK_0;
procedure CLICK_1;
procedure CLICK_2;
procedure CLICK_3;
procedure CLICK_4;
procedure CLICK_MORE;

variable floater_patch_msg;
variable hs_temp;

procedure getTimeBit;
procedure start;
procedure timed_event_p_proc;
procedure critter_p_proc;
procedure map_enter_p_proc;
procedure combat_p_proc;
procedure map_update_p_proc;
procedure is_dropping_p_proc;
procedure Check_Bess_Float;
procedure char_mods;
procedure char_mod_gender;
procedure Delete_Removed_Items(variable arg0);

variable Did_Bess_Float;

import variable prize_fighter_obj;

export variable your_slave;

variable roll_result;
variable lastmsg;
variable took_soda;
variable took_rocks;
variable gave_warning;
variable gave_warning2;
variable warning_timer;
variable rocks_timer;
variable soda_timer;
variable count;
variable stats_check;
variable did_stats_check;

procedure use_obj_on_p_proc;
procedure description_p_proc;
procedure damage_p_proc;
procedure talk_p_proc;
procedure Pamphlet;
procedure Oldletter;
procedure Oldletter2;
procedure Oldletter3;
procedure Node999;
procedure Initial_Inven;
procedure Audio;
procedure Audio2;
procedure Audio3;
procedure Tape;
procedure Tape2;
procedure Tape3;
procedure Tape4;
procedure Tape5;
procedure Tape6;
procedure Tape7;
procedure Tape8;
procedure Tape9;
procedure Tape10;
procedure Tape11;
procedure Tape12;
procedure Tape13;
procedure catpaw;
procedure catpaw2;
procedure catpaw3;
procedure catpaw4;
procedure catpaw5;
procedure catpaw6;


procedure atoim(variable arg0, variable arg1)
begin
    variable LVar2 := 0;
    variable LVar3 := 0;
    variable LVar4 := 0;
    LVar3 := arg1;
    while ((arg0 != LVar3) and (arg0 <= (LVar3 + ":")) and (arg0 >= (LVar3 + "0"))) do begin
        while (not((arg0 > (LVar3 + LVar2)) and (arg0 < (LVar3 + (LVar2 + 1))) or (arg0 == (LVar3 + LVar2))) and (LVar2 < 9)) do begin
            LVar2 := LVar2 + 1;
        end
        LVar3 := LVar3 + LVar2;
        LVar4 := (LVar4 * 10) + LVar2;
        LVar2 := 0;
    end
    return LVar4;
    return 0;
    arg0 := 0;
    arg1 := 0;
    LVar2 := 0;
    LVar3 := 0;
    LVar4 := 0;
end

procedure get_char(variable arg0, variable arg1)
begin
    if (arg0 == arg1) then begin
        return "";
    end
    if (arg0 < (arg1 + "A")) then begin
        if (arg0 < (arg1 + "1")) then begin
            if (arg0 < (arg1 + ")")) then begin
                if (arg0 < (arg1 + "%")) then begin
                    if (arg0 < (arg1 + "#")) then begin
                        if ((arg0 >= (arg1 + " ")) and (arg0 < (arg1 + "!"))) then begin
                            return " ";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "!")) and (arg0 < (arg1 + "\""))) then begin
                                return "!";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "\"")) and (arg0 < (arg1 + "#"))) then begin
                                    return "\"";
                                end
                            end
                        end
                    end
                    else begin
                        if ((arg0 >= (arg1 + "#")) and (arg0 < (arg1 + "$"))) then begin
                            return "#";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "$")) and (arg0 < (arg1 + "%"))) then begin
                                return "$";
                            end
                        end
                    end
                end
                else begin
                    if ((arg0 >= (arg1 + "%")) and (arg0 < (arg1 + "&"))) then begin
                        return "%";
                    end
                    else begin
                        if ((arg0 >= (arg1 + "&")) and (arg0 < (arg1 + "'"))) then begin
                            return "&";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "'")) and (arg0 < (arg1 + "("))) then begin
                                return "'";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "(")) and (arg0 < (arg1 + ")"))) then begin
                                    return "(";
                                end
                            end
                        end
                    end
                end
            end
            else begin
                if (arg0 < (arg1 + "-")) then begin
                    if ((arg0 >= (arg1 + ")")) and (arg0 < (arg1 + "*"))) then begin
                        return ")";
                    end
                    else begin
                        if ((arg0 >= (arg1 + "*")) and (arg0 < (arg1 + "+"))) then begin
                            return "*";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "+")) and (arg0 < (arg1 + ","))) then begin
                                return "+";
                            end
                            else begin
                                if ((arg0 >= (arg1 + ",")) and (arg0 < (arg1 + "-"))) then begin
                                    return ",";
                                end
                            end
                        end
                    end
                end
                else begin
                    if ((arg0 >= (arg1 + "-")) and (arg0 < (arg1 + "."))) then begin
                        return "-";
                    end
                    else begin
                        if ((arg0 >= (arg1 + ".")) and (arg0 < (arg1 + "/"))) then begin
                            return ".";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "/")) and (arg0 < (arg1 + "0"))) then begin
                                return "/";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "0")) and (arg0 < (arg1 + "1"))) then begin
                                    return "0";
                                end
                            end
                        end
                    end
                end
            end
        end
        else begin
            if (arg0 < (arg1 + "9")) then begin
                if (arg0 < (arg1 + "5")) then begin
                    if (arg0 < (arg1 + "3")) then begin
                        if ((arg0 >= (arg1 + "1")) and (arg0 < (arg1 + "2"))) then begin
                            return "1";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "2")) and (arg0 < (arg1 + "3"))) then begin
                                return "2";
                            end
                        end
                    end
                    else begin
                        if ((arg0 >= (arg1 + "3")) and (arg0 < (arg1 + "4"))) then begin
                            return "3";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "4")) and (arg0 < (arg1 + "5"))) then begin
                                return "4";
                            end
                        end
                    end
                end
                else begin
                    if (arg0 < (arg1 + "7")) then begin
                        if ((arg0 >= (arg1 + "5")) and (arg0 < (arg1 + "6"))) then begin
                            return "5";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "6")) and (arg0 < (arg1 + "7"))) then begin
                                return "6";
                            end
                        end
                    end
                    else begin
                        if ((arg0 >= (arg1 + "7")) and (arg0 < (arg1 + "8"))) then begin
                            return "7";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "8")) and (arg0 < (arg1 + "9"))) then begin
                                return "8";
                            end
                        end
                    end
                end
            end
            else begin
                if (arg0 < (arg1 + "=")) then begin
                    if (arg0 < (arg1 + ";")) then begin
                        if ((arg0 >= (arg1 + "9")) and (arg0 < (arg1 + ":"))) then begin
                            return "9";
                        end
                        else begin
                            if ((arg0 >= (arg1 + ":")) and (arg0 < (arg1 + ";"))) then begin
                                return ":";
                            end
                        end
                    end
                    else begin
                        if ((arg0 >= (arg1 + ";")) and (arg0 < (arg1 + "<"))) then begin
                            return ";";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "<")) and (arg0 < (arg1 + "="))) then begin
                                return "<";
                            end
                        end
                    end
                end
                else begin
                    if (arg0 < (arg1 + "?")) then begin
                        if ((arg0 >= (arg1 + "=")) and (arg0 < (arg1 + ">"))) then begin
                            return "=";
                        end
                        else begin
                            if ((arg0 >= (arg1 + ">")) and (arg0 < (arg1 + "?"))) then begin
                                return ">";
                            end
                        end
                    end
                    else begin
                        if ((arg0 >= (arg1 + "?")) and (arg0 < (arg1 + "@"))) then begin
                            return "?";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "@")) and (arg0 < (arg1 + "A"))) then begin
                                return "@";
                            end
                        end
                    end
                end
            end
        end
    end
    else begin
        if (arg0 < (arg1 + "A")) then begin
            if (arg0 < (arg1 + "Q")) then begin
                if (arg0 < (arg1 + "I")) then begin
                    if (arg0 < (arg1 + "E")) then begin
                        if (arg0 < (arg1 + "C")) then begin
                            if ((arg0 >= (arg1 + "A")) and (arg0 < (arg1 + "B"))) then begin
                                return "A";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "B")) and (arg0 < (arg1 + "C"))) then begin
                                    return "B";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "C")) and (arg0 < (arg1 + "D"))) then begin
                                return "C";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "D")) and (arg0 < (arg1 + "E"))) then begin
                                    return "D";
                                end
                            end
                        end
                    end
                    else begin
                        if (arg0 < (arg1 + "G")) then begin
                            if ((arg0 >= (arg1 + "E")) and (arg0 < (arg1 + "F"))) then begin
                                return "E";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "F")) and (arg0 < (arg1 + "G"))) then begin
                                    return "F";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "G")) and (arg0 < (arg1 + "H"))) then begin
                                return "G";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "H")) and (arg0 < (arg1 + "I"))) then begin
                                    return "H";
                                end
                            end
                        end
                    end
                end
                else begin
                    if (arg0 < (arg1 + "M")) then begin
                        if (arg0 < (arg1 + "K")) then begin
                            if ((arg0 >= (arg1 + "I")) and (arg0 < (arg1 + "J"))) then begin
                                return "I";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "J")) and (arg0 < (arg1 + "K"))) then begin
                                    return "J";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "K")) and (arg0 < (arg1 + "L"))) then begin
                                return "K";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "L")) and (arg0 < (arg1 + "M"))) then begin
                                    return "L";
                                end
                            end
                        end
                    end
                    else begin
                        if (arg0 < (arg1 + "O")) then begin
                            if ((arg0 >= (arg1 + "M")) and (arg0 < (arg1 + "N"))) then begin
                                return "M";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "N")) and (arg0 < (arg1 + "O"))) then begin
                                    return "N";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "O")) and (arg0 < (arg1 + "P"))) then begin
                                return "O";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "P")) and (arg0 < (arg1 + "Q"))) then begin
                                    return "P";
                                end
                            end
                        end
                    end
                end
            end
            else begin
                if (arg0 < (arg1 + "Y")) then begin
                    if (arg0 < (arg1 + "U")) then begin
                        if (arg0 < (arg1 + "S")) then begin
                            if ((arg0 >= (arg1 + "Q")) and (arg0 < (arg1 + "R"))) then begin
                                return "Q";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "R")) and (arg0 < (arg1 + "S"))) then begin
                                    return "R";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "S")) and (arg0 < (arg1 + "T"))) then begin
                                return "S";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "T")) and (arg0 < (arg1 + "U"))) then begin
                                    return "T";
                                end
                            end
                        end
                    end
                    else begin
                        if (arg0 < (arg1 + "W")) then begin
                            if ((arg0 >= (arg1 + "U")) and (arg0 < (arg1 + "V"))) then begin
                                return "U";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "V")) and (arg0 < (arg1 + "W"))) then begin
                                    return "V";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "W")) and (arg0 < (arg1 + "X"))) then begin
                                return "W";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "X")) and (arg0 < (arg1 + "Y"))) then begin
                                    return "X";
                                end
                            end
                        end
                    end
                end
                else begin
                    if (arg0 < (arg1 + "]")) then begin
                        if (arg0 < (arg1 + "[")) then begin
                            if ((arg0 >= (arg1 + "Y")) and (arg0 < (arg1 + "Z"))) then begin
                                return "Y";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "Z")) and (arg0 < (arg1 + "["))) then begin
                                    return "Z";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "[")) and (arg0 < (arg1 + "\\"))) then begin
                                return "[";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "\\")) and (arg0 < (arg1 + "]"))) then begin
                                    return "\\";
                                end
                            end
                        end
                    end
                    else begin
                        if (arg0 < (arg1 + "_")) then begin
                            if ((arg0 >= (arg1 + "]")) and (arg0 < (arg1 + "^"))) then begin
                                return "]";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "^")) and (arg0 < (arg1 + "_"))) then begin
                                    return "^";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "_")) and (arg0 < (arg1 + "`"))) then begin
                                return "_";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "`")) and (arg0 < (arg1 + "A"))) then begin
                                    return "`";
                                end
                            end
                        end
                    end
                end
            end
        end
        else begin
            if (arg0 < (arg1 + "Q")) then begin
                if (arg0 < (arg1 + "I")) then begin
                    if (arg0 < (arg1 + "E")) then begin
                        if (arg0 < (arg1 + "C")) then begin
                            if ((arg0 >= (arg1 + "A")) and (arg0 < (arg1 + "B"))) then begin
                                return "A";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "B")) and (arg0 < (arg1 + "C"))) then begin
                                    return "B";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "C")) and (arg0 < (arg1 + "D"))) then begin
                                return "C";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "D")) and (arg0 < (arg1 + "E"))) then begin
                                    return "D";
                                end
                            end
                        end
                    end
                    else begin
                        if (arg0 < (arg1 + "G")) then begin
                            if ((arg0 >= (arg1 + "E")) and (arg0 < (arg1 + "F"))) then begin
                                return "E";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "F")) and (arg0 < (arg1 + "G"))) then begin
                                    return "F";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "G")) and (arg0 < (arg1 + "H"))) then begin
                                return "G";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "H")) and (arg0 < (arg1 + "I"))) then begin
                                    return "H";
                                end
                            end
                        end
                    end
                end
                else begin
                    if (arg0 < (arg1 + "M")) then begin
                        if (arg0 < (arg1 + "K")) then begin
                            if ((arg0 >= (arg1 + "I")) and (arg0 < (arg1 + "J"))) then begin
                                return "I";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "J")) and (arg0 < (arg1 + "K"))) then begin
                                    return "J";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "K")) and (arg0 < (arg1 + "L"))) then begin
                                return "K";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "L")) and (arg0 < (arg1 + "M"))) then begin
                                    return "L";
                                end
                            end
                        end
                    end
                    else begin
                        if (arg0 < (arg1 + "O")) then begin
                            if ((arg0 >= (arg1 + "M")) and (arg0 < (arg1 + "N"))) then begin
                                return "M";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "N")) and (arg0 < (arg1 + "O"))) then begin
                                    return "N";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "O")) and (arg0 < (arg1 + "P"))) then begin
                                return "O";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "P")) and (arg0 < (arg1 + "Q"))) then begin
                                    return "P";
                                end
                            end
                        end
                    end
                end
            end
            else begin
                if (arg0 < (arg1 + "Y")) then begin
                    if (arg0 < (arg1 + "U")) then begin
                        if (arg0 < (arg1 + "S")) then begin
                            if ((arg0 >= (arg1 + "Q")) and (arg0 < (arg1 + "R"))) then begin
                                return "Q";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "R")) and (arg0 < (arg1 + "S"))) then begin
                                    return "R";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "S")) and (arg0 < (arg1 + "T"))) then begin
                                return "S";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "T")) and (arg0 < (arg1 + "U"))) then begin
                                    return "T";
                                end
                            end
                        end
                    end
                    else begin
                        if (arg0 < (arg1 + "W")) then begin
                            if ((arg0 >= (arg1 + "U")) and (arg0 < (arg1 + "V"))) then begin
                                return "U";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "V")) and (arg0 < (arg1 + "W"))) then begin
                                    return "V";
                                end
                            end
                        end
                        else begin
                            if ((arg0 >= (arg1 + "W")) and (arg0 < (arg1 + "X"))) then begin
                                return "W";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "X")) and (arg0 < (arg1 + "Y"))) then begin
                                    return "X";
                                end
                            end
                        end
                    end
                end
                else begin
                    if (arg0 < (arg1 + "{")) then begin
                        if ((arg0 >= (arg1 + "Y")) and (arg0 < (arg1 + "Z"))) then begin
                            return "Y";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "Z")) and (arg0 < (arg1 + "{"))) then begin
                                return "Z";
                            end
                        end
                    end
                    else begin
                        if ((arg0 >= (arg1 + "{")) and (arg0 < (arg1 + "|"))) then begin
                            return "{";
                        end
                        else begin
                            if ((arg0 >= (arg1 + "|")) and (arg0 < (arg1 + "}"))) then begin
                                return "|";
                            end
                            else begin
                                if ((arg0 >= (arg1 + "}")) and (arg0 < (arg1 + "~"))) then begin
                                    return "}";
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    return "";
    return 0;
    arg0 := 0;
    arg1 := 0;
end

procedure wordar(variable arg0, variable arg1)
begin
    variable LVar2 := "";
    variable LVar3 := "";
    variable LVar4 := 0;
    for (0; LVar4 < arg1; LVar3 := LVar3 + LVar5) begin
        LVar5 := get_char(arg0, LVar3);
        if (LVar5 == "") then begin
            return "";
            continue;
        end
        if (LVar5 == "|") then begin
            LVar4 := LVar4 + 1;
        end
    end
    while (1) do begin
        LVar5 := get_char(arg0, LVar3);
        if ((LVar5 == "") or (LVar5 == "|")) then begin
            return LVar2;
        end
        else begin
            LVar2 := LVar2 + LVar5;
            LVar3 := LVar3 + LVar5;
        end
    end
    return "";
    return 0;
    arg0 := 0;
    arg1 := 0;
    LVar2 := 0;
    LVar3 := 0;
    LVar4 := 0;
    LVar5 := 0;
end

procedure item_options_0
begin
    cur_section_start := start0;
    call item_options_mode();
end

procedure item_options_1
begin
    cur_section_start := start1;
    call item_options_mode();
end

procedure item_options_2
begin
    cur_section_start := start2;
    call item_options_mode();
end

procedure item_options_3
begin
    cur_section_start := start3;
    call item_options_mode();
end

procedure item_options_4
begin
    cur_section_start := start4;
    call item_options_mode();
end

procedure item_options_5
begin
    cur_section_start := start5;
    call item_options_mode();
end

procedure item_options_6
begin
    cur_section_start := start6;
    call item_options_mode();
end

procedure display_next_option(variable arg0)
begin
    if (arg0 == 0) then begin
        start0 := cur_section_start;
        sayOption(proto_data(cur_pid, 1), item_options_0);
    end
    else begin
        if (arg0 == 1) then begin
            start1 := cur_section_start;
            sayOption(proto_data(cur_pid, 1), item_options_1);
        end
        else begin
            if (arg0 == 2) then begin
                start2 := cur_section_start;
                sayOption(proto_data(cur_pid, 1), item_options_2);
            end
            else begin
                if (arg0 == 3) then begin
                    start3 := cur_section_start;
                    sayOption(proto_data(cur_pid, 1), item_options_3);
                end
                else begin
                    if (arg0 == 4) then begin
                        start4 := cur_section_start;
                        sayOption(proto_data(cur_pid, 1), item_options_4);
                    end
                    else begin
                        if (arg0 == 5) then begin
                            start5 := cur_section_start;
                            sayOption(proto_data(cur_pid, 1), item_options_5);
                        end
                        else begin
                            if (arg0 == 6) then begin
                                start6 := cur_section_start;
                                sayOption(proto_data(cur_pid, 1), item_options_6);
                            end
                        end
                    end
                end
            end
        end
    end
    return 0;
    arg0 := 0;
end

procedure count_items_avail
begin
    variable LVar0 := 0;
    LVar0 := cur_section_start;
    cur_section_start := 500;
    items_avail := 0;
    while ((message_str(SCRIPT_TEST0, cur_section_start) != "Error") and (message_str(SCRIPT_TEST0, cur_section_start) == "[ITEM]")) do begin
        cur_gvar := atoim(message_str(SCRIPT_TEST0, cur_section_start + 4), "");
        if ((message_str(SCRIPT_TEST0, cur_section_start + 4) == "") or global_var(cur_gvar)) then begin
            items_avail := items_avail + 1;
        end
        cur_section_start := cur_section_start + 25;
    end
    cur_section_start := LVar0;
    return 0;
    LVar0 := 0;
end

procedure draw_item_properties
begin
    variable LVar0 := 7;
    variable LVar1 := 7;
    variable LVar2 := 100;
    variable LVar3 := 1;
    variable LVar4 := 1;
    variable LVar5 := 1;
    variable LVar6 := 0;
    variable LVar7 := 0;
    variable LVar8 := 0;
    variable LVar9 := 0;
    variable LVar10 := 0;
    variable LVar11 := 0;
    variable LVar12 := 0;
    variable LVar13 := 0;
    variable LVar14 := 0;
    variable LVar15 := 0;
    variable LVar16 := 0;
    variable LVar17 := 0;
    selectWin("win_dscr");
    setTextColor(0.00000, 1.00000, 0.00000);
    format(proto_data(cur_pid, 1), 25, LVar2, 250, 10, 2);
    LVar2 := LVar2 + 30;
    while ((message_str(SCRIPT_TEST0, cur_section_start + LVar0) != "[TOOLS]") and (LVar0 < 25)) do begin
        LVar0 := LVar0 + 1;
    end
    LVar0 := LVar0 + 1;
    format(message_str(SCRIPT_TEST0, 300), 25, LVar2, 250, 10, 2);
    LVar2 := LVar2 + 10;
    LVar1 := LVar0;
    while ((message_str(SCRIPT_TEST0, cur_section_start + LVar0) != "[SKILLS]") and (LVar0 < 25) and (message_str(SCRIPT_TEST0, cur_section_start + LVar0) != "Error") and (message_str(SCRIPT_TEST0, cur_section_start) == "[ITEM]")) do begin
        LVar16 := 0;
        LVar17 := 0;
        LVar15 := 0;
        while (not(LVar15)) do begin
            LVar14 := wordar(message_str(SCRIPT_TEST0, cur_section_start + LVar0), LVar16);
            if (LVar14 == "") then begin
                LVar15 := 1;
                if (LVar17 == 0) then begin
                    LVar3 := 0;
                end
            end
            else begin
                LVar6 := atoim(LVar14, "");
                if (obj_is_carrying_obj_pid(dude_obj, LVar6)) then begin
                    setTextColor(0.00000, 1.00000, 0.00000);
                    LVar17 := 1;
                end
                else begin
                    setTextColor(1.00000, 0.00000, 0.00000);
                end
                if (LVar16) then begin
                    format(message_str(SCRIPT_TEST0, 150) + proto_data(LVar6, 1), 25, LVar2, 250, 10, 0);
                end
                else begin
                    format(proto_data(LVar6, 1), 25, LVar2, 250, 10, 0);
                end
                LVar2 := LVar2 + 10;
                LVar16 := LVar16 + 1;
            end
        end
        LVar0 := LVar0 + 1;
    end
    if (LVar1 == LVar0) then begin
        setTextColor(0.00000, 1.00000, 0.00000);
        format(message_str(SCRIPT_TEST0, 303), 25, LVar2, 250, 10, 0);
        LVar2 := LVar2 + 10;
    end
    LVar0 := LVar0 + 1;
    setTextColor(0.00000, 1.00000, 0.00000);
    format(message_str(SCRIPT_TEST0, 301), 25, LVar2, 250, 10, 2);
    LVar2 := LVar2 + 10;
    LVar1 := LVar0;
    while ((message_str(SCRIPT_TEST0, cur_section_start + LVar0) != "[COMPONENTS]") and (LVar0 < 25) and (message_str(SCRIPT_TEST0, cur_section_start + LVar0) != "Error") and (message_str(SCRIPT_TEST0, cur_section_start) == "[ITEM]")) do begin
        LVar7 := parse_skill_name(message_str(SCRIPT_TEST0, cur_section_start + LVar0));
        LVar8 := atoim(message_str(SCRIPT_TEST0, cur_section_start + LVar0), message_str(SCRIPT_TEST0, 19 + LVar7) + ":");
        if (dude_skill(LVar7) >= LVar8) then begin
            setTextColor(0.00000, 1.00000, 0.00000);
        end
        else begin
            setTextColor(1.00000, 0.00000, 0.00000);
            LVar4 := 0;
        end
        format(message_str(SCRIPT_TEST0, 1 + LVar7) + ": " + LVar8, 25, LVar2, 250, 10, 0);
        LVar2 := LVar2 + 10;
        LVar0 := LVar0 + 1;
    end
    if (LVar1 == LVar0) then begin
        setTextColor(0.00000, 1.00000, 0.00000);
        format(message_str(SCRIPT_TEST0, 303), 25, LVar2, 250, 10, 0);
        LVar2 := LVar2 + 10;
    end
    LVar0 := LVar0 + 1;
    setTextColor(0.00000, 1.00000, 0.00000);
    format(message_str(SCRIPT_TEST0, 302), 25, LVar2, 250, 10, 2);
    LVar2 := LVar2 + 10;
    LVar1 := LVar0;
    max := 32767;
    while ((LVar0 < 25) and (message_str(SCRIPT_TEST0, cur_section_start + LVar0) != "Error") and (message_str(SCRIPT_TEST0, cur_section_start) == "[ITEM]")) do begin
        LVar9 := atoim(message_str(SCRIPT_TEST0, cur_section_start + LVar0), "");
        LVar10 := atoim(message_str(SCRIPT_TEST0, cur_section_start + LVar0), "" + LVar9 + ":");
        if (obj_is_carrying_obj_pid(dude_obj, LVar9) >= LVar10) then begin
            setTextColor(0.00000, 1.00000, 0.00000);
        end
        else begin
            setTextColor(1.00000, 0.00000, 0.00000);
            LVar5 := 0;
        end
        LVar11 := obj_is_carrying_obj_pid(dude_obj, LVar9) / LVar10;
        if (LVar11 < max) then begin
            max := LVar11;
        end
        format(proto_data(LVar9, 1) + ": " + LVar10, 25, LVar2, 250, 10, 0);
        LVar2 := LVar2 + 10;
        LVar0 := LVar0 + 1;
    end
    if (LVar1 == LVar0) then begin
        setTextColor(0.00000, 1.00000, 0.00000);
        format(message_str(SCRIPT_TEST0, 303), 25, LVar2, 250, 10, 0);
        LVar2 := LVar2 + 10;
    end
    if (LVar3 and LVar4 and LVar5) then begin
        can_batch := 1;
    end
    else begin
        can_batch := 0;
    end
    cur_undo := message_str(SCRIPT_TEST0, cur_section_start + 6);
    if ((cur_undo == "YES") and LVar3 and LVar4 and obj_is_carrying_obj_pid(dude_obj, cur_pid)) then begin
        can_undo := 1;
    end
    else begin
        can_undo := 0;
    end
    setTextColor(0.00000, 1.00000, 0.00000);
    format(message_str(SCRIPT_TEST0, 304), 25, LVar2, 250, 10, 2);
    LVar2 := LVar2 + 10;
    cur_time := atoim(message_str(SCRIPT_TEST0, cur_section_start + 5), "");
    LVar12 := cur_time / (60 * 10) / 60;
    LVar13 := cur_time / (60 * 10) % 60;
    format(message_str(SCRIPT_TEST0, 305) + LVar12, 25, LVar2, 250, 10, 0);
    LVar2 := LVar2 + 10;
    format(message_str(SCRIPT_TEST0, 306) + LVar13, 25, LVar2, 250, 10, 0);
    showWin;
    return 0;
    LVar0 := 0;
    LVar1 := 0;
    LVar2 := 0;
    LVar3 := 0;
    LVar4 := 0;
    LVar5 := 0;
    LVar6 := 0;
    LVar7 := 0;
    LVar8 := 0;
    LVar9 := 0;
    LVar10 := 0;
    LVar11 := 0;
    LVar12 := 0;
    LVar13 := 0;
    LVar14 := 0;
    LVar15 := 0;
    LVar16 := 0;
    LVar17 := 0;
end

procedure draw_item_pcx
begin
    variable LVar0 := 0;
    variable LVar1 := 0;
    cur_pcx := message_str(SCRIPT_TEST0, cur_section_start + 2);
    cur_size := atoim(message_str(SCRIPT_TEST0, cur_section_start + 3), "");
    LVar0 := cur_size / 1000;
    LVar1 := cur_size % 1000;
    call redraw_win_dscr();
    selectWin("win_dscr");
    displayGfx(cur_pcx, 150 - (LVar0 / 2), 55 - (LVar1 / 2), LVar0, LVar1);
    showWin;
    return 0;
    LVar0 := 0;
    LVar1 := 0;
end

procedure parse_skill_name(variable arg0)
begin
    variable LVar1 := 0;
    variable LVar2 := -1;
    while ((LVar1 < 18) and (LVar2 < 0)) do begin
        if ((arg0 > message_str(SCRIPT_TEST0, 19 + LVar1)) and (arg0 < (message_str(SCRIPT_TEST0, 19 + LVar1) + ";"))) then begin
            LVar2 := LVar1;
        end
        LVar1 := LVar1 + 1;
    end
    return LVar2;
    return 0;
    arg0 := 0;
    LVar1 := 0;
    LVar2 := 0;
end

procedure display_items_list
begin
    sayStart;
    mouseShape("pcx/st1.pcx", 0, 0);
    sayReply("r_display_list", message_str(SCRIPT_TEST0, 200));
    call display_items_avail();
    sayOption(message_str(SCRIPT_TEST0, 101), exit_mode);
    sayEnd;
end

procedure display_items_avail
begin
    variable LVar0 := 0;
    variable LVar1 := 0;
    call redraw_win_idle();
    cur_section_start := 500;
    if (cur_pos != 0) then begin
        sayOption(message_str(SCRIPT_TEST0, 106), list_back);
    end
    while (LVar1 < cur_pos) do begin
        cur_gvar := atoim(message_str(SCRIPT_TEST0, cur_section_start + 4), "");
        if ((message_str(SCRIPT_TEST0, cur_section_start + 4) == "") or global_var(cur_gvar)) then begin
            LVar1 := LVar1 + 1;
        end
        cur_section_start := cur_section_start + 25;
    end
    while ((LVar0 < 7) and (message_str(SCRIPT_TEST0, cur_section_start) != "Error") and (message_str(SCRIPT_TEST0, cur_section_start) == "[ITEM]")) do begin
        cur_pid := atoim(message_str(SCRIPT_TEST0, cur_section_start + 1), "");
        cur_gvar := atoim(message_str(SCRIPT_TEST0, cur_section_start + 4), "");
        if ((message_str(SCRIPT_TEST0, cur_section_start + 4) == "") or global_var(cur_gvar)) then begin
            call display_next_option(LVar0);
            LVar0 := LVar0 + 1;
        end
        cur_section_start := cur_section_start + 25;
    end
    if ((cur_pos + 6) < (items_avail - 1)) then begin
        sayOption(message_str(SCRIPT_TEST0, 105), list_next_one);
    end
    if (items_avail == 0) then begin
        sayOption(message_str(SCRIPT_TEST0, 107), exit_mode);
    end
    return 0;
    LVar0 := 0;
    LVar1 := 0;
end

procedure list_next_one
begin
    cur_pos := cur_pos + 7;
end

procedure list_back
begin
    cur_pos := cur_pos - 7;
end

procedure display_item_options
begin
    cur_pid := atoim(message_str(SCRIPT_TEST0, cur_section_start + 1), "");
    cur_gvar := atoim(message_str(SCRIPT_TEST0, cur_section_start + 4), "");
    max_undo := obj_is_carrying_obj_pid(dude_obj, cur_pid);
    sayStart;
    mouseShape("pcx/st1.pcx", 0, 0);
    sayReply("r_item_options", proto_data(cur_pid, 2));
    call draw_item_pcx();
    call draw_item_properties();
    if (can_batch and (max > 1)) then begin
        sayOption(message_str(SCRIPT_TEST0, 108) + message_str(SCRIPT_TEST0, 110) + max + message_str(SCRIPT_TEST0, 111), batch_all_items);
    end
    if (can_batch) then begin
        sayOption(message_str(SCRIPT_TEST0, 103), batch_one_item);
    end
    if (can_undo and (max_undo > 1)) then begin
        sayOption(message_str(SCRIPT_TEST0, 109) + message_str(SCRIPT_TEST0, 110) + max_undo + message_str(SCRIPT_TEST0, 111), undo_all_items);
    end
    if (can_undo) then begin
        sayOption(message_str(SCRIPT_TEST0, 104), undo_one_item);
    end
    sayOption(message_str(SCRIPT_TEST0, 102), items_list_mode);
    sayOption(message_str(SCRIPT_TEST0, 101), exit_mode);
    sayEnd;
end

procedure display_batch_ok
begin
    sayStart;
    mouseShape("pcx/st1.pcx", 0, 0);
    sayReply("r_batch_item", message_str(SCRIPT_TEST0, 201));
    sayOption(message_str(SCRIPT_TEST0, 100), item_options_mode);
    sayOption(message_str(SCRIPT_TEST0, 101), exit_mode);
    sayEnd;
end

procedure display_undo_ok
begin
    sayStart;
    mouseShape("pcx/st1.pcx", 0, 0);
    sayReply("r_undo_batch", message_str(SCRIPT_TEST0, 202));
    sayOption(message_str(SCRIPT_TEST0, 100), item_options_mode);
    sayOption(message_str(SCRIPT_TEST0, 101), exit_mode);
    sayEnd;
end

procedure exit_mode
begin
    mode := -1;
end

procedure items_list_mode
begin
    mode := 1;
end

procedure item_options_mode
begin
    mode := 2;
end

procedure batch_ok_mode
begin
    mode := 3;
end

procedure undo_ok_mode
begin
    mode := 4;
end

procedure batch_item(variable arg0)
begin
    variable LVar1 := 7;
    variable LVar2 := 0;
    variable LVar3 := 0;
    variable LVar4 := 0;
    variable LVar5 := 0;
    game_time_advance(cur_time * arg0);
    while ((message_str(SCRIPT_TEST0, cur_section_start + LVar1) != "[COMPONENTS]") and (LVar1 < 25)) do begin
        LVar1 := LVar1 + 1;
    end
    LVar1 := LVar1 + 1;
    while ((LVar1 < 25) and (message_str(SCRIPT_TEST0, cur_section_start + LVar1) != "Error") and (message_str(SCRIPT_TEST0, cur_section_start) == "[ITEM]")) do begin
        LVar2 := atoim(message_str(SCRIPT_TEST0, cur_section_start + LVar1), "");
        LVar3 := atoim(message_str(SCRIPT_TEST0, cur_section_start + LVar1), LVar2 + ":");
        removed_qty := obj_is_carrying_obj_pid(dude_obj, LVar2);
        if ((LVar3 * arg0) < removed_qty) then begin
            removed_qty := LVar3 * arg0;
        end
        while (removed_qty) do begin
            restock_obj := obj_carrying_pid_obj(dude_obj, LVar2);
            if (obj_type(dude_obj) == 1) then begin
                if (critter_inven_obj(dude_obj, INVEN_TYPE_WORN) == restock_obj) then begin
                    if (obj_item_subtype(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 0) then begin
                        restock_obj := critter_inven_obj(dude_obj, INVEN_TYPE_WORN);
                        debug_msg("armour pid == " + obj_pid(restock_obj));
                        rm_obj_from_inven(dude_obj, restock_obj);
                        add_obj_to_inven(dude_obj, restock_obj);
                    end
                end
                else begin
                    if ((critter_inven_obj(dude_obj, INVEN_TYPE_LEFT_HAND) == restock_obj) or (critter_inven_obj(dude_obj, INVEN_TYPE_RIGHT_HAND) == restock_obj)) then begin
                        inven_unwield(dude_obj);
                    end
                end
            end
            restock_amt := rm_mult_objs_from_inven(dude_obj, restock_obj, removed_qty);
            destroy_object(restock_obj);
            removed_qty := removed_qty - restock_amt;
            restock_obj := 0;
            restock_amt := 0;
        end
        LVar1 := LVar1 + 1;
    end
    restock_obj := create_object(cur_pid, 0, 0);
    if (obj_item_subtype(restock_obj) == 3) then begin
        if (get_weapon_ammo_pid(restock_obj) > 0) then begin
            set_weapon_ammo_count(restock_obj, 0);
        end
    end
    add_mult_objs_to_inven(dude_obj, restock_obj, arg0);
    LVar4 := cur_time * arg0 / (60 * 10) / 60;
    LVar5 := cur_time * arg0 / (60 * 10) % 60;
    display_msg(message_str(SCRIPT_TEST0, 400) + proto_data(cur_pid, 1) + message_str(SCRIPT_TEST0, 402) + arg0 + message_str(SCRIPT_TEST0, 403) + LVar4 + message_str(SCRIPT_TEST0, 404) + LVar5 + message_str(SCRIPT_TEST0, 405));
    call batch_ok_mode();
    return 0;
    arg0 := 0;
    LVar1 := 0;
    LVar2 := 0;
    LVar3 := 0;
    LVar4 := 0;
    LVar5 := 0;
end

procedure undo_batch(variable arg0)
begin
    variable LVar1 := 7;
    variable LVar2 := 0;
    variable LVar3 := 0;
    variable LVar4 := 0;
    variable LVar5 := 0;
    game_time_advance(cur_time * arg0);
    while ((message_str(SCRIPT_TEST0, cur_section_start + LVar1) != "[COMPONENTS]") and (LVar1 < 25)) do begin
        LVar1 := LVar1 + 1;
    end
    LVar1 := LVar1 + 1;
    while ((LVar1 < 25) and (message_str(SCRIPT_TEST0, cur_section_start + LVar1) != "Error") and (message_str(SCRIPT_TEST0, cur_section_start) == "[ITEM]")) do begin
        LVar2 := atoim(message_str(SCRIPT_TEST0, cur_section_start + LVar1), "");
        LVar3 := atoim(message_str(SCRIPT_TEST0, cur_section_start + LVar1), LVar2 + ":");
        restock_obj := create_object(LVar2, 0, 0);
        if (obj_item_subtype(restock_obj) == 3) then begin
            if (get_weapon_ammo_pid(restock_obj) > 0) then begin
                set_weapon_ammo_count(restock_obj, 0);
            end
        end
        add_mult_objs_to_inven(dude_obj, restock_obj, LVar3 * arg0);
        LVar1 := LVar1 + 1;
    end
    removed_qty := obj_is_carrying_obj_pid(dude_obj, cur_pid);
    if (arg0 < removed_qty) then begin
        removed_qty := arg0;
    end
    while (removed_qty) do begin
        restock_obj := obj_carrying_pid_obj(dude_obj, cur_pid);
        if (obj_type(dude_obj) == 1) then begin
            if (critter_inven_obj(dude_obj, INVEN_TYPE_WORN) == restock_obj) then begin
                if (obj_item_subtype(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 0) then begin
                    restock_obj := critter_inven_obj(dude_obj, INVEN_TYPE_WORN);
                    debug_msg("armour pid == " + obj_pid(restock_obj));
                    rm_obj_from_inven(dude_obj, restock_obj);
                    add_obj_to_inven(dude_obj, restock_obj);
                end
            end
            else begin
                if ((critter_inven_obj(dude_obj, INVEN_TYPE_LEFT_HAND) == restock_obj) or (critter_inven_obj(dude_obj, INVEN_TYPE_RIGHT_HAND) == restock_obj)) then begin
                    inven_unwield(dude_obj);
                end
            end
        end
        restock_amt := rm_mult_objs_from_inven(dude_obj, restock_obj, removed_qty);
        destroy_object(restock_obj);
        removed_qty := removed_qty - restock_amt;
        restock_obj := 0;
        restock_amt := 0;
    end
    LVar4 := cur_time * arg0 / (60 * 10) / 60;
    LVar5 := cur_time * arg0 / (60 * 10) % 60;
    display_msg(message_str(SCRIPT_TEST0, 401) + proto_data(cur_pid, 1) + message_str(SCRIPT_TEST0, 402) + arg0 + message_str(SCRIPT_TEST0, 403) + LVar4 + message_str(SCRIPT_TEST0, 404) + LVar5 + message_str(SCRIPT_TEST0, 405));
    call undo_ok_mode();
    return 0;
    arg0 := 0;
    LVar1 := 0;
    LVar2 := 0;
    LVar3 := 0;
    LVar4 := 0;
    LVar5 := 0;
end

procedure batch_one_item
begin
    call batch_item(1);
end

procedure batch_all_items
begin
    call batch_item(max);
end

procedure undo_one_item
begin
    call undo_batch(1);
end

procedure undo_all_items
begin
    call undo_batch(max_undo);
end

procedure loop_mode
begin
    while (mode != -1) do begin
        if (mode == 1) then begin
            call display_items_list();
        end
        else begin
            if (mode == 2) then begin
                call display_item_options();
            end
            else begin
                if (mode == 3) then begin
                    call display_batch_ok();
                end
                else begin
                    if (mode == 4) then begin
                        call display_undo_ok();
                    end
                end
            end
        end
    end
end

procedure batch_init
begin
    mode := 1;
    cur_section_start := 500;
    cur_pos := 0;
    call count_items_avail();
    setFont(5);
    setTextColor(0.00000, 1.00000, 0.00000);
    setHighlightColor(1.00000, 1.00000, 1.00000);
    setHighlightColor(1.00000, 1.00000, 0.64000);
    sayReplyWindow(300, 1, 340, 179, "PCX/w_rep.pcx");
    sayOptionWindow(300, 180, 340, 199, "PCX/w_opt.pcx");
    sayBorder(25, 25);
    createWin("win_dscr", 1, 1, 300, 378);
    selectWin("win_dscr");
    display("PCX/w_dscr.pcx");
    showWin;
    call loop_mode();
    deleteWin("win_dscr");
end

procedure redraw_win_dscr
begin
    deleteWin("win_dscr");
    createWin("win_dscr", 1, 1, 300, 378);
    selectWin("win_dscr");
    display("PCX/w_dscr.pcx");
    showWin;
end

procedure redraw_win_idle
begin
    deleteWin("win_dscr");
    createWin("win_dscr", 1, 1, 300, 378);
    selectWin("win_dscr");
    display("PCX/w_idle.pcx");
    showWin;
end

procedure ChooseFromList
begin
    variable LVar0 := 0;
    Reply(stored_msg);
    if (message_str(SCRIPT_NEWR1, top_msg - 1) != "") then begin
        giq_option(1, NAME, message_str(SCRIPT_NEWR1, 150), CLICK_PREV, NEUTRAL_REACTION);
    end
    if (LVar0 == 0) then begin
        if (message_str(SCRIPT_NEWR1, top_msg + 0) != "") then begin
            giq_option(1, NAME, message_str(SCRIPT_NEWR1, top_msg + 0), CLICK_0, NEUTRAL_REACTION);
        end
        else begin
            LVar0 := 1;
        end
    end
    if (LVar0 == 0) then begin
        if (message_str(SCRIPT_NEWR1, top_msg + 1) != "") then begin
            giq_option(1, NAME, message_str(SCRIPT_NEWR1, top_msg + 1), CLICK_1, NEUTRAL_REACTION);
        end
        else begin
            LVar0 := 1;
        end
    end
    if (LVar0 == 0) then begin
        if (message_str(SCRIPT_NEWR1, top_msg + 2) != "") then begin
            giq_option(1, NAME, message_str(SCRIPT_NEWR1, top_msg + 2), CLICK_2, NEUTRAL_REACTION);
        end
        else begin
            LVar0 := 1;
        end
    end
    if (LVar0 == 0) then begin
        if (message_str(SCRIPT_NEWR1, top_msg + 3) != "") then begin
            giq_option(1, NAME, message_str(SCRIPT_NEWR1, top_msg + 3), CLICK_3, NEUTRAL_REACTION);
        end
        else begin
            LVar0 := 1;
        end
    end
    if (LVar0 == 0) then begin
        if (message_str(SCRIPT_NEWR1, top_msg + 4) != "") then begin
            giq_option(1, NAME, message_str(SCRIPT_NEWR1, top_msg + 4), CLICK_4, NEUTRAL_REACTION);
        end
        else begin
            LVar0 := 1;
        end
    end
    if (LVar0 == 0) then begin
        if (message_str(SCRIPT_NEWR1, top_msg + 5) != "") then begin
            giq_option(1, NAME, message_str(SCRIPT_NEWR1, 151), CLICK_MORE, NEUTRAL_REACTION);
        end
    end
    return 0;
    LVar0 := 0;
end

procedure CLICK_PREV
begin
    top_msg := top_msg - 5;
    call ChooseFromList();
end

procedure CLICK_0
begin
    set_global_var(var_num, (global_var(var_num) / 100 * 100) + (top_msg % 100));
    call stored_node();
end

procedure CLICK_1
begin
    set_global_var(var_num, (global_var(var_num) / 100 * 100) + ((top_msg + 1) % 100));
    call stored_node();
end

procedure CLICK_2
begin
    set_global_var(var_num, (global_var(var_num) / 100 * 100) + ((top_msg + 2) % 100));
    call stored_node();
end

procedure CLICK_3
begin
    set_global_var(var_num, (global_var(var_num) / 100 * 100) + ((top_msg + 3) % 100));
    call stored_node();
end

procedure CLICK_4
begin
    set_global_var(var_num, (global_var(var_num) / 100 * 100) + ((top_msg + 4) % 100));
    call stored_node();
end

procedure CLICK_MORE
begin
    top_msg := top_msg + 5;
    call ChooseFromList();
end

procedure getTimeBit
begin
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    if ((LVar0 >= 100) and (LVar0 <= 159)) then begin
        return 1;
    end
    if ((LVar0 >= 200) and (LVar0 <= 259)) then begin
        return 2;
    end
    if ((LVar0 >= 300) and (LVar0 <= 359)) then begin
        return 4;
    end
    if ((LVar0 >= 400) and (LVar0 <= 459)) then begin
        return 8;
    end
    if ((LVar0 >= 500) and (LVar0 <= 559)) then begin
        return 16;
    end
    if ((LVar0 >= 600) and (LVar0 <= 659)) then begin
        return 32;
    end
    if ((LVar0 >= 700) and (LVar0 <= 759)) then begin
        return 64;
    end
    if ((LVar0 >= 800) and (LVar0 <= 859)) then begin
        return 128;
    end
    if ((LVar0 >= 900) and (LVar0 <= 959)) then begin
        return 256;
    end
    if ((LVar0 >= 1000) and (LVar0 <= 1059)) then begin
        return 512;
    end
    if ((LVar0 >= 1100) and (LVar0 <= 1159)) then begin
        return 1024;
    end
    if ((LVar0 >= 1200) and (LVar0 <= 1259)) then begin
        return 2048;
    end
    if ((LVar0 >= 1300) and (LVar0 <= 1359)) then begin
        return 4096;
    end
    if ((LVar0 >= 1400) and (LVar0 <= 1459)) then begin
        return 8192;
    end
    if ((LVar0 >= 1500) and (LVar0 <= 1559)) then begin
        return 16384;
    end
    if ((LVar0 >= 1600) and (LVar0 <= 1659)) then begin
        return 32768;
    end
    if ((LVar0 >= 1700) and (LVar0 <= 1759)) then begin
        return 65536;
    end
    if ((LVar0 >= 1800) and (LVar0 <= 1859)) then begin
        return 131072;
    end
    if ((LVar0 >= 1900) and (LVar0 <= 1959)) then begin
        return 262144;
    end
    if ((LVar0 >= 2000) and (LVar0 <= 2059)) then begin
        return 524288;
    end
    if ((LVar0 >= 2100) and (LVar0 <= 2159)) then begin
        return 1048576;
    end
    if ((LVar0 >= 2200) and (LVar0 <= 2259)) then begin
        return 2097152;
    end
    if ((LVar0 >= 2300) and (LVar0 <= 2359)) then begin
        return 4194304;
    end
    if ((LVar0 >= 0) and (LVar0 <= 100)) then begin
        return 8388608;
    end
    return 0;
    LVar0 := 0;
end

procedure start
begin
    if (local_var(0) == 0) then begin
        set_local_var(0, game_time);
        set_global_var(GVAR_BUST_SKEEVE, global_var(GVAR_BUST_SKEEVE) + 75);
        if (global_var(GVAR_BUST_SKEEVE) < 0) then begin
            set_global_var(GVAR_BUST_SKEEVE, 0);
        end
        else begin
            if (global_var(GVAR_BUST_SKEEVE) > (100 + (2 * (dude_endurance - 10)))) then begin
                set_global_var(GVAR_BUST_SKEEVE, 100 + (2 * (dude_endurance - 10)));
            end
        end
    end
    if (script_action == timed_event_proc) then begin
        if (fixed_param == 1) then begin
            float_msg(self_obj, message_str(SCRIPT_SCOUTF, 400), FLOAT_MSG_WARNING);
            add_timer_event(dude_obj, game_ticks(4), 3);
        end
        else begin
            if (fixed_param == 2) then begin
                float_msg(self_obj, message_str(SCRIPT_SCOUTF, 402), FLOAT_MSG_WARNING);
                add_timer_event(dude_obj, game_ticks(4), 3);
            end
        end
    end
end

procedure timed_event_p_proc
begin
    if (fixed_param == 1) then begin
        critter_damage(self_obj, 400);
        display_msg(g_mstr(400));
    end
    else begin
        if (fixed_param == 2) then begin
            if ((global_var(GVAR_NCR_V15_DARION_DEAL) == 3) and global_var(GVAR_NCR_V15_DARION_DEAD)) then begin
                move_to(dude_obj, dude_tile, 1);
                fade_in;
            end
        end
        else begin
            if (fixed_param == 3) then begin
                if (not(Check_Bess_Float())) then begin
                    add_timer_event(dude_obj, 1, 3);
                end
            end
            else begin
                if (fixed_param == 4) then begin
                    set_global_var(GVAR_DUDE_START_SEQ_1, game_time + (7 * (24 * (60 * (60 * 10))) * 2));
                end
                else begin
                    if (fixed_param == 5) then begin
                        if (global_var(GVAR_ADDICT_TRAGIC) == 1) then begin
                            set_global_var(GVAR_ADDICT_TRAGIC, 0);
                        end
                    end
                    else begin
                        if (fixed_param == 6) then begin
                            script_overrides;
                            reg_anim_func(2, self_obj);
                            reg_anim_func(1, 1);
                            reg_anim_animate(self_obj, 2, -1);
                            reg_anim_play_sfx(self_obj, "zippo", 10);
                            reg_anim_func(3, 0);
                        end
                        else begin
                            if (fixed_param == 7) then begin
                                script_overrides;
                                reg_anim_func(2, self_obj);
                                reg_anim_func(1, 1);
                                reg_anim_animate(self_obj, 5, -1);
                                reg_anim_play_sfx(self_obj, "powr", 6);
                                reg_anim_animate(self_obj, 2, -1);
                                reg_anim_play_sfx(self_obj, "zippo", 9);
                                reg_anim_animate_reverse(self_obj, 5, -1);
                                reg_anim_play_sfx(self_obj, "powrb", 8);
                                reg_anim_func(3, 0);
                            end
                            else begin
                                if (fixed_param == 8) then begin
                                    if (count == 3) then begin
                                        float_msg(dude_obj, message_str(SCRIPT_AITEM6, 412), FLOAT_MSG_GREEN);
                                    end
                                    else begin
                                        if (count == 4) then begin
                                            float_msg(dude_obj, message_str(SCRIPT_AITEM6, 413), FLOAT_MSG_GREEN);
                                            script_overrides;
                                            reg_anim_func(2, dude_obj);
                                            reg_anim_func(1, 1);
                                            reg_anim_animate_reverse(dude_obj, 37, -1);
                                            reg_anim_animate(dude_obj, 48, -1);
                                            reg_anim_func(3, 0);
                                        end
                                        else begin
                                            if (count == 5) then begin
                                                display_msg(message_str(SCRIPT_AITEM6, 414));
                                                float_msg(dude_obj, message_str(SCRIPT_AITEM6, 415), FLOAT_MSG_GREEN);
                                            end
                                            else begin
                                                if (count == 6) then begin
                                                    float_msg(dude_obj, message_str(SCRIPT_AITEM6, 416), FLOAT_MSG_GREEN);
                                                end
                                                else begin
                                                    if (count == 7) then begin
                                                        script_overrides;
                                                        reg_anim_func(2, dude_obj);
                                                        reg_anim_func(1, 1);
                                                        reg_anim_animate(dude_obj, 37, -1);
                                                        reg_anim_func(3, 0);
                                                    end
                                                    else begin
                                                        if (count == 8) then begin
                                                            float_msg(dude_obj, message_str(SCRIPT_AITEM6, 417), FLOAT_MSG_GREEN);
                                                        end
                                                        else begin
                                                            if (count == 9) then begin
                                                                float_msg(dude_obj, message_str(SCRIPT_AITEM6, 418), FLOAT_MSG_RED);
                                                                display_msg(message_str(SCRIPT_AITEM6, 419));
                                                                script_overrides;
                                                                reg_anim_func(2, dude_obj);
                                                                reg_anim_func(1, 1);
                                                                reg_anim_animate(dude_obj, 21, -1);
                                                                reg_anim_func(3, 0);
                                                            end
                                                            else begin
                                                                if (count == 10) then begin
                                                                    script_overrides;
                                                                    reg_anim_func(2, dude_obj);
                                                                    reg_anim_func(1, 1);
                                                                    reg_anim_animate(dude_obj, 37, -1);
                                                                    reg_anim_func(3, 0);
                                                                    gfade_out(600);
                                                                    display_msg(message_str(SCRIPT_AITEM6, 420));
                                                                    game_time_advance((13 - dude_endurance) * (60 * (60 * 10)));
                                                                    gfade_in(600);
                                                                end
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                    count := count + 1;
                                    if (count > 10) then begin
                                        count := 0;
                                        game_ui_enable;
                                    end
                                    else begin
                                        add_timer_event(self_obj, game_ticks(4), 8);
                                    end
                                end
                                else begin
                                    if (fixed_param == 91) then begin
                                        critter_dmg(self_obj, 1000, DMG_plasma);
                                    end
                                    else begin
                                        if (fixed_param == 92) then begin
                                            call talk_p_proc();
                                        end
                                        else begin
                                            if (fixed_param == 93) then begin
                                                float_msg(self_obj, message_str(SCRIPT_MCGARETH, 140), FLOAT_MSG_YELLOW);
                                                set_global_var(GVAR_RESERVED, 2);
                                                set_global_var(GVAR_LAST_BATTLE_BEGIN, 0);
                                                critter_dmg(self_obj, 40, DMG_plasma);
                                            end
                                            else begin
                                                if (fixed_param == 132) then begin
                                                    restock_obj := obj_carrying_pid_obj(dude_obj, 124);
                                                    use_obj_on_obj(restock_obj, dude_obj);
                                                    rm_fixed_timer_event(self_obj, 132);
                                                end
                                                else begin
                                                    if (fixed_param == 133) then begin
                                                        restock_obj := obj_carrying_pid_obj(dude_obj, 125);
                                                        use_obj_on_obj(restock_obj, dude_obj);
                                                        rm_fixed_timer_event(self_obj, 133);
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end

procedure critter_p_proc
begin
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    variable LVar3 := 0;
    variable LVar4 := 0;
    variable LVar5 := 0;
    variable LVar6 := 0;
    if (obj_is_carrying_obj_pid(dude_obj, 542) > 0) then begin
        if (global_var(GVAR_AHELDER_Q1_AGRO) == 20) then begin
            LVar6 := obj_carrying_pid_obj(dude_obj, 542);
            rm_obj_from_inven(dude_obj, LVar6);
            call Delete_Removed_Items(542);
        end
    end
    if (global_var(GVAR_DUDE_START_SEQ_1) != 0) then begin
        if ((game_time > global_var(GVAR_DUDE_START_SEQ_1)) and not((global_var(GVAR_V13_STATUS_FLAGS) bwand 2) != 0) and (cur_map_index != MAP_VAULT13)) then begin
            set_global_var(GVAR_VIGNETTE_SEQUENCE, global_var(GVAR_VIGNETTE_SEQUENCE) bwor 1);
            set_global_var(GVAR_DUDE_START_SEQ_1, 0);
        end
    end
    if (global_var(GVAR_ADDICT_TRAGIC) == 1) then begin
        if (local_var(6) == 0) then begin
            set_local_var(6, 1);
            add_timer_event(dude_obj, (7 * (24 * (60 * (60 * 10)))) - 10, 5);
        end
    end
    if (obj_is_carrying_obj_pid(dude_obj, 562) == 1) then begin
        if (global_var(GVAR_LIBERATE_SALVATOREGUNS) == 1) then begin
            float_msg(self_obj, message_str(SCRIPT_MCGARETH, 135), FLOAT_MSG_LIGHT_GREY);
            set_global_var(GVAR_LIBERATE_SALVATOREGUNS, 2);
        end
    end
    if ((obj_is_carrying_obj_pid(dude_obj, 941) >= 1) and (obj_is_carrying_obj_pid(dude_obj, 948) >= 1)) then begin
        LVar5 := obj_carrying_pid_obj(dude_obj, 941);
        rm_obj_from_inven(dude_obj, LVar5);
        call Delete_Removed_Items(941);
    end
    if (obj_is_carrying_obj_pid(dude_obj, 569) == 1) then begin
        if (has_trait(TRAIT_PERK, dude_obj, PERK_snakeater)) then begin
            if (global_var(GVAR_RESERVED) == 0) then begin
                float_msg(self_obj, message_str(SCRIPT_MCGARETH, 139), FLOAT_MSG_RED);
                add_timer_event(self_obj, 20, 93);
                set_global_var(GVAR_RESERVED, 1);
            end
        end
        else begin
            if (global_var(GVAR_RESERVED) == 0) then begin
                float_msg(self_obj, message_str(SCRIPT_MCGARETH, 136), FLOAT_MSG_RED);
                add_timer_event(self_obj, 30, 91);
                set_global_var(GVAR_RESERVED, 1);
            end
        end
    end
    if (global_var(GVAR_MIRIA_ASK2TIME) > 0) then begin
        if (((game_time - soda_timer) >= (60 * (60 * 10))) and (soda_timer != 0) or (((game_time - rocks_timer) >= (60 * (60 * 10))) and (rocks_timer != 0))) then begin
            set_global_var(GVAR_MIRIA_ASK2TIME, 0);
            soda_timer := 0;
            rocks_timer := 0;
        end
    end
    if (global_var(GVAR_MIRIA_ASK2TIME) == 1) then begin
        if (took_soda == 1) then begin
            set_global_var(GVAR_MIRIA_ASK2TIME, 3);
        end
        took_rocks := 1;
        rocks_timer := game_time;
    end
    if (global_var(GVAR_MIRIA_ASK2TIME) == 2) then begin
        if (took_rocks == 1) then begin
            set_global_var(GVAR_MIRIA_ASK2TIME, 3);
        end
        took_soda := 1;
        soda_timer := game_time;
    end
    if ((global_var(GVAR_MIRIA_ASK2TIME) == 2) or (global_var(GVAR_MIRIA_ASK2TIME) == 1) or (global_var(GVAR_MIRIA_ASK2TIME) == 0)) then begin
    end
    else begin
        if ((global_var(GVAR_MIRIA_ASK2TIME) == 3) and (gave_warning != 1)) then begin
            gave_warning := 1;
            display_msg("Something doesn't feel quite right in your stomach.");
            warning_timer := game_time + game_ticks(10);
        end
        else begin
            if ((game_time >= warning_timer) and (gave_warning2 != 1)) then begin
                gave_warning2 := 1;
                warning_timer := game_time + game_ticks(3);
                display_msg("You feel an intense pressure in your stomach.");
            end
            else begin
                if ((game_time >= warning_timer) and (gave_warning2 == 1)) then begin
                    explosion(dude_tile, dude_elevation, 999999);
                end
            end
        end
    end
    if (global_var(GVAR_BEEN_POISONED) == 0) then begin
        if (dude_skill(SKILL_SCIENCE) > 74) then begin
            set_global_var(GVAR_BEEN_POISONED, 1);
        end
        else begin
            if (get_pc_stat(PCSTAT_level) >= 10) then begin
                set_global_var(GVAR_BEEN_POISONED, 1);
            end
        end
    end
    if (global_var(GVAR_BEEN_POISONED) == 1) then begin
        if ((obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 3) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 232) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 348) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 349) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 554)) then begin
            if (global_var(GVAR_FLASHLIGHT_IS_ON) == 1) then begin
                set_global_var(GVAR_BEEN_POISONED, 2);
                display_msg(g_mstr(468));
            end
            if (global_var(GVAR_FLASHLIGHT_IS_ON) == 2) then begin
                set_global_var(GVAR_BEEN_POISONED, 2);
                display_msg(g_mstr(469));
            end
            if (global_var(GVAR_FLASHLIGHT_IS_ON) == 3) then begin
                set_global_var(GVAR_BEEN_POISONED, 2);
                display_msg(g_mstr(470));
            end
            if (dude_skill(SKILL_SCIENCE) > 74) then begin
                set_global_var(GVAR_BEEN_POISONED, 2);
                display_msg(g_mstr(464));
            end
            else begin
                if (get_pc_stat(PCSTAT_level) >= 10) then begin
                    set_global_var(GVAR_BEEN_POISONED, 2);
                    display_msg(g_mstr(465));
                end
            end
        end
    end
    return 0;
    LVar0 := 0;
    LVar1 := 0;
    LVar2 := 0;
    LVar3 := 0;
    LVar4 := 0;
    LVar5 := 0;
    LVar6 := 0;
end

procedure map_enter_p_proc
begin
    if ((global_var(GVAR_SAN_FRAN_VERTI_ELE_QST) > 1) or (global_var(GVAR_SAN_FRAN_VERTI_STEAL_SHI_QST) > 1) or (global_var(GVAR_SAN_FRAN_VERTI_SHI_QST) > 1) or (global_var(GVAR_SAN_FRAN_VERTI_STEAL_ELE_QST) > 1) or (global_var(GVAR_SAN_FRAN_BOS_QUEST) > 3) or (global_var(GVAR_BOS_TO_BH_QUEST) > 0) and has_trait(TRAIT_PERK, dude_obj, PERK_scrounger) and (global_var(GVAR_GECKOS_SKINS) == 1)) then begin
        float_msg(self_obj, message_str(SCRIPT_ACMONKM, 2700), FLOAT_MSG_RED);
        add_timer_event(self_obj, 30, 91);
    end
    tile_set_center(dude_tile);
end

procedure combat_p_proc
begin
    if (weapon_dmg_type(target_obj) == 5) then begin
        if ((obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 3) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 232) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 348) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 349) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 554)) then begin
            set_global_var(GVAR_HAS_PERMISSION_TO_OPEN_SLAVE_PEN, 1);
            display_msg(g_mstr(461));
        end
    end
    if (CUR_MAP_NEWR2) then begin
        if (prize_fighter_obj == 0) then begin
        end
        else begin
            if (fixed_param == 4) then begin
                if (global_var(GVAR_NEW_RENO_ROUND_TIME) != 0) then begin
                    if ((((global_var(GVAR_NEW_RENO_ROUND_TIME) - game_time) / 10) <= 0) and (global_var(GVAR_NEW_RENO_ROUND_TIME) != 0)) then begin
                        last_timed_obj := prize_fighter_obj;
                        last_timed_param := last_timed_param;
                        rm_fixed_timer_event(prize_fighter_obj, 42);
                        add_timer_event(prize_fighter_obj, 0, 42);
                    end
                    else begin
                        if ((critter_state(dude_obj) bwand 2) or (critter_state(prize_fighter_obj) bwand 2)) then begin
                            last_timed_obj := prize_fighter_obj;
                            last_timed_param := last_timed_param;
                            rm_fixed_timer_event(prize_fighter_obj, 41);
                            add_timer_event(prize_fighter_obj, 0, 41);
                        end
                    end
                end
            end
        end
    end
end

procedure map_update_p_proc
begin
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := (1 + has_trait(TRAIT_OBJECT, dude_obj, 0)) * (game_time - local_var(0)) / (60 * 10 * 3);
    if (LVar0 > 0) then begin
        set_global_var(GVAR_BUST_SKEEVE, global_var(GVAR_BUST_SKEEVE) + -LVar0);
        if (global_var(GVAR_BUST_SKEEVE) < 0) then begin
            set_global_var(GVAR_BUST_SKEEVE, 0);
        end
        else begin
            if (global_var(GVAR_BUST_SKEEVE) > (100 + (2 * (dude_endurance - 10)))) then begin
                set_global_var(GVAR_BUST_SKEEVE, 100 + (2 * (dude_endurance - 10)));
            end
        end
    end
    if (global_var(GVAR_HAVE_MUTATED) == 0) then begin
        if (global_var(GVAR_MUTATE_STAGE) > 0) then begin
            LVar1 := (game_time / (10 * 60 * 60 * 24)) - global_var(GVAR_MUTATE_WHEN);
            if (LVar1 > 30) then begin
                if (global_var(GVAR_MUTATE_STAGE) < 5) then begin
                    display_mstr(140);
                    set_global_var(GVAR_MUTATE_STAGE, 5);
                    set_global_var(GVAR_HAVE_MUTATED, 1);
                end
            end
            else begin
                if (LVar1 > 25) then begin
                    if (global_var(GVAR_MUTATE_STAGE) < 4) then begin
                        display_mstr(130);
                        set_global_var(GVAR_MUTATE_STAGE, 4);
                    end
                end
                else begin
                    if (LVar1 > 20) then begin
                        if (global_var(GVAR_MUTATE_STAGE) < 3) then begin
                            display_mstr(120);
                            set_global_var(GVAR_MUTATE_STAGE, 3);
                        end
                    end
                    else begin
                        if (LVar1 > 15) then begin
                            if (global_var(GVAR_MUTATE_STAGE) < 2) then begin
                                display_mstr(110);
                                set_global_var(GVAR_MUTATE_STAGE, 2);
                            end
                        end
                    end
                end
            end
        end
    end
    if (self_obj) then begin
        if (obj_carrying_pid_obj(self_obj, 366) and not(global_var(GVAR_GAVE_GECK_EXP))) then begin
            set_global_var(GVAR_GAVE_GECK_EXP, 1);
            display_msg(mstr(150) + 4000 + mstr(151));
            give_exp_points(4000);
        end
    end
    return 0;
    LVar0 := 0;
    LVar1 := 0;
end

procedure is_dropping_p_proc
begin
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    if (obj_pid(source_obj) == 366) then begin
        script_overrides;
        display_msg(g_mstr(1099));
    end
    if (obj_pid(source_obj) == 556) then begin
        script_overrides;
        display_msg(g_mstr(20000));
        set_global_var(GVAR_ELDRIDGE_TASK, global_var(GVAR_ELDRIDGE_TASK) + -1);
        critter_rm_trait(dude_obj, TRAIT_PERK, PERK_pack_rat_perk, 1);
        critter_rm_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
        LVar2 := obj_carrying_pid_obj(dude_obj, 556);
        rm_obj_from_inven(dude_obj, LVar2);
        call Delete_Removed_Items(556);
        if ((global_var(GVAR_ELDRIDGE_TASK) == 2) or (global_var(GVAR_ELDRIDGE_TASK) == 3)) then begin
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_pack_rat_perk, 1);
        end
        if ((global_var(GVAR_ELDRIDGE_TASK) == 4) or (global_var(GVAR_ELDRIDGE_TASK) == 5)) then begin
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_pack_rat_perk, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
        end
        if ((global_var(GVAR_ELDRIDGE_TASK) == 6) or (global_var(GVAR_ELDRIDGE_TASK) == 7)) then begin
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
        end
        if (global_var(GVAR_ELDRIDGE_TASK) > 7) then begin
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_pack_rat_perk, 1);
        end
    end
    if (obj_pid(source_obj) == 557) then begin
        script_overrides;
        display_msg(g_mstr(20000));
        set_global_var(GVAR_ELDRIDGE_TASK, global_var(GVAR_ELDRIDGE_TASK) + -1);
        critter_rm_trait(dude_obj, TRAIT_PERK, PERK_pack_rat_perk, 1);
        critter_rm_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
        LVar2 := obj_carrying_pid_obj(dude_obj, 557);
        rm_obj_from_inven(dude_obj, LVar2);
        call Delete_Removed_Items(557);
        if ((global_var(GVAR_ELDRIDGE_TASK) == 2) or (global_var(GVAR_ELDRIDGE_TASK) == 3)) then begin
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_pack_rat_perk, 1);
        end
        if ((global_var(GVAR_ELDRIDGE_TASK) == 4) or (global_var(GVAR_ELDRIDGE_TASK) == 5)) then begin
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_pack_rat_perk, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
        end
        if ((global_var(GVAR_ELDRIDGE_TASK) == 6) or (global_var(GVAR_ELDRIDGE_TASK) == 7)) then begin
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
        end
        if (global_var(GVAR_ELDRIDGE_TASK) > 7) then begin
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_strong_back, 1);
            critter_add_trait(dude_obj, TRAIT_PERK, PERK_pack_rat_perk, 1);
        end
    end
    if (obj_pid(source_obj) == 571) then begin
        script_overrides;
        set_global_var(GVAR_ALLOWED_TO_SPEAK_TO_JACK, 4);
        display_msg(message_str(SCRIPT_MCTARWIN, 126));
        LVar2 := obj_carrying_pid_obj(dude_obj, 571);
        rm_obj_from_inven(dude_obj, LVar2);
        call Delete_Removed_Items(571);
    end
    return 0;
    LVar0 := 0;
    LVar1 := 0;
    LVar2 := 0;
end

procedure Check_Bess_Float
begin
    if (tile_distance(19894, dude_tile) < 10) then begin
        if (not(Did_Bess_Float)) then begin
            Did_Bess_Float := 1;
            float_msg(dude_obj, mstr(141), FLOAT_MSG_NORMAL);
        end
        return 1;
    end
    return 0;
end

procedure char_mods
begin
    if (global_var(GVAR_MIRIA_ASK1TIME) == 1) then begin
        call char_mod_gender();
    end
end

procedure char_mod_gender
begin
end

procedure Delete_Removed_Items(variable arg0)
begin
    if (tile_contains_obj_pid(1, 0, arg0)) then begin
        arg0 := tile_contains_pid_obj(1, 0, arg0);
        destroy_object(arg0);
    end
    return 0;
    arg0 := 0;
end

procedure use_obj_on_p_proc
begin
    variable LVar0 := 0;
    if (source_obj == dude_obj) then begin
        if ((obj_being_used_with == 106) or (obj_being_used_with == 124) or (obj_being_used_with == 125) or (obj_being_used_with == 126)) then begin
            set_global_var(GVAR_BUST_SKEEVE, global_var(GVAR_BUST_SKEEVE) + 5);
            if (global_var(GVAR_BUST_SKEEVE) < 0) then begin
                set_global_var(GVAR_BUST_SKEEVE, 0);
            end
            else begin
                if (global_var(GVAR_BUST_SKEEVE) > (100 + (2 * (dude_endurance - 10)))) then begin
                    set_global_var(GVAR_BUST_SKEEVE, 100 + (2 * (dude_endurance - 10)));
                end
            end
        end
        else begin
            if ((obj_being_used_with == 81) or (obj_being_used_with == 103)) then begin
                set_global_var(GVAR_BUST_SKEEVE, global_var(GVAR_BUST_SKEEVE) + 10);
                if (global_var(GVAR_BUST_SKEEVE) < 0) then begin
                    set_global_var(GVAR_BUST_SKEEVE, 0);
                end
                else begin
                    if (global_var(GVAR_BUST_SKEEVE) > (100 + (2 * (dude_endurance - 10)))) then begin
                        set_global_var(GVAR_BUST_SKEEVE, 100 + (2 * (dude_endurance - 10)));
                    end
                end
            end
            else begin
                if ((obj_being_used_with == 226) or (obj_being_used_with == 227)) then begin
                    set_global_var(GVAR_BUST_SKEEVE, global_var(GVAR_BUST_SKEEVE) + 25);
                    if (global_var(GVAR_BUST_SKEEVE) < 0) then begin
                        set_global_var(GVAR_BUST_SKEEVE, 0);
                    end
                    else begin
                        if (global_var(GVAR_BUST_SKEEVE) > (100 + (2 * (dude_endurance - 10)))) then begin
                            set_global_var(GVAR_BUST_SKEEVE, 100 + (2 * (dude_endurance - 10)));
                        end
                    end
                end
                else begin
                    if (0) then begin
                        set_global_var(GVAR_BUST_SKEEVE, global_var(GVAR_BUST_SKEEVE) + 50);
                        if (global_var(GVAR_BUST_SKEEVE) < 0) then begin
                            set_global_var(GVAR_BUST_SKEEVE, 0);
                        end
                        else begin
                            if (global_var(GVAR_BUST_SKEEVE) > (100 + (2 * (dude_endurance - 10)))) then begin
                                set_global_var(GVAR_BUST_SKEEVE, 100 + (2 * (dude_endurance - 10)));
                            end
                        end
                    end
                    else begin
                        if (0) then begin
                            set_global_var(GVAR_BUST_SKEEVE, global_var(GVAR_BUST_SKEEVE) + 75);
                            if (global_var(GVAR_BUST_SKEEVE) < 0) then begin
                                set_global_var(GVAR_BUST_SKEEVE, 0);
                            end
                            else begin
                                if (global_var(GVAR_BUST_SKEEVE) > (100 + (2 * (dude_endurance - 10)))) then begin
                                    set_global_var(GVAR_BUST_SKEEVE, 100 + (2 * (dude_endurance - 10)));
                                end
                            end
                        end
                        else begin
                            if (0) then begin
                                set_global_var(GVAR_BUST_SKEEVE, global_var(GVAR_BUST_SKEEVE) + 90);
                                if (global_var(GVAR_BUST_SKEEVE) < 0) then begin
                                    set_global_var(GVAR_BUST_SKEEVE, 0);
                                end
                                else begin
                                    if (global_var(GVAR_BUST_SKEEVE) > (100 + (2 * (dude_endurance - 10)))) then begin
                                        set_global_var(GVAR_BUST_SKEEVE, 100 + (2 * (dude_endurance - 10)));
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
        if ((obj_pid(obj_being_used_with) == 124) or (obj_pid(obj_being_used_with) == 125) or (obj_pid(obj_being_used_with) == 310) or (obj_pid(obj_being_used_with) == 662) or (obj_pid(obj_being_used_with) == 311)) then begin
            if (random(1, 100) <= 15) then begin
                display_mstr(500);
                set_critter_stat(dude_obj, STAT_pe, -2);
                if (not(is_iface_tag_active(4))) then begin
                    show_iface_tag(4);
                end
                set_global_var(GVAR_ALCOHOL_ADDICT, 1);
            end
        end
        if (obj_pid(obj_being_used_with) == 670) then begin
            script_overrides;
            rm_obj_from_inven(dude_obj, obj_being_used_with);
            call Delete_Removed_Items(670);
            set_global_var(GVAR_MIRIA_ASK2TIME, 1);
        end
        if (obj_pid(obj_being_used_with) == 106) then begin
            if (global_var(GVAR_MIRIA_ASK2TIME) > 0) then begin
                script_overrides;
                rm_obj_from_inven(dude_obj, obj_being_used_with);
                call Delete_Removed_Items(106);
            end
            set_global_var(GVAR_MIRIA_ASK2TIME, 2);
        end
        if (obj_pid(obj_being_used_with) == 757) then begin
            if (not(combat_is_initialized)) then begin
                if ((obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 3) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 232) and (obj_is_carrying_obj_pid(dude_obj, 101) > 0)) then begin
                    script_overrides;
                    if (local_var(2) == 0) then begin
                        display_msg(message_str(SCRIPT_AITEM6, 400));
                    end
                    else begin
                        display_msg(message_str(SCRIPT_AITEM6, 401));
                    end
                    add_timer_event(dude_obj, 1, 7);
                    set_local_var(2, local_var(2) + 1);
                    if ((local_var(2) % 10) == 0) then begin
                        script_overrides;
                        display_msg(message_str(SCRIPT_AITEM6, 403));
                        set_global_var(GVAR_TEST_SOLAR_SCORCHER, 1);
                        rm_obj_from_inven(dude_obj, obj_being_used_with);
                        call Delete_Removed_Items(757);
                    end
                end
                else begin
                    if ((obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 348) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 349) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 599) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 600)) then begin
                        script_overrides;
                        display_msg(message_str(SCRIPT_AITEM6, 402));
                    end
                    else begin
                        if ((dude_gender == 0) and (source_obj == dude_obj) and (obj_is_carrying_obj_pid(dude_obj, 101) > 0) and (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) != 348) and (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) != 349) and (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) != 599) and (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) != 600)) then begin
                            script_overrides;
                            if (local_var(2) == 0) then begin
                                display_msg(message_str(SCRIPT_AITEM6, 400));
                            end
                            else begin
                                display_msg(message_str(SCRIPT_AITEM6, 401));
                            end
                            add_timer_event(dude_obj, 1, 6);
                            set_local_var(2, local_var(2) + 1);
                            if ((local_var(2) % 10) == 0) then begin
                                script_overrides;
                                display_msg(message_str(SCRIPT_AITEM6, 403));
                                set_global_var(GVAR_TEST_SOLAR_SCORCHER, 1);
                                rm_obj_from_inven(dude_obj, obj_being_used_with);
                                call Delete_Removed_Items(757);
                            end
                        end
                        else begin
                            if ((dude_gender == 1) and (source_obj == dude_obj) and (obj_is_carrying_obj_pid(dude_obj, 101) > 0)) then begin
                                script_overrides;
                                display_msg(message_str(SCRIPT_AITEM6, 425));
                            end
                        end
                    end
                end
                if (obj_is_carrying_obj_pid(dude_obj, 101) == 0) then begin
                    script_overrides;
                    display_msg(message_str(SCRIPT_AITEM6, 404));
                end
            end
        end
        if (obj_pid(obj_being_used_with) == 589) then begin
            if (not(combat_is_initialized)) then begin
                if ((obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 3) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 232) and (obj_is_carrying_obj_pid(dude_obj, 101) > 0)) then begin
                    script_overrides;
                    if (local_var(2) == 0) then begin
                        display_msg(message_str(SCRIPT_AITEM6, 400));
                    end
                    else begin
                        display_msg(message_str(SCRIPT_AITEM6, 401));
                    end
                    add_timer_event(dude_obj, 1, 7);
                    set_local_var(2, local_var(2) + 1);
                    if ((local_var(2) % 10) == 0) then begin
                        script_overrides;
                        display_msg(message_str(SCRIPT_AITEM6, 403));
                        set_global_var(GVAR_TEST_SOLAR_SCORCHER, 1);
                        rm_obj_from_inven(dude_obj, obj_being_used_with);
                        call Delete_Removed_Items(589);
                    end
                end
                else begin
                    if ((obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 348) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 349) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 599) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 600) and (obj_is_carrying_obj_pid(dude_obj, 101) > 0)) then begin
                        script_overrides;
                        display_msg(message_str(SCRIPT_AITEM6, 402));
                    end
                    else begin
                        if ((dude_gender == 0) and (source_obj == dude_obj) and (obj_is_carrying_obj_pid(dude_obj, 101) > 0) and (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) != 348) and (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) != 349) and (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) != 599) and (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) != 600)) then begin
                            script_overrides;
                            if (local_var(2) == 0) then begin
                                display_msg(message_str(SCRIPT_AITEM6, 400));
                            end
                            else begin
                                display_msg(message_str(SCRIPT_AITEM6, 401));
                            end
                            add_timer_event(dude_obj, 1, 6);
                            set_local_var(2, local_var(2) + 1);
                            if ((local_var(2) % 10) == 0) then begin
                                script_overrides;
                                display_msg(message_str(SCRIPT_AITEM6, 403));
                                set_global_var(GVAR_TEST_SOLAR_SCORCHER, 1);
                                rm_obj_from_inven(dude_obj, obj_being_used_with);
                                call Delete_Removed_Items(589);
                            end
                        end
                    end
                end
                if (obj_is_carrying_obj_pid(dude_obj, 101) == 0) then begin
                    script_overrides;
                    display_msg(message_str(SCRIPT_AITEM6, 404));
                end
            end
        end
        if (obj_pid(obj_being_used_with) == 625) then begin
            if (not(combat_is_initialized)) then begin
                game_ui_disable;
                if ((obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 3) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 232) and (obj_is_carrying_obj_pid(dude_obj, 101) > 0)) then begin
                    script_overrides;
                    display_msg(message_str(SCRIPT_AITEM6, 410));
                    add_timer_event(dude_obj, 1, 7);
                end
                else begin
                    if ((obj_is_carrying_obj_pid(dude_obj, 101) > 0) and ((obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 348) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 349) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 599) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 600))) then begin
                        script_overrides;
                        display_msg(message_str(SCRIPT_AITEM6, 402));
                    end
                    else begin
                        if ((dude_gender == 0) and (source_obj == dude_obj) and (obj_is_carrying_obj_pid(dude_obj, 101) > 0) and (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) != 348) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) != 349)) then begin
                            script_overrides;
                            display_msg(message_str(SCRIPT_AITEM6, 410));
                            add_timer_event(dude_obj, 1, 6);
                        end
                    end
                end
                if (obj_is_carrying_obj_pid(dude_obj, 101) == 0) then begin
                    script_overrides;
                    display_msg(message_str(SCRIPT_AITEM6, 404));
                    game_ui_enable;
                end
                count := count + 1;
                if (count > 10) then begin
                    count := 0;
                end
                else begin
                    add_timer_event(self_obj, game_ticks(3), 8);
                end
                rm_obj_from_inven(dude_obj, obj_being_used_with);
                call Delete_Removed_Items(625);
            end
        end
        if (not(combat_is_initialized)) then begin
            if (obj_pid(obj_being_used_with) == 616) then begin
                script_overrides;
                gfade_out(10 * 2);
                set_critter_stat(dude_obj, STAT_ag, 1);
                display_msg(message_str(SCRIPT_AITEM6, 441));
                float_msg(dude_obj, message_str(SCRIPT_AITEM6, 440), FLOAT_MSG_BLUE);
                gfade_in(10 * 2);
                scr_return(1);
            end
            else begin
                if (obj_pid(obj_being_used_with) == 661) then begin
                    if (local_var(15) == 0) then begin
                        set_local_var(15, 1);
                        script_overrides;
                        gfade_out(10);
                        display_mstr(400);
                        critter_mod_skill(dude_obj, SKILL_SNEAK, 5);
                        critter_mod_skill(dude_obj, SKILL_UNARMED_COMBAT, 5);
                        gfade_in(10);
                        scr_return(1);
                    end
                end
                else begin
                    if (obj_pid(obj_being_used_with) == 331) then begin
                        script_overrides;
                        if (local_var(16) == 0) then begin
                            set_local_var(16, 1);
                            gfade_out(10);
                            critter_mod_skill(dude_obj, SKILL_ENERGY_WEAPONS, 10);
                            display_msg(message_str(SCRIPT_NICATPW5, 100));
                            gfade_in(10);
                            scr_return(1);
                        end
                    end
                    else begin
                        if (obj_pid(obj_being_used_with) == 444) then begin
                            if (local_var(17) == 0) then begin
                                set_local_var(17, 1);
                                script_overrides;
                                gfade_out(10);
                                debug_msg("  mark_on_map(" + 25 + ")");
                                mark_area_known(MARK_TYPE_TOWN, 25, MARK_STATE_KNOWN);
                                set_global_var(GVAR_NEW_RENO_FLAG_3, global_var(GVAR_NEW_RENO_FLAG_3) bwor 262144);
                                display_msg(message_str(SCRIPT_KLADWTWN, 2360));
                                gfade_in(10);
                                scr_return(1);
                            end
                        end
                        else begin
                            if (obj_pid(obj_being_used_with) == 343) then begin
                                script_overrides;
                                if (town_known(63) == MARK_STATE_UNKNOWN) then begin
                                    gfade_out(10);
                                    mark_area_known(MARK_TYPE_TOWN, 63, MARK_STATE_KNOWN);
                                    mark_area_known(MARK_TYPE_TOWN, 64, MARK_STATE_KNOWN);
                                    mark_area_known(MARK_TYPE_TOWN, 65, MARK_STATE_KNOWN);
                                    display_msg(message_str(SCRIPT_KLADWTWN, 2361));
                                    gfade_in(10);
                                    scr_return(0);
                                end
                                else begin
                                    display_msg(message_str(SCRIPT_KLADWTWN, 2362));
                                end
                            end
                            else begin
                                if (obj_pid(obj_being_used_with) == 523) then begin
                                    script_overrides;
                                    if (town_known(14) == MARK_STATE_UNKNOWN) then begin
                                        gfade_out(10);
                                        display_msg(message_str(SCRIPT_EISANMAP, 100));
                                        debug_msg("  mark_on_map(" + 14 + ")");
                                        mark_area_known(MARK_TYPE_TOWN, 14, MARK_STATE_KNOWN);
                                        gfade_in(10);
                                        scr_return(1);
                                    end
                                end
                                else begin
                                    if (obj_pid(obj_being_used_with) == 328) then begin
                                        script_overrides;
                                        if (dude_luck <= 3) then begin
                                            LVar0 := random(199, 228);
                                        end
                                        else begin
                                            if (dude_luck < 9) then begin
                                                LVar0 := random(200, 228);
                                            end
                                            else begin
                                                if (dude_luck >= 9) then begin
                                                    LVar0 := random(200, 243);
                                                end
                                            end
                                        end
                                        if (LVar0 == 232) then begin
                                            set_global_var(GVAR_8_BALL_TOILET_SECRET, 1);
                                        end
                                        else begin
                                            if (LVar0 == 233) then begin
                                                set_global_var(GVAR_8_BALL_TRASH_SECRET, 1);
                                            end
                                            else begin
                                                if (LVar0 == 243) then begin
                                                    set_global_var(GVAR_8_BALL_VAULT_TERMINAL, 1);
                                                end
                                            end
                                        end
                                        display_msg(message_str(SCRIPT_ZI8BALL, LVar0));
                                        scr_return(0);
                                    end
                                    else begin
                                        if (obj_pid(obj_being_used_with) == 458) then begin
                                            script_overrides;
                                            if (global_var(GVAR_HOLODISK_MB_OUTSIDE) != 1) then begin
                                                gfade_out(10);
                                                set_global_var(GVAR_HOLODISK_MB_OUTSIDE, 1);
                                                display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                gfade_in(10);
                                            end
                                            else begin
                                                display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                            end
                                            scr_return(0);
                                        end
                                        else begin
                                            if (obj_pid(obj_being_used_with) == 459) then begin
                                                script_overrides;
                                                if (global_var(GVAR_HOLODISK_MB_LEVEL_1) != 1) then begin
                                                    gfade_out(10);
                                                    set_global_var(GVAR_HOLODISK_MB_LEVEL_1, 1);
                                                    display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                    gfade_in(10);
                                                end
                                                else begin
                                                    display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                end
                                                scr_return(0);
                                            end
                                            else begin
                                                if (obj_pid(obj_being_used_with) == 460) then begin
                                                    script_overrides;
                                                    if (global_var(GVAR_HOLODISK_MB_LEVEL_2) != 1) then begin
                                                        gfade_out(10);
                                                        set_global_var(GVAR_HOLODISK_MB_LEVEL_2, 1);
                                                        display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                        gfade_in(10);
                                                    end
                                                    else begin
                                                        display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                    end
                                                    scr_return(0);
                                                end
                                                else begin
                                                    if (obj_pid(obj_being_used_with) == 461) then begin
                                                        script_overrides;
                                                        if (global_var(GVAR_HOLODISK_MB_LEVEL_3) != 1) then begin
                                                            gfade_out(10);
                                                            set_global_var(GVAR_HOLODISK_MB_LEVEL_3, 1);
                                                            display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                            gfade_in(10);
                                                        end
                                                        else begin
                                                            display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                        end
                                                        scr_return(0);
                                                    end
                                                    else begin
                                                        if (obj_pid(obj_being_used_with) == 462) then begin
                                                            script_overrides;
                                                            if (global_var(GVAR_HOLODISK_MB_LEVEL_4) != 1) then begin
                                                                gfade_out(10);
                                                                set_global_var(GVAR_HOLODISK_MB_LEVEL_4, 1);
                                                                display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                                gfade_in(10);
                                                            end
                                                            else begin
                                                                display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                            end
                                                            scr_return(0);
                                                        end
                                                        else begin
                                                            if (obj_pid(obj_being_used_with) == 463) then begin
                                                                script_overrides;
                                                                if (global_var(GVAR_HOLODISK_SIERRA_EVACUATION) != 1) then begin
                                                                    gfade_out(10);
                                                                    set_global_var(GVAR_HOLODISK_SIERRA_EVACUATION, 1);
                                                                    display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                                    gfade_in(10);
                                                                end
                                                                else begin
                                                                    display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                                end
                                                                scr_return(0);
                                                            end
                                                            else begin
                                                                if (obj_pid(obj_being_used_with) == 464) then begin
                                                                    script_overrides;
                                                                    if (global_var(GVAR_HOLODISK_SIERRA_EXP_LOG) != 1) then begin
                                                                        gfade_out(10);
                                                                        set_global_var(GVAR_HOLODISK_SIERRA_EXP_LOG, 1);
                                                                        display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                                        gfade_in(10);
                                                                    end
                                                                    else begin
                                                                        display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                                    end
                                                                    scr_return(0);
                                                                end
                                                                else begin
                                                                    if (obj_pid(obj_being_used_with) == 465) then begin
                                                                        script_overrides;
                                                                        if (global_var(GVAR_HOLODISK_SIERRA_MED_LOG) != 1) then begin
                                                                            gfade_out(10);
                                                                            set_global_var(GVAR_HOLODISK_SIERRA_MED_LOG, 1);
                                                                            display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                                            gfade_in(10);
                                                                        end
                                                                        else begin
                                                                            display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                                        end
                                                                        scr_return(0);
                                                                    end
                                                                    else begin
                                                                        if (obj_pid(obj_being_used_with) == 478) then begin
                                                                            script_overrides;
                                                                            if (global_var(GVAR_SIERRA_MISSION_HOLODISK) != 1) then begin
                                                                                gfade_out(10);
                                                                                set_global_var(GVAR_SIERRA_MISSION_HOLODISK, 1);
                                                                                display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                                                gfade_in(10);
                                                                            end
                                                                            else begin
                                                                                display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                                            end
                                                                            scr_return(0);
                                                                        end
                                                                        else begin
                                                                            if (obj_pid(obj_being_used_with) == 477) then begin
                                                                                script_overrides;
                                                                                if (global_var(GVAR_SIERRA_GNN_HOLODISK) != 1) then begin
                                                                                    gfade_out(10);
                                                                                    set_global_var(GVAR_SIERRA_GNN_HOLODISK, 1);
                                                                                    display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                                                    gfade_in(10);
                                                                                end
                                                                                else begin
                                                                                    display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                                                end
                                                                                scr_return(0);
                                                                            end
                                                                            else begin
                                                                                if ((obj_pid(obj_being_used_with) == 493) or (obj_pid(obj_being_used_with) == 472)) then begin
                                                                                    script_overrides;
                                                                                    if (global_var(GVAR_ELRON_HOLODISK) != 1) then begin
                                                                                        gfade_out(10);
                                                                                        set_global_var(GVAR_ELRON_HOLODISK, 1);
                                                                                        display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                                                        gfade_in(10);
                                                                                    end
                                                                                    else begin
                                                                                        display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                                                    end
                                                                                    scr_return(0);
                                                                                end
                                                                                else begin
                                                                                    if (obj_pid(obj_being_used_with) == 490) then begin
                                                                                        script_overrides;
                                                                                        if (global_var(GVAR_NCR_HISTORY_HOLO_DOWNLOAD) != 1) then begin
                                                                                            gfade_out(10);
                                                                                            set_global_var(GVAR_NCR_HISTORY_HOLO_DOWNLOAD, 1);
                                                                                            display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                                                            gfade_in(10);
                                                                                        end
                                                                                        else begin
                                                                                            display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                                                        end
                                                                                        scr_return(0);
                                                                                    end
                                                                                    else begin
                                                                                        if (obj_pid(obj_being_used_with) == 921) then begin
                                                                                            script_overrides;
                                                                                            if (local_var(8) == 0) then begin
                                                                                                set_local_var(8, 1);
                                                                                                display_msg(message_str(SCRIPT_MISCTEXT, 104));
                                                                                                critter_mod_skill(dude_obj, SKILL_GAMBLING, 10);
                                                                                            end
                                                                                            else begin
                                                                                                display_msg(message_str(SCRIPT_MISCTEXT, 105));
                                                                                            end
                                                                                        end
                                                                                        else begin
                                                                                            if (obj_pid(obj_being_used_with) == 673) then begin
                                                                                                script_overrides;
                                                                                                if (global_var(GVAR_FAMILIAR_WITH_MODOC_WELL) != 1) then begin
                                                                                                    gfade_out(10);
                                                                                                    set_global_var(GVAR_FAMILIAR_WITH_MODOC_WELL, 1);
                                                                                                    display_msg(message_str(SCRIPT_MISCTEXT, 102));
                                                                                                    gfade_in(10);
                                                                                                end
                                                                                                else begin
                                                                                                    display_msg(message_str(SCRIPT_MISCTEXT, 101));
                                                                                                end
                                                                                                scr_return(0);
                                                                                            end
                                                                                            else begin
                                                                                                if (obj_pid(obj_being_used_with) == 583) then begin
                                                                                                    script_overrides;
                                                                                                    if (global_var(GVAR_IN_TROUBLE_WITH_MARIA) == 0) then begin
                                                                                                        set_global_var(GVAR_IN_TROUBLE_WITH_MARIA, 1);
                                                                                                        display_msg(message_str(SCRIPT_KLADWTWN, 2350));
                                                                                                    end
                                                                                                    else begin
                                                                                                        display_msg(message_str(SCRIPT_KLADWTWN, 2351));
                                                                                                    end
                                                                                                end
                                                                                                else begin
                                                                                                    if (obj_pid(obj_being_used_with) == 624) then begin
                                                                                                        script_overrides;
                                                                                                        set_local_var(10, 1);
                                                                                                        tap_key(1);
                                                                                                        add_timer_event(self_obj, 4, 92);
                                                                                                    end
                                                                                                    else begin
                                                                                                        if (obj_pid(obj_being_used_with) == 909) then begin
                                                                                                            script_overrides;
                                                                                                            set_local_var(11, 1);
                                                                                                            tap_key(1);
                                                                                                            add_timer_event(self_obj, 4, 92);
                                                                                                        end
                                                                                                        else begin
                                                                                                            if (obj_pid(obj_being_used_with) == 758) then begin
                                                                                                                script_overrides;
                                                                                                                if (global_var(GVAR_HOLODISK_ENCLAVE_VERTIBIRD) != 1) then begin
                                                                                                                    roll_result := roll_vs_skill(dude_obj, 13, -20);
                                                                                                                    if (is_success(roll_result)) then begin
                                                                                                                        set_global_var(GVAR_HOLODISK_ENCLAVE_VERTIBIRD, 1);
                                                                                                                        display_msg(message_str(SCRIPT_KLADWTWN, 2358));
                                                                                                                    end
                                                                                                                    else begin
                                                                                                                        display_msg(message_str(SCRIPT_KLADWTWN, 2357));
                                                                                                                    end
                                                                                                                end
                                                                                                                else begin
                                                                                                                    display_msg(message_str(SCRIPT_KLADWTWN, 2359));
                                                                                                                end
                                                                                                            end
                                                                                                            else begin
                                                                                                                if (obj_pid(obj_being_used_with) == 553) then begin
                                                                                                                    script_overrides;
                                                                                                                    if (town_known(8) == MARK_STATE_UNKNOWN) then begin
                                                                                                                        gfade_out(10);
                                                                                                                        display_msg(message_str(SCRIPT_KLADWTWN, 2363));
                                                                                                                        debug_msg("  mark_on_map(" + 8 + ")");
                                                                                                                        mark_area_known(MARK_TYPE_TOWN, 8, MARK_STATE_KNOWN);
                                                                                                                        gfade_in(10);
                                                                                                                        scr_return(1);
                                                                                                                    end
                                                                                                                    else begin
                                                                                                                        display_msg(message_str(SCRIPT_KLADWTWN, 2364));
                                                                                                                    end
                                                                                                                end
                                                                                                                else begin
                                                                                                                    if (obj_pid(obj_being_used_with) == 565) then begin
                                                                                                                        script_overrides;
                                                                                                                        call Initial_Inven();
                                                                                                                    end
                                                                                                                    else begin
                                                                                                                        if (obj_pid(obj_being_used_with) == 941) then begin
                                                                                                                            script_overrides;
                                                                                                                            set_local_var(12, 1);
                                                                                                                            tap_key(1);
                                                                                                                            add_timer_event(self_obj, 4, 92);
                                                                                                                        end
                                                                                                                        else begin
                                                                                                                            if (obj_pid(obj_being_used_with) == 940) then begin
                                                                                                                                script_overrides;
                                                                                                                                set_local_var(13, 1);
                                                                                                                                tap_key(1);
                                                                                                                                add_timer_event(self_obj, 4, 92);
                                                                                                                            end
                                                                                                                            else begin
                                                                                                                                if (obj_pid(obj_being_used_with) == 913) then begin
                                                                                                                                    script_overrides;
                                                                                                                                    set_local_var(14, 1);
                                                                                                                                    tap_key(1);
                                                                                                                                    add_timer_event(self_obj, 4, 92);
                                                                                                                                end
                                                                                                                                else begin
                                                                                                                                    if (obj_pid(obj_being_used_with) == 228) then begin
                                                                                                                                        script_overrides;
                                                                                                                                        if (local_var(18) == 0) then begin
                                                                                                                                            set_local_var(18, 1);
                                                                                                                                            set_global_var(GVAR_BEEN_POISONED, 1);
                                                                                                                                            set_global_var(GVAR_FLASHLIGHT_IS_ON, 3);
                                                                                                                                            game_time_advance(60 * 10 * 10);
                                                                                                                                            display_msg(g_mstr(463));
                                                                                                                                        end
                                                                                                                                        else begin
                                                                                                                                            display_msg(g_mstr(467));
                                                                                                                                        end
                                                                                                                                    end
                                                                                                                                end
                                                                                                                            end
                                                                                                                        end
                                                                                                                    end
                                                                                                                end
                                                                                                            end
                                                                                                        end
                                                                                                    end
                                                                                                end
                                                                                            end
                                                                                        end
                                                                                    end
                                                                                end
                                                                            end
                                                                        end
                                                                    end
                                                                end
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    return 0;
    LVar0 := 0;
end

procedure description_p_proc
begin
    if (not(combat_is_initialized)) then begin
        script_overrides;
        call batch_init();
    end
end

procedure damage_p_proc
begin
    if (weapon_dmg_type(target_obj) == 5) then begin
        if ((obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 3) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 232) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 348) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 349) or (obj_pid(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 554)) then begin
            set_global_var(GVAR_HAS_PERMISSION_TO_OPEN_SLAVE_PEN, 1);
            display_msg(g_mstr(461));
        end
    end
end

procedure talk_p_proc
begin
    if (local_var(10) == 1) then begin
        start_gdialog(219, self_obj, 4, -1, -1);
        gsay_start;
        call Pamphlet();
        gsay_end;
        end_dialogue;
    end
    else begin
        if (local_var(11) == 1) then begin
            start_gdialog(219, self_obj, 4, -1, -1);
            gsay_start;
            call Oldletter();
            gsay_end;
            end_dialogue;
        end
        else begin
            if (local_var(12) == 1) then begin
                start_gdialog(219, self_obj, 4, -1, -1);
                gsay_start;
                call Audio();
                gsay_end;
                end_dialogue;
            end
            else begin
                if (local_var(13) == 1) then begin
                    start_gdialog(219, self_obj, 4, -1, -1);
                    gsay_start;
                    call Tape();
                    gsay_end;
                    end_dialogue;
                end
                else begin
                    if (local_var(14) == 1) then begin
                        start_gdialog(219, self_obj, 4, -1, -1);
                        gsay_start;
                        call catpaw();
                        gsay_end;
                        end_dialogue;
                    end
                end
            end
        end
    end
end

procedure Pamphlet
begin
    set_local_var(10, 0);
    gsay_reply(SCRIPT_KLADWTWN, 2353);
    giq_option(4, SCRIPT_KLADWTWN, 2354, Node999, NEUTRAL_REACTION);
end

procedure Oldletter
begin
    set_local_var(11, 0);
    if (dude_iq > 2) then begin
        gsay_reply(SCRIPT_KLADWTWN, 5850);
    end
    else begin
        gsay_reply(SCRIPT_KLADWTWN, 5856);
    end
    giq_option(3, SCRIPT_KLADWTWN, 5853, Oldletter2, NEUTRAL_REACTION);
    giq_option(-2, SCRIPT_KLADWTWN, 5855, Node999, NEUTRAL_REACTION);
end

procedure Oldletter2
begin
    gsay_reply(SCRIPT_KLADWTWN, 5851);
    giq_option(3, SCRIPT_KLADWTWN, 5853, Oldletter3, NEUTRAL_REACTION);
end

procedure Oldletter3
begin
    gsay_reply(SCRIPT_KLADWTWN, 5852);
    giq_option(3, SCRIPT_KLADWTWN, 5854, Node999, NEUTRAL_REACTION);
end

procedure Node999
begin
end

procedure Initial_Inven
begin
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    variable LVar3 := 0;
    LVar0 := create_object(911, 0, 0);
    LVar1 := create_object(912, 0, 0);
    LVar2 := random(1, 10);
    LVar3 := dude_luck + LVar2;
    if ((obj_is_carrying_obj_pid(dude_obj, 910) >= 1) and (LVar3 >= 13)) then begin
        display_msg(message_str(SCRIPT_AICRSHDR, 4121));
        removed_qty := obj_is_carrying_obj_pid(dude_obj, 910);
        if (1 < removed_qty) then begin
            removed_qty := 1;
        end
        if (removed_qty > 0) then begin
            restock_obj := obj_carrying_pid_obj(dude_obj, 910);
            if (obj_type(self_obj) == 1) then begin
                restock_obj := obj_carrying_pid_obj(dude_obj, 910);
                if (critter_inven_obj(self_obj, INVEN_TYPE_WORN) == restock_obj) then begin
                    if (obj_item_subtype(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 0) then begin
                        restock_obj := critter_inven_obj(dude_obj, INVEN_TYPE_WORN);
                        debug_msg("armour pid == " + obj_pid(restock_obj));
                        rm_obj_from_inven(dude_obj, restock_obj);
                        add_obj_to_inven(dude_obj, restock_obj);
                    end
                end
                else begin
                    if ((critter_inven_obj(dude_obj, INVEN_TYPE_LEFT_HAND) == restock_obj) or (critter_inven_obj(dude_obj, INVEN_TYPE_RIGHT_HAND) == restock_obj)) then begin
                        inven_unwield(dude_obj);
                    end
                end
            end
            restock_amt := rm_mult_objs_from_inven(dude_obj, restock_obj, removed_qty);
            destroy_object(restock_obj);
        end
        restock_obj := 0;
        restock_amt := 0;
        add_obj_to_inven(dude_obj, LVar1);
    end
    else begin
        if (obj_is_carrying_obj_pid(dude_obj, 910) >= 1) then begin
            display_msg(message_str(SCRIPT_AICRSHDR, 4120));
            removed_qty := obj_is_carrying_obj_pid(dude_obj, 910);
            if (1 < removed_qty) then begin
                removed_qty := 1;
            end
            if (removed_qty > 0) then begin
                restock_obj := obj_carrying_pid_obj(dude_obj, 910);
                if (obj_type(self_obj) == 1) then begin
                    restock_obj := obj_carrying_pid_obj(dude_obj, 910);
                    if (critter_inven_obj(self_obj, INVEN_TYPE_WORN) == restock_obj) then begin
                        if (obj_item_subtype(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 0) then begin
                            restock_obj := critter_inven_obj(dude_obj, INVEN_TYPE_WORN);
                            debug_msg("armour pid == " + obj_pid(restock_obj));
                            rm_obj_from_inven(dude_obj, restock_obj);
                            add_obj_to_inven(dude_obj, restock_obj);
                        end
                    end
                    else begin
                        if ((critter_inven_obj(dude_obj, INVEN_TYPE_LEFT_HAND) == restock_obj) or (critter_inven_obj(dude_obj, INVEN_TYPE_RIGHT_HAND) == restock_obj)) then begin
                            inven_unwield(dude_obj);
                        end
                    end
                end
                restock_amt := rm_mult_objs_from_inven(dude_obj, restock_obj, removed_qty);
                destroy_object(restock_obj);
            end
            restock_obj := 0;
            restock_amt := 0;
            add_obj_to_inven(dude_obj, LVar0);
        end
        else begin
            display_msg(message_str(SCRIPT_AICRSHDR, 4122));
        end
    end
    return 0;
    LVar0 := 0;
    LVar1 := 0;
    LVar2 := 0;
    LVar3 := 0;
end

procedure Audio
begin
    set_local_var(12, 0);
    gsay_reply(SCRIPT_KLADWTWN, 2370);
    if ((obj_is_carrying_obj_pid(dude_obj, 38) >= 1) and (obj_is_carrying_obj_pid(dude_obj, 98) >= 1)) then begin
        giq_option(2, SCRIPT_KLADWTWN, 2372, Audio2, NEUTRAL_REACTION);
    end
    if ((obj_is_carrying_obj_pid(dude_obj, 39) >= 1) and (obj_is_carrying_obj_pid(dude_obj, 98) >= 1)) then begin
        giq_option(2, SCRIPT_KLADWTWN, 2373, Audio3, NEUTRAL_REACTION);
    end
    giq_option(2, SCRIPT_KLADWTWN, 2374, Node999, NEUTRAL_REACTION);
end

procedure Audio2
begin
    variable LVar0 := 0;
    LVar0 := create_object(948, 0, 0);
    gsay_reply(SCRIPT_KLADWTWN, 2375);
    add_mult_objs_to_inven(dude_obj, LVar0, 1);
    removed_qty := obj_is_carrying_obj_pid(dude_obj, 38);
    if (1 < removed_qty) then begin
        removed_qty := 1;
    end
    if (removed_qty > 0) then begin
        restock_obj := obj_carrying_pid_obj(dude_obj, 38);
        if (obj_type(self_obj) == 1) then begin
            restock_obj := obj_carrying_pid_obj(dude_obj, 38);
            if (critter_inven_obj(self_obj, INVEN_TYPE_WORN) == restock_obj) then begin
                if (obj_item_subtype(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 0) then begin
                    restock_obj := critter_inven_obj(dude_obj, INVEN_TYPE_WORN);
                    debug_msg("armour pid == " + obj_pid(restock_obj));
                    rm_obj_from_inven(dude_obj, restock_obj);
                    add_obj_to_inven(dude_obj, restock_obj);
                end
            end
            else begin
                if ((critter_inven_obj(dude_obj, INVEN_TYPE_LEFT_HAND) == restock_obj) or (critter_inven_obj(dude_obj, INVEN_TYPE_RIGHT_HAND) == restock_obj)) then begin
                    inven_unwield(dude_obj);
                end
            end
        end
        restock_amt := rm_mult_objs_from_inven(dude_obj, restock_obj, removed_qty);
        destroy_object(restock_obj);
    end
    restock_obj := 0;
    restock_amt := 0;
    removed_qty2 := obj_is_carrying_obj_pid(dude_obj, 98);
    if (1 < removed_qty2) then begin
        removed_qty2 := 1;
    end
    if (removed_qty2 > 0) then begin
        restock_obj2 := obj_carrying_pid_obj(dude_obj, 98);
        if (obj_type(self_obj) == 1) then begin
            restock_obj2 := obj_carrying_pid_obj(dude_obj, 98);
            if (critter_inven_obj(self_obj, INVEN_TYPE_WORN) == restock_obj2) then begin
                if (obj_item_subtype(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 0) then begin
                    restock_obj2 := critter_inven_obj(dude_obj, INVEN_TYPE_WORN);
                    debug_msg("armour pid == " + obj_pid(restock_obj2));
                    rm_obj_from_inven(dude_obj, restock_obj2);
                    add_obj_to_inven(dude_obj, restock_obj2);
                end
            end
            else begin
                if ((critter_inven_obj(dude_obj, INVEN_TYPE_LEFT_HAND) == restock_obj2) or (critter_inven_obj(dude_obj, INVEN_TYPE_RIGHT_HAND) == restock_obj2)) then begin
                    inven_unwield(dude_obj);
                end
            end
        end
        restock_amt2 := rm_mult_objs_from_inven(dude_obj, restock_obj2, removed_qty2);
        destroy_object(restock_obj2);
    end
    restock_obj2 := 0;
    restock_amt2 := 0;
    giq_option(2, SCRIPT_KLADWTWN, 2371, Node999, NEUTRAL_REACTION);
    return 0;
    LVar0 := 0;
end

procedure Audio3
begin
    variable LVar0 := 0;
    LVar0 := create_object(948, 0, 0);
    gsay_reply(SCRIPT_KLADWTWN, 2375);
    add_mult_objs_to_inven(dude_obj, LVar0, 1);
    removed_qty := obj_is_carrying_obj_pid(dude_obj, 39);
    if (1 < removed_qty) then begin
        removed_qty := 1;
    end
    if (removed_qty > 0) then begin
        restock_obj := obj_carrying_pid_obj(dude_obj, 39);
        if (obj_type(self_obj) == 1) then begin
            restock_obj := obj_carrying_pid_obj(dude_obj, 39);
            if (critter_inven_obj(self_obj, INVEN_TYPE_WORN) == restock_obj) then begin
                if (obj_item_subtype(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 0) then begin
                    restock_obj := critter_inven_obj(dude_obj, INVEN_TYPE_WORN);
                    debug_msg("armour pid == " + obj_pid(restock_obj));
                    rm_obj_from_inven(dude_obj, restock_obj);
                    add_obj_to_inven(dude_obj, restock_obj);
                end
            end
            else begin
                if ((critter_inven_obj(dude_obj, INVEN_TYPE_LEFT_HAND) == restock_obj) or (critter_inven_obj(dude_obj, INVEN_TYPE_RIGHT_HAND) == restock_obj)) then begin
                    inven_unwield(dude_obj);
                end
            end
        end
        restock_amt := rm_mult_objs_from_inven(dude_obj, restock_obj, removed_qty);
        destroy_object(restock_obj);
    end
    restock_obj := 0;
    restock_amt := 0;
    removed_qty2 := obj_is_carrying_obj_pid(dude_obj, 98);
    if (1 < removed_qty2) then begin
        removed_qty2 := 1;
    end
    if (removed_qty2 > 0) then begin
        restock_obj2 := obj_carrying_pid_obj(dude_obj, 98);
        if (obj_type(self_obj) == 1) then begin
            restock_obj2 := obj_carrying_pid_obj(dude_obj, 98);
            if (critter_inven_obj(self_obj, INVEN_TYPE_WORN) == restock_obj2) then begin
                if (obj_item_subtype(critter_inven_obj(dude_obj, INVEN_TYPE_WORN)) == 0) then begin
                    restock_obj2 := critter_inven_obj(dude_obj, INVEN_TYPE_WORN);
                    debug_msg("armour pid == " + obj_pid(restock_obj2));
                    rm_obj_from_inven(dude_obj, restock_obj2);
                    add_obj_to_inven(dude_obj, restock_obj2);
                end
            end
            else begin
                if ((critter_inven_obj(dude_obj, INVEN_TYPE_LEFT_HAND) == restock_obj2) or (critter_inven_obj(dude_obj, INVEN_TYPE_RIGHT_HAND) == restock_obj2)) then begin
                    inven_unwield(dude_obj);
                end
            end
        end
        restock_amt2 := rm_mult_objs_from_inven(dude_obj, restock_obj2, removed_qty2);
        destroy_object(restock_obj2);
    end
    restock_obj2 := 0;
    restock_amt2 := 0;
    giq_option(2, SCRIPT_KLADWTWN, 2371, Node999, NEUTRAL_REACTION);
    return 0;
    LVar0 := 0;
end

procedure Tape
begin
    set_local_var(13, 0);
    if (obj_is_carrying_obj_pid(dude_obj, 948) >= 1) then begin
        gsay_reply(SCRIPT_AICRSHDR, 4132);
        giq_option(2, SCRIPT_AICRSHDR, 4133, Tape2, NEUTRAL_REACTION);
        giq_option(2, SCRIPT_AICRSHDR, 4134, Tape8, NEUTRAL_REACTION);
        giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
    end
    else begin
        gsay_reply(SCRIPT_AICRSHDR, 4130);
        giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
    end
end

procedure Tape2
begin
    gsay_reply(SCRIPT_AICRSHDR, 4138);
    giq_option(2, SCRIPT_AICRSHDR, 4137, Tape3, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure Tape3
begin
    gsay_reply(SCRIPT_AICRSHDR, 4139);
    giq_option(2, SCRIPT_AICRSHDR, 4135, Tape4, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure Tape4
begin
    gsay_reply(SCRIPT_AICRSHDR, 4140);
    giq_option(2, SCRIPT_AICRSHDR, 4137, Tape5, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure Tape5
begin
    gsay_reply(SCRIPT_AICRSHDR, 4141);
    giq_option(2, SCRIPT_AICRSHDR, 4136, Tape, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure Tape6
begin
    gsay_reply(SCRIPT_AICRSHDR, 4142);
    giq_option(2, SCRIPT_AICRSHDR, 4137, Tape7, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure Tape7
begin
    gsay_reply(SCRIPT_AICRSHDR, 4143);
    giq_option(2, SCRIPT_AICRSHDR, 4136, Tape, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure Tape8
begin
    gsay_reply(SCRIPT_AICRSHDR, 4142);
    giq_option(2, SCRIPT_AICRSHDR, 4137, Tape9, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure Tape9
begin
    gsay_reply(SCRIPT_AICRSHDR, 4143);
    giq_option(2, SCRIPT_AICRSHDR, 4135, Tape10, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure Tape10
begin
    gsay_reply(SCRIPT_AICRSHDR, 4144);
    giq_option(2, SCRIPT_AICRSHDR, 4137, Tape11, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure Tape11
begin
    gsay_reply(SCRIPT_AICRSHDR, 4145);
    giq_option(2, SCRIPT_AICRSHDR, 4136, Tape, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure Tape12
begin
    gsay_reply(SCRIPT_AICRSHDR, 4146);
    giq_option(2, SCRIPT_AICRSHDR, 4137, Tape13, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure Tape13
begin
    gsay_reply(SCRIPT_AICRSHDR, 4147);
    giq_option(2, SCRIPT_AICRSHDR, 4136, Tape, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_AICRSHDR, 4131, Node999, NEUTRAL_REACTION);
end

procedure catpaw
begin
    set_local_var(14, 0);
    gsay_reply(SCRIPT_KLADWTWN, 2380);
    giq_option(2, SCRIPT_KLADWTWN, 2385, catpaw2, NEUTRAL_REACTION);
end

procedure catpaw2
begin
    gsay_reply(SCRIPT_KLADWTWN, 2381);
    giq_option(2, SCRIPT_KLADWTWN, 2385, catpaw3, NEUTRAL_REACTION);
end

procedure catpaw3
begin
    gsay_reply(SCRIPT_KLADWTWN, 2382);
    giq_option(2, SCRIPT_KLADWTWN, 2385, catpaw4, NEUTRAL_REACTION);
end

procedure catpaw4
begin
    if (dude_perception >= 6) then begin
        gsay_reply(SCRIPT_KLADWTWN, 2383);
        giq_option(2, SCRIPT_KLADWTWN, 2385, catpaw5, NEUTRAL_REACTION);
    end
    else begin
        gsay_reply(SCRIPT_KLADWTWN, 2383);
        giq_option(2, SCRIPT_KLADWTWN, 2386, Node999, NEUTRAL_REACTION);
    end
end

procedure catpaw5
begin
    gsay_reply(SCRIPT_KLADWTWN, 2384);
    giq_option(2, SCRIPT_KLADWTWN, 2386, Node999, NEUTRAL_REACTION);
    giq_option(2, SCRIPT_KLADWTWN, 2387, catpaw6, NEUTRAL_REACTION);
end

procedure catpaw6
begin
    game_time_advance(100);
    end_dialogue;
    load_map(179, 0);
end
