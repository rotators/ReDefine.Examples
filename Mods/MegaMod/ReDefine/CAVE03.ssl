procedure Exit_Grid_Give_Car;
procedure Get_Car_Hex;
procedure Get_Current_Town;

variable ProtoOfItemGiven;
variable ValueOfRollCheck := 1;
variable Scenery_Creation;
variable Scenery_Creation_Hex;
variable Scenery_Creation_Count;
variable Temp_Scenery_Creation_Hex;
variable Scenery_Creation_Ptr;
variable How_Many_Party_Members_Are_Injured;
variable How_Many_Party_Members_Armed;
variable PartyHealingItem;
variable trunk_tile;
variable encounter_pid;
variable encounter_sid;
variable LVar0;
variable picked;
variable Critter_Hex;
variable Script;
variable Elev;
variable critter_ptr;
variable global_temp;
variable dest_tile;
variable step_tile;
variable in_dialog;
variable forced_node;
variable restock_amt;
variable restock_obj;
variable restock_trash;
variable removed_qty;

procedure start;
procedure map_exit_p_proc;
procedure map_enter_p_proc;
procedure map_update_p_proc;
procedure checkPartyMembersNearDoor;
procedure Create_Chests_Sewer;
procedure Create_Chests_Cave;
procedure Create_Critters_Two;
procedure Create_Critters_One;
procedure Create_Critters_Cave;
procedure Place_Critters_Sewer;
procedure Place_Critters_Cave;
procedure Place_Critters;
procedure Place_Critters_MegaMod;
procedure Pick_Gecko_PID;
procedure Pick_Alien_PID;
procedure Spawn_Critter(variable arg0, variable arg1, variable arg2, variable arg3);
procedure Pick_Tough_Ant_PID;
procedure choose_pid_sid;

variable Critter;
variable Critter_Tile;


procedure Exit_Grid_Give_Car
begin
    if ((global_var(GVAR_CAR_PLACED_TILE) == Get_Car_Hex()) and (global_var(GVAR_PLAYER_GOT_CAR) != 0) and (car_current_town == Get_Current_Town()) and (global_var(GVAR_BREAKDOWN_TIMER) == 0) and (global_var(GVAR_CAR_CURRENT_TOWN) == cur_map_index)) then begin
        if ((Get_Current_Town() >= 26) and (Get_Current_Town() <= 29) or (Get_Current_Town() == 47) or ((Get_Current_Town() >= 31) and (Get_Current_Town() <= 43)) or (Get_Current_Town() == 55)) then begin
            while (global_var(GVAR_CAR_PLACED_TILE) != -1) do begin
                set_global_var(GVAR_CAR_PLACED_TILE, -1);
            end
            while (global_var(GVAR_CAR_CURRENT_TOWN) != -1) do begin
                set_global_var(GVAR_CAR_CURRENT_TOWN, -1);
            end
            while (global_var(GVAR_CAR_HAS_BEEN_DRIVEN) != -1) do begin
                set_global_var(GVAR_CAR_HAS_BEEN_DRIVEN, -1);
            end
            while (global_var(GVAR_ABANDONED_MAP_252_CLEARED) != -1) do begin
                set_global_var(GVAR_ABANDONED_MAP_252_CLEARED, -1);
            end
            while (global_var(GVAR_ABANDONED_MAP_251_CLEARED) != 1) do begin
                set_global_var(GVAR_ABANDONED_MAP_251_CLEARED, 1);
            end
            car_give_to_party;
        end
    end
end

procedure Get_Car_Hex
begin
    if (CUR_MAP_DESERT1) then begin
        return 19094;
    end
    else begin
        if (CUR_MAP_A12) then begin
            return 11508;
        end
        else begin
            if (CUR_MAP_A10) then begin
                return 21273;
            end
            else begin
                if (CUR_MAP_EPAENT) then begin
                    return 22713;
                end
                else begin
                    if (CUR_MAP_ARDEAD) then begin
                        return 27312;
                    end
                    else begin
                        if (CUR_MAP_CRSNMAIN) then begin
                            return 19144;
                        end
                        else begin
                            if (CUR_MAP_DENBUS1) then begin
                                if ((global_var(GVAR_ABANDONED_MAP_251_CLEARED) == 1) and (global_var(GVAR_PLAYER_GOT_CAR) != 0)) then begin
                                    return 11687;
                                end
                                else begin
                                    if ((global_var(GVAR_PLAYER_GOT_CAR) == 0) or ((global_var(GVAR_ABANDONED_MAP_251_CLEARED) == 0) and (global_var(GVAR_PLAYER_GOT_CAR) != 0))) then begin
                                        return 24548;
                                    end
                                end
                            end
                            else begin
                                if (CUR_MAP_DENBUS2) then begin
                                    return 29103;
                                end
                                else begin
                                    if (CUR_MAP_ABBEY) then begin
                                        return 22321;
                                    end
                                    else begin
                                        if (CUR_MAP_ARBRIDGE) then begin
                                            return 27312;
                                        end
                                        else begin
                                            if (CUR_MAP_ARDEAD) then begin
                                                return 27313;
                                            end
                                            else begin
                                                if (CUR_MAP_B21) then begin
                                                    return 24916;
                                                end
                                                else begin
                                                    if (CUR_MAP_BROKEN1) then begin
                                                        return 17752;
                                                    end
                                                    else begin
                                                        if (CUR_MAP_COLLY) then begin
                                                            return 26097;
                                                        end
                                                        else begin
                                                            if (CUR_MAP_DEPOLV1) then begin
                                                                return 28699;
                                                            end
                                                            else begin
                                                                if (CUR_MAP_EPAX) then begin
                                                                    return 18242;
                                                                end
                                                                else begin
                                                                    if (CUR_MAP_GECKSETL) then begin
                                                                        return 25709;
                                                                    end
                                                                    else begin
                                                                        if (CUR_MAP_GSTFARM) then begin
                                                                            return 23951;
                                                                        end
                                                                        else begin
                                                                            if (CUR_MAP_JENFARM7) then begin
                                                                                return 9483;
                                                                            end
                                                                            else begin
                                                                                if (CUR_MAP_KLADWTWN) then begin
                                                                                    return 25669;
                                                                                end
                                                                                else begin
                                                                                    if (CUR_MAP_KLATOXCV) then begin
                                                                                        return 19943;
                                                                                    end
                                                                                    else begin
                                                                                        if (CUR_MAP_LARS1) then begin
                                                                                            return 22677;
                                                                                        end
                                                                                        else begin
                                                                                            if (CUR_MAP_LARS3) then begin
                                                                                                return 30696;
                                                                                            end
                                                                                            else begin
                                                                                                if (CUR_MAP_MBCLOSE) then begin
                                                                                                    return 22146;
                                                                                                end
                                                                                                else begin
                                                                                                    if (CUR_MAP_MODMAIN) then begin
                                                                                                        return 24531;
                                                                                                    end
                                                                                                    else begin
                                                                                                        if (CUR_MAP_NAVARRO) then begin
                                                                                                            return 28888;
                                                                                                        end
                                                                                                        else begin
                                                                                                            if (CUR_MAP_NCRENT) then begin
                                                                                                                return 23078;
                                                                                                            end
                                                                                                            else begin
                                                                                                                if (CUR_MAP_NEWR1) then begin
                                                                                                                    return 25321;
                                                                                                                end
                                                                                                                else begin
                                                                                                                    if (CUR_MAP_NEWR2) then begin
                                                                                                                        return 9509;
                                                                                                                    end
                                                                                                                    else begin
                                                                                                                        if (CUR_MAP_NEWR3) then begin
                                                                                                                            return 30894;
                                                                                                                        end
                                                                                                                        else begin
                                                                                                                            if (CUR_MAP_NEWR4) then begin
                                                                                                                                return 16068;
                                                                                                                            end
                                                                                                                            else begin
                                                                                                                                if (CUR_MAP_NEWRCS) then begin
                                                                                                                                    return 18699;
                                                                                                                                end
                                                                                                                                else begin
                                                                                                                                    if (CUR_MAP_NEWRGO) then begin
                                                                                                                                        return 22500;
                                                                                                                                    end
                                                                                                                                    else begin
                                                                                                                                        if (CUR_MAP_NEWRST) then begin
                                                                                                                                            return 26506;
                                                                                                                                        end
                                                                                                                                        else begin
                                                                                                                                            if (CUR_MAP_RAIDERS1) then begin
                                                                                                                                                if (dude_elevation == 0) then begin
                                                                                                                                                    return 25304;
                                                                                                                                                end
                                                                                                                                                else begin
                                                                                                                                                    if (dude_elevation == 1) then begin
                                                                                                                                                        return 21298;
                                                                                                                                                    end
                                                                                                                                                end
                                                                                                                                            end
                                                                                                                                            else begin
                                                                                                                                                if (CUR_MAP_REDDOWN) then begin
                                                                                                                                                    return 18650;
                                                                                                                                                end
                                                                                                                                                else begin
                                                                                                                                                    if (CUR_MAP_RNDMDDG) then begin
                                                                                                                                                        return 19506;
                                                                                                                                                    end
                                                                                                                                                    else begin
                                                                                                                                                        if (CUR_MAP_SCRAPT) then begin
                                                                                                                                                            return 26515;
                                                                                                                                                        end
                                                                                                                                                        else begin
                                                                                                                                                            if (CUR_MAP_SFCHINA) then begin
                                                                                                                                                                return 31699;
                                                                                                                                                            end
                                                                                                                                                            else begin
                                                                                                                                                                if (CUR_MAP_SLVCAMP) then begin
                                                                                                                                                                    return 21895;
                                                                                                                                                                end
                                                                                                                                                                else begin
                                                                                                                                                                    if (CUR_MAP_GLOWENT) then begin
                                                                                                                                                                        return 22737;
                                                                                                                                                                    end
                                                                                                                                                                    else begin
                                                                                                                                                                        if (CUR_MAP_TRIBE01) then begin
                                                                                                                                                                            return 29487;
                                                                                                                                                                        end
                                                                                                                                                                        else begin
                                                                                                                                                                            if (CUR_MAP_TRUCK) then begin
                                                                                                                                                                                return 23132;
                                                                                                                                                                            end
                                                                                                                                                                            else begin
                                                                                                                                                                                if (CUR_MAP_V13ENT) then begin
                                                                                                                                                                                    return 26354;
                                                                                                                                                                                end
                                                                                                                                                                                else begin
                                                                                                                                                                                    if (CUR_MAP_V14ENT) then begin
                                                                                                                                                                                        return 19105;
                                                                                                                                                                                    end
                                                                                                                                                                                    else begin
                                                                                                                                                                                        if (CUR_MAP_V15ENT) then begin
                                                                                                                                                                                            if ((global_var(GVAR_V15_NCR_DEAL) == 2) and global_var(GVAR_NCR_V15_DARION_DEAD)) then begin
                                                                                                                                                                                                return 29718;
                                                                                                                                                                                            end
                                                                                                                                                                                            else begin
                                                                                                                                                                                                return 26932;
                                                                                                                                                                                            end
                                                                                                                                                                                        end
                                                                                                                                                                                        else begin
                                                                                                                                                                                            if (CUR_MAP_VCTYCTYD) then begin
                                                                                                                                                                                                return 28899;
                                                                                                                                                                                            end
                                                                                                                                                                                            else begin
                                                                                                                                                                                                if (CUR_MAP_CRISIENT) then begin
                                                                                                                                                                                                    return 18697;
                                                                                                                                                                                                end
                                                                                                                                                                                                else begin
                                                                                                                                                                                                    if (CUR_MAP_MODOCT2) then begin
                                                                                                                                                                                                        return 26298;
                                                                                                                                                                                                    end
                                                                                                                                                                                                    else begin
                                                                                                                                                                                                        if (CUR_MAP_BROHDENT) then begin
                                                                                                                                                                                                            return 28313;
                                                                                                                                                                                                        end
                                                                                                                                                                                                        else begin
                                                                                                                                                                                                            if (CUR_MAP_BREAKDWN) then begin
                                                                                                                                                                                                                return 18518;
                                                                                                                                                                                                            end
                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                if (CUR_MAP_ABANDON3) then begin
                                                                                                                                                                                                                    return 23754;
                                                                                                                                                                                                                end
                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                    if (CUR_MAP_BHRNDDST) then begin
                                                                                                                                                                                                                        return 18909;
                                                                                                                                                                                                                    end
                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                        if (CUR_MAP_BHRNDMNT) then begin
                                                                                                                                                                                                                            return 18909;
                                                                                                                                                                                                                        end
                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                            if (CUR_MAP_BRHDHLP) then begin
                                                                                                                                                                                                                                return 25104;
                                                                                                                                                                                                                            end
                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                if (CUR_MAP_RNDPOSTM) then begin
                                                                                                                                                                                                                                    return 17890;
                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                    if (CUR_MAP_RNDBD) then begin
                                                                                                                                                                                                                                        return 26503;
                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                        if (CUR_MAP_RNDBHEAD) then begin
                                                                                                                                                                                                                                            return 22726;
                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                            if (CUR_MAP_RNDBRIDG) then begin
                                                                                                                                                                                                                                                return 18095;
                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                if (CUR_MAP_RNDCAFE) then begin
                                                                                                                                                                                                                                                    return 23903;
                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                    if (CUR_MAP_RNDEXCOW) then begin
                                                                                                                                                                                                                                                        return 18889;
                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                        if (CUR_MAP_RNDFORVR) then begin
                                                                                                                                                                                                                                                            return 18904;
                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                            if (CUR_MAP_RNDHOLY1) then begin
                                                                                                                                                                                                                                                                return 21936;
                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                if (CUR_MAP_RNDHOLY2) then begin
                                                                                                                                                                                                                                                                    return 20880;
                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                    if (CUR_MAP_RNDMSTR) then begin
                                                                                                                                                                                                                                                                        return 19898;
                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                        if (CUR_MAP_RNDPARIH) then begin
                                                                                                                                                                                                                                                                            return 23125;
                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                            if (CUR_MAP_RNDSHUTL) then begin
                                                                                                                                                                                                                                                                                return 20702;
                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                if (CUR_MAP_RNDTINWD) then begin
                                                                                                                                                                                                                                                                                    return 18724;
                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                    if (CUR_MAP_RNDTOXIC) then begin
                                                                                                                                                                                                                                                                                        return 22101;
                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                        if (CUR_MAP_RNDUVILG) then begin
                                                                                                                                                                                                                                                                                            return 19095;
                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                            if (CUR_MAP_RNDWHALE) then begin
                                                                                                                                                                                                                                                                                                return 23109;
                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                if (CUR_MAP_CAVE0) then begin
                                                                                                                                                                                                                                                                                                    return 18909;
                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                    if (CUR_MAP_CAVE1) then begin
                                                                                                                                                                                                                                                                                                        return 26508;
                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                        if (CUR_MAP_CAVE2) then begin
                                                                                                                                                                                                                                                                                                            return 24706;
                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                            if (CUR_MAP_CAVE3) then begin
                                                                                                                                                                                                                                                                                                                return 24915;
                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                if (CUR_MAP_CAVE4) then begin
                                                                                                                                                                                                                                                                                                                    return 27512;
                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_CAVE5) then begin
                                                                                                                                                                                                                                                                                                                        return 26292;
                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_GAMMOVIE) then begin
                                                                                                                                                                                                                                                                                                                            return 25523;
                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_RNDBESS) then begin
                                                                                                                                                                                                                                                                                                                                return 27318;
                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_COAST1) then begin
                                                                                                                                                                                                                                                                                                                                    return 18086;
                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_COAST2) then begin
                                                                                                                                                                                                                                                                                                                                        return 19089;
                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_COAST3) then begin
                                                                                                                                                                                                                                                                                                                                            return 19279;
                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_COAST4) then begin
                                                                                                                                                                                                                                                                                                                                                return 19278;
                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_COAST5) then begin
                                                                                                                                                                                                                                                                                                                                                    return 23500;
                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_COAST6) then begin
                                                                                                                                                                                                                                                                                                                                                        return 22291;
                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_COAST7) then begin
                                                                                                                                                                                                                                                                                                                                                            return 16518;
                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_COAST8) then begin
                                                                                                                                                                                                                                                                                                                                                                return 23718;
                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_COAST9) then begin
                                                                                                                                                                                                                                                                                                                                                                    return 21107;
                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_COAST10) then begin
                                                                                                                                                                                                                                                                                                                                                                        return 17919;
                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_COAST11) then begin
                                                                                                                                                                                                                                                                                                                                                                            return 20079;
                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_07DESERT) then begin
                                                                                                                                                                                                                                                                                                                                                                                return 25515;
                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_GAMMOVIE) then begin
                                                                                                                                                                                                                                                                                                                                                                                    return 19096;
                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_DESERT2) then begin
                                                                                                                                                                                                                                                                                                                                                                                        return 19094;
                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_DESERT3) then begin
                                                                                                                                                                                                                                                                                                                                                                                            return 18894;
                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_DESERT4) then begin
                                                                                                                                                                                                                                                                                                                                                                                                return 19718;
                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_DESERT5) then begin
                                                                                                                                                                                                                                                                                                                                                                                                    return 24112;
                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_DESERT6) then begin
                                                                                                                                                                                                                                                                                                                                                                                                        return 18914;
                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_DESERT7) then begin
                                                                                                                                                                                                                                                                                                                                                                                                            return 24525;
                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_DESERT8) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                return 17890;
                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_DESERT9) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                    return 22880;
                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_DESRT10) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                        return 22880;
                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_DESRT11) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                            return 20692;
                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_DESRT12) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                return 21308;
                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_CITY1) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                    return 12693;
                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_CITY2) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                        return 9898;
                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_CITY3) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                            return 23542;
                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_CITY4) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                return 28089;
                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_CITY5) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                    return 20464;
                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_CITY6) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                        return 29496;
                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_CITY7) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                            return 19535;
                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_CITY8) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                return 21702;
                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_CAVE6) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return 21681;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_CAVE7) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return 19078;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_MOUNTN1) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return 17875;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_MOUNTN2) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return 17876;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_MOUNTN3) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return 19478;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_MOUNTN4) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return 19099;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_MOUNTN5) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return 20678;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_MOUNTN6) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return 20073;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_CARDESRT) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return 19100;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return -1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                end
                                                                                                                                                                                                                            end
                                                                                                                                                                                                                        end
                                                                                                                                                                                                                    end
                                                                                                                                                                                                                end
                                                                                                                                                                                                            end
                                                                                                                                                                                                        end
                                                                                                                                                                                                    end
                                                                                                                                                                                                end
                                                                                                                                                                                            end
                                                                                                                                                                                        end
                                                                                                                                                                                    end
                                                                                                                                                                                end
                                                                                                                                                                            end
                                                                                                                                                                        end
                                                                                                                                                                    end
                                                                                                                                                                end
                                                                                                                                                            end
                                                                                                                                                        end
                                                                                                                                                    end
                                                                                                                                                end
                                                                                                                                            end
                                                                                                                                        end
                                                                                                                                    end
                                                                                                                                end
                                                                                                                            end
                                                                                                                        end
                                                                                                                    end
                                                                                                                end
                                                                                                            end
                                                                                                        end
                                                                                                    end
                                                                                                end
                                                                                            end
                                                                                        end
                                                                                    end
                                                                                end
                                                                            end
                                                                        end
                                                                    end
                                                                end
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end

procedure Get_Current_Town
begin
    if (CUR_MAP_ARDEAD) then begin
        return 22;
    end
    else begin
        if (CUR_MAP_CRSNMAIN) then begin
            return 78;
        end
        else begin
            if (CUR_MAP_DENBUS1) then begin
                return 1;
            end
            else begin
                if (CUR_MAP_DENBUS2) then begin
                    return 1;
                end
                else begin
                    if (CUR_MAP_ABBEY) then begin
                        return 52;
                    end
                    else begin
                        if (CUR_MAP_ARBRIDGE) then begin
                            return 0;
                        end
                        else begin
                            if (CUR_MAP_ARDEAD) then begin
                                return 0;
                            end
                            else begin
                                if (CUR_MAP_B21) then begin
                                    return 51;
                                end
                                else begin
                                    if (CUR_MAP_BROKEN1) then begin
                                        return 6;
                                    end
                                    else begin
                                        if (CUR_MAP_COLLY) then begin
                                            return 73;
                                        end
                                        else begin
                                            if (CUR_MAP_DEPOLV1) then begin
                                                return 8;
                                            end
                                            else begin
                                                if (CUR_MAP_EPAX) then begin
                                                    return 49;
                                                end
                                                else begin
                                                    if (CUR_MAP_GECKSETL) then begin
                                                        return 5;
                                                    end
                                                    else begin
                                                        if (CUR_MAP_GSTFARM) then begin
                                                            return 20;
                                                        end
                                                        else begin
                                                            if (CUR_MAP_JENFARM7) then begin
                                                                return 17;
                                                            end
                                                            else begin
                                                                if (CUR_MAP_KLADWTWN) then begin
                                                                    return 2;
                                                                end
                                                                else begin
                                                                    if (CUR_MAP_KLATOXCV) then begin
                                                                        return 23;
                                                                    end
                                                                    else begin
                                                                        if (CUR_MAP_LARS1) then begin
                                                                            return 67;
                                                                        end
                                                                        else begin
                                                                            if (CUR_MAP_LARS3) then begin
                                                                                return 68;
                                                                            end
                                                                            else begin
                                                                                if (CUR_MAP_MBCLOSE) then begin
                                                                                    return 12;
                                                                                end
                                                                                else begin
                                                                                    if (CUR_MAP_MODMAIN) then begin
                                                                                        return 3;
                                                                                    end
                                                                                    else begin
                                                                                        if (CUR_MAP_NCRENT) then begin
                                                                                            return 10;
                                                                                        end
                                                                                        else begin
                                                                                            if (CUR_MAP_NEWR1) then begin
                                                                                                return 7;
                                                                                            end
                                                                                            else begin
                                                                                                if (CUR_MAP_NEWR2) then begin
                                                                                                    return 7;
                                                                                                end
                                                                                                else begin
                                                                                                    if (CUR_MAP_NEWR3) then begin
                                                                                                        return 7;
                                                                                                    end
                                                                                                    else begin
                                                                                                        if (CUR_MAP_NEWR4) then begin
                                                                                                            return 7;
                                                                                                        end
                                                                                                        else begin
                                                                                                            if (CUR_MAP_NEWRCS) then begin
                                                                                                                return 7;
                                                                                                            end
                                                                                                            else begin
                                                                                                                if (CUR_MAP_NEWRGO) then begin
                                                                                                                    return 30;
                                                                                                                end
                                                                                                                else begin
                                                                                                                    if (CUR_MAP_NEWRST) then begin
                                                                                                                        return 48;
                                                                                                                    end
                                                                                                                    else begin
                                                                                                                        if (CUR_MAP_RAIDERS1) then begin
                                                                                                                            return 25;
                                                                                                                        end
                                                                                                                        else begin
                                                                                                                            if (CUR_MAP_REDDOWN) then begin
                                                                                                                                return 13;
                                                                                                                            end
                                                                                                                            else begin
                                                                                                                                if (CUR_MAP_RNDMDDG) then begin
                                                                                                                                    return 18;
                                                                                                                                end
                                                                                                                                else begin
                                                                                                                                    if (CUR_MAP_SCRAPT) then begin
                                                                                                                                        return 53;
                                                                                                                                    end
                                                                                                                                    else begin
                                                                                                                                        if (CUR_MAP_SFCHINA) then begin
                                                                                                                                            return 14;
                                                                                                                                        end
                                                                                                                                        else begin
                                                                                                                                            if (CUR_MAP_SLVCAMP) then begin
                                                                                                                                                return 87;
                                                                                                                                            end
                                                                                                                                            else begin
                                                                                                                                                if (CUR_MAP_GLOWENT) then begin
                                                                                                                                                    return 58;
                                                                                                                                                end
                                                                                                                                                else begin
                                                                                                                                                    if (CUR_MAP_TRIBE01) then begin
                                                                                                                                                        return 54;
                                                                                                                                                    end
                                                                                                                                                    else begin
                                                                                                                                                        if (CUR_MAP_TRUCK) then begin
                                                                                                                                                            return 50;
                                                                                                                                                        end
                                                                                                                                                        else begin
                                                                                                                                                            if (CUR_MAP_V13ENT) then begin
                                                                                                                                                                return 11;
                                                                                                                                                            end
                                                                                                                                                            else begin
                                                                                                                                                                if (CUR_MAP_V14ENT) then begin
                                                                                                                                                                    return 72;
                                                                                                                                                                end
                                                                                                                                                                else begin
                                                                                                                                                                    if (CUR_MAP_V15ENT) then begin
                                                                                                                                                                        return 9;
                                                                                                                                                                    end
                                                                                                                                                                    else begin
                                                                                                                                                                        if (CUR_MAP_VCTYCTYD) then begin
                                                                                                                                                                            return 4;
                                                                                                                                                                        end
                                                                                                                                                                        else begin
                                                                                                                                                                            if (CUR_MAP_CRISIENT) then begin
                                                                                                                                                                                return 56;
                                                                                                                                                                            end
                                                                                                                                                                            else begin
                                                                                                                                                                                if (CUR_MAP_MODOCT2) then begin
                                                                                                                                                                                    return 75;
                                                                                                                                                                                end
                                                                                                                                                                                else begin
                                                                                                                                                                                    if (CUR_MAP_BROHDENT) then begin
                                                                                                                                                                                        return 81;
                                                                                                                                                                                    end
                                                                                                                                                                                    else begin
                                                                                                                                                                                        if (CUR_MAP_EPAENT) then begin
                                                                                                                                                                                            return 83;
                                                                                                                                                                                        end
                                                                                                                                                                                        else begin
                                                                                                                                                                                            if (CUR_MAP_NAVARRO) then begin
                                                                                                                                                                                                return 15;
                                                                                                                                                                                            end
                                                                                                                                                                                            else begin
                                                                                                                                                                                                if (CUR_MAP_BREAKDWN) then begin
                                                                                                                                                                                                    return 89;
                                                                                                                                                                                                end
                                                                                                                                                                                                else begin
                                                                                                                                                                                                    if (CUR_MAP_ABANDON3) then begin
                                                                                                                                                                                                        return 88;
                                                                                                                                                                                                    end
                                                                                                                                                                                                    else begin
                                                                                                                                                                                                        if (CUR_MAP_BHRNDDST) then begin
                                                                                                                                                                                                            return 44;
                                                                                                                                                                                                        end
                                                                                                                                                                                                        else begin
                                                                                                                                                                                                            if (CUR_MAP_BHRNDMNT) then begin
                                                                                                                                                                                                                return 44;
                                                                                                                                                                                                            end
                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                if (CUR_MAP_BRHDHLP) then begin
                                                                                                                                                                                                                    return 82;
                                                                                                                                                                                                                end
                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                    if (CUR_MAP_CARDESRT) then begin
                                                                                                                                                                                                                        return 21;
                                                                                                                                                                                                                    end
                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                        if (CUR_MAP_RNDPOSTM) then begin
                                                                                                                                                                                                                            return 55;
                                                                                                                                                                                                                        end
                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                            if (CUR_MAP_RNDBD) then begin
                                                                                                                                                                                                                                return 19;
                                                                                                                                                                                                                            end
                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                if (CUR_MAP_RNDBHEAD) then begin
                                                                                                                                                                                                                                    return 33;
                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                    if (CUR_MAP_RNDBRIDG) then begin
                                                                                                                                                                                                                                        return 36;
                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                        if (CUR_MAP_RNDCAFE) then begin
                                                                                                                                                                                                                                            return 37;
                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                            if (CUR_MAP_RNDEXCOW) then begin
                                                                                                                                                                                                                                                return 43;
                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                if (CUR_MAP_RNDFORVR) then begin
                                                                                                                                                                                                                                                    return 40;
                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                    if (CUR_MAP_RNDHOLY1) then begin
                                                                                                                                                                                                                                                        return 38;
                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                        if (CUR_MAP_RNDHOLY2) then begin
                                                                                                                                                                                                                                                            return 39;
                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                            if (CUR_MAP_RNDMSTR) then begin
                                                                                                                                                                                                                                                                return 71;
                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                if (CUR_MAP_RNDPARIH) then begin
                                                                                                                                                                                                                                                                    return 42;
                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                    if (CUR_MAP_RNDSHUTL) then begin
                                                                                                                                                                                                                                                                        return 34;
                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                        if (CUR_MAP_RNDTINWD) then begin
                                                                                                                                                                                                                                                                            return 32;
                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                            if (CUR_MAP_RNDTOXIC) then begin
                                                                                                                                                                                                                                                                                return 41;
                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                if (CUR_MAP_RNDUVILG) then begin
                                                                                                                                                                                                                                                                                    return 35;
                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                    if (CUR_MAP_RNDWHALE) then begin
                                                                                                                                                                                                                                                                                        return 31;
                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                        if (CUR_MAP_CAVE0) then begin
                                                                                                                                                                                                                                                                                            return 27;
                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                            if (CUR_MAP_CAVE1) then begin
                                                                                                                                                                                                                                                                                                return 27;
                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                if (CUR_MAP_CAVE2) then begin
                                                                                                                                                                                                                                                                                                    return 27;
                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                    if (CUR_MAP_CAVE3) then begin
                                                                                                                                                                                                                                                                                                        return 27;
                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                        if (CUR_MAP_CAVE4) then begin
                                                                                                                                                                                                                                                                                                            return 27;
                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                            if (CUR_MAP_CAVE5) then begin
                                                                                                                                                                                                                                                                                                                return 27;
                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                if (CUR_MAP_GAMMOVIE) then begin
                                                                                                                                                                                                                                                                                                                    return 47;
                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_RNDBESS) then begin
                                                                                                                                                                                                                                                                                                                        return 47;
                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_COAST1) then begin
                                                                                                                                                                                                                                                                                                                            return 29;
                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_COAST2) then begin
                                                                                                                                                                                                                                                                                                                                return 29;
                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_COAST3) then begin
                                                                                                                                                                                                                                                                                                                                    return 29;
                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_COAST4) then begin
                                                                                                                                                                                                                                                                                                                                        return 29;
                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_COAST5) then begin
                                                                                                                                                                                                                                                                                                                                            return 29;
                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_COAST6) then begin
                                                                                                                                                                                                                                                                                                                                                return 29;
                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_COAST7) then begin
                                                                                                                                                                                                                                                                                                                                                    return 29;
                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_COAST8) then begin
                                                                                                                                                                                                                                                                                                                                                        return 29;
                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_COAST9) then begin
                                                                                                                                                                                                                                                                                                                                                            return 29;
                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_COAST10) then begin
                                                                                                                                                                                                                                                                                                                                                                return 29;
                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_COAST11) then begin
                                                                                                                                                                                                                                                                                                                                                                    return 47;
                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_07DESERT) then begin
                                                                                                                                                                                                                                                                                                                                                                        return 47;
                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_GAMMOVIE) then begin
                                                                                                                                                                                                                                                                                                                                                                            return 47;
                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_DESERT2) then begin
                                                                                                                                                                                                                                                                                                                                                                                return 26;
                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_DESERT3) then begin
                                                                                                                                                                                                                                                                                                                                                                                    return 26;
                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_DESERT4) then begin
                                                                                                                                                                                                                                                                                                                                                                                        return 26;
                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_DESERT5) then begin
                                                                                                                                                                                                                                                                                                                                                                                            return 26;
                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_DESERT6) then begin
                                                                                                                                                                                                                                                                                                                                                                                                return 26;
                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_DESERT7) then begin
                                                                                                                                                                                                                                                                                                                                                                                                    return 26;
                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_DESERT8) then begin
                                                                                                                                                                                                                                                                                                                                                                                                        return 26;
                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_DESERT9) then begin
                                                                                                                                                                                                                                                                                                                                                                                                            return 26;
                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_DESRT10) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                return 26;
                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_DESRT11) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                    return 47;
                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_DESRT12) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                        return 47;
                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_CITY1) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                            return 28;
                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_CITY2) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                return 28;
                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_CITY3) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                    return 28;
                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_CITY4) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                        return 28;
                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_CITY5) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                            return 28;
                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_CITY6) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                return 28;
                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_CITY7) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                    return 28;
                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_CITY8) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                        return 28;
                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_CAVE6) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                            return 45;
                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_CAVE7) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                return 46;
                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_MOUNTN1) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return 27;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_MOUNTN2) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return 27;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_MOUNTN3) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return 27;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_MOUNTN4) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return 27;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_MOUNTN5) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return 47;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_MOUNTN6) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return 47;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (CUR_MAP_CARDESRT) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return 21;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (CUR_MAP_DESERT1) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return 26;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (CUR_MAP_A10) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return 69;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (CUR_MAP_A12) then begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return 66;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    else begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return -1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                        end
                                                                                                                                                                                                                                    end
                                                                                                                                                                                                                                end
                                                                                                                                                                                                                            end
                                                                                                                                                                                                                        end
                                                                                                                                                                                                                    end
                                                                                                                                                                                                                end
                                                                                                                                                                                                            end
                                                                                                                                                                                                        end
                                                                                                                                                                                                    end
                                                                                                                                                                                                end
                                                                                                                                                                                            end
                                                                                                                                                                                        end
                                                                                                                                                                                    end
                                                                                                                                                                                end
                                                                                                                                                                            end
                                                                                                                                                                        end
                                                                                                                                                                    end
                                                                                                                                                                end
                                                                                                                                                            end
                                                                                                                                                        end
                                                                                                                                                    end
                                                                                                                                                end
                                                                                                                                            end
                                                                                                                                        end
                                                                                                                                    end
                                                                                                                                end
                                                                                                                            end
                                                                                                                        end
                                                                                                                    end
                                                                                                                end
                                                                                                            end
                                                                                                        end
                                                                                                    end
                                                                                                end
                                                                                            end
                                                                                        end
                                                                                    end
                                                                                end
                                                                            end
                                                                        end
                                                                    end
                                                                end
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end

procedure start
begin
end

procedure map_exit_p_proc
begin
    call Exit_Grid_Give_Car();
end

procedure map_enter_p_proc
begin
    variable LVar0 := 0;
    variable LVar1 := 0;
    wm_area_set_pos(26, worldmap_xpos, worldmap_ypos);
    wm_area_set_pos(27, worldmap_xpos, worldmap_ypos);
    wm_area_set_pos(28, worldmap_xpos, worldmap_ypos);
    wm_area_set_pos(29, worldmap_xpos, worldmap_ypos);
    wm_area_set_pos(47, worldmap_xpos, worldmap_ypos);
    call Place_Critters();
    if (map_first_run) then begin
        display_msg(message_str(SCRIPT_CAVE01, 100));
    end
    if (map_first_run and not(global_var(GVAR_MYSTERIOUS_STRANGER) bwand 1) and (random(0, 99) < (30 + (2 * dude_luck))) and has_trait(TRAIT_PERK, dude_obj, PERK_mysterious_stranger)) then begin
        if (not(global_var(GVAR_MYSTERIOUS_STRANGER) bwand 2)) then begin
            set_global_var(GVAR_MYSTERIOUS_STRANGER, global_var(GVAR_MYSTERIOUS_STRANGER) bwor 2);
            debug_msg("Set the Stranger Gender");
            if (random(0, 99) < 50) then begin
                set_global_var(GVAR_MYSTERIOUS_STRANGER, global_var(GVAR_MYSTERIOUS_STRANGER) bwor 4);
            end
        end
        if (global_var(GVAR_MYSTERIOUS_STRANGER) bwand 4) then begin
            if (get_pc_stat(PCSTAT_level) > 26) then begin
                Critter := create_object_sid(16777503, 0, 0, SCRIPT_ECMSTSTR);
            end
            else begin
                if (get_pc_stat(PCSTAT_level) > 22) then begin
                    Critter := create_object_sid(16777501, 0, 0, SCRIPT_ECMSTSTR);
                end
                else begin
                    if (get_pc_stat(PCSTAT_level) > 18) then begin
                        Critter := create_object_sid(16777499, 0, 0, SCRIPT_ECMSTSTR);
                    end
                    else begin
                        if (get_pc_stat(PCSTAT_level) > 14) then begin
                            Critter := create_object_sid(16777497, 0, 0, SCRIPT_ECMSTSTR);
                        end
                        else begin
                            Critter := create_object_sid(16777487, 0, 0, SCRIPT_ECMSTSTR);
                        end
                    end
                end
            end
        end
        else begin
            if (get_pc_stat(PCSTAT_level) > 26) then begin
                Critter := create_object_sid(16777502, 0, 0, SCRIPT_ECMSTSTR);
            end
            else begin
                if (get_pc_stat(PCSTAT_level) > 22) then begin
                    Critter := create_object_sid(16777500, 0, 0, SCRIPT_ECMSTSTR);
                end
                else begin
                    if (get_pc_stat(PCSTAT_level) > 18) then begin
                        Critter := create_object_sid(16777498, 0, 0, SCRIPT_ECMSTSTR);
                    end
                    else begin
                        if (get_pc_stat(PCSTAT_level) > 14) then begin
                            Critter := create_object_sid(16777496, 0, 0, SCRIPT_ECMSTSTR);
                        end
                        else begin
                            Critter := create_object_sid(16777486, 0, 0, SCRIPT_ECMSTSTR);
                        end
                    end
                end
            end
        end
        Critter_Tile := tile_num_in_direction(dude_tile, random(0, 5), random(5, 10));
        critter_attempt_placement(Critter, Critter_Tile, dude_elevation);
    end
    set_global_var(GVAR_LOAD_MAP_INDEX, 0);
    if (elevation(dude_obj == 0)) then begin
        if ((get_month >= 3) and (get_month < 5)) then begin
            if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                set_light_level(game_time_hour - 600 + 40);
            end
            else begin
                if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                    set_light_level(100);
                end
                else begin
                    if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                        set_light_level(100 - (game_time_hour - 1800));
                    end
                    else begin
                        set_light_level(40);
                    end
                end
            end
        end
        else begin
            if ((get_month >= 5) and (get_month < 9)) then begin
                if ((game_time_hour >= 500) and (game_time_hour < (500 + 100))) then begin
                    set_light_level(game_time_hour - 500 + 40);
                end
                else begin
                    if ((game_time_hour >= (500 + 100)) and (game_time_hour < 1900)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1900) and (game_time_hour < (1900 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1900));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
            else begin
                if ((get_month >= 9) and (get_month < 11)) then begin
                    if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                        set_light_level(game_time_hour - 600 + 40);
                    end
                    else begin
                        if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                            set_light_level(100);
                        end
                        else begin
                            if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                                set_light_level(100 - (game_time_hour - 1800));
                            end
                            else begin
                                set_light_level(40);
                            end
                        end
                    end
                end
                else begin
                    if ((game_time_hour >= 700) and (game_time_hour < (700 + 100))) then begin
                        set_light_level(game_time_hour - 700 + 40);
                    end
                    else begin
                        if ((game_time_hour >= (700 + 100)) and (game_time_hour < 1700)) then begin
                            set_light_level(100);
                        end
                        else begin
                            if ((game_time_hour >= 1700) and (game_time_hour < (1700 + 100))) then begin
                                set_light_level(100 - (game_time_hour - 1700));
                            end
                            else begin
                                set_light_level(40);
                            end
                        end
                    end
                end
            end
        end
    end
    else begin
        set_light_level(50);
    end
end

procedure map_update_p_proc
begin
    if (elevation(dude_obj == 0)) then begin
        if ((get_month >= 3) and (get_month < 5)) then begin
            if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                set_light_level(game_time_hour - 600 + 40);
            end
            else begin
                if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                    set_light_level(100);
                end
                else begin
                    if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                        set_light_level(100 - (game_time_hour - 1800));
                    end
                    else begin
                        set_light_level(40);
                    end
                end
            end
        end
        else begin
            if ((get_month >= 5) and (get_month < 9)) then begin
                if ((game_time_hour >= 500) and (game_time_hour < (500 + 100))) then begin
                    set_light_level(game_time_hour - 500 + 40);
                end
                else begin
                    if ((game_time_hour >= (500 + 100)) and (game_time_hour < 1900)) then begin
                        set_light_level(100);
                    end
                    else begin
                        if ((game_time_hour >= 1900) and (game_time_hour < (1900 + 100))) then begin
                            set_light_level(100 - (game_time_hour - 1900));
                        end
                        else begin
                            set_light_level(40);
                        end
                    end
                end
            end
            else begin
                if ((get_month >= 9) and (get_month < 11)) then begin
                    if ((game_time_hour >= 600) and (game_time_hour < (600 + 100))) then begin
                        set_light_level(game_time_hour - 600 + 40);
                    end
                    else begin
                        if ((game_time_hour >= (600 + 100)) and (game_time_hour < 1800)) then begin
                            set_light_level(100);
                        end
                        else begin
                            if ((game_time_hour >= 1800) and (game_time_hour < (1800 + 100))) then begin
                                set_light_level(100 - (game_time_hour - 1800));
                            end
                            else begin
                                set_light_level(40);
                            end
                        end
                    end
                end
                else begin
                    if ((game_time_hour >= 700) and (game_time_hour < (700 + 100))) then begin
                        set_light_level(game_time_hour - 700 + 40);
                    end
                    else begin
                        if ((game_time_hour >= (700 + 100)) and (game_time_hour < 1700)) then begin
                            set_light_level(100);
                        end
                        else begin
                            if ((game_time_hour >= 1700) and (game_time_hour < (1700 + 100))) then begin
                                set_light_level(100 - (game_time_hour - 1700));
                            end
                            else begin
                                set_light_level(40);
                            end
                        end
                    end
                end
            end
        end
    end
    else begin
        set_light_level(50);
    end
end

procedure checkPartyMembersNearDoor
begin
    if (party_member_obj(16777278) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777278)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777376) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777376)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777377) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777377)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777305) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777305)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777313) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777313)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777323) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777323)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777352) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777352)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777378) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777378)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777368) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777368)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777379) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777379)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777380) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777380)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777295) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777295)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777381) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777381)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777407) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777407)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777411) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777411)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777412) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777412)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777413) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777413)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777481) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777481)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777558) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777558)) <= 5) then begin
            return 1;
        end
    end
    if (party_member_obj(16777600) != 0) then begin
        if (tile_distance_objs(self_obj, party_member_obj(16777600)) <= 5) then begin
            return 1;
        end
    end
    return 0;
end

procedure Create_Chests_Sewer
begin
    variable LVar0 := 0;
    LVar0 := create_object(245, 17327, 1);
    if (LVar0) then begin
        if (random(1, 2) == 1) then begin
            add_mult_objs_to_inven(LVar0, create_object(40, 0, 0), random(1, 5));
        end
        if (random(1, 4) == 1) then begin
            if (get_pc_stat(PCSTAT_level) > 7) then begin
                add_obj_to_inven(LVar0, create_object(235, 0, 0));
            end
            else begin
                add_obj_to_inven(LVar0, create_object(160, 0, 0));
            end
        end
        item_caps_adjust(LVar0, 20 * random(1, dude_luck));
    end
    LVar0 := create_object(245, 15885, 1);
    if (LVar0) then begin
        if (random(1, 2) == 1) then begin
            add_mult_objs_to_inven(LVar0, create_object(40, 0, 0), random(1, 5));
        end
        if (random(1, 4) == 1) then begin
            if (get_pc_stat(PCSTAT_level) > 5) then begin
                add_obj_to_inven(LVar0, create_object(115, 0, 0));
            end
            else begin
                add_obj_to_inven(LVar0, create_object(10, 0, 0));
            end
        end
        item_caps_adjust(LVar0, 20 * random(dude_luck, dude_luck * dude_luck));
    end
    LVar0 := create_object(245, 20316, 2);
    if (LVar0) then begin
        if (random(1, 2) == 1) then begin
            if (get_pc_stat(PCSTAT_level) < 7) then begin
                add_mult_objs_to_inven(LVar0, create_object(25, 0, 0), random(1, 5));
            end
            else begin
                add_mult_objs_to_inven(LVar0, create_object(26, 0, 0), random(1, 5));
            end
        end
        if (random(1, 4) == 1) then begin
            if (get_pc_stat(PCSTAT_level) > 10) then begin
                add_obj_to_inven(LVar0, create_object(15, 0, 0));
            end
            else begin
                add_obj_to_inven(LVar0, create_object(10, 0, 0));
            end
        end
        item_caps_adjust(LVar0, 20 * random(dude_luck, dude_luck * dude_luck));
    end
    LVar0 := create_object(245, 20871, 2);
    if (LVar0) then begin
        if (random(1, 2) == 1) then begin
            if (get_pc_stat(PCSTAT_level) < 7) then begin
                add_mult_objs_to_inven(LVar0, create_object(25, 0, 0), random(1, 5));
            end
            else begin
                add_mult_objs_to_inven(LVar0, create_object(26, 0, 0), random(1, 5));
            end
        end
        if (random(1, 4) == 1) then begin
            if (get_pc_stat(PCSTAT_level) > 10) then begin
                add_obj_to_inven(LVar0, create_object(15, 0, 0));
            end
            else begin
                add_obj_to_inven(LVar0, create_object(10, 0, 0));
            end
        end
        item_caps_adjust(LVar0, 20 * random(dude_luck, dude_luck * dude_luck));
    end
end

procedure Create_Chests_Cave
begin
    variable LVar0 := 0;
    LVar0 := create_object(245, 19865, 1);
    if (LVar0) then begin
        if (random(1, 2) == 1) then begin
            add_mult_objs_to_inven(LVar0, create_object(40, 0, 0), random(1, 5));
        end
        if (random(1, 4) == 1) then begin
            if (get_pc_stat(PCSTAT_level) > 7) then begin
                add_obj_to_inven(LVar0, create_object(235, 0, 0));
            end
            else begin
                add_obj_to_inven(LVar0, create_object(160, 0, 0));
            end
        end
        item_caps_adjust(LVar0, 20 * random(1, dude_luck));
    end
    LVar0 := create_object(245, 28501, 1);
    if (LVar0) then begin
        if (random(1, 2) == 1) then begin
            add_mult_objs_to_inven(LVar0, create_object(40, 0, 0), random(1, 5));
        end
        if (random(1, 4) == 1) then begin
            if (get_pc_stat(PCSTAT_level) > 5) then begin
                add_obj_to_inven(LVar0, create_object(115, 0, 0));
            end
            else begin
                add_obj_to_inven(LVar0, create_object(10, 0, 0));
            end
        end
        item_caps_adjust(LVar0, 20 * random(dude_luck, dude_luck * dude_luck));
    end
    LVar0 := create_object(245, 20127, 1);
    if (LVar0) then begin
        if (random(1, 2) == 1) then begin
            if (get_pc_stat(PCSTAT_level) < 7) then begin
                add_mult_objs_to_inven(LVar0, create_object(25, 0, 0), random(1, 5));
            end
            else begin
                add_mult_objs_to_inven(LVar0, create_object(26, 0, 0), random(1, 5));
            end
        end
        if (random(1, 4) == 1) then begin
            if (get_pc_stat(PCSTAT_level) > 10) then begin
                add_obj_to_inven(LVar0, create_object(15, 0, 0));
            end
            else begin
                add_obj_to_inven(LVar0, create_object(10, 0, 0));
            end
        end
        item_caps_adjust(LVar0, 20 * random(dude_luck, dude_luck * dude_luck));
    end
    LVar0 := create_object(245, 12266, 1);
    if (LVar0) then begin
        if (random(1, 2) == 1) then begin
            if (get_pc_stat(PCSTAT_level) < 7) then begin
                add_mult_objs_to_inven(LVar0, create_object(25, 0, 0), random(1, 5));
            end
            else begin
                add_mult_objs_to_inven(LVar0, create_object(26, 0, 0), random(1, 5));
            end
        end
        if (random(1, 4) == 1) then begin
            if (get_pc_stat(PCSTAT_level) > 10) then begin
                add_obj_to_inven(LVar0, create_object(15, 0, 0));
            end
            else begin
                add_obj_to_inven(LVar0, create_object(10, 0, 0));
            end
        end
        item_caps_adjust(LVar0, 20 * random(dude_luck, dude_luck * dude_luck));
    end
end

procedure Create_Critters_Two
begin
    call Spawn_Critter(encounter_pid, 21267, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 21474, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 23676, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 21288, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 22888, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 24488, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 26294, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 25296, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 22895, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 22305, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 23903, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 25307, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 27303, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 27518, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 20914, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 22721, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 23113, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 25322, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 27333, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 25130, encounter_sid, 2);
    call Spawn_Critter(encounter_pid, 23735, encounter_sid, 2);
end

procedure Create_Critters_One
begin
    call Spawn_Critter(encounter_pid, 22661, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 22474, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 22888, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 24698, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 23103, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 21308, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 23119, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 21931, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 20740, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 18340, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 17331, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 17520, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 19319, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 20301, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 20487, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 20077, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 17863, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 17472, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 16878, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 16886, encounter_sid, 1);
end

procedure Create_Critters_Cave
begin
    call Spawn_Critter(encounter_pid, 28900, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 28510, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 25510, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 20329, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 21727, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 20066, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 21267, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 21078, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 22488, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 22901, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 21109, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 19108, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 16303, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 13083, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 16064, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 15671, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 13874, encounter_sid, 1);
    call Spawn_Critter(encounter_pid, 12665, encounter_sid, 1);
end

procedure Place_Critters_Sewer
begin
    call choose_pid_sid();
    call Create_Critters_One();
    call Create_Critters_Two();
    if (random(1, 100) >= (100 - dude_luck)) then begin
        call Create_Chests_Sewer();
    end
end

procedure Place_Critters_Cave
begin
    call choose_pid_sid();
    call Create_Critters_Cave();
    if (random(1, 100) >= (100 - dude_luck)) then begin
        call Create_Chests_Cave();
    end
end

procedure Place_Critters
begin
    call choose_pid_sid();
    if ((CUR_MAP_CAVE0) or (CUR_MAP_CAVE1) or (CUR_MAP_CAVE2) or (CUR_MAP_CAVE3) or (CUR_MAP_CAVE4) or (CUR_MAP_CAVE5)) then begin
        call Place_Critters_Cave();
    end
    else begin
        call Place_Critters_Sewer();
    end
end

procedure Place_Critters_MegaMod
begin
    call choose_pid_sid();
    if ((CUR_MAP_CITY1) or (CUR_MAP_CITY2) or (CUR_MAP_CITY3) or (CUR_MAP_CITY4) or (CUR_MAP_CITY5) or (CUR_MAP_CITY6) or (CUR_MAP_CITY7) or (CUR_MAP_CITY8)) then begin
        call Place_Critters_Sewer();
    end
end

procedure Pick_Gecko_PID
begin
    if ((get_pc_stat(PCSTAT_level) >= 1) and (get_pc_stat(PCSTAT_level) <= 5)) then begin
        picked := 16777296;
    end
    else begin
        if ((get_pc_stat(PCSTAT_level) >= 6) and (get_pc_stat(PCSTAT_level) <= 10)) then begin
            picked := 16777297;
        end
        else begin
            if ((get_pc_stat(PCSTAT_level) >= 11) and (get_pc_stat(PCSTAT_level) <= 15)) then begin
                picked := 16777299;
            end
            else begin
                if ((get_pc_stat(PCSTAT_level) >= 16) and (get_pc_stat(PCSTAT_level) <= 20)) then begin
                    picked := 16777302;
                end
                else begin
                    if ((get_pc_stat(PCSTAT_level) >= 21) and (get_pc_stat(PCSTAT_level) <= 25)) then begin
                        picked := 16777456;
                    end
                    else begin
                        if (get_pc_stat(PCSTAT_level) >= 26) then begin
                            picked := 16777457;
                        end
                    end
                end
            end
        end
    end
    return picked;
end

procedure Pick_Alien_PID
begin
    if ((get_pc_stat(PCSTAT_level) >= 1) and (get_pc_stat(PCSTAT_level) <= 25)) then begin
        picked := 16777458;
    end
    else begin
        if ((get_pc_stat(PCSTAT_level) >= 26) and (get_pc_stat(PCSTAT_level) <= 30)) then begin
            picked := 16777459;
        end
        else begin
            if ((get_pc_stat(PCSTAT_level) >= 31) and (get_pc_stat(PCSTAT_level) <= 35)) then begin
                picked := 16777464;
            end
            else begin
                if ((get_pc_stat(PCSTAT_level) >= 36) and (get_pc_stat(PCSTAT_level) <= 40)) then begin
                    picked := 16777462;
                end
                else begin
                    if ((get_pc_stat(PCSTAT_level) >= 41) and (get_pc_stat(PCSTAT_level) <= 45)) then begin
                        picked := 16777465;
                    end
                    else begin
                        if (get_pc_stat(PCSTAT_level) >= 46) then begin
                            picked := 16777463;
                        end
                    end
                end
            end
        end
    end
    return picked;
end

procedure Spawn_Critter(variable arg0, variable arg1, variable arg2, variable arg3)
begin
    critter_ptr := create_object_sid(arg0, 0, 0, arg2);
    critter_attempt_placement(critter_ptr, arg1, arg3);
    if (not(tile_contains_pid_obj(arg1, arg3, arg0))) then begin
        destroy_object(critter_ptr);
        if (CUR_MAP_BROKEN2) then begin
            if (arg3 == 1) then begin
                set_map_var(30, map_var(30) - 1);
            end
            else begin
                if (arg3 == 2) then begin
                    set_map_var(29, map_var(29) - 1);
                end
            end
        end
        else begin
            if (CUR_MAP_SFTANKER) then begin
                set_global_var(GVAR_BOZAR_UPGRADE_ONE, global_var(GVAR_BOZAR_UPGRADE_ONE) - 1);
            end
            else begin
                if (CUR_MAP_MODGARD) then begin
                    set_global_var(GVAR_MODOC_ORIGINAL_QUEST_DONE, global_var(GVAR_MODOC_ORIGINAL_QUEST_DONE) - 1);
                end
                else begin
                    if (CUR_MAP_REDDTUN) then begin
                        set_global_var(GVAR_REDDING_RESPAWN_TIMER, global_var(GVAR_REDDING_RESPAWN_TIMER) - 1);
                    end
                    else begin
                        if (CUR_MAP_REDMTUN) then begin
                            set_global_var(GVAR_ENTERED_MAIN, global_var(GVAR_ENTERED_MAIN) - 1);
                        end
                        else begin
                            if (CUR_MAP_REDWAN1) then begin
                                set_global_var(GVAR_REDDING_M_MOB_COUNTER, global_var(GVAR_REDDING_M_MOB_COUNTER) - 1);
                            end
                            else begin
                                if (CUR_MAP_ABANDON1) then begin
                                    if (arg3 == 0) then begin
                                        set_sfall_global("counter1", get_sfall_global_int("counter1") - 1);
                                    end
                                    else begin
                                        if (arg3 == 1) then begin
                                            set_sfall_global("counter2", get_sfall_global_int("counter2") - 1);
                                        end
                                    end
                                end
                                else begin
                                    if (CUR_MAP_ABANDON2) then begin
                                        if (arg3 == 0) then begin
                                            set_sfall_global("counter3", get_sfall_global_int("counter3") - 1);
                                        end
                                        else begin
                                            if (arg3 == 1) then begin
                                                set_sfall_global("counter4", get_sfall_global_int("counter4") - 1);
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end

procedure Pick_Tough_Ant_PID
begin
    variable LVar0 := 0;
    LVar0 := random(1, 3);
    if (LVar0 == 1) then begin
        picked := 16777864;
    end
    else begin
        if (LVar0 == 2) then begin
            picked := 16777865;
        end
        else begin
            if (LVar0 == 3) then begin
                picked := 16777599;
            end
        end
    end
    return picked;
end

procedure choose_pid_sid
begin
    if (get_sfall_global_int("nirran_1") == 0) then begin
        LVar0 := random(1, 13);
        if (LVar0 == 1) then begin
            if (get_pc_stat(PCSTAT_level) < 6) then begin
                encounter_pid := 16777296;
                encounter_sid := 615;
            end
            else begin
                if (get_pc_stat(PCSTAT_level) < 12) then begin
                    encounter_pid := 16777297;
                    encounter_sid := 615;
                end
                else begin
                    if (get_pc_stat(PCSTAT_level) < 13) then begin
                        encounter_pid := 16777456;
                        encounter_sid := 615;
                    end
                    else begin
                        encounter_pid := 16777457;
                        encounter_sid := 615;
                    end
                end
            end
        end
        else begin
            if (LVar0 == 2) then begin
                if (get_pc_stat(PCSTAT_level) < 5) then begin
                    encounter_pid := 16777299;
                    encounter_sid := 615;
                end
                else begin
                    if (get_pc_stat(PCSTAT_level) < 12) then begin
                        encounter_pid := 16777302;
                        encounter_sid := 615;
                    end
                    else begin
                        if (get_pc_stat(PCSTAT_level) < 13) then begin
                            encounter_pid := 16777456;
                            encounter_sid := 615;
                        end
                        else begin
                            encounter_pid := 16777457;
                            encounter_sid := 615;
                        end
                    end
                end
            end
            else begin
                if (LVar0 == 3) then begin
                    encounter_pid := 16777221;
                    encounter_sid := 616;
                end
                else begin
                    if (LVar0 == 4) then begin
                        encounter_pid := 16777222;
                        encounter_sid := 616;
                    end
                    else begin
                        if (LVar0 == 5) then begin
                            encounter_pid := 16777223;
                            encounter_sid := 22;
                        end
                        else begin
                            if (LVar0 == 6) then begin
                                encounter_pid := 16777224;
                                encounter_sid := 22;
                            end
                            else begin
                                if (LVar0 == 7) then begin
                                    encounter_pid := 16777333;
                                    encounter_sid := 617;
                                end
                                else begin
                                    if (LVar0 == 8) then begin
                                        encounter_pid := 16777334;
                                        encounter_sid := 617;
                                    end
                                    else begin
                                        if (LVar0 == 9) then begin
                                            if (get_pc_stat(PCSTAT_level) < 5) then begin
                                                encounter_pid := 16777296;
                                                encounter_sid := 615;
                                            end
                                            else begin
                                                if (get_pc_stat(PCSTAT_level) > 12) then begin
                                                    encounter_pid := 16777456;
                                                    encounter_sid := 615;
                                                end
                                                else begin
                                                    if (get_pc_stat(PCSTAT_level) > 15) then begin
                                                        encounter_pid := 16777457;
                                                        encounter_sid := 615;
                                                    end
                                                end
                                            end
                                        end
                                        else begin
                                            if (LVar0 == 10) then begin
                                                encounter_pid := 16777221;
                                                encounter_sid := 616;
                                            end
                                            else begin
                                                if (LVar0 == 11) then begin
                                                    encounter_pid := 16777223;
                                                    encounter_sid := 22;
                                                end
                                                else begin
                                                    if (LVar0 == 12) then begin
                                                        encounter_pid := 16777333;
                                                        encounter_sid := 617;
                                                    end
                                                    else begin
                                                        if (LVar0 == 13) then begin
                                                            if (get_pc_stat(PCSTAT_level) < 5) then begin
                                                                encounter_pid := 16777486;
                                                                encounter_sid := 625;
                                                            end
                                                            else begin
                                                                if (get_pc_stat(PCSTAT_level) < 11) then begin
                                                                    encounter_pid := 16777400;
                                                                    encounter_sid := 625;
                                                                end
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    else begin
        if (get_sfall_global_int("nirran_1") == 1) then begin
            if ((get_pc_stat(PCSTAT_level) >= 1) and (get_pc_stat(PCSTAT_level) <= 3)) then begin
                LVar0 := random(1, 100);
                if (LVar0 <= 50) then begin
                    encounter_pid := 16777227;
                    encounter_sid := 19;
                end
                else begin
                    LVar0 := random(1, 3);
                    if (LVar0 == 1) then begin
                        encounter_sid := 16777598;
                    end
                    else begin
                        if (LVar0 == 2) then begin
                            encounter_sid := 16777841;
                        end
                        else begin
                            if (LVar0 == 3) then begin
                                encounter_sid := 16777842;
                            end
                        end
                    end
                    encounter_sid := 19;
                end
            end
            else begin
                if ((get_pc_stat(PCSTAT_level) >= 4) and (get_pc_stat(PCSTAT_level) <= 6)) then begin
                    LVar0 := random(1, 100);
                    if (LVar0 <= 50) then begin
                        encounter_pid := 16777332;
                        encounter_sid := 19;
                    end
                    else begin
                        encounter_pid := 16777599;
                        encounter_sid := 19;
                    end
                end
                else begin
                    if ((get_pc_stat(PCSTAT_level) >= 7) and (get_pc_stat(PCSTAT_level) <= 8)) then begin
                        encounter_pid := 16777296;
                        encounter_sid := 615;
                    end
                    else begin
                        if ((get_pc_stat(PCSTAT_level) >= 9) and (get_pc_stat(PCSTAT_level) <= 10)) then begin
                            encounter_pid := 16777297;
                            encounter_sid := 615;
                        end
                        else begin
                            if ((get_pc_stat(PCSTAT_level) >= 11) and (get_pc_stat(PCSTAT_level) <= 15)) then begin
                                encounter_pid := 16777299;
                                encounter_sid := 615;
                            end
                            else begin
                                if ((get_pc_stat(PCSTAT_level) >= 16) and (get_pc_stat(PCSTAT_level) <= 20)) then begin
                                    encounter_pid := 16777302;
                                    encounter_sid := 615;
                                end
                                else begin
                                    if ((get_pc_stat(PCSTAT_level) >= 21) and (get_pc_stat(PCSTAT_level) <= 25)) then begin
                                        encounter_pid := 16777456;
                                        encounter_sid := 615;
                                    end
                                    else begin
                                        if ((get_pc_stat(PCSTAT_level) >= 26) and (get_pc_stat(PCSTAT_level) <= 30)) then begin
                                            encounter_pid := 16777457;
                                            encounter_sid := 615;
                                        end
                                        else begin
                                            if ((get_pc_stat(PCSTAT_level) >= 31) and (get_pc_stat(PCSTAT_level) <= 35)) then begin
                                                encounter_pid := 16777458;
                                                encounter_sid := 790;
                                            end
                                            else begin
                                                if ((get_pc_stat(PCSTAT_level) >= 36) and (get_pc_stat(PCSTAT_level) <= 40)) then begin
                                                    encounter_pid := 16777459;
                                                    encounter_sid := 790;
                                                end
                                                else begin
                                                    if ((get_pc_stat(PCSTAT_level) >= 41) and (get_pc_stat(PCSTAT_level) <= 45)) then begin
                                                        encounter_pid := 16777464;
                                                        encounter_sid := 790;
                                                    end
                                                    else begin
                                                        if ((get_pc_stat(PCSTAT_level) >= 46) and (get_pc_stat(PCSTAT_level) <= 50)) then begin
                                                            encounter_pid := 16777462;
                                                            encounter_sid := 790;
                                                        end
                                                        else begin
                                                            if ((get_pc_stat(PCSTAT_level) >= 51) and (get_pc_stat(PCSTAT_level) <= 55)) then begin
                                                                encounter_pid := 16777465;
                                                                encounter_sid := 790;
                                                            end
                                                            else begin
                                                                if ((get_pc_stat(PCSTAT_level) >= 56) and (get_pc_stat(PCSTAT_level) <= 99)) then begin
                                                                    encounter_pid := 16777463;
                                                                    encounter_sid := 790;
                                                                end
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end
